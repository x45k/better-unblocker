/*hammerhead|script|start*/if (typeof window !== 'undefined' && window){window['hammerhead|process-dom-method'] && window['hammerhead|process-dom-method']();if (window.__get$ && typeof __get$ === 'undefined')var __get$Loc = window.__get$Loc,__set$Loc = window.__set$Loc,__set$ = window.__set$,__get$ = window.__get$,__call$ = window.__call$,__get$Eval = window.__get$Eval,__proc$Script = window.__proc$Script,__proc$Html = window.__proc$Html,__get$PostMessage = window.__get$PostMessage,__get$ProxyUrl = window.__get$ProxyUrl,__rest$Array = window.__rest$Array,__rest$Object = window.__rest$Object,__arrayFrom$ = window.__arrayFrom$;} else {if (typeof __get$ === 'undefined')var __get$Loc = function(l){return l},__set$Loc = function(l,v){return l = v},__set$ = function(o,p,v){return o[p] = v},__get$ = function(o,p){return o[p]},__call$ = function(o,p,a){return o[p].apply(o,a)},__get$Eval = function(e){return e},__proc$Script = function(s){return s},__proc$Html = function(h){return h},__get$PostMessage = function(w,p){return arguments.length===1?w.postMessage:p},__get$ProxyUrl = function(u,d){return u},__rest$Array = function(a,i){return Array.prototype.slice.call(a, i)},__rest$Object = function(o,p){var k=Object.keys(o),n={};for(var i=0;i<k.length;++i)if(p.indexOf(k[i])<0)n[k[i]]=o[k[i]];return n},__arrayFrom$ = function(r){if(!r)return r;return!Array.isArray(r)&&"function"==typeof r[Symbol.iterator]?Array.from(r):r};if (typeof importScripts !== "undefined" && /\[native code]/g.test(importScripts.toString())) {var __getWorkerSettings$ = function () {return null};importScripts((location.origin || (location.protocol + "//" + location.host)) + "/worker-hammerhead.js");}}/*hammerhead|script|processing-header-end*/
window.sc.getESLInstance().addEslConfig({paths:{"js/cosmic.pc.lsZm6d5C":"//ms.bdstatic.com/se/chat-search/static/js/cosmic.pc.lsZm6d5C","js/cosmic-agent-ui.pc.Dxc4Elaq":"//ms.bdstatic.com/se/chat-search/static/js/cosmic-agent-ui.pc.Dxc4Elaq","js/search-components.pc.BE62d8-q":"//ms.bdstatic.com/se/chat-search/static/js/search-components.pc.BE62d8-q","js/share-img-utils.pc.KeJdRRYE":"//ms.bdstatic.com/se/chat-search/static/js/share-img-utils.pc.KeJdRRYE","js/bootstrap.pc.IMX_qn6-":"//ms.bdstatic.com/se/chat-search/static/js/bootstrap.pc.IMX_qn6-","js/baidubce-sdk.bundle.min.pc.DiNU-FrE":"//ms.bdstatic.com/se/chat-search/static/js/baidubce-sdk.bundle.min.pc.DiNU-FrE","js/echarts.pc.D2eWkmUa":"//ms.bdstatic.com/se/chat-search/static/js/echarts.pc.D2eWkmUa","js/artplayer.pc.HVd1QnTR":"//ms.bdstatic.com/se/chat-search/static/js/artplayer.pc.HVd1QnTR","js/jsencrypt.min.pc.CIS6xxmc":"//ms.bdstatic.com/se/chat-search/static/js/jsencrypt.min.pc.CIS6xxmc","js/index.pc.DihnYmlG":"//ms.bdstatic.com/se/chat-search/static/js/index.pc.DihnYmlG","js/qeditor.pc.N-rbs8Tu":"//ms.bdstatic.com/se/chat-search/static/js/qeditor.pc.N-rbs8Tu","js/client.esm.pc.CgpQ51lf":"//ms.bdstatic.com/se/chat-search/static/js/client.esm.pc.CgpQ51lf","js/crypto.pc.DP5BwNok":"//ms.bdstatic.com/se/chat-search/static/js/crypto.pc.DP5BwNok","js/cosmic":"//ms.bdstatic.com/se/chat-search/static/js/cosmic.pc.lsZm6d5C"}}),define("js/bootstrap.pc.IMX_qn6-",["require","./cosmic","./search-components.pc.BE62d8-q","san","@baidu/chat-stream","@baidu/boxx","./cosmic-agent-ui.pc.Dxc4Elaq","lottie-web","@baidu/marklang","@baidu/video-controller"],(function(t,e,n,a,i,o,r,s,l,c){"use strict";function d(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,a.get?a:{enumerable:!0,get:function(){return  __get$(t,n) }})}})),e.default=t,Object.freeze(e)}function u(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return  __get$(e,n) }})}}))})),Object.freeze(t)}var p=function(t,e){var n,a;return p=Object.setPrototypeOf||(n={__proto__:[]},(null!=(a=Array)&&"undefined"!=typeof Symbol&& __get$(a,Symbol.hasInstance) ?!! __call$(a,Symbol.hasInstance,[n]) :n instanceof a)&&function(t,e){t.__proto__=e})||function(t,e){for(var n in e)e.hasOwnProperty(n)&&( __set$(t,n,__get$(e,n)) )},p(t,e)};var h=function(){return h=Object.assign||function(t){for(var e,n=1,a=Array.from(arguments).length;n<a;n++)for(var i in e= __get$(Array.from(arguments),n) )Object.prototype.hasOwnProperty.call(e,i)&&( __set$(t,i,__get$(e,i)) );return t},h.apply(this,Array.from(arguments))};function f(){for(var t=[],e=0;e<Array.from(arguments).length;e++) __set$(t,e,__get$(Array.from(arguments),e)) ;var n=Object.assign||function(t){for(var e=void 0,n=1,a=Array.from(arguments).length;n<a;n++)for(var i in e= __get$(Array.from(arguments),n) )Object.prototype.hasOwnProperty.call(e,i)&&( __set$(t,i,__get$(e,i)) );return t};return n.apply(this,t)}function g(t){var e=function(t){if(URL&&t)try{var e=new URL(t);if(void 0!==e.host)return{protocol:e.protocol,host:e.host,pathname:e.pathname,ext:""}}catch(t){console.error(t)}}(t);if(!e){var n=document.createElement("a"); __set$(n,"href",t) ,e={protocol:n.protocol,host:n.host|| __get$Loc(location) .host,pathname:n.pathname,ext:""}}var a=e.pathname.split(".");return e.ext= __get$(a,a.length-1) ,e}function m(t){return+t.toFixed(1)}function v(t){if(!t)return{xpath:""};for(var e=[];t&&1===t.nodeType&&t!==t.parentNode;){var n=t.tagName.toLowerCase();if(t.getAttribute("id")?n+="[#"+t.getAttribute("id")+"]":t.classList&&t.classList.length&&(n+="[."+ __get$(t.classList,t.classList.length-1) +"]"),e.push(n),t===document.body)break;t=t.parentNode}return{xpath:e.join("<")}}var y=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?)_/):"",w=y&&y[2]&&+y[2]<14;function b(t){console.error("[SpyClient_log]"+t)}function _(t){return Object.keys(t).map((function(e){var n= __get$(t,e) ;return void 0===n?n="":"string"!=typeof n&&(n=JSON.stringify(n)),encodeURIComponent(e)+"="+encodeURIComponent(n)})).join("&")}function k(t){return"[object Array]"===Object.prototype.toString.call(t)}var S=function(){function t(t){if(this.sample={},this.markCache={},!t.pid)throw new Error("pid is required");this.option={pid:t.pid,lid:t.lid,check:!1!==t.check,sample:t.sample,localCache:t.localCache,logServer:t.logServer||"https://sp1.baidu.com/5b1ZeDe5KgQFm2e88IuM_a/mwb2.gif?"}}return t.prototype.handle=function(t){if(this.check(t)){if(t=f({pid:this.option.pid,lid:this.option.lid,ts:Date.now(),group:"common"},t),this.option.localCache&&this.option.localCache.addLog(t),"number"==typeof t.sample){if(Math.random()>t.sample)return}else if("number"==typeof this.option.sample&&Math.random()>this.option.sample)return;return delete t.sample,t}},t.prototype.send=function(t,e){void 0===e&&(e=!1);for(var n=[],a=0,i=k(t)?t:[t];a<i.length;a++){var o= __get$(i,a) ;if((o=this.handle(o))&&(n.push(o),!e)){var r=this.option.logServer+_(o);this.request(r)}}e&&this.sendPost(n)},t.prototype.check=function(t){if(!this.option.check)return!0;var e=["perf","except","dist","count"];if(-1===e.indexOf(t.type))return b("type only is one of "+e.join(", ")),!1;if(t.group&&t.group.length>30)return b("group length execeeds 30"),!1;var n=/^[a-zA-Z0-9-_]{0,30}$/;if("except"===t.type){if("string"!=typeof t.info.msg||!t.info.msg.length)return b("info.msg field must be not empty and is String"),!1}else for(var a=0,i=Object.keys(t.info);a<i.length;a++){var o= __get$(i,a) ;if(!n.test(o))return b("info."+o+" is unexpected. Length must be not more than 30. Supported chars: a-zA-Z0-9-_"),!1;var r= __get$(t.info,o) ;if("dist"===t.type){if(r.length>30)return b("info."+o+" value length execeeds 30 when type == 'dist'"),!1}else if("number"!=typeof r)return b("info."+o+" value must be number"),!1}if(t.dim)for(var s=0,l=Object.keys(t.dim);s<l.length;s++){var c= __get$(l,s) ;if(!n.test(c))return b("dim key ["+c+"] is unexpected. Length must be not more than 30. Supported chars: a-zA-Z0-9-_"),!1;var d= __get$(t.dim,c) ;if(!/^[a-zA-Z0-9\-_\*\.\s\/#\+@\&\u4e00-\u9fa5]{0,30}$/.test(d))return b("dim."+c+" value ["+d+"] is unexpected. Length must be not more than 30. Supported chars: a-zA-Z0-9-_*. /#+@& and Chinese"),!1}return!0},t.prototype.sendPerf=function(t){this.send(f({type:"perf"},t))},t.prototype.sendExcept=function(t){this.send(f({type:"except"},t))},t.prototype.sendDist=function(t){this.send(f({type:"dist"},t))},t.prototype.sendCount=function(t){this.send(f({type:"count"},t))},t.prototype.sendExceptForError=function(t,e){var n=f({},e);n.info=f({},e.info||{},{msg:t.message,stack:t.stack}),this.sendExcept(n)},t.prototype.startMark=function(t){ __set$(this.markCache,t,{start:Date.now()}) },t.prototype.endMark=function(t){return  __get$(this.markCache,t) ?( __get$(this.markCache,t) .total=Date.now()- __get$(this.markCache,t) .start, __get$(this.markCache,t) .total):0},t.prototype.clearMark=function(t){ __get$(this.markCache,t) &&delete this.markCache[t]},t.prototype.getAllMark=function(){for(var t={},e=0,n=Object.keys(this.markCache);e<n.length;e++){var a= __get$(n,e) ; __set$(t,a,__get$(this.markCache,a).total) }return t},t.prototype.clearAllMark=function(){this.markCache={}},t.prototype.sendPost=function(t){var e=(k(t)?t:[t])[0],n={pid:e.pid,type:e.type,group:e.group},a=this.option.logServer+_(n);this.request(a,t)},t.prototype.request=function(t,e){!w&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(t,e?JSON.stringify(e):void 0)||(e?this.fetch(t,e):(new Image).src=t)},t.prototype.fetch=function(t,e){fetch?fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}):b("Global fetch method doesn't exist")},t}(),x=window.__spyHead,I="first-input",T=function(){function t(){var t=this;if(this.observer=null,window.PerformanceObserver){x&&x.entryMap&& __get$(x.entryMap,I) &&this.handle( __get$(x.entryMap,I) );try{this.observer=new PerformanceObserver((function(e){t.handle(e.getEntries())})),this.observer.observe({entryTypes:[I]})}catch(t){}}}return t.prototype.listenFID=function(t){this.cb=t,this.callCB()},t.prototype.callCB=function(){void 0!==this.finalValue&&this.cb&&this.cb({fid:this.finalValue})},t.prototype.destroy=function(){this.observer&&this.observer.disconnect(),this.observer=null},t.prototype.handle=function(t){var e=t.pop();e&&(this.finalValue=e.duration,this.callCB(),this.destroy())},t}(),C=window.__spyHead,L="layout-shift",D=function(){function t(){var t=this;if(this.observer=null,this.onceLeave=!1,window.PerformanceObserver){C&&C.entryMap&& __get$(C.entryMap,L) &&this.handle( __get$(C.entryMap,L) );try{this.observer=new PerformanceObserver((function(e){t.handle(e.getEntries())})),this.observer.observe({entryTypes:[L]})}catch(t){}}}return t.prototype.listenLayoutShift=function(t){this.cb=t},t.prototype.leave=function(){this.onceLeave||(this.onceLeave=!0,this.observer&&this.observer.takeRecords&&this.observer.takeRecords(),this.finalValue=this.value,this.callCB(),this.destroy())},t.prototype.callCB=function(){void 0!==this.finalValue&&this.cb&&this.cb({layoutShift:this.finalValue})},t.prototype.destroy=function(){this.observer&&this.observer.disconnect(),this.observer=null},t.prototype.handle=function(t){var e=this;t.map((function(t){t.hadRecentInput||(e.value=(e.value||0)+(t.value||0))}))},t}(),P={};function E(t){return  __get$(P,t) }var A=window.__spyHead,O="largest-contentful-paint",R=function(){function t(){var t=this;if(this.observer=null,window.PerformanceObserver){A&&A.entryMap&& __get$(A.entryMap,O) &&this.handle( __get$(A.entryMap,O) );try{this.observer=new PerformanceObserver((function(e){t.handle(e.getEntries())})),this.observer.observe({entryTypes:[O]})}catch(t){}}}return t.prototype.listenLCP=function(t){this.cb=t,this.callCB()},t.prototype.callCB=function(){this.finalValue&&this.cb&&this.cb({lcp:this.finalValue})},t.prototype.load=function(){var t,e;this.observer&&this.observer.takeRecords&&this.observer.takeRecords(),this.finalValue=this.value,t="lcp",e=this.value, __set$(P,t,e) ,this.callCB(),this.destroy()},t.prototype.destroy=function(){this.observer&&this.observer.disconnect(),this.observer=null},t.prototype.handle=function(t){var e=this;t.map((function(t){e.value=t.renderTime||t.loadTime}))},t}();function N(t){return t.name.indexOf(".gif?")<0}var M,q,j=function(){function t(){this.lastLongTask=0,this.observer=null,this.interval=5e3,this.filterRequest=N,this.observerCallback=this.observerCallback.bind(this),this.ttiCheck=this.ttiCheck.bind(this)}return t.prototype.check=function(){return window.PerformanceObserver&&performance&&performance.timing&&performance.timing.navigationStart},t.prototype.listenTTI=function(t,e){this.check()&&(this.observeLongtask(2e4),this.cb=t,(e=e||{}).interval&&(this.interval=e.interval),e.filterRequest&&(this.filterRequest=e.filterRequest))},t.prototype.load=function(){this.check()&&(this.ttiTimer=setInterval(this.ttiCheck,this.interval))},t.prototype.ttiCheck=function(){if(this.cb){var t=performance.now();if(!(t-this.lastLongTask<this.interval)){var e=this.getNetworkSilenceAt();if(!1!==e&&!(t-e<this.interval)){clearTimeout(this.ttiTimer);var n=this.lastLongTask;n||(n=performance.timing.domContentLoadedEventEnd-performance.timing.navigationStart),this.stopObserveLongTask(),this.cb({tti:n})}}}},t.prototype.observerCallback=function(t){var e=t.getEntries(),n= __get$(e,e.length-1) ;this.lastLongTask=n.startTime+n.duration},t.prototype.stopObserveLongTask=function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.stopLongTaskTimeoutId&&clearTimeout(this.stopLongTaskTimeoutId)},t.prototype.getNetworkSilenceAt=function(){for(var t=0,e=0,n=performance.getEntriesByType("resource").filter(this.filterRequest);e<n.length;e++){var a= __get$(n,e) ;if(!a.responseEnd)return!1;a.responseEnd>t&&(t=a.responseEnd)}return t},t.prototype.observeLongtask=function(t){this.stopObserveLongTask();try{this.observer=new PerformanceObserver(this.observerCallback),this.observer.observe({entryTypes:["longtask"]}),this.stopLongTaskTimeoutId=setTimeout(this.stopObserveLongTask,t)}catch(t){}},t}(),B=function(){function t(){}return t.prototype.listenTiming=function(t){window.performance&&window.performance.timing&&(this.cb=t)},t.prototype.load=function(){var t=this;setTimeout((function(){t.cb&&t.cb(t.getMetric())}),500)},t.prototype.getMetric=function(){var t={},e=window.performance.timing,n=e.navigationStart;if(t.dns=e.domainLookupEnd-e.domainLookupStart,t.tcp=e.connectEnd-e.connectStart,t.request=e.responseStart-e.requestStart,t.response=e.responseEnd-e.responseStart,t.parseHtml=e.domInteractive-e.domLoading,t.domReady=e.domContentLoadedEventEnd-n,t.loadEventHandle=e.loadEventEnd-e.loadEventStart,t.load=e.loadEventEnd-n,performance.getEntriesByType){var a=performance.getEntriesByType("paint");a&&a.length&&a.forEach((function(e){var n=e.name,a=e.duration,i=e.startTime,o=Math.ceil(a+i);"first-paint"===n&&(t.fp=o),"first-contentful-paint"===n&&(t.fcp=o)}))}return e.domFirstPaint&&(t.t7FirstPaint=e.domFirstPaint-n),e.domFirstScreenPaint&&(t.t7FirstScreen=e.domFirstScreenPaint-n),t},t}();!function(t){t.JS="js",t.CSS="css",t.IMG="img",t.FONT="font"}(M||(M={})),function(t){ __set$(t,t.ttf=0,"ttf") , __set$(t,t.eot=1,"eot") , __set$(t,t.woff=2,"woff") , __set$(t,t.woff2=3,"woff2") }(q||(q={}));var H=["/mwb2.gif"];function $(t,e){for(var n=0,a=e;n<a.length;n++){var i= __get$(a,n) ;if(t.indexOf(i)>-1)return!0}return!1}function F(t){return+t.toFixed(1)}var U=function(){function t(){this.trigger="load",this.jsList=[],this.cssList=[],this.imgList=[],this.fontList=[],this.hostList={},this.bigImgList={},this.httpResList={},this.slowList={},this.resOption={ignorePaths:[],trigger:"load"},this.bigImgOption={ignorePaths:[],maxSize:153600,trigger:"load"},this.httpResOption={ignorePaths:[],trigger:"load"},this.slowOption={ignorePaths:[],trigger:"load",threshold:1e3}}return t.prototype.check=function(){return performance&&performance.getEntriesByType},t.prototype.listenResource=function(t,e){void 0===e&&(e={}),this.check()&&(this.resOption=f(this.resOption,e),this.trigger=this.resOption.trigger,this.cb=t)},t.prototype.listenBigImg=function(t,e){void 0===e&&(e={}),this.check()&&(this.bigImgOption=f(this.bigImgOption,e),this.trigger=this.bigImgOption.trigger,this.bigImgCB=t)},t.prototype.listenHttpResource=function(t,e){void 0===e&&(e={}),this.check()&&(this.httpResOption=f(this.httpResOption,e),this.trigger=this.httpResOption.trigger,this.httpResCB=t)},t.prototype.listenSlowResource=function(t,e){void 0===e&&(e={}),this.check()&&(this.slowOption=f(this.slowOption,e),this.trigger=this.slowOption.trigger,this.slowResCB=t)},t.prototype.report=function(){var t=this,e=this.getMetric();if(e){var n=e.metric,a=e.hostMetric;this.cb&&this.cb(n,a)}this.bigImgCB&&"function"==typeof window.requestIdleCallback&&Object.keys(this.bigImgList).length&&window.requestIdleCallback((function(){for(var e=0,n=Object.keys(t.bigImgList);e<n.length;e++)for(var a= __get$(n,e) ,i=0,o= __get$(t.bigImgList,a) ;i<o.length;i++){var r= __get$(o,i) ,s=r.timing,l=r.type;try{var c=document.body.querySelector('img[src="'+s.name+'"]');t.bigImgCB({msg:s.name,dur:s.duration,xpath:v(c).xpath,host:a,type:l})}catch(t){console.error(t)}}})),this.httpResCB&&"function"==typeof window.requestIdleCallback&&Object.keys(this.httpResList).length&&window.requestIdleCallback((function(){for(var e=0,n=Object.keys(t.httpResList);e<n.length;e++)for(var a= __get$(n,e) ,i=0,o= __get$(t.httpResList,a) ;i<o.length;i++){var r= __get$(o,i) ,s=r.timing,l=r.type;try{var c=document.body.querySelector('[src="'+s.name+'"]');t.httpResCB({msg:s.name,dur:s.duration,xpath:v(c).xpath,host:a,type:l})}catch(t){console.error(t)}}})),this.slowResCB&&"function"==typeof window.requestIdleCallback&&Object.keys(this.slowList).length&&window.requestIdleCallback((function(){for(var e=0,n=Object.keys(t.slowList);e<n.length;e++)for(var a= __get$(n,e) ,i=0,o= __get$(t.slowList,a) ;i<o.length;i++){var r= __get$(o,i) ,s=r.timing,l=r.type;try{var c=document.body.querySelector('[src="'+s.name+'"]'),d={wait:m((u=s).domainLookupStart-(u.navigationStart||u.fetchStart||u.startTime)),dns:m(u.domainLookupEnd-u.domainLookupStart),connect:m(u.connectEnd-u.connectStart),req:m(u.responseStart-u.requestStart),res:m(u.responseEnd-u.responseStart)};t.slowResCB(h(h({},d),{dur:s.duration,msg:s.name,xpath:v(c).xpath,host:a,type:l}))}catch(t){console.error(t)}}var u}))},t.prototype.load=function(){var t=this;"load"===this.trigger&&this.check()&&setTimeout((function(){t.report()}),500)},t.prototype.leave=function(){"leave"===this.trigger&&this.report()},t.prototype.push=function(t,e,n,a){$(a.pathname,this.resOption.ignorePaths||[])||(e.push(n),this.pushWithHost(t,this.hostList,n,a)),$(a.pathname,this.slowOption.ignorePaths||[])||n.duration>this.slowOption.threshold&&this.pushWithHost(t,this.slowList,n,a)},t.prototype.pushWithHost=function(t,e,n,a){var i=a.host; __get$(e,i) ||( __set$(e,i,[]) ), __get$(e,i) .push({timing:n,type:t})},t.prototype.collectHttpResInHttps=function(t,e,n){"https:"!== __get$Loc(location) .protocol||0!==e.name.indexOf("http://")||$(n.pathname,this.httpResOption.ignorePaths||[])||this.pushWithHost(t,this.httpResList,e,n)},t.prototype.addScript=function(t,e){"js"===e.ext&&0!==t.decodedBodySize&&this.push("js",this.jsList,t,e)},t.prototype.addResFromCss=function(t,e){e.ext&&q.hasOwnProperty(e.ext)?this.push("font",this.fontList,t,e):this.addImg(t,e)},t.prototype.addLink=function(t,e){"css"===e.ext?this.push("css",this.cssList,t,e):"js"===e.ext&&this.push("js",this.jsList,t,e)},t.prototype.addImg=function(t,e){this.push("img",this.imgList,t,e),t.decodedBodySize>(this.bigImgOption.maxSize||0)&&!$(e.pathname,this.bigImgOption.ignorePaths||[])&&this.pushWithHost("img",this.bigImgList,t,e)},t.prototype.handleTimings=function(t){for(var e=t.length,n=0;n<e;n++){var a= __get$(t,n) ,i=g(a.name);if(!$(i.pathname,H))switch( __get$(t,n) .initiatorType){case"script":this.addScript(a,i);break;case"css":this.addResFromCss(a,i);break;case"img":this.addImg(a,i);break;case"link":this.addLink(a,i);break;case"audio":this.collectHttpResInHttps("audio",a,i);break;case"video":this.collectHttpResInHttps("video",a,i)}}},t.prototype.getNumAndSize=function(t,e){var n={},a=t+"Num",i=t+"Size",o=t+"TransferSize",r=t+"CacheRate",s=t+"Duration"; __set$(n,a,0) , __set$(n,i,0) , __set$(n,o,0) ;var l=0;if(e.forEach((function(t){n[a]++, __set$(n,i,__get$(n,i)+t.decodedBodySize/1024) , __set$(n,o,__get$(n,o)+t.transferSize/1024) ,l+=t.duration})), __set$(n,s,F(__get$(n,a)>0?l/__get$(n,a):0)) , __get$(n,i) ){var c= __get$(n,i) - __get$(n,o) ; __set$(n,r,F(c>=0?100*c/__get$(n,i):0)) }return  __set$(n,i,F(__get$(n,i))) , __set$(n,o,F(__get$(n,o))) ,n},t.prototype.getMetric=function(){var t=performance.getEntriesByType("navigation")[0],e=performance.getEntriesByType("resource");if(t&&e&&e.length){this.handleTimings(e);var n=h(h(h(h({},this.getNumAndSize(M.JS,this.jsList)),this.getNumAndSize(M.CSS,this.cssList)),this.getNumAndSize(M.IMG,this.imgList)),this.getNumAndSize(M.FONT,this.fontList)),a=t;n.docSize=F(a.decodedBodySize/1024),n.docTransferSize=F(a.transferSize/1024),n.headerSize=F((a.transferSize-a.encodedBodySize||0)/1024),n.allSize=F(n.docSize+n.jsSize+n.cssSize+n.imgSize+n.fontSize),n.allTransferSize=F(n.docTransferSize+n.jsTransferSize+n.cssTransferSize+n.imgTransferSize+n.fontTransferSize);for(var i={},o=0,r=Object.keys(this.hostList);o<r.length;o++){var s= __get$(r,o) ,l= __get$(this.hostList,s) .map((function(t){return t.timing})); __set$(i,s,this.getNumAndSize("host",l)) }return{metric:n,hostMetric:i}}},t}(),G=null;window.performance&&window.performance.memory&&(G=window.performance.memory);var W,z=function(){function t(){this.onceLeave=!1}return t.prototype.listenMemory=function(t){this.cb=t},t.prototype.leave=function(){if(!this.onceLeave&&G){this.onceLeave=!0;var t=window.performance.memory;if(t.usedJSHeapSize===G.usedJSHeapSize&&t.totalJSHeapSize===G.totalJSHeapSize)return;var e=window.performance.memory;this.cb&&this.cb({usedJSHeapSize:e.usedJSHeapSize/1024,totalJSHeapSize:e.totalJSHeapSize/1024,jsHeapSizeLimit:e.jsHeapSizeLimit/1024,usedJSHeapRate:100*e.usedJSHeapSize/e.totalJSHeapSize})}},t}(),Q=function(){function t(){}return t.prototype.getNavigatorInfo=function(){var t,n={},a=navigator.connection;return"object"===(void 0===a?"undefined":(t=a)&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":e._typeof(t))&&(n={downlink:a.downlink,effectiveType:a.effectiveType,rtt:a.rtt,saveData:!!a.saveData}),navigator.deviceMemory&&(n.deviceMemory=navigator.deviceMemory),navigator.hardwareConcurrency&&(n.hardwareConcurrency=navigator.deviceMemory),n},t.prototype.load=function(){},t}(),J=window.__spyHead,V="longtask",K=function(){function t(){var t=this;this.lts=[],this.observer=null,this.onceLeave=!1,J&&J.entryMap&& __get$(J.entryMap,V) &&(this.lts=this.lts.concat( __get$(J.entryMap,V) ));try{this.observer=new PerformanceObserver((function(e){t.lts=t.lts.concat(e.getEntries())})),this.observer.observe({entryTypes:[V]})}catch(t){}}return t.prototype.check=function(){return window.PerformanceObserver&&performance&&performance.timing&&performance.timing.navigationStart},t.prototype.listenFSPLongTask=function(t){this.check()&&(this.fspCB=t)},t.prototype.listenLCPLongTask=function(t){this.check()&&(this.lcpCB=t)},t.prototype.listenLoadLongTask=function(t){this.check()&&(this.loadCB=t)},t.prototype.listenPageLongTask=function(t){this.check()&&(this.pageCB=t)},t.prototype.load=function(){var t=this;if(this.check()){var e=this.getStatData(Date.now());setTimeout((function(){if(t.loadCB&&t.loadCB({loadLongtaskTime:e.time,loadTBT:e.tbt,loadTotalTime:e.totalTime,loadLongtaskRate:e.rate,loadLongtaskNum:e.num}),performance.timing&&performance.timing.domFirstScreenPaint){var n=t.getStatData(performance.timing.domFirstScreenPaint);t.fspCB&&t.fspCB({fspLongtaskTime:n.time,fspTBT:n.tbt,fspTotalTime:n.totalTime,fspLongtaskRate:n.rate,fspLongtaskNum:n.num})}if(E("lcp")){var a=t.getStatData(performance.timing.navigationStart+E("lcp"));t.lcpCB&&t.lcpCB({lcpLongtaskTime:a.time,lcpTBT:a.tbt,lcpTotalTime:a.totalTime,lcpLongtaskRate:a.rate,lcpLongtaskNum:a.num})}}),200)}},t.prototype.leave=function(){if(!this.onceLeave){this.onceLeave=!0;var t=this.getStatData(Date.now());this.pageCB&&this.pageCB({pageLongtaskTime:t.time,pageTBT:t.tbt,pageTotalTime:t.totalTime,pageLongtaskRate:t.rate,pageLongtaskNum:t.num,pageIframeLongtaskTime:t.iframeTime,pageIframeLongtaskRate:t.iframeRate,pageIframeLongtaskNum:t.iframeNum})}},t.prototype.destroy=function(){this.lts=[],this.observer&&this.observer.disconnect(),this.observer=null},t.prototype.getStatData=function(t){for(var e=performance.timing.navigationStart,n=0,a=0,i=0,o=0,r=0,s={},l=0;l<this.lts.length;l++){var c= __get$(this.lts,l) ,d=c.duration;if(e+c.startTime+d<t&&(n+=d,a+=d-50>0?d-50:0,i++,c.attribution&&c.attribution[0])){var u=c.attribution[0].containerSrc;u&&u!== __get$(__get$Loc(location),"href") &&( __get$(s,u) ||( __set$(s,u,[]) ), __get$(s,u) .push(d),o+=d,r++)}}var p=t-e;return{num:i,time:n,tbt:a,totalTime:p,rate:100*n/p,iframeTime:o,iframeNum:r,iframeRate:100*o/p,iframeLongtasks:s}},t}(),X=function(t){function e(e){var n=t.call(this,e)||this;return n.modules=[],n.register(new T),n.register(new R),n.register(new D),n.register(new j),n.register(new B),n.register(new U),n.register(new z),n.register(new Q),n.register(new K),n.visibilitychangeCB=n.visibilitychangeCB.bind(n),n.load=n.load.bind(n),n.leave=n.leave.bind(n),"complete"===document.readyState?n.load():window.addEventListener("load",n.load),document.addEventListener("visibilitychange",n.visibilitychangeCB),window.addEventListener("beforeunload",n.leave,!1),window.addEventListener("unload",n.leave,!1),n.handleHead(),n}return function(t,e){function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.handleHead=function(){var t=this;if(this.option.localCache){var e=window.__spyHead;if(e&&e.winerrors){for(var n=0;n<e.winerrors.length;n++){var a= __get$(e.winerrors,n) ;this.option.localCache.addLog(a)}e.interceptor=function(e){t.option.localCache.addLog(e)}}}},e.prototype.listenFID=function(t){this.invoke("listenFID",t)},e.prototype.listenLayoutShift=function(t){this.invoke("listenLayoutShift",t)},e.prototype.listenLCP=function(t){this.invoke("listenLCP",t)},e.prototype.listenFSPLongTask=function(t){this.invoke("listenFSPLongTask",t)},e.prototype.listenLCPLongTask=function(t){this.invoke("listenLCPLongTask",t)},e.prototype.listenLoadLongTask=function(t){this.invoke("listenLoadLongTask",t)},e.prototype.listenPageLongTask=function(t){this.invoke("listenPageLongTask",t)},e.prototype.listenMemory=function(t){this.invoke("listenMemory",t)},e.prototype.getNavigatorInfo=function(){return this.invoke("getNavigatorInfo")},e.prototype.listenResource=function(t,e){this.invoke("listenResource",t,e)},e.prototype.listenBigImg=function(t,e){this.invoke("listenBigImg",t,e)},e.prototype.listenHttpResource=function(t,e){this.invoke("listenHttpResource",t,e)},e.prototype.listenSlowResource=function(t,e){this.invoke("listenSlowResource",t,e)},e.prototype.listenTiming=function(t){this.invoke("listenTiming",t)},e.prototype.listenTTI=function(t,e){this.invoke("listenTTI",t,e)},e.prototype.invoke=function(t,e,n){for(var a=0;a<this.modules.length;a++){var i= __get$(this.modules,a) ;if("function"==typeof  __get$(i,t) )return  __get$(i,t) .apply(i,[e,n])}console.error("no method",t)},e.prototype.register=function(t){this.modules.push(t)},e.prototype.load=function(){for(var t=0;t<this.modules.length;t++){var e= __get$(this.modules,t) ;e.load&&e.load()}},e.prototype.leave=function(){for(var t=0;t<this.modules.length;t++){var e= __get$(this.modules,t) ;e.leave&&e.leave()}},e.prototype.destroy=function(){for(var t=0;t<this.modules.length;t++){var e= __get$(this.modules,t) ;e.destroy&&e.destroy()}document.removeEventListener("visibilitychange",this.visibilitychangeCB),window.removeEventListener("load",this.load),window.removeEventListener("beforeunload",this.leave),window.removeEventListener("unload",this.destroy)},e.prototype.visibilitychangeCB=function(){"hidden"===document.visibilityState&&this.leave()},e}(S),Y={exports:{}};W=Y,n.commonjsGlobal,W.exports=function(){function t(t){if(URL&&t)try{var e=new URL(t);if(void 0!==e.host)return{protocol:e.protocol,host:e.host,pathname:e.pathname,ext:""}}catch(t){console.error(t)}}function e(e){var n=t(e);if(!n){var a=document.createElement("a"); __set$(a,"href",e) ,n={protocol:a.protocol,host:a.host|| __get$Loc(location) .host,pathname:a.pathname,ext:""}}var i=n.pathname.split(".");return n.ext= __get$(i,i.length-1) ,n}function n(t){return+t.toFixed(1)}function a(t){return{wait:n(t.domainLookupStart-(t.navigationStart||t.fetchStart||t.startTime)),dns:n(t.domainLookupEnd-t.domainLookupStart),connect:n(t.connectEnd-t.connectStart),req:n(t.responseStart-t.requestStart),res:n(t.responseEnd-t.responseStart)}}function i(t){if(!t)return{xpath:""};for(var e=[];t&&1===t.nodeType&&t!==t.parentNode;){var n=t.tagName.toLowerCase();if(t.getAttribute("id")?n+="[#"+t.getAttribute("id")+"]":t.classList&&t.classList.length&&(n+="[."+ __get$(t.classList,t.classList.length-1) +"]"),e.push(n),t===document.body)break;t=t.parentNode}return{xpath:e.join("<")}}var o={conf:{},winerrors:[],errorDestroy:function(){},observerDestroy:function(){},entryMap:{},init:function(t){this.conf=t},addError:function(t){if(this.winerrors.length>0){var e= __get$(this.winerrors,this.winerrors.length-1) ;if(t.info.msg===e.info.msg)return void(e.info.count+=e.info.count||0)}this.winerrors.length<1e3&&this.winerrors.push(t)},send:function(t,e,n){var a=this.conf;if(t.type=t.type||"except",t.pid=a.pid,t.lid=a.lid,t.ts=Date.now(),this.addError(t),this.interceptor&&this.interceptor(t),!1!==e){var i=(n=n||a.logServer)+"?pid="+t.pid+"&lid="+t.lid+"&ts="+t.ts+"&type="+t.type+"&group="+t.group+"&info="+encodeURIComponent(JSON.stringify(t.info));t.dim&&(i+="&dim="+encodeURIComponent(JSON.stringify(t.dim)));var o=new Image;o.src=i,o.onload=o.onerror=function(){o=null}}}};function r(t){var n=t.resourceError||{},a=t.jsError||{},r=Math.random()<(a.sample?a.sample:0),s=Math.random()<(n.sample?n.sample:0),l=o.winerrors,c=0;function d(t){try{var d=t.target,u={info:{},dim:{},group:""},p=u.info,h=t.srcElement,f=navigator.connection||{};if(p.downlink=f.downlink,p.effectiveType=f.effectiveType,p.rtt=f.rtt,p.deviceMemory=navigator.deviceMemory||0,p.hardwareConcurrency=navigator.hardwareConcurrency||0,h===window){u.group=a.group;var g=t.error||{};if(p.msg=t.message,p.file=t.filename,p.ln=t.lineno,p.col=t.colno,p.stack=(g.stack||"").split("\n").slice(0,3).join("\n"),-1!==p.msg.indexOf("MODULE_TIMEOUT")){var m=p.msg.match(/^.*Hang:(.*); Miss:(.*)/);m&&m[2]&&(p.msg="MODULE_TIMEOUT for miss:"+m[2])}for(var v=[],y=0;y<l.length;y++){var w= __get$(l,y) ,b=w.info.count>1?"("+w.info.count+")":"";v.push(b+w.info.msg)}p.hisErrors=v.join("----");var _=!0;a.handler&&(_=a.handler(u)),!1!==_&&o.send(u,r)}else{u.group=n.group,u.dim.type=h.tagName.toLowerCase();var k=h.src|| __get$(h,"href") ||"";if(k.indexOf("/mwb2.gif?")>-1)return;p.msg=k||"unknown load eror",u.dim.host=e(k).host,d&&"IMG"===d.tagName&&(p.xpath=i(d).xpath),c&&(p.hisErrCount=c),_=!0,n.handler&&(_=n.handler(u)),!1!==_&&o.send(u,s),c++}}catch(t){console.error(t)}}window.addEventListener("error",d,!0),o.errorDestroy=function(){window.removeEventListener("error",d,!0),o.winerrors=[]}}function s(){if(window.PerformanceObserver){var t= new window.PerformanceObserver(function(t){for(var e=o.entryMap,n=t.getEntries(),a=0;a<n.length;a++){var i=__get$(n,a);__get$(e,i.entryType)||__set$(e,i.entryType,[]),__get$(e,i.entryType).push(i);}}) ;o.observerDestroy=function(){t.disconnect()};try{t.observe({entryTypes:["longtask","layout-shift","first-input","largest-contentful-paint"]})}catch(t){}}}function l(t){var e=t.whiteScreenError||{},n=e.handler,i=e.selector,r=e.subSelector,s=e.timeout||6e3,l=Math.random()<(e.sample?e.sample:0);function c(){if(!window.performance)return!1;var t=a(window.performance.timing);return"&wait="+t.wait+"&dns="+t.dns+"&connect="+t.connect+"&requestTime="+t.req+"&resoneTime="+t.res}function d(){if(!o.winerrors)return!1;for(var t=o.winerrors,e=[],n=0;n<t.length;n++){var a=( __get$(t,n) .info.stack||"").split("\n")[0];e.push("("+n+")"+(a|| __get$(t,n) .info.msg))}return e.join(";;")}function u(){var t={},e=navigator.connection||{};return t.downlink=e.downlink,t.effectiveType=e.effectiveType,t.rtt=e.rtt,t.deviceMemory=navigator.deviceMemory||0,t.hardwareConcurrency=navigator.hardwareConcurrency||0,t}function p(){var t=document.querySelector(i);return!t||!t.querySelector(r)||t.clientHeight<2*window.innerHeight/3}i&&setTimeout((function(){if(p()){var t={group:e.group,info:{msg:"",netTime:c(),hisErrors:d(),deviceInfo:u()}};t.info.msg="WhiteScren Error";var a=!0;n&&(a=n(t)),!1!==a&&t.info.msg&&o&&o.send(t,l)}}),s)}return o.init=function(t){t.logServer||(t.logServer="https://sp1.baidu.com/5b1ZeDe5KgQFm2e88IuM_a/mwb2.gif"),this.conf=t,r(t),s(),l(t)},window.__spyclientConf&&o.init(window.__spyclientConf),o}();var Z=Y.exports,tt=n.getDefaultExportFromCjs(Z),et=new URL(document.URL),nt=et.host.indexOf("debug")>-1||"2"===et.searchParams.get("info"),at=(+et.searchParams.get("bottomBarHeight")||0)/window.devicePixelRatio;function it(){var t="";if(nt)try{t=JSON.parse(et.searchParams.get("dheader"))["User-Agent"]}catch(t){console.error("获取debug环境ua失败",t)}var e=(nt&&t?t:navigator.userAgent).toLowerCase(),n=e.includes("iphone")||e.includes("ipod")||e.includes("ipad"),a=e.includes("android"),i=e.includes("baiduboxapp"),o=e.includes("searchcraft"),r=e.includes("theme/dark"),s=e.includes("bdhonorbrowser"),l=e.includes("huawei"),c=e.includes("qqbrowser"),d=e.includes("safari")&&!e.includes("chrome"),u=e.includes("firefox"),p= __get$(__get$Loc(location),"href") .includes("extension://")&&e.includes("edg/"),h=e.includes("arkweb")&&e.includes("tablet"),f=e.includes("ipad")||h,g=e.includes("arkweb")&&!f,m=f?"pc":/Mobi|Android|iPhone|ArkWeb/i.test(e||"")?"wise":"pc";return{isIOS:n,isAndroid:a,isBaiduBox:i,isSearchCraft:o,isDarkMode:r,isQQBrowser:c,isSafari:d,platform:m,debugUA:t,isWindows:e.includes("windows"),isFirefox:u,isEdgeExtension:p,scene:"pc",isDeepSeekPage:"/deepseek"=== __get$Loc(location) .pathname&&"pc"!==m,isOnline:"chat.baidu.com"===et.host,isBdhonor:s,isHarmony:g,isHarmonyPad:h,isHuawei:l}}var ot=it();function rt(){return ot.platform}function st(){return ot.isOnline}function lt(){return ot.isDeepSeekPage}function ct(){return ot.isIOS}function dt(){return ot.isAndroid}function ut(){return ot.isSearchCraft}function pt(){return ot.isHarmony}function ht(){return ot.isBaiduBox}function ft(){return ht()&&!pt()}function gt(){return!("pc"===rt()||ht()||nt||ot.isBdhonor||ut()||pt())}function mt(){return ot.isFirefox}function vt(){return"extension"===ot.scene}function yt(){if(pt())return!0;if(!ct())return!1;var t=window.screen,e=t.width,n=t.height;return 375===e&&812===n||414===e&&896===n||390===e&&844===n||428===e&&926===n||430===e&&932===n||393===e&&852===n||430===e&&932===n||375===e&&812===n}function wt(t){return pt()?t+at+11-45:lt()?dt()||!yt()?t:t+11:0}function bt(t){var e=!!t;return Array.isArray(t)&&t.forEach((function(t){switch(t.type){case"TEXT":e=!!t.data.text.query;break;case"IMAGE":e=Object.keys(t.data.image).length>0}})),e}function _t(t){var e=t;if(Array.isArray(t)){var n="";t.forEach((function(t){var e=t.data;if("TEXT"===t.type)n+=e.text.query})),e=n}return e||""}function kt(t,e){var n=[];if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length)for(var a=0;a<e.length;a++){var i={};switch(i.type= __get$(e,a) , __get$(e,a) ){case"TEXT":i.data={text: __get$(t,a) };break;case"IMAGE":i.data={image: __get$(t,a) };break;case"FILE":i.data={file: __get$(t,a) }}n.push(i)}else if("object"===(void 0===t?"undefined":function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}(t))&&null!==t&&!Array.isArray(t)){var o={};switch(o.type=e,e){case"TEXT":o.data={text:t};break;case"IMAGE":o.data={image:t};break;case"FILE":o.data={file:t}}n.push(o)}return n.length>0?n:""}var St,xt={exports:{}};function It(t,e){return null!=e&&"undefined"!=typeof Symbol&& __get$(e,Symbol.hasInstance) ?!! __call$(e,Symbol.hasInstance,[t]) :t instanceof e}St=xt.exports,n.commonjsGlobal,function(t){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){if(!It(t,e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var a= __get$(e,n) ;a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function i(t,e,n){return e&&a(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t){return r(t)||s(t)||l(t)||d()}function r(t){if(Array.isArray(t))return c(t)}function s(t){if("undefined"!=typeof Symbol&&null!= __get$(t,Symbol.iterator) ||null!=t["@@iterator"])return Array.from(t)}function l(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t){var e=[],n=[];function a(t){if(t.$change)return t.target=n.slice(0),void e.push(t);for(var i in t)t.hasOwnProperty(i)&&(n.push(i),a( __get$(t,i) ),n.pop())}return a(t),e}function p(t){if(It(t,Array))return t;if("string"!=typeof t)return[];for(var e=t.split("."),n=[],a=0,i=e.length;a<i;a++){var o= __get$(e,a) ,r=o.indexOf("[");if(r>=0)for(r>0&&(n.push(o.slice(0,r)),o=o.slice(r));91===o.charCodeAt(0);){var s=o.indexOf("]");if(s<0)throw new Error("name syntax error: "+t);var l=o.slice(1,s);/^[0-9]+$/.test(l)?n.push(+l):/^(['"])([^\1]+)\1$/.test(l)&&n.push(l.slice(1,-1)),o=o.slice(s+1)}else n.push(o)}return n}var h="undefined"!=typeof window;function f(t,e){h&&window.__san_devtool__&&window.__san_devtool__.emit(t,e)}var g,m=0,v=function(){return(++m).toString()},y=function(){function t(){var e=this,a=Array.from(arguments).length>0&&void 0!==Array.from(arguments)[0]?Array.from(arguments)[0]:{},i=a.initData,o=void 0===i?{}:i,r=a.actions,s=void 0===r?{}:r,l=a.log,c=void 0!==l&&l,d=a.name;n(this,t),this.raw=o,this.actions=s,this.log=c,this.name=d,this.id=v(),this.listeners=[],this.stateChangeLogs=[],this.actionInfos=[],this.actionInfoIndex={},this.aiLen=0,this.stateGetter=function(t){return e.getState(t)}}return i(t,[{key:"getState",value:function(t){t=p(t);for(var e=this.raw,n=0,a=t.length;null!=e&&n<a;n++)e= __get$(e,__get$(t,n)) ;return e}},{key:"listen",value:function(t){"function"==typeof t&&this.listeners.push(t),this.log&&f("store-listened",{store:this,listener:t})}},{key:"unlisten",value:function(t){for(var e=this.listeners.length;e--;) __get$(this.listeners,e) ===t&&this.listeners.splice(e,1);this.log&&f("store-unlistened",{store:this,listener:t})}},{key:"_fire",value:function(t){for(var e=0,n=this.listeners.length;e<n;e++) __get$(this.listeners,e) .call(this,t)}},{key:"addAction",value:function(t,e){if("function"==typeof e){if( __get$(this.actions,t) )throw new Error("Action "+t+" exists!"); __set$(this.actions,t,e) ,this.log&&f("store-action-added",{store:this,action:e})}}},{key:"dispatch",value:function(t,e){return this._dispatch(t,e)}},{key:"_dispatch",value:function(t,e,n){var a=this,i= __get$(this.actions,t) ,o=v();if("function"==typeof i){var r,s=this._actionStart(o,t,i,e,n);if(s){if("function"==typeof s.then)return s.then((function(t){return a._actionDone(o),t}));var l=this.raw;this.raw=s[0],r=s[1],this.log&&this.stateChangeLogs.push({oldValue:l,newValue:this.raw,diff:r,id:o})}this._actionDone(o),r&&r.length>0&&this._fire(r)}}},{key:"_getActionInfo",value:function(t){var e= __get$(this.actionInfoIndex,t) ;if(null!=e)return  __get$(this.actionInfos,e) }},{key:"_actionStart",value:function(t,e,n,a,i){var o=this,r={id:t,name:e,parentId:i,childs:[]};if(this.log&&(r.startTime=(new Date).getTime(),r.payload=a), __set$(this.actionInfos,this.aiLen,r) , __set$(this.actionInfoIndex,t,this.aiLen++) ,i){var s=this._getActionInfo(i);s&&s.childs.push(t)}this.log&&f("store-dispatch",{store:this,name:e,payload:a,actionId:t,parentId:i});var l=n.call(this,a,{getState:this.stateGetter,dispatch:function(e,n){return o._dispatch(e,n,r.done?null:t)}});if(null!=l){if("function"==typeof l.buildWithDiff){var c=l.buildWithDiff()(this.raw);return c[1]=u(c[1]),this.log&&(r.updateInfo=c),c}if("function"==typeof l.then)return l}}},{key:"_actionDone",value:function(t){this._getActionInfo(t).selfDone=!0,this._detectActionDone(t)}},{key:"_detectActionDone",value:function(t){if(t){var e=this._getActionInfo(t);if(e){if(!e.selfDone)return!1;for(var n=0;n<e.childs.length;n++)if(!this._getActionInfo( __get$(e.childs,n) ).done)return!1;if(e.done=!0,this.log&&(e.endTime=(new Date).getTime(),f("store-dispatched",{store:this,diff:e.updateInfo?e.updateInfo[1]:null,name:e.name,payload:e.payload,actionId:e.id,parentId:e.parentId})),e.parentId)this._detectActionDone(e.parentId);else if(!this.log){for(var a=this.actionInfos.length;a--;)if(! __get$(this.actionInfos,a) .done)return;this.actionInfos=[],this.aiLen=0,this.actionInfoIndex={}}return!0}}}}]),t}(),w=new y({name:"__default__"});function b(t,e,n,a){var i=n.stateName;if(i){for(var r=i.length,s=a,l=0;l<r;){var c= __get$(i,l) ;if(! __get$(s,c) ){s.__selfDiff__||(s=null);break}l++,s= __get$(s,c) }if(0!==l&&s){var d=s.__diffs__;if(d)for(var u=0;u<d.length;u++){var p= __get$(d,u) ,h=p.target,f=n.dataName,g=n.stateName;h.length>r&&(f+="."+h.slice(r).join("."),g=h),h.length>=r&&p.splice?t.data.splice(f,It(p.splice.insertions,Array)?[p.splice.index,p.splice.deleteCount].concat(o(p.splice.insertions)):[p.splice.index,p.splice.deleteCount]):t.data.set(f,e.getState(g))}}}}function _(t){for(var e={},n=0,a=t.length;n<a;n++){for(var i= __get$(t,n) .target,o=e,r=[],s=0;s<i.length;s++){var l= __get$(i,s) ,c= __get$(o,l) ;if(!c){c={__diffs__:[]}, __set$(o,l,c) ;for(var d=0;d<s;d++){var u= __get$(r,d) .__offsprings__;u||(u= __get$(r,d) .__offsprings__=[]),u.push(c)}}o=c, __set$(r,s,c) }o.__selfDiff__=!0}for(var p=0,h=t.length;p<h;p++){for(var f= __get$(t,p) ,g=f.target,m=e,v=0;v<g.length;v++)(m= __get$(m,__get$(g,v)) ).__diffs__.push(f);var y=m.__offsprings__;if(y)for(var w=0;w<y.length;w++) __get$(y,w) .__diffs__.push(f)}return e}f("store-default-inited",{store:w});try{g=new Function("RawClass","return class extends RawClass {}")}catch(t){}function k(t){var e=function(){};e.prototype=t.prototype;var n=function(e){return t.call(this,e)||this};return n.prototype=new e,n.prototype.constructor=n,e.prototype.hasOwnProperty("aPack")&&(n.prototype.aPack=e.prototype.aPack),n}function S(t){var e;return(e=0===t.toString().indexOf("class")?g(t):k(t)).template=t.template,e.components=t.components,e.trimWhitespace=t.trimWhitespace,e.delimiters=t.delimiters,e.autoFillStyleAndId=t.autoFillStyleAndId,e.filters=t.filters,e.computed=t.computed,e.aPack=t.aPack,e.messages=t.messages,e}function x(t,n,a){var i=[];function o(t,n,a){It(t,y)||(a=n,n=t,t=w);for(var o=[],r=0,s=Object.keys(n),l=0;l<s.length;l++){var c= __get$(s,l) ,d= __get$(n,c) ,u={dataName:c};switch(e(d)){case"string":u.stateName=p(d);break;case"function":u.getter=d;break;default:u=null}u&&(o.push(u),r++)}i.push({mapStates:n,mapStateInfos:o,mapStateCount:r,mapActions:a,store:t}),t.log&&f("store-connected",{mapStates:n,mapActions:a,store:t})}function r(t){var e,n,o;"function"==typeof t?(n=S(t),e=t.prototype,o=n.prototype):(e=t||{},n= __call$(Object,"assign",[{},t]) ,o=n);var r=e.inited,s=e.disposed;if(o.inited=function(){var t=this;this.__storeListeners=this.__storeListeners||[];for(var e=function(e){for(var n= __get$(i,e) ,o=n.mapStates,r=n.mapStateCount,s=n.mapStateInfos,l=n.store,c=0;c<r;c++){var d= __get$(s,c) ;"function"==typeof d.getter?t.data.set(d.dataName,d.getter(l.getState(),t)):t.data.set(d.dataName,l.getState(d.stateName))}var u=function(e){for(var n=_(e),a=0;a<r;a++){var i= __get$(s,a) ;"function"==typeof i.getter?t.data.set(i.dataName,i.getter(l.getState(),t)):b(t,l,i,n)}};l.listen(u),t.__storeListeners.push(u),l.log&&f("store-comp-inited",{mapStates:o,mapActions:a,store:l,component:t})},n=0;n<i.length;n++)e(n);"function"==typeof r&&r.call(this)},o.disposed=function(){for(var t=0;t<i.length;t++){var e= __get$(i,t) ,n=e.mapStates,a=e.mapActions,o=e.store;o.unlisten( __get$(this.__storeListeners,t) ),o.log&&f("store-comp-disposed",{mapStates:n,mapActions:a,store:o,component:this})}"function"==typeof s&&s.call(this)},!o.actions){o.actions={};for(var l=function(t){var e= __get$(i,t) ,n=e.mapActions,a=e.store;if(!n)return"continue";if(It(n,Array))for(var r=function(t){var e= __get$(n,t) ; __set$(o.actions,e,function(t){return a.dispatch(e,t);}) },s=0;s<n.length;s++)r(s);else for(var l=Object.keys(n),c=function(t){var e= __get$(l,t) ,i= __get$(n,e) ; __set$(o.actions,e,function(t){return a.dispatch(i,t);}) },d=0;d<l.length;d++)c(d)},c=0;c<i.length;c++)l(c)}return n}return o(t,n,a),r.connect=function(t,e,n){return o(t,e,n),r},r}x.createConnector=function(t){if(It(t,y))return function(e,n){return x(t,e,n)};throw new Error(t+" must be an instance of Store!")},x.san=function(t,e,n){return x(t,e,n)};var I="2.2.8";t.Store=y,t.connect=x,t.store=w,t.version=I,Object.defineProperty(t,"__esModule",{value:!0})}(St);var Tt=xt.exports,Ct={exports:{}};function Lt(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":e._typeof(t)}!function(t,e){n.commonjsGlobal,function(t){var e=function(t){var e={};for(var n in t) __set$(e,n,__get$(t,n)) ;return e},n=function(t,e){for(var n=0;n<t.length;n++){var a= __get$(t,n) ;if(e(a))return a}},a=function(t){if(!t)return!1;for(var e in t)if(t.hasOwnProperty(e))return!0;return!1},i=function(t,e){for(var n=0;n<t.length;n++)if( __get$(t,n) ===e)return n;return-1},o=function(t,e,n){return{$change:t,oldValue:e,newValue:n}},r=function(t,e,n,a,i){return{$change:"change",oldValue:t,newValue:e,splice:{index:n,deleteCount:a,insertions:i}}},s="function"==typeof Symbol&&"symbol"==Lt(Symbol.iterator)?function(t){return void 0===t?"undefined":Lt(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":Lt(t)},l=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}): __set$(t,e,n) ,t},c=function(){function t(t,e){var n=[],a=!0,i=!1,o=void 0;try{for(var r,s= __call$(t,Symbol.iterator,[]) ;!(a=(r=s.next()).done)&&(n.push(r.value),!e||n.length!==e);a=!0);}catch(t){i=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(t){return Array.isArray(t)?t:Array.from(t)},u=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++) __set$(n,e,__get$(t,e)) ;return n}return Array.from(t)},p={},h={$set:function(t,e,n){var a= __get$(t,e) ;return n===a?[n,null]:[n,o(t.hasOwnProperty(e)?"change":"add",a,n)]},$push:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $push command on non array object is forbidden.");var i=a.concat([n]);return[i,r(a,i,a.length,0,[n])]},$unshift:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $unshift command on non array object is forbidden.");var i=[n].concat(a);return[i,r(a,i,0,0,[n])]},$pop:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $pop command on non array object is forbidden.");if(a.length&&(!0===n||"function"==typeof n&&n(a))){var i=a.slice(0,-1);return[i,r(a,i,a.length,1,[])]}return[a,null]},$shift:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $shift command on non array object is forbidden.");if(a.length&&(!0===n||"function"==typeof n&&n(a))){var i=a.slice(1);return[i,r(a,i,a.length,1,[])]}return[a,null]},$removeAt:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $removeAt command on non array object is forbidden.");if(n>=a.length||n<0)return[a,null];var i=a.slice(0,n).concat(a.slice(n+1));return[i,r(a,i,n,1,[])]},$remove:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $removeAt command on non array object is forbidden.");var o=i(a,n);if(-1===o)return[a,null];var s=a.slice(0,o).concat(a.slice(o+1));return[s,r(a,s,o,1,[])]},$splice:function(t,e,n){var a=d(n),i=a[0],o=a[1],s=a.slice(2),l= __get$(t,e) ;if(!Array.isArray(l))throw new Error("Usage of $splice command on non array object is forbidden.");var c=l.slice(0,i).concat(s).concat(l.slice(i+o));return[c,r(l,c,i,o,s)]},$map:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $map command on non array object is forbidden.");var i=a.map(n);return[i,o("change",a,i)]},$filter:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $filter command on non array object is forbidden.");var i=a.filter(n);return[i,o("change",a,i)]},$reduce:function(t,e,n){var a= __get$(t,e) ;if(!Array.isArray(a))throw new Error("Usage of $reduce command on non array object is forbidden.");var i="function"==typeof n?a.reduce(n):a.reduce.apply(a,u(n));return[i,o("change",a,i)]},$merge:function(t,n,a){var i= __get$(t,n) ||{},r=e(i),s={};for(var l in a)if(a.hasOwnProperty(l)){var c= __get$(a,l) ,d= __get$(i,l) ;if(c!==d){ __set$(r,l,c) ;var u=i.hasOwnProperty(l)?"change":"add"; __set$(s,l,o(u,d,c)) }}return[r,s]},$defaults:function(t,n,a){var i= __get$(t,n) ,r=e(i),s={};for(var l in a)a.hasOwnProperty(l)&&void 0=== __get$(r,l) &&( __set$(r,l,__get$(a,l)) , __set$(s,l,o("add",void 0,__get$(a,l))) );return[r,s]},$apply:function(t,e,n){var a=n( __get$(t,e) );return[a,o(t.hasOwnProperty(e)?"change":"add", __get$(t,e) ,a)]},$omit:function(t,e,n){var a= __get$(t,e) ;return!0===n||"function"==typeof n&&n(a)?[p,o("remove",a,void 0)]:[a,null]},$composeBefore:function(t,e,n){var a= __get$(t,e) ;if("function"!=typeof a)throw new Error("Usage of $composeBefore command on non function object is forbidden.");if("function"!=typeof n)throw new Error("Passing non function object to $composeBefore command is forbidden");var i=function(){return a(n.apply(void 0,Array.from(arguments)))};return[i,o("change",a,i)]},$composeAfter:function(t,e,n){var a= __get$(t,e) ;if("function"!=typeof a)throw new Error("Usage of $composeAfter command on non function object is forbidden.");if("function"!=typeof n)throw new Error("Passing non function object to $composeAfter command is forbidden");var i=function(){return n(a.apply(void 0,Array.from(arguments)))};return[i,o("change",a,i)]}},f=Object.keys(h),g=f.map((function(t){return t.slice(1)})),m=function t(e,i){var o=n(f,(function(t){return i.hasOwnProperty(t)}));if(o){var r={source:e},s= __get$(i,o) ;return  __call$(h,o,[r,"source",s]) }var l=function(a){var o= __get$(i,a) ,r=n(f,(function(t){return o.hasOwnProperty(t)}));return r? __call$(h,r,[e,a,__get$(o,r)]) :t( __get$(e,a) ||{},o)},d=function(t,e){for(var n in i)if(!t.hasOwnProperty(n)&&i.hasOwnProperty(n)){var a=l(n),o=c(a,2),r=o[0],s=o[1]; __set$(e,n,s) ,r!==p&&( __set$(t,n,r) )}return[t,e]};if(Array.isArray(e)){for(var u=[],g={},m=0;m<e.length;m++)if(i.hasOwnProperty(m)){var v=l(m),y=c(v,2),w=y[0],b=y[1];a(b)&&( __set$(g,m,b) ),w!==p&&u.push(w)}else u.push( __get$(e,m) );return d(u,g)}var _={},k={};for(var S in e)if(i.hasOwnProperty(S)){var x=l(S),I=c(x,2);w=I[0],b=I[1],a(b)&&( __set$(k,S,b) ),w!==p&&( __set$(_,S,w) )}else  __set$(_,S,__get$(e,S)) ;return d(_,k)},v=function(t,e){return m(t,e)[0]},y="[".charCodeAt(0),w=function(t){if(Array.isArray(t))return t;for(var e=(t+"").split("."),n=[],a=0;a<e.length;a++){var i= __get$(e,a) ,o=i.indexOf("[");if(o>=0)for(o>0&&(n.push(i.slice(0,o)),i=i.slice(o));i.charCodeAt(0)===y;){var r=i.indexOf("]");if(r<0)throw new Error("Property path syntax error: "+t);var s=i.slice(1,r);if(/^[0-9]+$/.test(s))n.push(+s);else{if(!/^(['"])([^\1]+)\1$/.test(s))throw new Error("Property path syntax error: "+t);n.push(new Function("return "+s)())}i=i.slice(r+1)}else n.push(i)}return n},b=function(t,e){if(null==t)return e;for(var n=w(t),a={},i=a,o=0;o<n.length-1;o++)i= __set$(i,__get$(n,o),{}) ;return  __set$(i,__get$(n,n.length-1),e) ,a},_=function(t,e,n){return v(t,b(e,{$set:n}))},k=function(t,e,n){return v(t,b(e,{$push:n}))},S=function(t,e,n){return v(t,b(e,{$unshift:n}))},x=function(t,e,n){return v(t,b(e,{$pop:n}))},I=function(t,e,n){return v(t,b(e,{$shift:n}))},T=function(t,e,n){return v(t,b(e,{$removeAt:n}))},C=function(t,e,n){return v(t,b(e,{$remove:n}))},L=function(t,e,n,a){for(var i=Array.from(arguments).length,o=Array(i>4?i-4:0),r=4;r<i;r++) __set$(o,r-4,__get$(Array.from(arguments),r)) ;var s=[n,a].concat(o);return v(t,b(e,{$splice:s}))},D=function(t,e,n){return v(t,b(e,{$map:n}))},P=function(t,e,n){return v(t,b(e,{$filter:n}))},E=function(t,e){for(var n=Array.from(arguments).length,a=Array(n>2?n-2:0),i=2;i<n;i++) __set$(a,i-2,__get$(Array.from(arguments),i)) ;var o=1===a.length?{$reduce:a[0]}:{$reduce:a};return v(t,b(e,o))},A=function(t,e,n){return v(t,b(e,{$merge:n}))},O=function(t,e,n){return v(t,b(e,{$defaults:n}))},R=function(t,e,n){return v(t,b(e,{$apply:n}))},N=function(t,e){return v(t,b(e,{$omit:!(Array.from(arguments).length>2&&void 0!==Array.from(arguments)[2])||Array.from(arguments)[2]}))},M=function(t,e,n){return v(t,b(e,{$composeBefore:n}))},q=function(t,e,n){return v(t,b(e,{$composeAfter:n}))},j=function(t,e,n,a){if(Array.isArray(n)){var i=function(){var i=n.map((function(e){return e(t)})),o=function(t){return a.apply(void 0,u(i).concat([t]))};return{v:R(t,e,o)}}();if("object"===(void 0===i?"undefined":s(i)))return i.v}var o=n(t),r=function(t){return a(o,t)};return R(t,e,r)},B={},H=function t(e,n){return g.reduce((function(a,i){return  __set$(a,i,function(a){for(var o=Array.from(arguments).length,r=Array(o>1?o-1:0),s=1;s<o;s++)__set$(r,s-1,__get$(Array.from(arguments),s));var c=l({},"$"+i,1===r.length?r[0]:r),d=A(n,a,c);return t(e,d);}) ,a}),{value:function(){return v(e,n)},withDiff:function(){return m(e,n)}})},$=function(t){return H(t,B)},F=function t(e){return g.reduce((function(n,a){return  __set$(n,a,function(n){for(var i=Array.from(arguments).length,o=Array(i>1?i-1:0),r=1;r<i;r++)__set$(o,r-1,__get$(Array.from(arguments),r));var s=l({},"$"+a,1===o.length?o[0]:o),c=A(e,n,s);return t(c);}) ,n}),{build:function(){var t=function(t){return v(t,e)};return t.withDiff=function(t){return m(t,e)},t},buildWithDiff:function(){return function(t){return m(t,e)}}})},U=F({}),G=function(){return U};t.chain=$,t.immutable=$,t.macro=G,t.builder=G,t.updateBuilder=G,t.update=v,t.withDiff=m,t.set=_,t.push=k,t.unshift=S,t.pop=x,t.shift=I,t.removeAt=T,t.remove=C,t.splice=L,t.map=D,t.filter=P,t.reduce=E,t.merge=A,t.defaults=O,t.apply=R,t.omit=N,t.composeBefore=M,t.composeAfter=q,t.applyWith=j,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(0,Ct.exports);var Dt=Ct.exports;function Pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Et(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function At(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Pt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pt(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ot(t){switch(t){case"http:":return"80";case"https:":return"443";default:return  __get$Loc(location) .port}}function Rt(t,e,n){"function"==typeof n&&(n=n()),null===n&&(n=""),t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}function Nt(t,e,n){var a=Array.isArray(e),i="[object Object]"===Object.prototype.toString.call(e);for(var o in e)if(e.hasOwnProperty(o)){var r= __get$(e,o) ,s="object"===(void 0===r?"undefined":Et(r))&&null!==r,l=n?n+"["+(i||s?o:"")+"]":o;!n&&a?Rt(t,r.name,r.value):s?Nt(t,r,l):Rt(t,l,r)}}function Mt(t){if(void 0===t&&(t={}),!t)return"";var e="";for(var n in t)if(t.hasOwnProperty(n)){var a= __get$(t,n) ;null==a?a="":"object"===(void 0===a?"undefined":Et(a))&&(a=JSON.stringify(a)),e+="&"+encodeURIComponent(n)+"="+encodeURIComponent(a)}return e.slice(1)}function qt(t){var e={};return t&&t.forEach((function(t,n){ __set$(e,n,t) })),e}function jt(t,e){if(!t||!e)return"";var n=t.includes("?")?"&":"?";return""+t+n+e}function Bt(t,e){var n=Object.entries(e).map((function(t){var e=t[0],n=t[1];return encodeURIComponent(e)+"="+encodeURIComponent(n)})).join("&"),a=t.includes("?")?"&":"?";return""+t+a+n}var Ht={params:function(t){var e=[];return Nt(e,t), __call$(e.join("&"),"replace",[/%20/g,"+"]) },parse:function(t){var e=document.createElement("a"); __set$(e,"href",t) ;var n=e.pathname.startsWith("/")?e.pathname:"/"+e.pathname;if(t.startsWith("baiduboxapp")){var a=t.indexOf(":"),i=t.indexOf("?");n=t.slice(a+1,-1===i?t.length:i)}return{href: __get$(e,"href") ,host:e.host|| __get$Loc(location) .host,port:"0"===e.port||""===e.port?Ot(e.protocol):e.port,hash:e.hash,hostname:e.hostname|| __get$Loc(location) .hostname,pathname:n,protocol:e.protocol&&":"!==e.protocol?e.protocol: __get$Loc(location) .protocol,search:e.search,query:Ht.qs(e.search.slice(1))}},qs:function(t){if(!t)return{};var e=decodeURIComponent;return t.split("&").reduce((function(t,n){var a=n.indexOf("="),i=e(n.slice(0,a)),o=e(n.slice(a+1));if(!i)return t;var r= __get$(t,i) ;return Array.isArray(r)?r.push(o): __set$(t,i,r?[r,o]:o) ,t}),{})}};function $t(t){if(!t)return{};for(var e,n={},a=At((t.startsWith("?")?t.substring(1):t).split("&"));!(e=a()).done;){var i=e.value.split("="),o=i[0],r=i[1];o&&( __set$(n,o,void 0!==r?r:"") )}return n}function Ft(t){try{return decodeURIComponent(t)}catch(e){return t}}var Ut,Gt="https://chat.baidu.com",Wt={riskcheck:"/aichat/api/riskcheck",conversation:"/aichat/api/conversation",history:"/csaitab/history/list",knowledge:"/csaitab/knowledge/list",update:"/csaitab/knowledge/update",create:"/csaitab/knowledge/create",deletekl:"/csaitab/knowledge/delete",delete:"/csaitab/history/delete",uploadSts:"/aichat/api/file/sts",upload:"/aichat/api/file/upload",fileLoop:"/aichat/api/file/loop",fileDelete:"/aichat/api/knowledge/file/delete",loginConfirmation:"/aichat/api/loginConfirmation",sharePage:"/csaitab/history/share"},zt={FETCH_TIMEOUT_ERROR:"fetch timeout",FETCH_FAIL:"Failed to fetch"},Qt='[component="askBack"]',Jt="cs-ul-mb-fill",Vt="cs-fit-answer-container",Kt="#chat-container-main",Xt=".answer-box",Yt="百度AI助手",Zt=["catalogue_zsk_new","catalogue_zsk_name","catalogue_zsk_more"],te=".se-page-bd",ee=["cs_tab_cache_key","appendQuery","appendSa","extParams","extParamsJson","isLoggedIn","csaitab_slip_prefetch","clickTime","ori_word","ori_lid","agentInfo","headers","do_not_intercept","cs_ext_params"],ne="让我们换个话题聊聊吧。";!function(t){t.REBUILD="rebuild",t.APPEND="append"}(Ut||(Ut={}));var ae,ie,oe,re,se=["bkb","bks","bvoice","image"],le=["bkb_funcguide","bkb_functab"],ce=["agent","prob_agent","greet_agent","agent_ala","capsule_agent","contact_agent","funcguide_agent"],de=8;!function(t){t.CONVERSATION="conversation",t.SHOW_AGENT_GREETING="showAgentGreeting"}(ae||(ae={})),function(t){t.WRITE="ai_write",t.PAINT="ai_paint",t.ANALYSIS="url_analysis"}(ie||(ie={})),function(t){t.GRAPH_SEARCH="graph_search",t.CHAT_SEARCH="chat_search"}(oe||(oe={})),function(t){t.CHAT="3741000200000000",t.SIDEBAR="3741000110001000"}(re||(re={}));var ue,pe=["sid","uid","cuid"],he=[".jpeg",".png",".jpg",".bmp",".webp"],fe=[".pdf",".doc",".docx",".txt",".xls",".xlsx",".csv",".ppt",".pptx"],ge="https://psstatic.cdn.bcebos.com/basics/",me={PDF:ge+"aichat/pdf-wise_1744600722000.png",Word:ge+"aichat/word-wise_1744600783000.png",PPT:ge+"aichat/ppt-wise_1744600745000.png",TXT:ge+"aichat/txt-wise_1744600762000.png",Excel:ge+"aichat/excel-wise_1744600701000.png",unknown:""};!function(t){t.LOGIN="LOGIN",t.LOGIN_SUCCESS="LOGIN_SUCCESS",t.FEEDBACK_CLOSE="FEEDBACK_CLOSE"}(ue||(ue={}));var ve,ye="CHAT_SEARCH_USED_MODEL",we="CHAT_SEARCH_USER_SELECTED_MODEL",be=new Set(["home_bar","home_tool_bar","vs_tab","result_page_bar","sug_direct","his_start","his_bring","sug_start","sug_bring","message","a_assistant_60911","a_input_60911"]),_e={CHAT:{path:"/search"},HISTORY:{path:"/aichat/history"},SQUARE:{path:"/aichat/square"},DEEPSEEK:{path:"/deepseek"},KNOWLEDGE:{path:"/knowledge"}};!function(t){t.SMART_MODEL_ID="smartMode",t.DEFAULT_MODEL_ID="smartMode",t.DEEP_SEEK_MODEL_ID="DeepSeek-R1"}(ve||(ve={}));var ke=new Map([["1-1",ge+"chat/1-1_1741748805000.json"],["2-3",ge+"chat/2-3_1741693200000.json"],["3-2",ge+"chat/3-2_1741695732000.json"],["16-9",ge+"chat/16-9_1741695763000.json"],["9-16",ge+"chat/9-16_1741695745000.json"],["3-4",ge+"chat/3-4_1741748830000.json"],["4-3",ge+"chat/4-3_1741748848000.json"]]),Se="名额已满",xe=function(t){return Object.prototype.toString.call(t)};function Ie(t){return"[object Object]"===xe(t)}function Te(t){return"[object Array]"===xe(t)}function Ce(t){return"[object String]"===xe(t)}function Le(){return Le=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Le.apply(this,Array.from(arguments))}var De,Pe,Ee,Ae,Oe="askBack",Re="questionCloselyShort",Ne=new Set(["sa","apagelid","re_rank","ori_lid","sge_lid","sid","setype","pd","word","fqid","suv","cv","scv","insc","async_flag","pn","foot_ec","mod","cstabpage","chat_token","agent_id","agent_p","aitab_ct","actiontype","agt_rk","agt_sess_cnt","csextdata","a_srcid","a_tplname","a_order","blockCmpt"]),Me=[Oe,Re];function qe(t){void 0===t&&(t={});var e="";window.page&&window.page.amd&&window.page.amd.version&&(e=window.page.amd.version.searchUi);var n=window.page.comm.lid; __call$(Object,"assign",[t,{fqid:n,suv:e,insc:1,async_flag:1,foot_ec:"0_0",pn:0}]) ;var a={};return Object.keys(t).forEach((function(e){var n= __get$(t,e) ;Ne.has(e)&&null!=n&&""!==n&&( __set$(a,e,n) )})),a}function je(t){var e={};return Object.keys(t).forEach((function(n){var a= __get$(t,n) ;void 0!==a&&( __set$(e,n,a) )})),e}function Be(t){return t?t.inputCustom&&!Te(t.inputCustom)||t.word&&!Ce(t.word)?null:t:null}function He(t){return t&&Ce(t.type)&&Ce(t.triggerType)?t:null}function $e(t){var e=t.searchParams,n=t.eventParams,a=t.user,i=e||n,o=i.extParamsJson||i.extParams||i.cs_ext_params||{},r=i.headers||{},s=i.word,l=i.query,c=i.conversationLogId,d=i.isLoggedIn,u=i.urlParams,p=i.isShowHello,h=i.enterType,f=i.preQuery,g=i.tabName,m=i.pageType,v=i.interactionType,y=i.bottomBarHeight,w=i.topBarHeight,b=l||s;try{o=(o="string"==typeof o?JSON.parse(n?Ft(o):o):o).extParams&&"string"==typeof o.extParams?JSON.parse(o.extParams):o,r="string"==typeof r?JSON.parse(n?Ft(r):r):r}catch(t){console.error(t),"string"==typeof o&&(o="string"==typeof o&&$t(Ft(o)))}var _=i.extParamsJson,k=i.extParams;if(_&&k)try{_="string"==typeof _?JSON.parse(_?decodeURIComponent(_):_):o,k=(k="string"==typeof k?JSON.parse(k?decodeURIComponent(k):k):k).extParams&&"string"==typeof k.extParams?JSON.parse(k.extParams):k,o= __call$(Object,"assign",[_,k]) }catch(t){}var S=i.agentInfo||o.agentInfo||{},x=i.triggerType||o.triggerType||ae.CONVERSATION;try{S="string"==typeof S?JSON.parse(decodeURIComponent(S)):S}catch(t){console.error(t)}var I=o.invokeChatExt;if(I)try{var T="string"==typeof I?JSON.parse(I):I;S.agentParams?S.agentParams=Le({},S.agentParams,T):S.agentParams=T}catch(t){console.error("解析参数发生错误:",t)}S=function(t){var e=null==t?void 0:t.agentId;return(null==t?void 0:t.jumpUrl)||(null==t?void 0:t.jump_url)||!e||(t=Le({},t,{jumpUrl:{zbios:"baiduboxapp://swan/"+e+"?_baiduboxapp=%7B%22lingjing_type%22%3A"}})),t}(S);var C=o.sge_lid,L=o.apagelid,D=o.aPageWord,P=o.sa,E=o.ori_lid,A=o.ori_word,O=o.askType,R=o.aitab_ct,N=o.actiontype,M=o.csextdata,q=o.shareId,j=o.enter_type,B=o.out_enter_type,H=o.tplname,$=o.srcid,F=o.order,U=o.helloKey,G=o.helloAgentID,W=o.helloQuery,z=o.open_left_agent,Q=o.queryPrefix,J=o.messageReadStyle,V=o.upperSearchbox,K=o.openInputPanel,X=o.localSelectedId,Y=o.localFullFeature,Z=o.landingPageSwitch,tt=o.selectedId,et=o.internetSearch,nt=o.fullFeature,at=o.modelList,it=o.isShowHello,ot=o.subEnterType,st=o.searchBoxPanel,lt=o.knowledgeId,ct={sgeLid:C,query:A||b,agentInfo:S||{},conversationLogId:c,clientHeaders:r,apagelid:L,aPageWord:D,iosSlipPrefetchEnable:i.csaitab_slip_prefetch,setype:i.setype,sid:i.sid,sa:P||i.sa,agentSa:i.agentSa,appUrlParams:u,user:a,askType:O,connectPreQuery:f||Q||(Me.includes(O)&&A&&A!==b?b:""),aitab_ct:R,actiontype:N,triggerType:x,isShowHello:+it||+p||(A||b?0:1)||(q?1:0),tabName:g,shareId:q,csextdata:M,enterType:h||j,pcEnterType:j,tplname:H,srcid:$,order:F,openLeftAgent:z,pageType:m,messageReadStyle:J,upperSearchbox:Be(V),openInputPanel:He(K),interactionType:v,clickTime:i.clickTime,searchBoxPanel:st,topBarHeight:w,bottomBarHeight:y};(ct.isShowHello&&"wise"===rt()||"message"===h)&&(ct.isShowHello=1,J&&"0"!==J&&!Number.isNaN(+J)&&(ct.initShowHistory=!0)),ct.query&&i.clickTime&&(ct.naInjectTime=+new Date-i.clickTime),E&&(ct.oriLid=E),ot&&(ct.subEnterType=ot),lt&&(ct.knowledgeId=lt),void 0!==d&&(a.isUserLogin=!!+(d||0),ct.user=a),e&&e.chatsearch_action_id&&(ct.chatSearchAcitonId=e.chatsearch_action_id),g&&(ct.pcEnterType="find_agent"),p&&U&&(ct.helloInfo={helloKey:U,helloAgentID:G,helloQuery:W}),B&&(ct.outEnterType=B);var dt="string"==typeof(null==o?void 0:o.usedModel)?JSON.parse(o.usedModel):{modelFunction:{}},ut=dt.modelName,pt="";return dt.modelName=tt||ut||(!localStorage.getItem(we)&&be.has(h)?ve.SMART_MODEL_ID:X),tt||ut||!X||dt.modelName===X||(pt=dt.modelName),dt.modelFunction||(dt.modelFunction={}),et&&(dt.modelFunction.internetSearch=et),dt.modelName&&(ct.initModelInfo={localFullFeature:Y,landingPageSwitch:Z,fullFeature:"string"==typeof nt?"true"===nt:nt,usedModel:dt,modelList:at,notifyAppModelId:pt}),je(ct)}function Fe(t){var e=null,n=document.querySelectorAll(t);try{n.forEach((function(t){t.innerHTML&&(e= __call$(Object,"assign",[{},e,JSON.parse(t.innerHTML)]) )}))}catch(t){console.error("解析数据失败",t)}return e}function Ue(){return Ue=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Ue.apply(this,Array.from(arguments))}!function(t){t.OPEN="1",t.CLOSE="0"}(De||(De={})),function(t){t.OPEN="1",t.CLOSE="0"}(Pe||(Pe={})),function(t){t.OPEN="1",t.CLOSE="0"}(Ee||(Ee={})),function(t){ __set$(t,t.LOGIN=1,"LOGIN") , __set$(t,t.LOGOUT=0,"LOGOUT") }(Ae||(Ae={}));var Ge,We,ze=function(t){return!t||!Object.keys(t).length},Qe=new function(){var t=this;this.guideTip="百度AI推出全新智能模式，快来试试吧",this.defaultModel={modelName:"DeepSeek-R1",modelFunction:{internetSearch:De.OPEN}},this.isModelAvailable=function(t){var e;return null==(e=t.modelAvailable)||e},this.isLogin=function(){return!!t.userInfo&&t.userInfo.isUserLogin===Ae.LOGIN},this.handlePCModel=function(e,n,a){var i=JSON.parse(localStorage.getItem(ye));if(ze(i)||!t.isLogin()||"force"===a){var o=e.find((function(t){return t.modelName===n}));if(o&&t.isModelAvailable(o))return t.setUsedModel(o)}else{var r=e.find((function(t){return t.modelName===i.modelName}));if(r&&t.isModelAvailable(r)){var s;if(!i.modelFunction)i.modelFunction=null!=(s=r.modelFunction)?s:{internetSearch:De.OPEN};var l={modelName:r.modelName,modelFunction:Ue({},i.modelFunction)};return t.setUsedModel(l)}}return t.setUsedModel(t.transformModel(e[0]))},this.transformModel=function(e){return e?{modelName:e.modelName,modelFunction:e.modelFunction}:t.defaultModel},this.handleUsableModel=function(e){var n=e.usableModel,a=void 0===n?[]:n,i=e.defaultModel,o=void 0===i?"DeepSeek-R1":i,r=e.fusionEnhanceTips,s=e.userInfo,l=e.dsDegradeType;return t.userInfo=s,r&&(t.guideTip=r),{usedModel:t.handlePCModel(a,o,l),usableModel:a}},this.showToast=function(t){t.forEach((function(t){t.modelToast&&e.Toast.show({message:t.modelToast})}))},this.setUsedModel=function(e){if(ze(e))return t.defaultModel;var n=e;return n=function(t){return void 0===t.modelTitle}(e)?e:t.transformModel(e),"pc"===rt()&&localStorage.setItem(ye,JSON.stringify(n)),n},this.setUsableModel=function(t){return t.map((function(t){var e;return Ue({},t,{modelAvailable:null==(e=t.modelAvailable)||e})}))},this.init=function(e){var n=t.handleUsableModel(e),a=n.usableModel,i=void 0===a?[]:a,o=n.usedModel,r=t.setUsableModel(i),s=t.setUsedModel(o);return t.showToast(r),{usableModel:r,usedModel:s}}};function Je(){return Je=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Je.apply(this,Array.from(arguments))}!function(t){t.DeepSeek="DeepSeek",t.DeepSeek_R1="DeepSeek-R1",t.ERINE="ERINE",t.ERINE_4_5="ERINE-4.5",t.ERINE_X1="ERINE-X1",t.SMART_MODE="smartMode"}(Ge||(Ge={})),function(t){t.Model="Model",t.Function="Function"}(We||(We={}));var Ve= new function(){var t=this;this.guideShowData=null,this.defaultGuideData=null,this.newModelTip="",this.ModelTipMap={TIPS_SHOW_TEXT_KEY:"chat-search-model-tip-show",GUIDE_SHOW_KEY:"chat-search-model-guide-show"},this.handleModelUi=function(e,n,a){return void 0===a&&(a=!1),e.map(function(e){var i,o,r,s=e.id,l=(null==(i=e.modelFunction)?void 0:i.internetSearch)||De.CLOSE,c=(null==(o=e.modelFunction)?void 0:o.deepThink)||Pe.OPEN,d=(null==(r=e.modelFunction)?void 0:r.mcpSwitch)||Ee.CLOSE;return a&&(l=s.includes(Ge.DeepSeek)?t.getInternetStatus(l)?De.OPEN:De.CLOSE:De.OPEN,c=s.includes(Ge.DeepSeek)&&t.getDeepThinkStatus(c)?Pe.OPEN:Pe.CLOSE,d=s.includes(Ge.SMART_MODE)&&t.getMcpSwitchStatus(d)?Ee.OPEN:Ee.CLOSE),Je({},e,{checked:s===n,isShowFuncBtn:s.includes(Ge.DeepSeek),isShowCapsule:s===Ge.SMART_MODE,modelFunction:{internetSearch:l,deepThink:c,mcpSwitch:d}});});},this.handleModelData=function(e,n,a){void 0===n&&(n=[]),void 0===a&&(a=!1);var i={},o=[].concat(n),r=(null==e?void 0:e.landingPageSwitch)||"",s=(null==e?void 0:e.notifyAppModelId)||"";if((null==e?void 0:e.usedModel)&&t.updateLocalModelData(null==e?void 0:e.usedModel),Array.isArray(o)&&o.length>0){var l,c=null==e||null==(l=e.usedModel)?void 0:l.modelName;if(((c===Ge.DeepSeek_R1&&o.some(function(t){return t.id!==Ge.DeepSeek_R1;}))&&o.some(function(t){return t.id===Ge.DeepSeek;}))&&(c="DeepSeek"),!a||c){c="undefined"!==c&&c?c:ve.DEFAULT_MODEL_ID,o.some(function(t){return t.id===c&&(t.enable||t.hasPermission);})||(c=ve.DEFAULT_MODEL_ID),o.some(function(t){return t.id===c;})||(c=o[0].id);var d=(o=t.handleModelUi(o,c,!0)).find(function(t){return t.id===c;});i={modelName:null==d?void 0:d.id,modelFunction:null==d?void 0:d.modelFunction};}}var u={};return 0!==o.length&&__call$(Object,"assign",[u,{modelList:o}]),r&&__call$(Object,"assign",[u,{landingPageSwitch:r}]),i.modelName&&__call$(Object,"assign",[u,{usedModel:i}]),(null==e?void 0:e.notifyAppModelId)&&__call$(Object,"assign",[u,{notifyAppModelId:s}]),u;},this.getInternetStatus=function(t){var e=localStorage.getItem(ye)||"{}",n=!1;try{var a,i=JSON.parse(e);if(null==i?void 0:i.modelName.includes(Ge.DeepSeek))n="1"===(null==i||null==(a=i.modelFunction)?void 0:a.internetSearch);else n="1"===t;}catch(t){}return n;},this.getDeepThinkStatus=function(t){var e=localStorage.getItem(ye)||"{}",n=!0;try{var a,i,o=JSON.parse(e);if((null==o?void 0:o.modelName.includes(Ge.DeepSeek))&&void 0!==(null==o||null==(a=o.modelFunction)?void 0:a.deepThink))n="1"===(null==o||null==(i=o.modelFunction)?void 0:i.deepThink);else n="1"===t;}catch(t){}return n;},this.getMcpSwitchStatus=function(t){var e=localStorage.getItem(ye)||"{}",n=!1;try{var a,i,o=JSON.parse(e);if((null==o?void 0:o.modelName.includes(Ge.SMART_MODE))&&void 0!==(null==o||null==(a=o.modelFunction)?void 0:a.mcpSwitch))n="1"===(null==o||null==(i=o.modelFunction)?void 0:i.mcpSwitch);else n="1"===t;}catch(t){}return n;},this.updateLocalModelData=function(t){var e,n,a,i=localStorage.getItem(ye)||"{}",o={modelFunction:{}};try{o=JSON.parse(i);}catch(t){return;}o.modelFunction||(o.modelFunction={}),(null==t?void 0:t.modelName)&&(o.modelName=t.modelName),void 0!==(null==t||null==(e=t.modelFunction)?void 0:e.internetSearch)&&(o.modelFunction.internetSearch=t.modelFunction.internetSearch),void 0!==(null==t||null==(n=t.modelFunction)?void 0:n.deepThink)&&(o.modelFunction.deepThink=t.modelFunction.deepThink),void 0!==(null==t||null==(a=t.modelFunction)?void 0:a.mcpSwitch)&&(o.modelFunction.mcpSwitch=t.modelFunction.mcpSwitch),localStorage.setItem(ye,JSON.stringify(o));},this.setLocalModelData=function(t){localStorage.setItem(ye,JSON.stringify(t));},this.init=function(e,n,a){return void 0===n&&(n=[]),void 0===a&&(a=!1),t.handleModelData(e,n,a);},this.getModelTip=function(){var e=localStorage.getItem(t.ModelTipMap.TIPS_SHOW_TEXT_KEY);return(t.guideShowData||{}).isShowGuide&&e!==t.newModelTip?(localStorage.setItem(t.ModelTipMap.TIPS_SHOW_TEXT_KEY,t.newModelTip),t.newModelTip):"";},this.setGuideShowData=function(e){t.guideShowData=e.modelGuide,t.defaultGuideData=e.defaultGuide;},this.setNewModelTip=function(e){t.newModelTip=e;},this.getNewModelTip=function(){return t.newModelTip;},this.getModelGuideShowData=function(e){var n=t.ModelTipMap.GUIDE_SHOW_KEY+"-"+e,a=localStorage.getItem(n),i=t.guideShowData||{},o=i.isShowGuide,r=i.modelGuideList;if(a||!o)return null;var s=null==r?void 0:r.find(function(t){return t.modelId===e&&"model"===t.level;});return s&&localStorage.setItem(n,"1"),s;};}() ;function Ke(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Xe(){return Xe=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Xe.apply(this,Array.from(arguments))}function Ye(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ke(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ke(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ze(t,e){if(t&&e)return t.variables&& __get$(t.variables,e) }function tn(t,e,n){var a=Ze(t,e);return!!a&&a===n}function en(t,e,n){if(lt())return{usedModel:function(){var t=JSON.parse(localStorage.getItem(ye));if(t&&Object.keys(t).length)return t;var e={modelName:"DeepSeek-R1",modelFunction:{internetSearch:De.CLOSE}};return localStorage.setItem(ye,JSON.stringify(e)),e}()};if("wise"===rt()){var a=Ve.init;return(0,Ve.setNewModelTip)(n),a(t,e)}return{}}function nn(){var t,e,n= new URL(__get$(__get$Loc(location),"href")) .search,a=Fe('script[name="aiTabFrameBaseData"]')||{},i=qt( new URL(__get$(__get$Loc(location),"href")) .searchParams),o=$e({searchParams:i,user: __call$(Object,"assign",[a.user||{},a.userInfo||{}]) }),r="pc"!==rt()&&( __get$(window,"location") .pathname===_e.CHAT.path||lt()||tn(a.sample,"WISE_NEW_CSAITAB","1")),s="pc"!==rt()&&Ze(a.sample,"SINGLE_LINE_OVERVIEW");if(vt()){var l="https://chat.baidu.com"; __call$(Object,"assign",[a,{user:{},chatParams:{sse_host:l,sse_ws_host:l,setype:"csaitab"},urlInfo:{guideWordsUrl:l+"/aichat/api/aitabserver?ctl=guidewords"}}]) }return{syncSearchParams:n,guideWord:"",agentList:[],firstRankQuery:o.query,chatSearchAcitonId:o.chatSearchAcitonId||"",oriLid:o.oriLid||"",apagelid:o.apagelid||"",aPageWord:o.aPageWord||"",sgeLid:o.sgeLid||"",askType:o.askType||"",connectPreQuery:o.connectPreQuery||"",searchframeLid:r||"pc"===rt()?a.lid||Date.now():null==a||null==(t=a.searchframeParams)?void 0:t.lid,chatSearch:a.chatSearch,chatParams:a.chatParams||{},preChatParms:{},sa:o.sa||"",oriSa:o.sa||"",pn:0,isShowHello:+o.isShowHello||0,helloInfo:o.helloInfo||{},isHistoryLoading:!1,enterType:o.enterType||"",pcEnterType:o.pcEnterType||"",outEnterType:o.outEnterType||"",initShowHistory:o.initShowHistory||!1,triggerType:o.triggerType||ae.CONVERSATION,appUrlParams:{},shareId:o.shareId||"",lid:"",rank:0,topRank:1,shareRankList:[],showSelectedBox:!1,query:o.query||"",qaPairIdDiff:0,agentInfo:o.agentInfo||{},agentRank:0,agentSessionCount:0,agentSa:"bkb_agent",preQuery:"",showScrollToBottomBtn:!1,naInjectTime:o.naInjectTime,iosSlipPrefetchEnable:o.iosSlipPrefetchEnable,startTimeList:o.startTimeList,aitab_ct:o.aitab_ct,actiontype:o.actiontype,imageQuery:{},imageQueryLid:{},token:a.token||(null==(e=a.searchframeParams)?void 0:e.token)||"",pcClickInfo:{},searchParams:i,csextdata:o.csextdata,prefetchUrl:[],tplname:o.tplname||"",srcid:o.srcid||"",order:o.order||"",upperSearchbox:o.upperSearchbox,openInputPanel:o.openInputPanel,hideTopAgentList:!1,chatStatus:"",generateStatus:"",curRankInfo:{rank:0},subEnterType:o.subEnterType||"",subSession:{entrance:o.subEnterType||"",oriLid:"",reRank:0},blockCmptList:{},truncQueryIndexRange:[],phoneParams:a.phoneParams||{},syncTabData:!1,pulldownDisabled:!1,firstRankHideQuery:!1,showMindMap:!1,showWorkspaceType:"",workspaceData:{wenku:{outlineLid:"",outlineQid:"",pptId:""}},pptRanks:[],withoutStopSseRanks:[],messageReadStyle:o.messageReadStyle,urlInfo:a.urlInfo,singleOverviewType:s||"",pluginPromptType:0,chatPageInitialized:!1,searchBoxPanel:o.searchBoxPanel||"",topBarHeight:o.topBarHeight||"",bottomBarHeight:o.bottomBarHeight||""}}function an(){var t="";window.page&&window.page.amd&&window.page.amd.version&&(t=window.page.amd.version.searchUi);var e=Fe('script[name="aiTabFrameBaseData"]')||{},n=$e({searchParams:qt( new URL(__get$(__get$Loc(location),"href")) .searchParams),user: __call$(Object,"assign",[e.user||{},e.userInfo||{}]) }),a=en(n.initModelInfo,e.modelList||[],e.bottomModelGuide),i=function(t){if("pc"===rt()){var e=(0,Qe.init)(t),n=e.usableModel;return{usedModel:e.usedModel,usableModel:n}}return{usedModel:{},usableModel:[]}}(e),o=i.usedModel,r=i.usableModel,s="pc"!==rt()&&( __get$(window,"location") .pathname===_e.CHAT.path||tn(e.sample,"WISE_NEW_CSAITAB","1"));return!s&&function(t){if("pc"!==rt()){var e= new window.URL(__get$(__get$(window,"location"),"href")) ,n=new URLSearchParams(e.search);t.forEach((function(t){return n.delete(t)}));var a=e.origin+e.pathname+"?"+n.toString();window.history.replaceState({},document.title,a)}}(ee),{user:n.user||{},sample:e.sample,isWiseNewCsaitab:s,tabData:{lid:e.lid,data:e.tabList,showTabCount:e.showTabCount,showTagCount:e.showTagCount||4,hasSearchTag:e.hasSearchTag||!1,logUrl:"https://m.baidu.com/tc?",logParams:e.logParams||{}},sid:n.sid,tabName:n.tabName||"",tabList:e.tabList,pageType:n.pageType||"",cosmicVersion:e.cosmicVersion,scVersion:e.scVersion,searchUiVersion:t||"",openLeftAgent:n.openLeftAgent||0,queryIndustry:"",queryIntent:"",urlInfo:e.urlInfo,clientHeaders:n.clientHeaders||{},conversationLogId:n.conversationLogId,usedModel:a.usedModel||o,usableModel:r,modelList:a.modelList||[],landingPageSwitch:a.landingPageSwitch||"",notifyAppModelId:a.notifyAppModelId||"",showCapsules:!0}}var on= new Tt.Store({initData:Xe({},nn(),an()),actions:{update:function(t){for(var e,n=Dt.builder(),a=Ye(Object.keys(t));!(e=a()).done;){var i=e.value;n=n.set(i,__get$(t,i));}return n;},resetChatPageStore:function(){for(var t,e=nn(),n=Dt.builder(),a=Ye(Object.keys(e));!(t=a()).done;){var i=t.value;n=void 0===__get$(e,i)?n.omit(i):n.set(i,__get$(e,i));}return n;}}}) ;function rn(){return rn=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},rn.apply(this,Array.from(arguments))}var sn="19_103",ln="ai_tab",cn=vt();function dn(t){try{var e,n;if(cn)t.info&&(t.info.is_plugin=1);else if(null==(e=t.info)?void 0:e.file){var a,i;return!(null==(i=t.info)||null==(a=i.file)?void 0:a.startsWith("chrome-extension://"))}return(null==(n=t.info)?void 0:n.msg)&&/talosGlobalFuncName\d{10,}/.test(t.info.msg)&& __call$(t.info.msg,"replace",[/talosGlobalFuncName\d{10,}/,"talosGlobalFuncName${timestamp}"]) ,!0}catch(t){return!0}}var un=new X({pid:sn,lid:"",sample:1});function pn(t,e){var n=e.group;un.sendExceptForError(t,{group:n})}function hn(t){!on.getState("isDev")&&t&&un.sendPerf({group:"guide",info:{requestTime:t}})}tt.init({pid:sn,lid:"",resourceError:{group:ln+"_resource",sample:1,handler:function(t){return dn(t)}},jsError:{group:ln+"_js_error",sample:1,handler:function(t){return dn(t)}},whiteScreenError:{selector:"body",subSelector:"#conversation-flow-container",sample:0,timeout:6e3,group:ln+"_white_screen",handler:function(t){return dn(t)}}}),window.addEventListener("unhandledrejection",(function(t){var e=t.reason||{};un.sendExcept({group:ln+"_js_error",info:{msg:"string"==typeof e?e:e.message,stack:(e.stack||"").split("\n").slice(0,5).join("\n")}})}));var fn={exports:{}};!function(t){n.commonjsGlobal,t.exports=function(){var t=function(e,n){var a,i;return t=Object.setPrototypeOf||(a={__proto__:[]},(null!=(i=Array)&&"undefined"!=typeof Symbol&& __get$(i,Symbol.hasInstance) ?!! __call$(i,Symbol.hasInstance,[a]) :a instanceof i)&&function(t,e){t.__proto__=e})||function(t,e){for(var n in e)e.hasOwnProperty(n)&&( __set$(t,n,__get$(e,n)) )},t(e,n)};function e(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}var n=function(){function t(t,e){this.data=t,this.weight=e}return t.prototype.preOrder=function(t){t.push(this),this.left&&this.left.preOrder(t),this.right&&this.right.preOrder(t)},t}();function a(t){for(var e=[],a={},i=0,o=t;i<o.length;i++){var r= __get$(o,i) ;null== __get$(a,r) ? __set$(a,r,1) :a[r]++}for(var s=0,l=Object.entries(a);s<l.length;s++){var c= __get$(l,s) ,d=c[0],u=c[1];e.push(new n(d,u))}return e}function i(t){for(var e=function(t,e){return t.weight-e.weight};t.length>1;){t.sort(e);var a=t.shift(),i=t.shift();if(a&&i){var o=new n(null,a.weight+i.weight);o.left=a,o.right=i,t.unshift(o)}}return t.shift()}function o(t){if(null==t)return null;var e={};function n(t,a,i){var o=[].concat(i);o.push(a),null!=t&&(null==t.data?(n(t.left,"0",o),n(t.right,"1",o)): __set$(e,t.data,o.join("")) )}return n(t,"",[]),e}function r(t,e){for(var n=[],a=0,i=t;a<i.length;a++){var o= __get$(i,a) ;n.push( __get$(e,o) )}return n}function s(t){for(var e=t.join(""),n=Math.ceil(e.length/8),a=new Array(n+1),i=0,o="",r=0;r<e.length;r+=8)o=e.substring(r,r+8), __set$(a,i,parseInt(o,2)) ,i++;return  __set$(a,i,o.length) ,a}function l(t){var e=o(i(a(t)));return{result:s(r(t,e)),codes:e}}function c(t,e){t&&(e|=256);var n=Number(e).toString(2);return t?n.substring(n.length-8):n}function d(t,e){for(var n=[],a=0;a<e.length-1;a++){var i=a!==e.length-2;n.push(c(i, __get$(e,a) ))}var o= __get$(n,n.length-1) ,r= __get$(e,e.length-1) ;o="00000000".substring(8-(r-o.length))+o, __set$(n,n.length-1,o) ;for(var s={},l=0,d=Object.entries(t);l<d.length;l++){var u= __get$(d,l) ,p=u[0]; __set$(s,u[1],p) }var h=n.join(""),f=[],g=h.length;for(a=0;a<g;){for(var m=1,v=(i=!0,null);i&&a+m<=g&&""!==(p=h.substring(a,a+m));)(v= __get$(s,p) )?i=!1:m++;f.push(parseInt(v,10)),a+=m}return f}function u(t){for(var e=[],n=0;n<t.length;n++)e.push(t.charCodeAt(n));return e}function p(t){for(var e="",n=0,a=t;n<a.length;n++){var i= __get$(a,n) ;e+=String.fromCharCode(i)}return e}function h(t){var e=l(u(t)),n=e.result;return{codes:e.codes,result:p(n)}}function f(t,e){return p(d(t,u(e)))}var g=function(){function t(){}return t.prototype.set=function(t,e){},t.prototype.get=function(t,e){},t.prototype.rm=function(t){},t}(),m=function(t){function n(){return null!==t&&t.apply(this,Array.from(arguments))||this}return e(n,t),n.isSupport=function(){return!!window.localStorage},n.prototype.set=function(t,e){try{localStorage.setItem(t,e)}catch(t){console.error(t)}},n.prototype.get=function(t,e){var n=null;try{n=localStorage.getItem(t)}catch(t){console.error(t)}e&&e(n)},n.prototype.rm=function(t){try{localStorage.removeItem(t)}catch(t){console.error(t)}},n}(g),v=function(t){function n(){var e=t.call(this)||this;e.databaseName="spyLC",e.db=null,e.setQueue=[],e.getQueue=[];var n=window.indexedDB.open(e.databaseName);return n.onupgradeneeded=function(t){e.db=t.target&&t.target.result,e.db&&!e.db.objectStoreNames.contains(e.databaseName)&&e.db.createObjectStore(e.databaseName,{keyPath:"key"}),e.runQueueTask()},n.onsuccess=function(){e.db=n.result,e.runQueueTask()},e}return e(n,t),n.isSupport=function(){return!!window.indexedDB},n.prototype.set=function(t,e){this.db?this.db.transaction([this.databaseName],"readwrite").objectStore(this.databaseName).add({key:t,value:e}):this.setQueue.push({key:t,value:e})},n.prototype.get=function(t,e){if(this.db){var n=this.db.transaction([this.databaseName]).objectStore(this.databaseName).get(t);n.onsuccess=function(){var t=n.result?n.result:{value:""};e(t.value)}}else this.getQueue.push({key:t,cb:e})},n.prototype.runQueueTask=function(){var t=this;this.setQueue.forEach((function(e){t.set(e.key,e.value)})),this.getQueue.forEach((function(e){t.get(e.key,e.cb)}))},n}(g);function y(){for(var t=[],e=0;e<Array.from(arguments).length;e++) __set$(t,e,__get$(Array.from(arguments),e)) ;var n=Object.assign||function(t){for(var e=void 0,n=1,a=Array.from(arguments).length;n<a;n++)for(var i in e= __get$(Array.from(arguments),n) )Object.prototype.hasOwnProperty.call(e,i)&&( __set$(t,i,__get$(e,i)) );return t};return n.apply(this,t)}function w(t){for(var e="",n=0;n<t.length;n++){var a=t.charCodeAt(n);a<128?e+=String.fromCharCode(a):a>127&&a<2048?(e+=String.fromCharCode(a>>6|192),e+=String.fromCharCode(63&a|128)):(e+=String.fromCharCode(a>>12|224),e+=String.fromCharCode(a>>6&63|128),e+=String.fromCharCode(63&a|128))}return e}function b(t){for(var e="",n=0,a=0,i=0,o=0;n<t.length;)(a=t.charCodeAt(n))<128?(e+=String.fromCharCode(a),n++):a>191&&a<224?(i=t.charCodeAt(n+1),e+=String.fromCharCode((31&a)<<6|63&i),n+=2):(i=t.charCodeAt(n+1),o=t.charCodeAt(n+2),e+=String.fromCharCode((15&a)<<12|(63&i)<<6|63&o),n+=3);return e}function _(t,e){if(void 0===e&&(e=!1),!t)return"";e||(t=w(t));var n,a,i,o={},r=[],s=t.charAt(0),l=s,c=l,d=256,u=function(){r.push(s.length>1?String.fromCharCode( __get$(o,s) ):s)};for(e&&r.push(s),n=1;n<t.length;n++)a=t.charAt(n),e?(i=t.charCodeAt(n),s=i<256?a: __get$(o,i) ||s+l,r.push(s),l=s.charAt(0), __set$(o,d++,c+l) ,c=s):o.hasOwnProperty(s+a)?s+=a:(u(), __set$(o,s+a,d++) ,s=a);e||u();var p=r.join("");return e&&(p=b(p)),p}var k=function(){function t(t){void 0===t&&(t={}),this.tmpList=[],this.option=y({defaultTrigger:!0,compress:"lzw",key:"SpyLocalCache",interval:500,maxRecordLen:30,onFlush:function(){},onSave:function(){},onAdd:function(){return!0},storage:v.isSupport()?"indexedDB":m.isSupport()?"localstorage":"empty"},t),this.load=this.load.bind(this),this.init()}return t.prototype.init=function(){"indexedDB"===this.option.storage?this.storage=new v:"localstorage"===this.option.storage?this.storage=new m:this.storage=new g,"complete"===document.readyState?this.load():window.addEventListener("load",this.load)},t.prototype.load=function(){ __get$Loc(location) .search.indexOf("_FlushLogLocalCache=1")>-1&&this.option.defaultTrigger&&this.flushLog()},t.prototype.addLog=function(t){var e=this;this.option.onAdd&&!this.option.onAdd(t)||(t=JSON.stringify(t),this.tmpList.push(t),this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.save()}),this.option.interval))},t.prototype.getData=function(t){var e=this;try{this.storage.get(this.option.key,(function(n){n?e.storage.get(e.option.key+"Codes",(function(a){var i=[];try{a&&(a=JSON.parse(a)),i=e.unzip(n,a).split("\n")}catch(t){console.error(t)}t(i)})):t([])}))}catch(e){console.error(e),t([])}},t.prototype.save=function(){var t=this,e=Date.now();this.getData((function(n){var a=t.option.maxRecordLen-1,i=(n.length>a?n.slice(n.length-a,n.length):n).concat(t.tmpList),o=i.join("\n"),r=null,s=0;try{var l=t.zip(o),c="";l.codes?(c=JSON.stringify(l.codes),t.storage.set(t.option.key+"Codes",c)):t.storage.rm(t.option.key+"Codes"),t.storage.set(t.option.key,l.result),s=l.result.length}catch(t){r=t,console.error(t)}t.tmpList=[],t.option.onSave&&t.option.onSave({cost:Date.now()-e,length:s/1024,list:i,error:r})}))},t.prototype.flushLog=function(){var t=this;this.getData((function(e){try{for(var n=0;n<e.length;n++) __set$(e,n,JSON.parse(__get$(e,n))) }catch(n){e=[],t.storage.rm(t.option.key),console.error(n)}for(n=0;n<t.tmpList.length;n++)e.push(JSON.parse( __get$(t.tmpList,n) ));t.option.onFlush&&t.option.onFlush(e)}))},t.prototype.zip=function(t){return"lzw"===this.option.compress?{codes:null,result:_(t)}:"huffman"===this.option.compress?h(t):{codes:null,result:t}},t.prototype.unzip=function(t,e){return"lzw"===this.option.compress?_(t,!0):"huffman"===this.option.compress?f(e,t):t},t}();return k}()}(fn);var gn=fn.exports,mn=n.getDefaultExportFromCjs(gn);function vn(){return vn=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},vn.apply(this,Array.from(arguments))}var yn=function(){function t(){var e=this;this.spyCache=new mn({maxRecordLen:50,onFlush:t.getFlushFun(),storage:"localstorage",key:"csSpyLocalCache",compress:"no"}),window.onbeforeunload=function(){e.spyCache&&e.spyCache.save()},window.addEventListener("error",(function(t){e.sendLog({msg:t.message})}))}return t.prototype.sendLog=function(t){var e=on.getState("curRankInfo")||{};this.spyCache&&this.spyCache.addLog(vn({},t,{lid:e.lid||""}))},t.getFlushFun=function(){return function(t){t&&t.length&&function(t){for(var e=t.length;e>0&&!(encodeURIComponent(JSON.stringify(t)).length<6e3);e--)t.splice(0,1);un.sendExcept({group:"chat_local_cache",info:{msg:JSON.stringify(t)}})}(t)}},t}();function wn(t,e){return"string"==typeof t?Array.from(e?e.querySelectorAll(t):document.querySelectorAll(t)):(n=t,(null!=(a=Element)&&"undefined"!=typeof Symbol&& __get$(a,Symbol.hasInstance) ? __call$(a,Symbol.hasInstance,[n]) :n instanceof a)?[t]:Array.isArray(t)?t:"[object NodeList]"===Object.prototype.toString.call(t)?Array.from(t):[]);var n,a}function bn(t,e){return wn(t,e)}function _n(t,e){return e?e.querySelector(t):document.querySelector(t)}function kn(t,e,n){var a=wn(t);if(void 0===n)return a.length>0?a[0].getAttribute(e):null;a.forEach((function(t){null===n?t.removeAttribute(e):t.setAttribute(e,n)}))}function Sn(t){wn(t).forEach((function(t){t.parentNode&&t.parentNode.removeChild(t)}))}function xn(t,e,n){if(Element.prototype.closest)return t.closest(e);do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType&&n&&t!==n);return null}function In(t,e){return t?t.classList&&t.classList.contains(e)?t:In(t.parentElement,e):null}var Tn={exports:{}};function Cn(t,e){return null!=e&&"undefined"!=typeof Symbol&& __get$(e,Symbol.hasInstance) ?!! __call$(e,Symbol.hasInstance,[t]) :t instanceof e}function Ln(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":e._typeof(t)}!function(t){!function(){function e(t){var e={hash:"",queryString:"",params:{},query:{},path:t},n=e.path.indexOf("#");n>=0&&(e.hash=e.path.slice(n+1),e.path=e.path.slice(0,n));var a=e.query,i=e.path.indexOf("?");if(i>=0){e.queryString=e.path.slice(i+1),e.path=e.path.slice(0,i);for(var o=e.queryString.split("&"),r=0;r<o.length;r++){var s= __get$(o,r) ,l=s.indexOf("="),c="";l>0&&(c=s.slice(l+1),s=s.slice(0,l));var d=decodeURIComponent(s);c=decodeURIComponent(c),a.hasOwnProperty(d)? __set$(a,d,[].concat(__get$(a,d),c)) : __set$(a,d,c) }}return e}function n(t){if(!t)return"";if("string"==typeof t)return t;var e,n=t.query,a=t.params,i=t.path||"",o=[];if(i)for(var r=i.split("/"),s=0,l=r.length;s<l;s++){var c= __get$(r,s) ;if(/^:[a-z0-9_-]+$/.test(c)){e=!0;var d=c.slice(1);o.push(a&& __get$(a,d) ||n&& __get$(n,d) )}else o.push(c)}var u=t.queryString||"";if(0===u.indexOf("?")&&(u=u.slice(1)),!u&&n&&(!e||a)){var p=!0;for(var h in n)n.hasOwnProperty(h)&&(u+=(p?"":"&")+h+"="+encodeURIComponent( __get$(n,h) ),p=!1)}return o.join("/")+(u&&"?")+u}function a(t,n){var a,i=e(t),o=e(n),r=i.path;if(0===r.indexOf("/"))return t;if(r){var s=r.split("/"),l=o.path.split("/");l.pop();for(var c=0;c<s.length;c++){var d= __get$(s,c) ;switch(d){case"..":l.pop();break;case".":break;default:l.push(d)}}""!==l[0]&&l.unshift(""),a=l.join("/")}else a=o.path;return a+(i.queryString?"?"+i.queryString:"")}function i(){}function o(){var t= __get$(__get$Loc(location),"href") .indexOf("#");return t<0?"/": __get$(__get$Loc(location),"href") .slice(t+1)||"/"}function r(){this.current=o(),this.referrer="";var t=this;this.hashChangeHandler=function(){t.redirect(o())}}function s(){return  __get$Loc(location) .pathname+ __get$Loc(location) .search}function l(){if(!l.isSupport)throw new Error("[SAN-ROUTER ERROR] Your navigator doesn't supports HTML5!");this.current=s(),this.referrer="";var t=this;this.popstateHandler=function(){t.referrer=t.current,t.current=s(),t.fire("redirect",{url:t.current,referrer:t.referrer})}}i.prototype.on=function(t,e){"function"==typeof e&&(this._eventListeners||(this._eventListeners={}), __get$(this._eventListeners,t) ||( __set$(this._eventListeners,t,[]) ), __get$(this._eventListeners,t) .push(e))},i.prototype.un=function(t,e){if(this._eventListeners&& __get$(this._eventListeners,t) )if(e)for(var n= __get$(this._eventListeners,t) ,a=n.length;a--;) __get$(n,a) ===e&&n.splice(a,1);else  __set$(this._eventListeners,t,[]) },i.prototype.fire=function(t,e){if(!t)throw new Error("No event type specified");var n=this._eventListeners&& __get$(this._eventListeners,t) ;if(n)for(var a=0;a<n.length;a++) __call$(n,a,[e]) },r.prototype=new i,r.prototype.constructor=r,r.prototype.start=function(){window.addEventListener&&window.addEventListener("hashchange",this.hashChangeHandler,!1),window.attachEvent&&window.attachEvent("onhashchange",this.hashChangeHandler)},r.prototype.stop=function(){window.removeEventListener&&window.removeEventListener("hashchange",this.hashChangeHandler,!1),window.detachEvent&&window.detachEvent("onhashchange",this.hashChangeHandler)},r.prototype.redirect=function(t,e){e=e||{},t=a(t,this.current);var n,i,o,r=this.current,s=t!==r;s?(this.referrer=r,this.current=t,e.replace? __call$(__get$Loc(location),"replace",[(n=t,i=__get$(__get$Loc(location),"href"),o=i.indexOf("#"),i.slice(0,o+1)+n)]) : __get$Loc(location) .hash=t):r=this.referrer,!s&&!e.force||e.silent||this.fire("redirect",{url:t,referrer:r})},r.prototype.reload=function(){this.redirect(this.current,{force:!0})},l.prototype=new i,l.prototype.constructor=l,l.prototype.start=function(){window.addEventListener("popstate",this.popstateHandler)},l.prototype.stop=function(){window.removeEventListener("popstate",this.popstateHandler)},l.prototype.redirect=function(t,e){e=e||{},t=a(t,this.current);var n=this.current,i=t!==n;i&&(this.referrer=n,this.current=t, __call$(history,e.replace?"replaceState":"pushState",[{},"",t]) ),!i&&!e.force||e.silent||this.fire("redirect",{url:t,referrer:n})},l.prototype.reload=function(){this.fire("redirect",{url:this.current,referrer:this.referrer})},l.isSupport="pushState"in window.history;var c=365611;function d(t){return t.prototype&&(5===t.prototype.nodeType||"san-cmpt"===t.prototype._type)}function u(t){var n=(t=t||{}).mode||"hash";this.routes=[],this.routeAlives=[],this.listeners=[],this.__withRouteListeners=[],this.__redirectListener=function(t){return function(n){var a=e(n.url),i=t.match(a,n.referrer),o=i?i.data:a,r=0,s=1,l={url:n.url,hash:o.hash,queryString:o.queryString,query:o.query,params:o.params,path:o.path,referrer:n.referrer,config:i&&i.route.config,data:i&&i.data,resume:function(){0===s&&(s=1,c())},suspend:function(){s=0},stop:function(){s=-1}};function c(){if(s>0){if(r<t.listeners.length) __get$(t.listeners,r++) .call(t,l);else u();s>0&&c()}}function u(){if(s=-1,i)!function(t,e){var n=e.route,a=!1,i=t.routeAlives.length,o=t.__withRouteListeners.slice(0);for(;i--;){var r= __get$(t.routeAlives,i) ;r.id===n.id?(r.component.data.set("route",e.data),"function"==typeof r.component.route&&r.component.route(),a=!0):(r.component.dispose(),t.routeAlives.splice(i,1))}a||(n.Component?d(n.Component)?h(t,e):n.Component().then((function(a){d(a)?n.Component=a:a.__esModule&&d(a.default)&&(n.Component=a.default),h(t,e)})):n.handler.call(t,e.data));for(var s=0,l=o.length;s<l;s++) __call$(o,s,[e]) }(t,i);else for(var e=t.routeAlives.length;e--;) __get$(t.routeAlives,e) .component.dispose(),t.routeAlives.splice(e,1)}c()}}(this),this.setMode(n)}function p(t,e){var n=e.rule,a=[""];if("string"==typeof n){var i= __call$(n,"replace",[/\/:([a-z0-9_-]+)(?=\/|$)/gi,function(t,e){return a.push(e),"/([^/\\s]+)";}]) ;n=new RegExp("^"+i+"$","i")}if(!Cn(n,RegExp))throw new Error("[SAN-ROUTER ERROR] Rule must be string or RegExp!");var o=(++c).toString();t.routes.push({id:o,rule:n,handler:e.handler,keys:a,target:e.target||"#main",Component:e.Component,config:e})}function h(t,e){var n=e.route,a=new n.Component;a.$router=t,a.data.set("route",e.data),"function"==typeof a.route&&a.route();var i=function(t){switch(void 0===t?"undefined":Ln(t)){case"object":return t;case"string":return document.querySelector?document.querySelector(t):document.getElementById( __call$(t,"replace",[/#/i,""]) )}}(n.target);if(!i)throw new Error('[SAN-ROUTER ERROR] Attach failed, target element "'+n.target+'" is not found.');a.attach(i),t.routeAlives.push({component:a,id:n.id}),"function"==typeof n.handler&&setTimeout((function(){n.handler.call(t,e.data)}))}u.prototype.match=function(t,n){"string"==typeof t&&(t=e(t));for(var a=0;a<this.routes.length;a++){var i= __get$(this.routes,a) ,o=i.rule.exec(t.path);if(o){for(var r=i.keys||[],s=1;s<o.length;s++){var l= __get$(r,s) ||s,c= __get$(o,s) ; __set$(t.query,l,c) , __set$(t.params,l,c) }return{data:{hash:t.hash,queryString:t.queryString,params:t.params,query:t.query,path:t.path,referrer:n},url:t,route:i}}}return null},u.prototype.listen=function(t){this.listeners.push(t)},u.prototype.unlisten=function(t){for(var e=this.listeners.length;e--;) __get$(this.listeners,e) ===t&&this.listeners.splice(e,1)},u.prototype.start=function(){return this.isStarted||(this.isStarted=!0,this.locator.on("redirect",this.__redirectListener),this.locator.start(),this.locator.reload()),this},u.prototype.stop=function(){return this.locator.un("redirect",this.__redirectListener),this.locator.stop(),this.isStarted=!1,this},u.prototype.setMode=function(t){if(t=t.toLowerCase(),this.mode!==t){this.mode=t;var e=!1;switch(this.isStarted&&(this.stop(),e=!0),t){case"hash":this.locator=new r;break;case"html5":this.locator=new l}return e&&this.start(),this}},u.prototype.add=function(t){if(Cn(t,Array))for(var e=0,n=t.length;e<n;e++)p(this, __get$(t,e) );else"object"===(void 0===t?"undefined":Ln(t))&&p(this,t);return this},u.prototype.push=function(t,e){this.locator.redirect(n(t),e)},u.prototype.replace=function(t,e){e= __call$(Object,"assign",[{replace:!0},e]) ,this.locator.redirect(n(t),e)};var f,g=new u;try{f=new Function("RawClass","return class extends RawClass {}")}catch(t){}function m(t){var e;return(e=0===t.toString().indexOf("class")?f(t):function(t){var e=new Function;e.prototype=t.prototype;var n=function(e){return t.call(this,e)||this};return(n.prototype=new e).constructor=n,e.prototype.hasOwnProperty("aPack")&&(n.prototype.aPack=e.prototype.aPack),n}(t)).template=t.template,e.components=t.components,e.trimWhitespace=t.trimWhitespace,e.delimiters=t.delimiters,e.autoFillStyleAndId=t.autoFillStyleAndId,e.filters=t.filters,e.computed=t.computed,e.aPack=t.aPack,e.messages=t.messages,e}function v(t){return{template:'<a href="{{hrefPrefix}}{{href}}" onclick="return false;" on-click="clicker($event)" target="{{target}}" class="{{isActive ? activeClass : \'\'}}"><slot/></a>',clicker:function(e){var n=this.data.get("href");"string"==typeof n&&t.locator.redirect( __call$(n,"replace",[/^#/,""]) ),e.preventDefault?e.preventDefault():e.returnValue=!1},inited:function(){var e=this;this.routeListener=function(t){e.data.set("isActive",t.url===e.data.get("href"))},this.routeListener({url:t.locator.current}),t.listen(this.routeListener)},disposed:function(){t.unlisten(this.routeListener),this.routeListener=null},initData:function(){return{isActive:!1,hrefPrefix:"hash"===t.mode?"#":""}},computed:{href:function(){return a(this.data.get("to")||"",t.locator.current)}}}}var y={Link:v(g),createLink:v,withRoute:function(t,e){var n,a,i;e=e||g,"function"==typeof t?(a=m(t),n=t.prototype,i=a.prototype):(n=t||{},i=a= __call$(Object,"assign",[{},t]) );var o=n.inited;i.inited=function(){this.$router=e,this.data.set("route",e.match(e.locator.current,e.locator.referrer).data),"function"==typeof this.route&&this.route();var t=this;this.__routerListener=function(e){t.data.set("route",e.data),"function"==typeof t.route&&t.route()},e.__withRouteListeners.push(this.__routerListener),"function"==typeof o&&o.call(this)};var r=n.disposed;return i.disposed=function(){if(this.$router){for(var t=this.$router.__withRouteListeners,e=t.length;e--;)if( __get$(t,e) ===this.__routerListener){t.splice(e,1);break}this.__routerListener=null,this.$router=null}"function"==typeof r&&r.call(this)},a},router:g,Router:u,HashLocator:r,HTML5Locator:l,resolveURL:a,parseURL:e,stringifyURL:n,version:"2.0.2"};t.exports=y}()}(Tn);var Dn=Tn.exports,Pn={exports:{}};function En(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":e._typeof(t)}!function(t){n.commonjsGlobal,t.exports=function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==En(Symbol.iterator)?function(t){return void 0===t?"undefined":En(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":En(t)})(e)}function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}): __set$(t,e,n) ,t}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function a(t){for(var a=1;a<Array.from(arguments).length;a++){var i=null!= __get$(Array.from(arguments),a) ? __get$(Array.from(arguments),a) :{};a%2?n(Object(i),!0).forEach((function(n){e(t,n, __get$(i,n) )})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function i(t,e){if(null==t)return{};var n,a,i=function(t,e){if(null==t)return{};var n,a,i={},o=Object.keys(t);for(a=0;a<o.length;a++)n= __get$(o,a) ,e.indexOf(n)>=0||( __set$(i,n,__get$(t,n)) );return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n= __get$(o,a) ,e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&( __set$(i,n,__get$(t,n)) )}return i}function o(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}var s=/^(?:(\w+)\.)?(?:(\w+)\.)?(\w+)$/;function l(t){var e=s.exec(t[0]);if(null==e||4!==e.length)throw"UBC SDK error inputs";if(this.trackerName=e[1]||"t0",this.pluginName=e[2]||"",this.methodName=e[3],this.fields=[].slice.call(t,1),this.isCreateCommand="init"===this.methodName,this.isConfigCommand="config"===this.methodName,this.isEventCommand="event"===this.methodName||"pv"===this.methodName,this.isTimingCommand="timing"===this.methodName,!this.methodName)throw"UBC SDK methodName can not be empty!";if(this.isCreateCommand&&!this.fields[0])throw"UBC SDK serverId can not be empty!"}var c=window.navigator.userAgent,d=/ (lite|info) baiduboxapp\//i.test(c),u=/ mission baiduboxapp\//i.test(c),p=/ baiduboxapp\//i.test(c)&&!d&&!u,h=function(e,n){if(!Array.isArray(e)||!Array.isArray(n))return{};for(var a={},i=Math.min(e.length+1,n.length),o=0;o<i;o++)if("object"===t( __get$(n,o) ))for(var r in  __set$(a,__get$(e,o),{}) , __get$(n,o) ) __get$(n,o) .hasOwnProperty(r)&&( __set$(__get$(a,__get$(e,o)),r,__get$(__get$(n,o),r)) );else o<e.length&&( __set$(a,__get$(e,o),__get$(n,o)) );return a};function f(t){var e=Array.from(arguments).length>1&&void 0!==Array.from(arguments)[1]?Array.from(arguments)[1]: __get$(__get$(window,"location"),"href") ,n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i");if(e.split("?")[1]){var a=e.split("?")[1].match(n);return null!=a?decodeURIComponent(a[2]):null}return null}function g(){var e=Array.from(arguments).length>0&&void 0!==Array.from(arguments)[0]?Array.from(arguments)[0]:{};if(!e)return"";var n="";for(var a in e)if(e.hasOwnProperty(a)){var i= __get$(e,a) ;null==i?i="":"object"===t(i)&&(i=JSON.stringify(i)),n+="&"+encodeURIComponent(a)+"="+encodeURIComponent(i)}return n.slice(1)}function m(){var t=Array.from(arguments).length>0&&void 0!==Array.from(arguments)[0]?Array.from(arguments)[0]:"",e=Array.from(arguments).length>1&&void 0!==Array.from(arguments)[1]?Array.from(arguments)[1]:{};return t+(~t.indexOf("?")?"&":"?")+g(e)}function v(e){var n=t(e);return"function"===n||!!e&&"object"===n}function y(t){return!0===t||!1===t}function w(){}function b(t,e){try{if("function"==typeof t.find)return t.find(e);for(var n=0;n<t.length;n++)if(e( __get$(t,n) ,n,t))return  __get$(t,n) }catch(t){}}var _={cmdQueue:[],init:function(){_.cmdQueue=[]},run:function(t){var e=t.map((function(t){return _.toCommands.apply(_,[t])})),n=_.cmdQueue.concat(e);for(_.cmdQueue=[];n.length>0;)_.runCommand.apply(this,[n[0]])&&_.cmdQueue.push(n[0]),n.shift()},toCommands:function(t){return new l(t)},runCommand:function(t){if(t.isCreateCommand)this.create.apply(this,[t.trackerName].concat(o(t.fields)));else if(t.isConfigCommand){var e=this.getByName(t.trackerName);if(!e)throw"不存在"+t.trackerName+"实例";var n=t.fields[0];for(var a in n)n.hasOwnProperty(a)&&(v( __get$(n,a) )?e.set(a, __call$(Object,"assign",[{},e.get(a),__get$(n,a)]) ):e.set(a, __get$(n,a) ))}else if(t.isEventCommand){var i=this.getByName(t.trackerName);if(!i)throw"不存在"+t.trackerName+"实例";i.send.call(i,{type:"event",fields:t.fields})}else if(t.isTimingCommand){var r=this.getByName(t.trackerName);if(!r)throw"不存在"+t.trackerName+"实例";var s=t.fields[0],l=[].slice.call(t.fields,1);"start"===s?r.regestTimingReportor(l):"end"===s&&r.endTimingReportor(l)}}};_.init();var k= __get$({http:"http://mbd.baidu.com/tcbox?action=pblog",https:"https://mbd.baidu.com/tcbox?action=pblog"},"https:"===__get$(document,"location").protocol?"https":"http") ;function S(t,e,n,a){var i=function(t){var e=document.createElement("img");return e.width=1,e.height=1,e.src=t,e}(t=m(t,{data:e})),o=!1;setTimeout((function(){n&&!o&&(n(a),o=!0)}),100),i.onload=i.onerror=function(){i=null,n&&!o&&(n(a),o=!0)}}function x(t,e,n,a){t=m(t,{data:e}),window.navigator.sendBeacon(t),n(a)}function I(t,e){var n=Array.from(arguments).length>2&&void 0!==Array.from(arguments)[2]?Array.from(arguments)[2]:w,a=Array.from(arguments).length>3&&void 0!==Array.from(arguments)[3]?Array.from(arguments)[3]:0,i=Array.from(arguments).length>4?Array.from(arguments)[4]:void 0;return"function"==typeof window.navigator.sendBeacon&&(i.model.useSendBeacon&&0===a||1===a)?x(t,e,n,i):S(t,e,n,i)}var T,C,L=[{appname:"baiduboxmission",reg:/\bmission\sbaiduboxapp\b/i,appid:"10006"},{appname:"baiduboxlite",reg:/\b(?:lite|info) baiduboxapp\b/i,appid:"10001"},{appname:"baiduboxapp",reg:/\bbaiduboxapp\b/i,appid:"1"},{appname:"tieba",reg:/\btieba\b/i,appid:"11001"},{appname:"haokan",reg:/\bhaokan\b/i,appid:"11000"},{appname:"quanmin",reg:/\bbdminivideo\b/i,appid:"12022"},{appname:"bdmap",reg:/\bbaidumap_/i,appid:"11006"},{appname:"wangpan",reg:/\bnetdisk;/i,appid:"12018"},{appname:"askmybaby",reg:/\bmybaby\//i,appid:"12019"},{appname:"xifan",reg:/\bbdxifan\//i,appid:"12006"},{appid:"12031",appname:"sowhat"},{appid:"12010",appname:"lemon",reg:/lemonapp/i},{appid:"12015",appname:"baijiahao"},{appid:"12012",appname:"fanle"},{appid:"12013",appname:"zhaocaimao"},{appid:"12014",appname:"gamenow"},{appid:"12016",appname:"iqiyi"},{appid:"12017",appname:"baike"},{appid:"12023",appname:"flow"},{appid:"12026",appname:"dutaxi"},{appid:"12011",appname:"youjia"},{appid:"12020",appname:"feedsunion"},{appid:"12021",appname:"album"},{appid:"12024",appname:"webgame"},{appid:"12027",appname:"hmi_passenger"},{appid:"12028",appname:"bdwenku"},{appid:"12029",appname:"fanyi"},{appid:"12030",appname:"iknow"},{appid:"12025",appname:"duxiaoxiao"},{appid:"12032",appname:"baiduhanyu"},{appid:"12034",appname:"exp"},{appid:"12036",appname:"demo"},{appid:"12037",appname:"baiduyuedu"},{appid:"12038",appname:"cdm"},{appid:"12040",appname:"weiba"},{appid:"12041",appname:"baiduboxvision"},{appid:"12042",appname:"hiphop"},{appid:"12043",appname:"robobus-panel"},{appid:"12044",appname:"wenkustudent"},{appid:"12045",appname:"pc_live"},{appid:"12049",appname:"yunshangbaidu"},{appid:"12050",appname:"baiduwenku_pc"},{appid:"12051",appname:"yinci"},{appid:"12052",appname:"novel"},{appid:"12054",appname:"yoopu"},{appid:"12057",appname:"yinbo"},{appid:"12062",appname:"aiqicha"},{appid:"12066",appname:"Bamboo_Health"},{appid:"12067",appname:"Bamboo_Health_Dr"},{appid:"12073",appname:"superduer"},{appid:"12074",appname:"baidujiankangapp"},{appid:"12075",appname:"bdcrm_aifanfan"},{appid:"12077",appname:"muzhidoctor"},{appid:"12079",appname:"apollogo"},{appid:"12080",appname:"lvlin"},{appid:"12083",appname:"aipurchase"},{appid:"12088",appname:"BaiDuCarLife"},{appid:"12090",appname:"baidujiankangtt"},{appid:"12092",appname:"infoflow",reg:/\bbaiduhi/i},{appid:"12094",appname:"hmi_driver"},{appid:"12095",appname:"vr_expo"},{appid:"12096",appname:"content_ecommerce"},{appid:"12097",appname:"play_control"},{appid:"12098",appname:"aipurchaser"},{appid:"12101",appname:"ditutaojin"},{appid:"12102",appname:"hp_location"},{appid:"12106",appname:"chatroom"},{appid:"12107",appname:"gaia"},{appid:"12108",appname:"ubi"},{appid:"12109",appname:"yiju"},{appid:"12111",appname:"bml"},{appid:"12112",appname:"aihome"},{appid:"12113",appname:"aihome_children"},{appid:"12114",appname:"mobsecurity"},{appid:"12117",appname:"tomas"},{appid:"12118",appname:"baidu_flutter"},{appid:"12120",appname:"wepod"},{appid:"12121",appname:"yy"},{appid:"12122",appname:"kidedu"},{appid:"12123",appname:"wangpan_faster"},{appid:"12124",appname:"wepod_mobile"},{appid:"12125",appname:"baidu_vr_classroom_launcher"},{appid:"12192",appname:"searchcraft",reg:/\bSearchCraft\b/i}],D=["type","value","ext"];function P(t){this.model={},function(t,e){t.trackerName=e.trackerName,t.trackerId=e.trackerId||"",t.timingId=e.config&&e.config.timingId||"",t.useSendBeacon=e.config&&e.config.useSendBeacon||!1,t.version=e.config&&e.config.version||"1.0",e.config&&y(e.config.ifHeartbeatTime)?t.ifHeartbeatTime=e.config.ifHeartbeatTime:t.ifHeartbeatTime=!0,e.config&&y(e.config.testMode)?t.testMode=e.config.testMode:t.testMode=!1,t.testUrl=e.config&&e.config.testUrl||"",e.config&&y(e.config.autoPvTrack)?t.autoPvTrack=e.config.autoPvTrack:t.autoPvTrack=!1,e.config&&y(e.config.autoTimingTrack)?t.autoTimingTrack=e.config.autoTimingTrack:t.autoTimingTrack=!1,t.queryParams=e.config&&e.config.queryParams||{},t.version&&(t.queryParams.v=t.version,t.queryParams.appname=t.queryParams.appname||"baiduboxapp"),t.appid=e.config&&e.config.appid||"1",t.cateid=e.config&&e.config.cateid||"99",t.actiontype=e.config&&e.config.actiontype||"0",t.from=e.config&&e.config.from||"act",t.duration=e.config&&e.config.duration||3,t.source=e.config&&e.config.source||"",t.inBox=p?"1":"0",t.abtest=e.config&&e.config.abtest||"",t.network=e.config&&e.config.network||"",t.page=e.config&&e.config.page||"",t.baiduTongJiId=e.config&&e.config.baiduTongJiId,t.isBaiduTongJi=!(!e.config||!e.config.baiduTongJiId),t.timingTasks=[],t.apptype=function(){var t=Array.from(arguments).length>0&&void 0!==Array.from(arguments)[0]?Array.from(arguments)[0]:"",e={appname:"other",appid:"12133"};if(t)return b(L,(function(e){return t===e.appname}))||e;var n,a=(null===(n=navigator)||void 0===n?void 0:n.userAgent)||"";return b(L,(function(t){return t.reg?t.reg.test(a):-1!==a.search(t.appname)}))||e}().appid}(this.model,t),this.get("isBaiduTongJi")&&(window._hmt=window._hmt||[],function(t){if(t){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=t;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}}("https://hm.baidu.com/hm.js?"+this.get("baiduTongJiId"))),this.get("autoPvTrack")&&this.send({type:"event",fields:["pageAutoPv"]}),this.get("autoTimingTrack")&&this.regestTimingReportor(["pageAutoTiming"])}P.prototype.set=function(t,e){ __set$(this.model,t,e) },P.prototype.get=function(t){return  __get$(this.model,t) },P.prototype.send=function(t){var e,n,o,r=t.type,s=t.fields,l=0;if("event"===r){if(s&&v(s[0])?(o=s[0],function(t){return"function"==typeof t}(s[1])&&(e=s[1])):o=h(D,s),n=function(t,e){var n={cateid:t.cateid,actiondata:{id:t.trackerId,type:"0",timestamp:Date.now(),content:a(a({page:t.page|| __get$(window,"location") .hostname+ __get$(window,"location") .pathname,source:t.source||f("idfrom")||"",from:t.from},e),{},{ext:a({apptype:t.apptype},e.ext)})}};return"1.0"===t.version&&(n.actiondata.abtest=t.abtest,n.actiondata.inBox=t.inBox,n.actiondata.network=t.network,n.appid=t.appid,n.actiontype=t.actiontype),n}(this.model,o),o.useSendBeacon&&(l=o.useSendBeacon),this.get("isBaiduTongJi")){var c=n.actiondata.content||{},d=c.page,u=c.type,p=c.value;window._hmt.push(["_trackEvent",d,u,p])}}else"timing"===r&&(n=function(t,e){var n=e.starttime,o=e.ext,r=i(e,["starttime","ext"]),s={cateid:t.cateid,actiondata:{id:t.timingId,type:"1",timestamp:Date.now(),starttime:n,content:{duration:t.duration,option:a(a({page:t.page|| __get$(window,"location") .hostname+ __get$(window,"location") .pathname,source:t.source||f("idfrom")||"",from:t.from},r),{},{ext:a({apptype:t.apptype},o)})}}};return t.ifHeartbeatTime||(s.actiondata.endtime=Date.now(),s.actiondata.content.duration=(s.actiondata.endtime-s.actiondata.starttime)/1e3),"1.0"===t.version&&(s.actiondata.abtest=t.abtest,s.actiondata.inBox=t.inBox,s.actiondata.network=t.network,s.appid=t.appid,s.actiontype=t.actiontype),s}(this.model,s));var g=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/tcbox?action=pblog":k;"2.0"===this.model.version&&(g=this.get("testMode")?"http://bjyz-mco-searchbox201609-m12xi3-044.bjyz.baidu.com:8080/ztbox?action=zpblog":"https://mbd.baidu.com/ztbox?action=zpblog",g=m(g=this.model.testUrl||g,this.model.queryParams)),I.apply(this,[g,n,e,l,this])},P.prototype.regestTimingReportor=function(){var t=this,e=Array.from(arguments).length>0&&void 0!==Array.from(arguments)[0]?Array.from(arguments)[0]:[];if(!this.get("timingId"))throw"timing ID is required!";var n=this.get("timingTasks"),i=this.get("duration"),o=this.get("ifHeartbeatTime"),r={};r=e&&v(e[1])?a({type:e[0]},e[1]):h(D,e);var s=b(n,(function(t){return t.eventName===e[0]}));if(r.starttime=Date.now(),!s){var l=0;o&&(this.send({type:"timing",fields:r}),l=setInterval((function(){t.send({type:"timing",fields:r})}),1e3*i)),n.push({timingIntevalId:l,isReporting:!0,eventName:e[0],fields:r})}},P.prototype.stopAllTimingReportor=function(){var t=this;this.get("timingTasks").forEach((function(e){t.send({type:"timing",fields:e.fields}),e.isReporting=!1,clearInterval(e.timingIntevalId)}))},P.prototype.startAllTimingReportor=function(){var t=this,e=this.get("timingTasks"),n=this.get("duration"),a=this.get("ifHeartbeatTime");e.forEach((function(e){e.isReporting||(e.isReporting=!0,e.fields.starttime=Date.now(),a&&(t.send({type:"timing",fields:e.fields}),e.timingIntevalId=setInterval((function(){t.send({type:"timing",fields:e.fields})}),1e3*n)))}))},P.prototype.endTimingReportor=function(t){var e=this,n={};t&&v(t[1])&&(n=t[1]);var i=this.get("timingTasks"),o=[];i.forEach((function(i){var r=i.timingIntevalId;i.eventName===t[0]?(e.send({type:"timing",fields:a(a({},i.fields),n)}),clearInterval(r)):o.push(i),e.set("timingTasks",o)}))},P.prototype.removeAllTimingReportor=function(){var t=this,e=this.get("timingTasks");e.forEach((function(e){t.send({type:"timing",fields:e.fields}),clearInterval(e.timingIntevalId)})),e=[]},void 0!==document.hidden?(T="hidden",C="visibilitychange"):void 0!==document.msHidden?(T="msHidden",C="msvisibilitychange"):(void 0!==document.webkitHidden||void 0!==document.baiduboxappvisibilitychange)&&(T="webkitHidden",C="webkitvisibilitychange");var E=[],A={},O=["trackerName","trackerId","config"];function R(){for(var t=Array.from(arguments).length,e=new Array(t),n=0;n<t;n++) __set$(e,n,__get$(Array.from(arguments),n)) ;_.run.call(window.ubc,[e])}return R.create=function(){for(var t=Array.from(arguments).length,e=new Array(t),n=0;n<t;n++) __set$(e,n,__get$(Array.from(arguments),n)) ;var a=h(O,[].slice.call(e)),i=a.trackerName;if( __get$(A,i) )return  __get$(A,i) ;var o=new P(a);return  __set$(A,i,o) ,E.push(o),o},R.remove=function(t){for(var e=E.length,n=0;n<e;n++)if( __get$(__get$(E,n),t) ===t){E.splice(n,1), __set$(A,t,null) ;break}},R.main=function(){var t=window.ubc,e=t&&t.q;t&&"function"==typeof t.getAll&&(R=window.ubc),Array.isArray(e)&&(_.run.apply(R,[e]),t.q=[]),R.startTime=t&&t.l||1*new Date,R.loaded=!0,window.ubc=R},R.getByName=function(t){return  __get$(A,t) },R.getAll=function(){return E.slice()},R.main(),function(t){void 0!==document.addEventListener&&void 0!==T&&document.addEventListener(C,(function(){t.getAll().forEach((function(t){var e=t.get("timingTasks");Array.isArray(e)&&( __get$(document,T) ?t.stopAllTimingReportor():t.startAllTimingReportor())}))}),!1)}(R),R}()}(Pn);var An=Pn.exports,On=n.getDefaultExportFromCjs(An);function Rn(){return Rn=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Rn.apply(this,Array.from(arguments))}var Nn={eventType:{type:"sendCommand"}},Mn={eventType:{type:"notifyStateEvent"}},qn={from:"chatjs",to:"chatjs"},jn={container:{halfScreenClosed:Rn({name:"half-screen-closed",from:"na"},Nn),halfScreenOpened:Rn({name:"half-screen-opened",from:"na"},Nn),imageGuidanceShow:Rn({name:"image-guidance-showed",from:"na"},Nn),inputStart:Rn({name:"input-start",from:"na"},Nn),deleteAgent:Rn({name:"delete-agent",from:"na"},Nn),search:Rn({name:"search",from:"na"},Nn),backFirstpage:Rn({name:"back-firstpage",from:"na"},Nn),inputCancel:Rn({name:"input-cancel",from:"na"},Nn),sendAvatar:Rn({name:"send-avatar",from:"na"},Nn),deleteTag:Rn({name:"delete-tag",from:"na"},Nn),submitTag:Rn({name:"submit-tag",from:"na"},Nn),scanImage:Rn({name:"scan-image",from:"na"},Nn),chatRecommendUpdate:Rn({name:"chat-recommend-update",from:"na"},Nn),loginStatus:Rn({name:"login-status",from:"na"},Nn),longPressRespond:Rn({name:"execute-h5-function",from:"na"},Nn),searchPrerenderConfirm:Rn({name:"search-prerender-confirm",from:"na"},Nn),voicePanelStatus:Rn({name:"voice-panel-status",from:"na"},Nn),makeAiCall:Rn({name:"make-ai-call",from:"na"},Nn),stopSyncTabData:Rn({name:"stop-sync-tab-data",from:"na"},Nn),guidewordsReqIntercept:Rn({name:"guidewords-req-intercept",from:"na"},Nn),checkReady:Rn({name:"check-ready",from:"na"},Nn),updateCapsule:Rn({name:"update-capsule",from:"na"},Nn),openNewPageOrHistory:Rn({name:"checkout-chat",from:"na"},Nn),checkoutChatModel:Rn({name:"checkout-chat-model",from:"na"},Nn),exitShareSelect:Rn({name:"exit-share-select",from:"na"},Nn),getShareInfo:Rn({name:"get-share-info",from:"na"},Nn)},conversation:{openHalfScreen:Rn({name:"open-half-screen",to:"na"},Mn),closeHalfScreen:Rn({name:"close-half-screen",to:"na"},Mn),showImageGuidance:Rn({name:"show-image-guidance",to:"na"},Mn),sendInputConfig:Rn({name:"send-input-config",to:"na"},Mn),ready:Rn({name:"ready",to:"na"},Mn),sidebarUpdate:Rn({name:"sidebar-infoupdate",to:"na"},Mn),complete:Rn({name:"complete",to:"na"},Mn),resultLog:Rn({name:"result-log",to:"na"},Mn),clickLog:Rn({name:"click-log",to:"na"},Mn),launchSearch:Rn({name:"launch-search",to:"na"},Mn),openInput:Rn({name:"open-input",to:"na"},Mn),closeInput:Rn({name:"close-input",to:"na"},Mn),upperSearchbox:Rn({name:"upper-searchbox",to:"na"},Mn),photoQuestion:Rn({name:"open-camera",to:"na"},Mn),updataTag:Rn({name:"updata-tag",to:"na"},Mn),showImageEdit:Rn({name:"show-image-edit",to:"na"},Mn),chatSearchPageReady:Rn({name:"chat-search-page-ready"},qn),chatSearchRecommendTplUpdate:Rn({name:"chat-search-recommend-tpl-update"},qn),getGenerateCardSign:Rn({name:"get-generate-card-sign"},qn),removeFold:Rn({name:"remove-fold"},qn),exportFile:Rn({name:"export-file",to:"na"},Mn),updateSearchtips:Rn({name:"update-searchtips",to:"na"},Mn),updateGenerateInfo:Rn({name:"update-generate-info",to:"na"},Mn),generateStart:Rn({name:"generate-start",to:"na"},Mn),generateComplete:Rn({name:"generate-complete",to:"na"},Mn),errorOccur:Rn({name:"error-occur",to:"na"},Mn),abortProcess:Rn({name:"abort-process",to:"na"},Mn),loading:Rn({name:"loading",to:"na"},Mn),loadComplete:Rn({name:"load-complete",to:"na"},Mn),clickDownload:Rn({name:"click-download",to:"na"},Mn),multichatPagestatus:Rn({name:"multichat-pagestatus",to:"na"},Mn),goBack:Rn({name:"go-back",to:"na"},Mn),openFile:Rn({name:"open-file",to:"na"},Mn),search:Rn({name:"search"},qn),loadSlideToast:Rn({name:"load-slide-toast"},qn,{strick:!0}),showGuideCard:Rn({name:"show-guide-card"},qn,{strick:!0}),cardTypingComplete:Rn({name:"card-typing-complete"},qn),cardContentFinished:Rn({name:"card-content-finished"},qn),askDataInterflow:Rn({name:"ask-data-interflow",sticky:!0},qn),operateCapsulesDataInterflow:Rn({name:"operate-capsule-data-interflow"},qn),showFeedbackFormCard:Rn({name:"show-feedback-form-card"},qn),receiveFirstChunk:Rn({name:"receive-first-chunk",to:"na"},Mn),hitDanger:Rn({name:"hit-danger"},qn),feedbackPop:Rn({name:"feedback-pop"},qn),stopConversation:Rn({name:"stop-conversation"},qn),agentChange:Rn({name:"agent-change"},qn),capsuleShow:Rn({name:"caosule-show"},qn),openHalfScreenByUijson:Rn({name:"open-half-screen-by-uijson"},qn),updateImageQuery:Rn({name:"update-image-query"},qn),retryGenerate:Rn({name:"retry-generate"},qn),fillerEmptyHeight:Rn({name:"filler-emtpy-height"},qn),regenerate:Rn({name:"regenerate"},qn),askDataSend:Rn({name:"ask-data-send"},qn),agentTelHide:Rn({name:"agent-tel-hide"},qn),adultCheckHide:Rn({name:"adult-check-hide"},qn),asyncBubClick:Rn({name:"async-bub-click"},qn),dialogPop:Rn({name:"dialog-pop"},qn),dialogClick:Rn({name:"dialog-click"},qn),h5UpperSearchbox:Rn({name:"upper-searchbox"},qn),hoverRespond:Rn({name:"execute-h5-function"},qn),interactRespond:Rn({name:"interact-h5-function"},qn),deleteAgent:Rn({name:"delete-agent"},qn),stopBottomAlign:Rn({name:"stop-bottom-align"},qn),openCompositionEditor:Rn({name:"open-full-editor",to:"na"},Mn),updateInputBorder:Rn({name:"update-input-border",to:"na"},Mn),readyReply:Rn({name:"ready-reply",to:"na"},Mn),checkoutAiModel:Rn({name:"checkout-ai-model",to:"na"},Mn),updateModelList:Rn({name:"update-model-list",to:"na"},Mn),openExtendPanel:Rn({name:"open-extend-panel",to:"na"},Mn),sendSessionId:Rn({name:"session-info",to:"na"},Mn),sendShareInfo:Rn({name:"send-share-info",to:"na"},Mn),setShareStatus:Rn({name:"set-share-status",to:"na"},Mn),showShareMenu:Rn({name:"show-share-menu",to:"na"},Mn),enableLocation:Rn({name:"enable-location",to:"na"},Mn)},component:{chatToast:{},beforeLaunchConversation:{},beforeCreateNewGreet:{},imageQuerySelectedChange:{},imageQueryTabClicked:{},beforeCreateNewContext:{},ttsPlay:{},getHistoryStateChange:{},showHistoryTips:{},showPauseButton:{},historyRenderfinished:{},sharePopup:{},dialogChannel:{},loading:{},loginCancel:{},login:{},agentHintClick:{},showGoToBottom:{},questionGuide:{sticky:!0},beforeOpenAiCall:{},beforeRenderAiCallHistory:{},showGuide:{},sendTipsData:{sticky:!0},sendLoadingData:{sticky:!0},handleMindMapAction:{},handleWenkuAction:{},checkOutlineTitle:{},handlePptViewerPack:{},hitHintsDanger:{},showCoverContent:{},handlePptDownloadAction:{},sendInputPanelData:{},sendPromptOptimizerType:{},openInputPanel:{},openInputUpload:{},showGuideBlankBox:{},showFindAgentIframe:{},getUpdatedSa:{},responseRisk:{},stopDsMarkdown:{},wiseInputFocus:{},pcInputActive:{},showBottomTips:{sticky:!0},showLoginToast:{},showModelFunData:{},pauseVideoPlay:{},updateChatEditor:{},openChatEditor:{},closeChatEditor:{},closeWorkspaceStage:{},updateKnowledge:{},userUpdateEditor:{}}},Bn=new URL(document.URL).searchParams.get("chatsearch_action_id"),Hn=function(){return(window.sc.eventBus||(window.sc.eventBus=window.sc.initEventBus({type:"chatjs",platform:"na",pageType:"result",channelId:Bn},jn),window.sc.eventBus)).get()};function $n(){return $n=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},$n.apply(this,Array.from(arguments))}function Fn(){return Hn().conversation.cardTypingComplete}function Un(){return Hn().conversation.cardContentFinished}function Gn(){return Hn().conversation.hitDanger}function Wn(){return Hn().component.showModelFunData}function zn(){var t,e=Hn().conversation;return"pc"===rt()||lt()?e.h5UpperSearchbox:$n({},e.upperSearchbox,{emit:(t=e.upperSearchbox.emit,function(e){for(var n=Array.from(arguments).length,a=new Array(n>1?n-1:0),i=1;i<n;i++) __set$(a,i-1,__get$(Array.from(arguments),i)) ;var o=["file","image","inputCustom"],r={};return Object.keys(e).forEach((function(t){o.includes(t)||( __set$(r,t,__get$(e,t)) )})),t.apply(void 0,[].concat([r],a))})})}function Qn(){return Hn().component.chatToast}function Jn(){return Hn().component.beforeLaunchConversation}function Vn(){return Hn().component.imageQuerySelectedChange}function Kn(){return Hn().component.imageQueryTabClicked}function Xn(){return Hn().component.beforeCreateNewContext}function Yn(){return Hn().component.beforeCreateNewGreet}function Zn(){return Hn().component.getHistoryStateChange}function ta(){return Hn().component.historyRenderfinished}function ea(){return Hn().component.beforeRenderAiCallHistory}function na(){return Hn().component.beforeOpenAiCall}function aa(){return Hn().component.ttsPlay}function ia(){return Hn().conversation.retryGenerate}function oa(){return Hn().conversation.regenerate}function ra(){return Hn().conversation.fillerEmptyHeight}function sa(){return Hn().conversation.agentTelHide}function la(){return Hn().conversation.adultCheckHide}function ca(){return Hn().conversation.photoQuestion}function da(){return Hn().component.sharePopup}function ua(){return Hn().conversation.showFeedbackFormCard}function pa(){return Hn().component.dialogChannel}function ha(){return Hn().component.loading}function fa(){return Hn().component.loginCancel}function ga(){return Hn().component.showPauseButton}function ma(){return Hn().component.agentHintClick}function va(){return Hn().component.showGoToBottom}function ya(){return Hn().conversation.capsuleShow}function wa(){return Hn().conversation.updateImageQuery}function ba(){return Hn().conversation.stopBottomAlign}function _a(){return Hn().component.showGuide}function ka(){return Hn().component.sendTipsData}function Sa(){return Hn().component.showHistoryTips}function xa(){return Hn().conversation.openHalfScreenByUijson}function Ia(){return Hn().component.sendLoadingData}function Ta(){return Hn().component.openInputPanel}function Ca(){return Hn().component.sendInputPanelData}function La(){return Hn().component.sendPromptOptimizerType}function Da(){return Hn().component.openInputUpload}function Pa(){return Hn().component.showGuideBlankBox}function Ea(){return Hn().component.showFindAgentIframe}function Aa(){return Hn().component.getUpdatedSa}function Oa(){return Hn().component.responseRisk}function Ra(){return Hn().component.stopDsMarkdown}function Na(){return Hn().component.showBottomTips}function Ma(){return Hn().component.wiseInputFocus}function qa(){return Hn().component.pcInputActive}function ja(){return Hn().component.pauseVideoPlay}function Ba(){return Hn().conversation.interactRespond}function Ha(){return Hn().component.updateKnowledge}function $a(){return $a=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},$a.apply(this,Array.from(arguments))}var Fa=lt();function Ua(t,e){var n=t.ubcId||"17132",a={page:t.page||"resultpage",from:"search",version:"2.0",useSendBeacon:!0,queryParams:{appname:on.getState("isSearchCraft")?"searchcraft":"pc"===rt()?"pcsearch":"baiduboxapp"}},i=t.curLid,o=t.type,r=t.value,s=t.source,l=t.clk_result,c=t.info,d=t.page,u=t.ext,p={};e&&(p={query:e.query,qid:e.lid,tplname:e.tplname,srcid:e.srcid,order:e.order,sessionid:"lid["+(null==e?void 0:e.lid)+"]_si["+(null==e?void 0:e.srcid)+"]"});var h=$a({},u,{clk_result:l,info:c,browser:"pc"===rt()?"pc":"baiduboxapp"},p,{is_plugin:vt()?1:0},Fa&&{deepseek:1});"more"===t.value&&"click"===t.type&&(h.result_num=t.resultNum||0),"fold"===t.value&&(h.fold_result=t.fold),on.getState("chatParams")&&on.getState("chatParams").setype&&(h.setype=on.getState("chatParams").setype,h.lid=i||h.lid),h.query&&(h.query=_t(h.query)),ut()&&(h.setype="ssaitab"),On(n+".init",n,a),On(n+".config",a),On(n+".event",{ext:h,type:o,value:r,source:s,page:d||"resultpage",useSendBeacon:1})}function Ga(t,e){t&&e&&Ua({ubcId:"18663",type:"",value:"page_duration",ext:$a({enter_type:on.getState("pcEnterType")||"ai_tab_url",a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),sa:on.getState("oriSa"),starttime:String(t),endtime:String(e),duration:String(e-t),lid:on.getState("lid"),re_rank:String(on.getState("rank")),is_plugin:vt()?1:0},Fa&&{deepseek:1})})}function Wa(t){return t<1e10?1e3*t:t}function za(t){var e=t||(new Date).getTime();e=Wa(e);var n=new Date(e),a=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime(),i=new Date,o=new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime();return Math.floor((o-a)/864e5)}function Qa(t){t=t||(new Date).getTime();var e=new Date(t);return{year:e.getFullYear(),monthe:e.getMonth()+1,day:e.getDate(),week:e.getDay(),hour:e.getHours(),minute:e.getMinutes(),dayDiff:za(t)}}function Ja(t){return(t<10?"0":"")+t}function Va(t){if("object"!==(void 0===t?"undefined":function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}(t)))return t;var e={};return Object.keys(t).forEach((function(n){var a= __call$(n,"replace",[/_([a-z])/g,function(t,e){return e.toUpperCase();}]) ; __set$(e,a,__get$(t,n)) })),e}function Ka(t){if(!Te(t)&&!Ie(t))return t;var e=Array.isArray(t)?[]:{};return Object.keys(t).forEach((function(n){var a= __call$(n,"replace",[/_([a-z])/g,function(t,e){return e.toUpperCase();}]) ; __set$(e,a,Ka(__get$(t,n))) })),e}function Xa(t){return void 0===t&&(t=""), __call$(t,"replace",[/_([a-z])/g,function(t,e){return e.toUpperCase();}]) }function Ya(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Za(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ya(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ya(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ti= new Tt.Store({name:"knowledgeStore",initData:{knowledgeId:JSON.parse(qt(new URL(__get$(__get$Loc(location),"href")).searchParams).extParams||"{}").knowledgeId||"",knowledgeMsg:{},selectedItemId:"",selectedHistoryItemId:""},actions:{update:function(t){for(var e,n=Dt.builder(),a=Za(Object.keys(t));!(e=a()).done;){var i=e.value;n=n.set(i,__get$(t,i));}return n;},initKnowledgeMsg:function(t){return Dt.builder().set("knowledgeMsg",t);},updateItem:function(t,e){var n=t.knowledgeId,a=t.data,i=e.getState,o=Dt.builder(),r=n||i("knowledgeId"),s=__get$(i("knowledgeMsg"),r);return s?o=o.set("knowledgeMsg."+r,__call$(Object,"assign",[{},s,a])):o;}}}) ;function ei(){return ei=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},ei.apply(this,Array.from(arguments))}function ni(){oi&&(oi.dispose(),oi=null)}function ai(t){t.knowledgeId&&ti.dispatch("update",{knowledgeId:t.knowledgeId}),t.forceRefresh&&ni(),Dn.router.push({path:_e.KNOWLEDGE.path,query:{extParams:JSON.stringify(t)}},{force:!0})}var ii="",oi=null,ri="";function si(t){void 0===t&&(t={});var n=on.getState("rank"),a=on.getState("oriLid"),i= __get$Loc(location) .pathname,o={};try{o=JSON.parse(t.extParams||"{}")}catch(t){}if(i!==_e.CHAT.path||a||(null==o?void 0:o.ori_lid)!==a)if(0!==n||i!==_e.CHAT.path||a||(null==o?void 0:o.ori_lid)&&"his_middle"===(null==o?void 0:o.subEnterType)||(null==o?void 0:o.delete_knowledge)||(null==o?void 0:o.forceRefresh)){o.forceRefresh||(o.forceRefresh=!0,t.extParams&&(t.extParams=JSON.stringify(o))),ni();var r=je(t);Dn.router.push({path:_e.CHAT.path,query:ei({},r)},{force:!0})}else e.Toast.show({message:"已经是最新对话了"});else e.Toast.show({message:"已在当前对话"})}Dn.router.listen((function(t){var e=t.referrer;if(e){var n,a=Ht.parse(e);if(a.pathname===_e.CHAT.path&&t.path!==_e.CHAT.path)ii=e,oi&&(null==(n=oi.el)||n.classList.add("chat-page-hide"));if(a.pathname===_e.CHAT.path&&t.path===_e.CHAT.path||a.pathname===_e.KNOWLEDGE.path&&t.path===_e.KNOWLEDGE.path){var i;ni();var o=Dn.router.routeAlives&&Dn.router.routeAlives[0];null==o||null==(i=o.component)||i.dispose(),o&&Dn.router.routeAlives&&Dn.router.routeAlives.splice(0,1)}a.pathname===_e.KNOWLEDGE.path&&"knowledge"===ri&&ni()}}));var li=function(t){var e=t.Component,n=t.event,a=t.componentType,i=void 0===a?"":a;ri!==i&&ni(),ri=i;var o=!1,r=Ht.parse( __get$(__get$Loc(location),"href") ).query.extParams;if(r&&"string"==typeof r)try{o=!!JSON.parse(r).forceRefresh}catch(t){}if(n.referrer&&(o=!0),o||!oi){var s=document.querySelector(Kt);s&&(n.referrer&&on.dispatch("resetChatPageStore",null),oi&&oi.dispose(),(oi=new e).attach(s))}else{var l;null==(l=oi.el)||l.classList.remove("chat-page-hide")}};window.addEventListener("new_chat",(function(t){var e=t.data||{},n=e.sessionId,a=e.enterType;si({word:"百度AI助手",isShowHello:"1",pd:"csaitab",setype:"csaitab",extParams:JSON.stringify(ei({},n?ei({ori_lid:n,subEnterType:"his_middle"},a?{enter_type:a}:{}):{}))})}));var ci=function(){var t=navigator.userAgent,e=[],n="";return(e=/([\d+.]+)_(?:diordna|enohpi)_/.exec(t))?(e=e[1].split("."),n=e.reverse().join(".")):((e=/baiduboxapp\/([\d+.]+)/.exec(t))||(e=/searchcraft\/([\d+.]+)/i.exec(t)))&&(n=e[1]),ci=function(){return n},n};function di(t,e){e+="";for(var n=(t+="").split("."),a=e.split("."),i=Math.max(n.length,a.length),o=0;o<i;o++){if( __get$(n,o) &&! __get$(a,o) &&parseInt( __get$(n,o) ,10)>0||parseInt( __get$(n,o) ,10)>parseInt( __get$(a,o) ,10))return 1;if( __get$(a,o) &&! __get$(n,o) &&parseInt( __get$(a,o) ,10)>0||parseInt( __get$(n,o) ,10)<parseInt( __get$(a,o) ,10))return-1}return 0}var ui={pdf:"PDF",doc:"Word",docx:"Word",txt:"TXT",xls:"Excel",xlsx:"Excel",ppt:"PPT",pptx:"PPT",csv:"Excel"};function pi(t){if(!t)return"unknown";var e=t.toLowerCase();return  __get$(ui,e) ||"unknown"}function hi(t,e){return t?pi(t):e?pi(e.split(".").pop()):""}var fi=/\.(\w+)$/;function gi(t){var e=fi.exec(t);return e?pi(e[1]):"unknown"}function mi(t){if("[object Number]"!==xe(t))return"0B";for(var e=-1;t>=Math.pow(1024,1+ ++e););return""+Math.round(t/Math.pow(1024,e)*100)/100+ __get$(["B","KB","MB","GB"],e) }function vi(){return vi=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},vi.apply(this,Array.from(arguments))}var yi=Tt.connect(ti,{selectedHistoryItemId:"selectedHistoryItemId"})(a.defineComponent({template:'\n        <div\n            s-if="showData.show"\n            class="{{isSideBar ? \'chat-side-list-item\' : \'chat-history-list-item\'}}\n            {{showDeleteDialog ? \'no-hover\' : \'\'}}\n            {{source === \'knowledge\' ? \'chat-side-knowledge-item\' : \'\'}}"\n        >\n            <div\n                class="history-item-content {{isSelected && isSideBar ? \'selected\' : \'\'}}"\n                data-show-ext="{{realShowExt}}"\n                on-click="handleClick"\n            >\n                <div class="history-item-content-left">\n                    <span s-if="showData.agentText" class="history-item-agent">\n                        {{showData.agentText}}\n                    </span>\n                    <span\n                        s-if="showData.text"\n                        class="history-item-text\n                            {{showData.fileList && showData.fileList.length && !isSideBar > 0 ? \'cos-space-mr-md\' : \'\'}}\n                            {{showData.fileList && showData.fileList.length && isSideBar > 0 ? \'cos-space-mr-xxs\' : \'\'}}\n                        "\n                    >\n                        {{showData.text}}\n                    </span>\n                </div>\n                <div class="history-item-content-right" style="{{contentRightStyle}}">\n                    <span\n                        s-if="showData.fileList"\n                        s-for="fileInfo in showData.fileList"\n                        class="history-item-file"\n                    >\n                        <img src="{{fileInfo.iconUrl}}" class="history-item-file-img" />\n                        <span class="history-item-file-name">\n                            {{fileInfo.name}}\n                        </span>\n                    </span>\n                </div>\n            </div>\n            <span s-if="showData.updateTime && !isSideBar" class="history-item-time">\n                {{showData.updateTime}}\n            </span>\n            \x3c!-- hover态展示删除按钮 --\x3e\n            <span\n                s-if="!isSideBar"\n                class="history-item-delete"\n                on-click="handleHistoryDeleteBtn"\n                data-show-ext="{{deteleButtonShowExt}}"\n            >\n                <cos-icon name="bin" class="history-item-delete-btn"></cos-icon>\n            </span>\n            \x3c!-- 现组件上无法打曝光，所以再包了一层div --\x3e\n            <div\n                s-if="showDeleteDialog"\n                data-show-area\n                data-show-ext="{{deleteDialogShowExt}}"\n            >\n            \x3c!-- 删除会话弹窗 --\x3e\n                <cos-dialog\n                    open="{{showDeleteDialog}}"\n                    class="history-item-delete-dialog"\n                    appearance="info"\n                    title="确定删除对话？"\n                    okText="删除"\n                    outsideClosable="true"\n                    on-ok="handleDefaultOk"\n                    on-close="handleDefaultClose"\n                    on-cancel="handleDefaultCancel(\'cancle\')"\n                >删除后，对话记录不可恢复。</cos-dialog>\n            </div>\n        </div>\n    ',components:{"cos-icon":e.Icon,"cos-dialog":e.Dialog},computed:{showData:function(){var t,e=this.data.get("sessionData");if(!e)return{};var n=e.sessionId,a=e.dayDiff,i=e.updateTime,o=e.query,r=e.agentInfo,s={agentText:"",text:"",fileList:[],updateTime:"",sessionId:n,show:!0,isSideBar:!1};return r&&r.agentName&&(s.agentText="@"+r.agentName,s.agentInfo=r),null==o||o.forEach((function(t){var e;if("TEXT"===t.type)s.text=(null==(e=t.data.text)?void 0:e.query)||"";else if("FILE"===t.type){var n=t.data.file,a=pi(n.fileType);s.fileList.push({type:"file",iconUrl: __get$(me,a) ,name:n.fileName,fileUrl:n.fileUrl,fileSize:n.fileSize})}else if("IMAGE"===t.type){var i=t.data.image;s.fileList.push({type:"image",iconUrl:"https://gips3.baidu.com/it/u=828382227,2824983548&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f48_48",name:i.imageName,fileUrl:i.imageUrl,fileSize:i.imageSize}),i.imageName||(s.show=!1)}})),i&&(s.updateTime=function(t,e){if(!t)return"";var n=Qa(Wa(t));if(0===e){var a=Ja(n.minute);return Ja(n.hour)+":"+a}return n.year+"年"+n.monthe+"月"+n.day+"日"}(+i,a)),s.agentText||s.text||(null==(t=s.fileList)?void 0:t.length)||(s.show=!1),s},contentRightStyle:function(){var t,e=this.data.get("showData");return(null==(t=e.fileList)?void 0:t.length)?"min-width: "+19*e.fileList.length+"px":""},realShowExt:function(){var t,e,n,a=this.data.get("showData"),i=this.data.get("source"),o=this.data.get("isSideBar"),r={setype:"csaitab",value:"dialog",page:"his_dialog",ori_lid:a.sessionId,lid:a.sessionId,re_rank:"1",agentId:(null==(t=a.agentInfo)?void 0:t.agentId)||"",agentName:(null==(e=a.agentInfo)?void 0:e.agentName)||"",annex:[]};return o&&"knowledge"===i&&(r.page="resultpage",r.value="catalogue_zsk_dialog",r.zsk_id=this.data.get("knowledgeHisId"),r.zsk_name=ti.getState("knowledgeMsg."+r.zsk_id+".title"),r.query=a.text||""),null==(n=a.fileList)||n.forEach((function(t){r.annex.push({annex_type:"file"===t.type?"file":"pic",annex_size:mi(t.fileSize),annex_detail:t.fileUrl})})),JSON.stringify(r)},deteleButtonShowExt:function(){return JSON.stringify({setype:"csaitab",value:"delete_dialog",page:"his_dialog"})},deleteDialogShowExt:function(){return JSON.stringify({setype:"csaitab",value:"delete_dialog_pop",page:"his_dialog"})},isSelected:function(){var t=this.data.get("selectedHistoryItemId"),e=this.data.get("sessionData");return t===(null==e?void 0:e.sessionId)}},initData:function(){return{sessionData:null,showDeleteDialog:!1,source:"history"}},handleEscKey:function(t){"Escape"===t.key&&this.data.get("showDeleteDialog")&&this.handleDefaultCancel("esc")},handleClick:function(){var t,e,n,a=this.data.get("sessionData");if(this.data.get("selectedHistoryItemId")!==a.sessionId)if(ti.dispatch("update",{selectedHistoryItemId:this.data.get("sessionData.sessionId"),selectedItemId:""}),"knowledge"!==this.data.get("source")){this.fire("click");var i=this.data.get("showData");this.data.get("isSideBar")?Ua({type:"click",value:"catalogue_his_dialog",ext:{query:i.text}}):Ua({type:"click",value:"dialog",page:"his_dialog",ext:vi({ori_lid:i.sessionId,lid:i.sessionId,re_rank:"1",query:i.text,agent_id:(null==(t=i.agentInfo)?void 0:t.agentId)||"",agent_name:(null==(e=i.agentInfo)?void 0:e.agentName)||""},(null==(n=i.fileList)?void 0:n.length)?{annex:i.fileList.map((function(t){return{annex_type:"file",annex_size:mi(t.fileSize),annex_detail:t.fileUrl}}))}:{annex:[]})})}else this.knowledgeHistoryItemClick()},knowledgeHistoryItemClick:function(){var t=this.data.get("sessionData"),e=this.data.get("showData"),n=this.data.get("knowledgeHisId");if(n)ti.dispatch("update",{knowledgeId:n}),Ua({type:"click",value:"catalogue_zsk_dialog",ext:{query:e.text,zsk_id:n,zsk_name:ti.getState("knowledgeMsg."+n+".title")}});else{var a=ti.getState("knowledgeId");Ua({type:"click",value:"zsk_dialog",ext:{query:e.text,pos:this.data.get("pos"),zsk_name:ti.getState("knowledgeMsg."+a+".title"),zsk_id:a}})}"knowledge"===this.data.get("source")&&ai({knowledgeId:ti.getState("knowledgeId"),subEnterType:"his_middle",ori_lid:t.sessionId})},handleHistoryDeleteBtn:function(t){t.stopPropagation(),this.clickLogParams("delete_dialog"),document.addEventListener("keydown",this.handleEscKey.bind(this)),this.data.set("showDeleteDialog",!0)},handleDefaultCancel:function(t){this.data.set("showDeleteDialog",!1),document.removeEventListener("keydown",this.handleEscKey.bind(this)),this.clickLogParams("delete_dialog_pop",t||"")},handleDefaultOk:function(){var t=this.data.get("showData").sessionId;this.data.set("showDeleteDialog",!1),document.removeEventListener("keydown",this.handleEscKey.bind(this)),this.dispatch("delete-history",{sessionId:t}),this.data.get("selectedHistoryItemId")===t&&ti.dispatch("update",{selectedHistoryItemId:""}),setTimeout((function(){Ha().emit({updateType:"deleteHistoryItem",sessionId:t})}),500),this.clickLogParams("delete_dialog_pop","delete")},handleDefaultClose:function(){this.handleDefaultCancel("blank")},clickLogParams:function(t,e){Ua({type:"click",value:t,page:"his_dialog",ext:{button:e}})}}));function wi(){return wi=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},wi.apply(this,Array.from(arguments))}function bi(t,e){return bi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},bi(t,e)}var _i="今天",ki="最近7天",Si="最近30天",xi="最近一年",Ii="更久";var Ti=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bi(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{historyList:[],isSideBar:!1,source:"history",knowledgeHisId:""}},n.handleHistoryItemClick=function(t){this.dispatch("history-item-click",null);var e=wi({ori_lid:t.sessionId,subEnterType:"his_middle"},t.enterType?{enter_type:t.enterType}:{});si({isShowHello:"1",extParams:JSON.stringify(e)})},e}(a.Component);function Ci(){return Ci=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Ci.apply(this,Array.from(arguments))}function Li(t,e,n,a){return void 0===e&&(e={}),void 0===n&&(n=500),void 0===a&&(a=!1),Promise.race([fetch(t,e).then((function(t){if(t.ok){var e=t.headers.get("Content-Type");return a&&e&&e.includes("text/html")?t.text():t.json()}return Promise.reject({status:-2})})),new Promise((function(t){return setTimeout((function(){return t({status:-9999})}),n)}))])}function Di(t,e,n,a){void 0===e&&(e={}),void 0===n&&(n={}),void 0===a&&(a=500);var i=new URLSearchParams(e).toString();return Li(i?t+"?"+i:t,Ci({method:"GET"},n),a)}Ti.template='\n        <div class="chat-history-list" data-show-area>\n            <fragment s-for="item in showHistoryList">\n                <div class="{{!isSideBar ? \'chat-history-time-item\' : \'chat-knowledge-time-item\'}}">\n                    <div s-if="!isSideBar" class="chat-history-time-title">\n                        {{item.timeTitle}}\n                    </div>\n                    <fragment s-for="historyItem, idx in item.list">\n                        <history-list-item\n                            is-side-bar="{{isSideBar}}"\n                            source="{{source}}"\n                            session-data="{{historyItem}}"\n                            pos="{{idx + 1}}"\n                            knowledge-his-id="{{knowledgeHisId}}"\n                            on-click="handleHistoryItemClick(historyItem)"\n                        />\n                    </fragment>\n                </div>\n            </fragment>\n        </div>\n    ',Ti.components={"history-list-item":yi},Ti.computed={showHistoryList:function(){return function(t,e){var n=new Map;return null==t||t.forEach((function(t){var a,i,o,r,s,l,c,d,u,p=t.sessionId,h=t.updateTime,f=t.msgList,g=t.agentInfo,m=za(+h),v="";v="knowledge"===e?"知识库":0===m?_i:m<=7?ki:m<=30?Si:m<=365?xi:Ii,n.has(v)||n.set(v,{timeTitle:v,list:[]});var y=(null==f||null==(a=f[0])?void 0:a.query)||[],w=(null==f||null==(i=f[0])?void 0:i.enterType)||"",b=null==f||null==(u=f[0])||null==(d=u.chatResponse)||null==(c=d[0])||null==(l=c.data)||null==(s=l.message)||null==(r=s.content)||null==(o=r.agentInfo)?void 0:o.agentMeta;n.get(v).list.push({sessionId:p,dayDiff:m,updateTime:h,query:Ka(y),agentInfo:g||b&&b.length&&b[0],enterType:w})})),Array.from(n.values())}(this.data.get("historyList"),this.data.get("source"))}};var Pi,Ei,Ai=navigator.userAgent.toLowerCase(),Oi=Ai.includes("android"),Ri=/(iPhone|iPod|iPad)/gi.test(Ai),Ni=Ai.includes("baiduboxapp");function Mi(){return document.body.className.includes("darkmode")}function qi(t,e){return null!=e&&"undefined"!=typeof Symbol&& __get$(e,Symbol.hasInstance) ?!! __call$(e,Symbol.hasInstance,[t]) :t instanceof e}function ji(t){if(null===t)return t;var e,n=null;if(Array.isArray(t)){n=[];for(var a=0;a<t.length;a++) __set$(n,a,ji(__get$(t,a))) ;return n}if("object"==(void 0===t?"undefined":(e=t)&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e)){for(var i in n={},t)t.hasOwnProperty(i)&&( __set$(n,i,ji(__get$(t,i))) );return n}return qi(t,Date)?((n=new Date).setTime(t.getTime()),n):qi(t,RegExp)?n=new RegExp(t):t}function Bi(t,e){if(Ie(t)||(t={}),!Ie(e))throw new Error("obj must be object");var n=JSON.parse(JSON.stringify(t));return Object.keys(e).forEach((function(t){Ie( __get$(e,t) )? __set$(n,t,Bi(__get$(n,t),__get$(e,t))) : __set$(n,t,__get$(e,t)) })),n}function Hi(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function $i(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Hi(o,a,i,r,s,"next",t)}function s(t){Hi(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Fi(){return Fi=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Fi.apply(this,Array.from(arguments))}function Ui(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}!function(t){t.SENDING="SENDING",t.WAITING="WAITING",t.GENERATING="GENERATING",t.COMPLETE="COMPLETE",t.ABORT="ABORT"}(Pi||(Pi={})),function(t){t.THINKING="0",t.PLUGIN="1",t.GENERATING="2",t.COMPLETE="3"}(Ei||(Ei={}));var Gi=function(t){var e=this,n=this;this.useModel=Qe,this.permissionURI="/aichat/api/getModelPermission?tk="+sc(),this.getCurrentModel=function(){return e.botStore.getState("usedModel")},this.getUsableModel=function(){return e.botStore.getState("usableModel")},this.handleCheckPermission=function(t){return new Promise((function(n,a){fetch(e.permissionURI,{method:"post",credentials:"include",body:JSON.stringify({modelType:t})}).then((function(t){n(t.json())})).catch((function(t){a(t)}))}))},this.getGuideTip=function(){return e.useModel.guideTip},this.handleChangeModel=$i((function(t){var e,a,i,o,r,s,l,c,d,u;return Ui(this,(function(p){switch(p.label){case 0:if(e=t.modelName,a=t.hasModelPermissions,void 0===a||a)return[2,{usedModel:n.useModel.setUsedModel(t),usableModel:n.getUsableModel()}];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,n.handleCheckPermission(e)];case 2:return(i=p.sent())&&i.data?(o=i.data,s=(r=void 0===o?[]:o).find((function(t){return t.modelName===e})),l=s.hasModelPermissions,c=void 0!==l&&l,d=n.useModel.setUsableModel(r),n.useModel.showToast(d),c?(u=n.useModel.setUsedModel(t),[2,{usableModel:d,usedModel:u}]):[2,{usableModel:d,usedModel:n.getCurrentModel()}]):[3,4];case 3:return p.sent(),[2,{usableModel:n.getUsableModel(),usedModel:n.getCurrentModel()}];case 4:return[2,{usableModel:n.getUsableModel(),usedModel:n.getCurrentModel()}]}}))})),this.handleSelectModel=$i((function(t){var e,a,i,o,r;return Ui(this,(function(s){switch(s.label){case 0:return e=n.getUsableModel(),a=e.find((function(e){return e.modelName===(null==t?void 0:t.name)})),[4,n.handleChangeModel(a)];case 1:return(i=s.sent())&&(o=i.usedModel,r=i.usableModel,n.botStore.dispatch("update",{usedModel:o,usableModel:r})),[2]}}))})),this.refreshUsableModel=$i((function(){var t,e;return Ui(this,(function(a){switch(a.label){case 0:return[4,n.handleCheckPermission()];case 1:return(t=a.sent())&&t.data&&(e=t.data,n.botStore.dispatch("update",{usableModel:e})),[2]}}))})),this.handleChangeUsedModelStatus=function(t,n){var a=e.getCurrentModel(),i=e.getUsableModel();if(t===a.modelName){var o=Fi({},a,n);e.botStore.dispatch("update",{usedModel:e.useModel.setUsedModel(o)})}else{var r=i.find((function(e){return e.modelName===t}));if(r){var s=Fi({},e.useModel.setUsedModel(r),n);e.botStore.dispatch("update",{usedModel:e.useModel.setUsedModel(s)}),e.refreshUsableModel()}}},this.botStore=t};function Wi(){var t="landing"===on.getState("pageType");return ft()&&di(ci(),"15.7")>=0&&t}function zi(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Qi(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){zi(o,a,i,r,s,"next",t)}function s(t){zi(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Ji(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Vi=function(t){var e=this,n=this;this.useModelData=Ve,this.permissionURI="/aichat/api/getModelPermission?tk="+sc(),this.getCurrentModel=function(){return e.botStore.getState("usedModel")},this.getModelList=function(){return e.botStore.getState("modelList")},this.modelShowGuideList=["ERINE","DeepSeek"],this.functionShowGuideList=["mcp"],this.checkLoginList=["ERINE-X1"],this.handleCheckPermission=function(t){return new Promise((function(n,a){fetch(e.permissionURI,{method:"post",credentials:"include",body:JSON.stringify({modelId:t})}).then((function(t){n(t.json())})).catch((function(t){a(t)}))}))},this.updateModelList=function(t){e.botStore.dispatch("update",{modelList:[].concat(t)})},this.updateUsedModel=function(t){var n={modelName:t.id,modelFunction:t.modelFunction};e.botStore.dispatch("update",{usedModel:n}),e.useModelData.setLocalModelData(n),e.showGuide(e.useModelData.defaultGuideData)},this.handleModelShowGuide=function(t){if(e.modelShowGuideList.includes(t)){var n=e.useModelData.getModelGuideShowData(t);e.showGuide(n)}},this.showGuide=function(t){var n=e.botStore.getState("generateStatus"),a=e.botStore.getState("rank");n&&n!==Ei.COMPLETE||0!==Number(a)||t&&(Yn().emit(),Hn().component.showGuide.emit({multiRecommendWord:t,id:"init"}))},this.updateModelListPermission=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=[]),t.map((function(t){var n=e.find((function(e){return t.id===e.id}));return n&&(t.hasPermission=n.hasPermission,t.enable=n.enable),t}))},this.handleChangeModel=Qi((function(t){var e,a,i,o,r,s,l,c,d,u,p;return Ji(this,(function(h){switch(h.label){case 0:if(e=t.id,t.hasPermission&&e!==Ge.ERINE)return a=n.getModelList(),a=n.useModelData.handleModelUi(a,e),n.updateModelList(a),n.updateUsedModel(t),n.handleModelShowGuide(e),[2,!0];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.handleCheckPermission(e)];case 2:return(i=h.sent())&&i.data&&(o=i.data,s=(r=void 0===o?[]:o).find((function(t){return t.id===e})),l=s.hasPermission,c=void 0!==l&&l,d=n.getCurrentModel(),u=c?e:d.modelName,p=n.getModelList(),p=n.updateModelListPermission(p,r),p=n.useModelData.handleModelUi(p,u),n.updateModelList(p),c)?(n.updateUsedModel(t),n.handleModelShowGuide(e),[2,!0]):[3,4];case 3:return h.sent(),[3,4];case 4:return[2,!1]}}))})),this.handleSelectModel=Qi((function(t){var e,a,i,o;return Ji(this,(function(r){switch(r.label){case 0:if(e=n.getModelList(),!(a=e.find((function(e){return e.id===(null==t?void 0:t.id)}))))return[2,!1];if(!n.checkLoginList.includes(a.id))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,gs()];case 2:return r.sent(),[3,4];case 3:return r.sent(),Qn().emit({text:"登录失败，请稍后再试"}),[2,!1];case 4:return[4,n.handleChangeModel(a)];case 5:return(i=r.sent())||Qn().emit({text:a.failText||Se}),Wi()&&(o=i?t.id:n.botStore.getState("usedModel").modelName,Hn().conversation.updateModelList.emit({selectedId:o,modelList:e})),[2,i]}}))})),this.toggleInternetSearch=function(){var t=e.getCurrentModel(),n=e.getModelList(),a=n.find((function(e){return e.id===t.modelName}));a.modelFunction.internetSearch=a.modelFunction.internetSearch===De.OPEN?De.CLOSE:De.OPEN,e.updateModelList(n),e.updateUsedModel(a)},this.toggleDeepThink=function(){var t=e.getCurrentModel(),n=e.getModelList(),a=n.find((function(e){return e.id===t.modelName}));a.modelFunction.deepThink=a.modelFunction.deepThink===Pe.OPEN?Pe.CLOSE:Pe.OPEN,e.updateModelList(n),e.updateUsedModel(a)},this.toggleMcp=function(){var t=e.getCurrentModel(),n=e.getModelList(),a=n.find((function(e){return e.id===t.modelName})),i=a.modelFunction.mcpSwitch===Ee.OPEN?Ee.CLOSE:Ee.OPEN;a.modelFunction.mcpSwitch=i,e.updateModelList(n),e.updateUsedModel(a)},this.botStore=t};function Ki(t,e,n){void 0===n&&(n={});var a,i,o,r,s,l,c=0,d=!1,u=!1,p=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function h(e){var n=a,o=i;return a=i=void 0,l=e,r=t.apply(o,n)}function f(t){var n=t-l;return void 0===l||n>=e||n<0||u&&t-c>=o}function g(){var t=Date.now();if(f(t))return m(t);s=setTimeout(g,function(t){var n=t-c,a=e-(t-l);return u?Math.min(a,o-n):a}(t))}function m(t){return s=void 0,p&&a?h(t):(a=i=void 0,r)}function v(){var t=Date.now(),n=f(t);if(a=Array.prototype.slice.call(Array.from(arguments)),i=this,l=t,n){if(void 0===s)return function(t){return c=t,s=setTimeout(g,e),d?h(t):r}(l);if(u)return s=setTimeout(g,e),h(l)}return void 0===s&&(s=setTimeout(g,e)),r}return e=+e||0,Ie(n)&&(d=!!n.leading,o=(u="maxWait"in n)?Math.max(void 0===n.maxWait?0:+n.maxWait,e):o,p="trailing"in n?!!n.trailing:p),v.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=i=s=void 0},v.flush=function(){return void 0===s?r:m(Date.now())},v}function Xi(t,e,n){void 0===n&&(n={});var a=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return Ie(n)&&(a="leading"in n?!!n.leading:a,i="trailing"in n?!!n.trailing:i),Ki(t,e,{leading:a,maxWait:e,trailing:i})}var Yi=!1,Zi=!1,to=/^#.*#$/;function eo(t,e){if(void 0===e&&(e=!1),e||!Yi&&t&&o.canIUse("search.getMultiTabBarInfo")&&!lt()){try{no(t)}catch(t){console.error(t)}Yi=!0}}function no(t){Yi=!0;var e=new URL(t),n=document.createElement("iframe"),a=e.searchParams.get("params"),i=JSON.parse(a),o=di(ci(),"13.53.0")>=0;(!window.page.comm.isAndroid||window.page.comm.isAndroid&&o)&&(i.noUpdateTabList=1),e.searchParams.set("params",JSON.stringify(i)),n.style.display="none",n.src=e.toString(),document.body.appendChild(n),setTimeout((function(){document.body.removeChild(n)}),0)}function ao(){on.getState("iosSlipPrefetchEnable")&&!Zi&&(Zi=!0,Hn().conversation.receiveFirstChunk.emit({prefetch_confirm_url:""}))}function io(t,e){if(!lt()){var n=_t(e||on.getState("query"));if(!n||to.test(n)){if(Yi)return;e=Yt}var a=rc(e||on.getState("query")||Yt,!0),i=a.data,o=a.headers;i.mod=1,i.isShowHello=1;var r="/s?"+Mt(i);fetch(r,{headers:o}).then((function(t){return t.ok?t.text():Promise.reject({status:-2})})).then((function(e){var n=document.createElement("div");n.innerHTML=e;var a=kn(n.querySelector("#NATab"),"src");a&&eo(a,t)}))}}function oo(t){if(on.getState("isWiseNewCsaitab")&&o.canIUse("search.getMultiTabBarInfo")&&!lt()){var e;if(t=_t(t||on.getState("query")).trim(),void 0===(e=t)&&(e=""),!(t= __call$(__call$(e,"replace",["？","?"]),"replace",["，",","]) )||to.test(t)){if(Yi)return;t=Yt}var n=on.getState("tabData"),a=n.logUrl,i=n.showTabCount,r=n.showTagCount,s=n.hasSearchTag,l=n.data,c=n.logParams,d=n.lid,u=on.getState("user"),p={query:t||Yt,data:[],logParams:{},logUrl:a,showTabCount:i,showTagCount:r||4,hasSearchTag:s||!1};Array.isArray(l)&&l.forEach((function(e,n){var a=e.link,i=e.text,o=e.pd,r=e.ct,s=e.cst,l=e.log,h=e.select,f=e.nadegrate,g=e.source,m=e.productid,v=e.common,y=void 0===v?{}:v,w=e.tagImg,b={title:i||"",url:null==a?void 0: __call$(a,"replace",["word=","word="+encodeURIComponent(t)]) ,pd:o};if(w&&(b.tagImg=w),f&&(b.naDegrate=f),g&&(b.source=g),m&&(b.productId=m),"ps"===l&&(b.isSearch=1),1===h&&(b.isSelected=1,p.logParams={tcreq4log:1,ssid:c.ssid,from:c.from,bd_page_type:1,uid:u.uid||"0",pu:c.pu,baiduid:(null==u?void 0:u.baiduid)||"",ref:c.ref,w:c.pn+"_"+c.rn+"_"+t,ct:r,cst:s,pos:n,lid:d||on.getState("lid"),anchorTime:Math.round((new Date).getTime()/1e3),clk_info:{type:"vs_tab",applid:c.applid}}),e.pd){var _=e.vs?e.vs:"https://m.baidu.com/sf/vsearch?pd="+e.pd+"&tn=vsearch";e.args&&(_+="&"+e.args),_+="&word=",b.vs=_}Object.keys(y).forEach((function(t){ __set$(b,t,__get$(y,t)) })),p.data.push(b)})),no("baiduboxapp://searchframe/multiTabBarInfo?params="+encodeURIComponent(JSON.stringify(p)))}}function ro(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function so(){return so=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},so.apply(this,Array.from(arguments))}function lo(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ro(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ro(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var co=function(){function t(){this.RANK_ANSWER_BOX=".answer-box",this.SHOW_AREA="[data-show-area]",this.SUBPOS_SHOW_EXT="data-show-ext",this.NEED_SHOW_LOG="need-show-log",this.BASE_SHOW_EXT="data-show-log",this.subPosList=[],this.areaDataList=[],this.init()}var e=t.prototype;return e.addEle=function(t){var e=this;(t&&t.dom?this.getSubPosList([t.dom]):this.getSubPosList(this.areaDataList)).forEach((function(t){var n;t.dom.dataset.observered?e.subPosList=e.subPosList.map((function(e){return e.dom===t.dom?t:e})):(null==(n=e.subPosObserver)||n.observe(t.dom),t.dom.dataset.observered=!0,e.subPosList.push(t))}));for(var n=0;n<this.subPosList.length;n++){var a= __get$(this.subPosList,n) .dom;a&&a.closest("body")||this.subPosList.splice(n,1)}},e.init=function(){var t=this;this.startSubPosObserver(),window.addEventListener("unload",(function(){return t.destroy()})),this.updateListenDom()},e.updateListenDom=function(){var t=this;new MutationObserver((function(e){for(var n,a=lo(e);!(n=a()).done;){var i=n.value;i.addedNodes&&i.addedNodes.length>0&&1===i.addedNodes[0].nodeType&&i.addedNodes[0].hasAttribute("data-show-area")&&(!i.addedNodes[0].hasAttribute(t.NEED_SHOW_LOG)||"true"===i.addedNodes[0].getAttribute(t.NEED_SHOW_LOG))&&(t.areaDataList.push(i.addedNodes[0]),t.addEle({dom:i.addedNodes[0]}))}})).observe(document.body,{childList:!0,subtree:!0})},e.destroy=function(){this.subPosObserver&&this.subPosObserver.disconnect()},e.forceTrigger=function(t){this.subPosObserver.unobserve(t),this.subPosObserver.observe(t)},e.startSubPosObserver=function(){var t=this;this.subPosObserver=new IntersectionObserver((function(e){e.forEach((function(e){e.intersectionRatio>=.6&&t.subPosList.forEach((function(t){if(t.dom===e.target){var n=t.ubcId,a=t.page,i=t.source;Ua(so({type:"show",value:t.value},n?{ubcId:n}:{},a?{page:a}:{},i?{source:i}:{},{ext:so({},t,{valueInfo:Array.isArray(t.valueInfo)?t.valueInfo:[t.valueInfo],agent_id:t.agentId,agent_name:t.agentName,guide_word_type:t.guideWordType})}))}}))}))}),{threshold:[.4,.6]})},e.getAreaDataList=function(){return document.querySelectorAll(this.SHOW_AREA)},e.getSubPosList=function(t){var e=this,n=[];return t.forEach((function(t){var a,i=null==t||null==(a=t.parentNode)?void 0:a.querySelectorAll("["+e.SUBPOS_SHOW_EXT+"]");i&&i.length&&i.forEach((function(t){var a=e.getSubPosInfo(t);(a=je(a)).value&&n.push(so({dom:t},a))}))})),n},e.getSubPosInfo=function(t){if(!t)return{};var e={},n=null,a=null,i=void 0,o=void 0,r=void 0;try{var s=t.getAttribute(this.SUBPOS_SHOW_EXT);n=JSON.parse(s);var l=t.closest("["+this.BASE_SHOW_EXT+"]");if(l){var c=l.getAttribute(this.BASE_SHOW_EXT);a=c&&JSON.parse(c)}}catch(t){n=null}return n&&(e=n.component_content||{},i=n.agent_id||(null==a?void 0:a.agent_id),o=n.agent_name||(null==a?void 0:a.agent_name),r=n.guide_word_type),so({valueInfo:e,agentId:i,agentName:o,guideWordType:r,ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(on.getState("rank")),a_lid:on.getState("apagelid")},a,n)},e.updateTransDom=function(){var t=this;document.querySelectorAll("[data-show-area]").forEach((function(e){t.areaDataList.includes(e)||e.hasAttribute(t.NEED_SHOW_LOG)&&"true"!==e.getAttribute(t.NEED_SHOW_LOG)||(t.areaDataList.push(e),t.addEle({dom:e}))}))},e.deleteTransDom=function(t){this.areaDataList.includes(t)&&(this.areaDataList=this.areaDataList.filter((function(e){return e!==t})),this.subPosList=this.subPosList.filter((function(e){return e.dom!==t})),t.dataset.observered="",this.subPosObserver.unobserve(t))},t}(),uo=new co;function po(t){uo.addEle(t)}function ho(){uo.updateTransDom()}function fo(t){return 0===t.indexOf("https://pan.baidu.com/s/")}var go=function(t){return!t||!Object.keys(t).length};function mo(){return mo=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},mo.apply(this,Array.from(arguments))}var vo=null,yo=navigator.userAgent,wo=/baiduboxapp\/([\d.]+)/i;function bo(t){var e=t.url;"replace"===t.type? __call$(__get$(window,"location"),"replace",[e]) :window.open(e,"_blank")}function _o(t,e,n){var a,i;if("object"==(void 0===t?"undefined":(i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i))if("_drawer"!==(null==t?void 0:t.target)){var r=(null==(a=e.env)?void 0:a.platform)||"";switch(yo&&wo.test(yo)&&(r="na"),r){case"pc":bo({url:t.pcUrl||t.url,type:t.h5JumpType});break;case"na":var s;if(t.easyBrowser&&o.canIUse("easyBrowser.open")){o.easyBrowser.open(mo({},t.easyBrowser,{fail:function(e){bo({url:t.url,type:t.h5JumpType})}}));break}if(t.deeplink){o.canIUse("ad.deeplink")?o.ad.deeplink({webUrl:"baiduboxapp://v1/easybrowse/open?newbrowser=1&append=1&url="+encodeURIComponent(t.url),appUrl:t.deeplink}):bo({url:t.url,type:t.h5JumpType});break}if(null==(s=t.swan)?void 0:s.appKey)return void function(){if(vo)return vo;var t=document.createElement("script");return t.type="text/javascript",t.src="https://b.bdstatic.com/searchbox/icms/searchbox/js/swanInvoke.js",document.body.appendChild(t),vo=new Promise((function(e){return t.onload=function(){e(!0)}}))}().then((function(){var e,n,a,i,o=(null==(e=t.swan)?void 0:e.query)?(null==(n=t.swan)?void 0:n.path)+"?"+(null==(a=t.swan)?void 0:a.query):null==(i=t.swan)?void 0:i.path;window.swanInvoke({appKey:t.swan.appKey,path:o})}));if(fo(t.url)&&o.canIUse("netdisk.gotoPanLinkPage"))return void o.netdisk.gotoPanLinkPage({panLink:t.url,ubcSource:"ai_assistant",fail:function(){bo({url:t.url,type:t.h5JumpType})}});bo({url:t.url,type:t.h5JumpType});break;default:bo({url:t.url,type:t.h5JumpType})}}else{var l=t.percent,c=t.title,d=t.url,u=n.type,p=n.renderContextId;xa().emit({rank:p,halfScreenData:{percent:l,title:c,url:d,type:u}})}else console.error("跳转失败：LinkApiParams 参数错误")}var ko=null,So={link:function(t,e){return _o(t,ko,e)},showToast:function(t){Qn().emit({text:t})},request:function(t,e){void 0===e&&(e=500);var n=t.options,a=t.url,i=a,o=n||{},r=o.data,s=void 0===r?"":r,l=o.method;if(s)if("GET"===(void 0===l?"GET":l)){var c=new URLSearchParams(s).toString();i=c?a+"?"+c:a}else n.body=JSON.stringify(s),n.headers["Content-Type"]="application/json";return Li(i,n,e)}},xo=function(t){ko=t},Io=function(){return So};function To(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Co(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){To(o,a,i,r,s,"next",t)}function s(t){To(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Lo(){return Lo=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Lo.apply(this,Array.from(arguments))}function Do(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Po=!1,Eo=new Map,Ao=[];function Oo(){if(!Po){var t={type:"chat-view",platform:"pc"===rt()?"pc":"wise"},e={apis:Io(),env:t};xo(e),r.sdk.init({env:t,showProgress:!0,apis:Io()}),Po=!0}}function Ro(t){Oo();var e=(null==t?void 0:t.pluginInfo)||[],n=null==t?void 0:t.agentId;Array.isArray(e)&&e.forEach((function(t){if(Array.isArray(t.components)){var e=t.components,a=[];if(e.forEach((function(t){var e={};try{e=JSON.parse(t.component_desc)}catch(t){e={}}if(e.moduleId&&!Ao.includes(e.moduleId)){var n=Lo({resourceUrl:t.component_address||""},e);a.push(n)}})),0!==a.length&&n&&!Eo.get(n)){var i=r.sdk.loadResource(a);Eo.set(n,i)}}}))}function No(t){return new Promise(Co((function(e,n){var a,i,o,r,s,l;return Do(this,(function(c){switch(c.label){case 0:(a=null==t?void 0:t.agentId)||e(1),c.label=1;case 1:return c.trys.push([1,5,,6]),(i=Eo.get(a))?[4,i]:[3,3];case 2:return 0===(o=c.sent()).failedAssistants.length?(r=Ao.concat(o.successfulAssistants.map((function(t){return t.moduleId}))),s=new Set(r),Ao=Array.from(s),Eo.delete(a),e(1)):n("render assistant failed"),[3,4];case 3:e(1),c.label=4;case 4:return[3,6];case 5:return l=c.sent(),n(l),[3,6];case 6:return[2]}}))})))}function Mo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function qo(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function jo(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){qo(o,a,i,r,s,"next",t)}function s(t){qo(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Bo(){return Bo=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Bo.apply(this,Array.from(arguments))}function Ho(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Mo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mo(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $o(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Fo,Uo="";function Go(t){Uo||(Uo=t)}!function(t){ __set$(t,t.NORMAL=0,"NORMAL") , __set$(t,t.LOADING=1,"LOADING") , __set$(t,t.FAIL=2,"FAIL") , __set$(t,t.NOMORE=3,"NOMORE") , __set$(t,t.SUCCESS=4,"SUCCESS") }(Fo||(Fo={}));var Wo="拉取历史失败",zo="pc"===rt();function Qo(t){Ua({type:"show",value:t,ext:{setype:"csaitab"}})}function Jo(t){void 0===t&&(t={});var e=on.getState("chatParams")||{},n=on.getState("oriLid"),a=on.getState("pn"),i=Bo({},t.reqType?{req_type:t.reqType}:{},{from:"chat_search",sge_lid:e.sge_lid,token:sc(),pn:a,rn:de,search_before_lid:Uo,landingPageSwitch:on.getState("landingPageSwitch"),landingPage:lt()?"deepseek":"aitab",cur_ori_lid:n||Uo,deepseek:lt()?1:0});return t.knowledgeId&&(i.knowledgeId=t.knowledgeId),{data:i}}function Vo(){return di(ci(),"15.5")>=0&&!pt()&&!ut()&&"landing"===on.getState("pageType")}function Ko(t){var n=t.status,a=t.isEmpty;t.data;var i=t.length,o=t.options,r=void 0===o?{}:o,s=r.appendRender,l=r.isAiCall;if(0!==n)return l?void ha().emit(!1):(Zn().emit({state:2,appendRender:s}),on.dispatch("update",{isHistoryLoading:!1}),void Qo("refresh_fail"));if(a){var c=on.getState("pn");return zo&&0===c?(e.Toast.show({message:Wo}),si({isShowHello:"1",extParams:JSON.stringify({enter_type:"sidebar_dialog"})})):Vo()&&0===c&&!l&&(e.Toast.show({message:Wo}),si({word:"百度AI助手",isShowHello:"1",pd:"csaitab",setype:"csaitab",extParams:JSON.stringify({enter_type:"new_chat"})})),l?void ha().emit(!1):(Zn().emit({state:3,appendRender:s}),on.dispatch("update",{isHistoryLoading:!1}),void Qo("refresh_nomore"))}if(Zn().emit({state:4,appendRender:s}),Qo("refresh_succ"),!s){var d=on.getState("pn");on.dispatch("update",{pn:d+1})}if(l){var u=on.getState("rank");on.dispatch("update",{rank:u+i}),ea().emit()}else{if(!zo){var p=on.getState("topRank");on.dispatch("update",{topRank:p-i})}s&&on.dispatch("update",{rank:1})}ta().on((function(t){var e=t.initShowHistory,n=t.isAiCall;e&&Vs(on.getState("conversationLogId"),{lid:"",query:_t(on.getState("query")),chatNum:1,perfInfo:{baseDataTime:String(Date.now())},startTimeList:on.getState("startTimeList"),naInjectTime:on.getState("naInjectTime")},"invoke",{});setTimeout((function(){var t=on.getState("pn"),a=Vo()||zo;if(!e&&function(t){void 0===t&&(t="top");$l.showHistory(t)}(a&&1===t?"bottom":"top"),ho(),on.dispatch("update",{isHistoryLoading:!1}),n){var i=_n('.cs-rank-container[rank="'+on.getState("rank")+'"]'),o=_n(".capsules-box");i&&Kl({element:i,block:"end",margin:o?53:8,behavior:"instant"})}}),50)}),{once:!0})}function Xo(t){return Yo.apply(this,Array.from(arguments))}function Yo(){return Yo=jo((function(t){return $o(this,(function(e){return[2,new Promise((function(e){Li(t,{},1e4,zo).then((function(t){e(zo?t||"":(null==t?void 0:t.singCardContent)||"")})).catch((function(){e("")}))}))]}))})),Yo.apply(this,Array.from(arguments))}var Zo=["questionClosely","input","searchingSteps","askBack","agentRec","shortcuts"],tr=["base-clue-form"],er=["markdown","markdown-yiyan","markdown-hamburg"],nr=["writing","officeWriting"],ar='[authority-title](javascript:void(0)){type="authority"} ';function ir(t,e,n){var a=!1,i=[],o=!1,r={},s=!1,l=1,c={},d={sessionId:"",deleteQidList:[]},u=[],p="",h=on.getState("isShowHello"),f=n||h?function(t){var e=new Set(["questionClosely","askBack"]);return t.reduce((function(t,n){var a,i=null==n||null==(a=n.data.message.content)?void 0:a.generator;if(i)for(var o,r=Ho(i);!(o=r()).done;){var s=o.value;if(e.has(null==s?void 0:s.component)){t.push({data:{content:{generator:s}}});break}}return t}),[])}(t):[],g=t.map((function(t){var n,h,f,g,m,v;(null==t||null==(n=t.data.message.content)?void 0:n.shareId)&&(r.shareId=null==t||null==(v=t.data.message.content)?void 0:v.shareId);var y=null==t||null==(h=t.data.message.content)?void 0:h.generator;c=null==t||null==(f=t.data.message.content)?void 0:f.hints;var w,b,_,k=null==(m=t.data.message.content.agentInfo)||null==(g=m.agentMeta)?void 0:g[0],S="",x=[],I=null;if((null==t?void 0:t.sessionId)&&!d.sessionId&&(d.sessionId=t.sessionId),e&&(null==t?void 0:t.qid)&&Go(t.qid),(null==t?void 0:t.qid)&&!d.deleteQidList.includes(t.qid)&&d.deleteQidList.push(t.qid),k&&k.agentName&&k.logo){var T,C,L=zo?null==k||null==(T=k.jumpUrl)?void 0:T.h5:null==k||null==(C=k.jumpUrl)?void 0:C.zbios;w=k.agentName,b=L,_=k.logo,S="["+w+"]("+(b=b||"javascript:void(0)")+'){type="agent" src="'+_+'"}'}var D=!1,P=[];return null==y||y.forEach((function(t){var e,n;t.sectionId&&(s=!0);var i=t.component;if(zo||i){var r,c;if("uiMeta"===t.dataType&&(I=t),"chatForm"===i&&(t.data.isHistory=!0),!o&&t.hideAlaCard&&(o=t.hideAlaCard),I&&"uiData"===t.dataType)return I.data.historyUiData||(I.data.historyUiData=[]),tr.includes(null==I||null==(c=I.data)||null==(r=c.component)?void 0:r.type)?void(I.data={}):void I.data.historyUiData.push(t.data);if(!Zo.includes(i)){var d;if(t.data&&(t.data.backgroundImage||(null==(e=t.data)?void 0:e.bgLinearGradient)))t.bgProps={backgroundImage:t.data.backgroundImage,backgroundImageDark:t.data.backgroundImageDark,bgLinearGradient:null==(d=t.data)?void 0:d.bgLinearGradient};var h=null==t?void 0:t.authorityInfo,f=ar,g=er.includes(i);h&&h.title&&g&&(f= __call$(f,"replace",["authority-title",h.title]) ,t.data.value=f+t.data.value),S&&!D&&0===x.length&&(D=!0,g?(p+="transform: translateY(calc((var(--font-size-scale)*-4px)));",t.data.value=S+t.data.value):u.push({component:"markdown",data:{value:S,type:"entry"}}));var m=a?P:x;if(-1!==nr.indexOf(i)&&m.length>0&& __get$(m,m.length-1) .component===i)return  __get$(m,m.length-1) .data.content= __get$(m,m.length-1) .data.content||"", __get$(m,m.length-1) .data.content+=t.data.content||"", __get$(m,m.length-1) .data.typing=null,void( __get$(m,m.length-1) .data.isEnd=t.data.isEnd);if(1===(null==(n=t.data)?void 0:n.isIndependenGuide))a=!0;else if(a)return void P.push(t);g&&x.length>0&& __get$(x,x.length-1) .component===i?s&&l!==t.sectionId?(x.push(t),l=t.sectionId): __get$(x,x.length-1) .data.value+=t.data.value:(t.agentInfo=k,g&&!t.data.value||x.push(t))}}})),P.length&&i.push(P),[].concat(u,x)}));return{blocksList:g=g.filter((function(t){return t&&t.length>0})),hints:c,independenBlocks:i,hideAlaCard:o,shareParams:JSON.stringify(r),deleteParams:JSON.stringify(d),aiEntryStyle:p,isSeparateBub:s,historyAskMessage:f}}function or(t){var e=t.question,n=t.appendRender,a=t.isAiCall,i=on.getState("syncTabData");if(n&&!a){var o,r;on.dispatch("update",Bo({query:null===e?Yt:e[0].data.question.question,agentQuery:null===e?"":e[0].data.question.agentQuery},e&&(null==(o=e[0])?void 0:o.data.agentInfo)?{agentInfo:e[0].data.agentInfo}:{}));var s=e&&"text"!==(null==(r=e[0])?void 0:r.type)?Yt:"";on.getState("isWiseNewCsaitab")?oo(s):io(!0,s)}else if(n&&a&&i&&e){var l,c=null==(l=e[0].data.question)?void 0:l.question;on.getState("isWiseNewCsaitab")?oo(c):io(!0,c)}}function rr(t){var e=t.mmsQuery,n=t.query,a=t.createTime,i=t.reRank,o=t.agentInfo,r=t.appendRender,s=t.isAiCall;if(null!==n){var l=function(t){var e,n=(null==t?void 0:t.agentMeta)&&t.agentMeta[0],a=(null==t?void 0:t.agentId)&&t.agentId[0];if(n&&a){var i={agentId:null==n?void 0:n.agentId,agentName:null==n?void 0:n.agentName,agentSearchId:a||"",description:null==n?void 0:n.description,startIndex:0,endIndex:(null==n||null==(e=n.agentName)?void 0:e.length)||0,guides:[],jumpUrl:null==n?void 0:n.jumpUrl,logo:null==n?void 0:n.logo,pluginInfo:null==n?void 0:n.pluginInfo};return Ro(i),i}}(o),c="",d="",u=[],p=[],h=null,f=[];Array.isArray(n)&&n.forEach((function(t){var e=t.data;switch(t.type){case"TEXT":c+=e.text.query,d+=e.text.text_type,h||(h=t,f.push(h)),h.data.text.query=c,h.data.text_type=d;break;case"IMAGE":u.push(e.image);break;case"FILE":p.push(t.data.file)}})),p.length&&f.push({type:"FILE",data:{file:p}}),u.length&&f.push({type:"IMAGE",data:{image:u}});var g=(Array.isArray(n)?f:[n]).map((function(t,n){var o,s;return function(t){var e,n,a,i=t.queryInfo,o=t.reRank,r=t.text_type,s=t.agentInfoResult,l=t.createTime,c=t.mmsQuery,d=t.index,u=t.appendRender,p={type:"text",data:{question:{mmsQuery:c,hisRank:o,text_type:r,question:"",createTime:l,reRank:o,agentQuery:(null==(n=i.data)||null==(e=n.text)?void 0:e.query)||""},isHistory:!0,initShowHistory:u,agentInfo:s}},h=p.data.question;return"string"==typeof i?(p.type=c?"image":"text",h.question=c?c.value:i,p):"TEXT"===i.type?(h.hisRank=0===d?h.hisRank:0,h.question="pc"!==rt()&&!on.getState("isWiseNewCsaitab")&&s?"@"+s.agentName+i.data.text.query:i.data.text.query,p):"IMAGE"===i.type?(p.type="image",h.hisRank=0===d?h.hisRank:0,h.question=null==(a=i.data.image)?void 0:a.map((function(t){return Va(t)})),p):"FILE"===i.type?(p.type="file",h.question=i.data.file?i.data.file.map((function(t){return Va(t)})):{},p):void 0}({queryInfo:t,reRank:i,text_type:(null==(s=t.data)||null==(o=s.text)?void 0:o.text_type)||"",agentInfoResult:l,createTime:a,mmsQuery:e,index:n,appendRender:r})}))||{};return or({question:g,appendRender:r,isAiCall:s}),g}or({question:n,appendRender:r,isAiCall:s})}function sr(t){return lr.apply(this,Array.from(arguments))}function lr(){return lr=jo((function(t,e){var n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b,_,k,S,x,I,T,C,L,D,P,E,A,O,R,N,M,q,j,B,H,$,F,U,G;return $o(this,(function(W){switch(W.label){case 0:return void 0===e&&(e={}),u=e.fetchCard,p=void 0===u||u,h=e.appendRender,f=e.isAiCall,g=t.chatResponse||[],m=rr({mmsQuery:t.mmsQuery,query:t.query,text_type:t.text_type,createTime:t.createTime,reRank:t.reRank,agentInfo:null==(o=g[0])||null==(i=o.data)||null==(a=i.message)||null==(n=a.content)?void 0:n.agentInfo,appendRender:h,isAiCall:f}),v=on.getState("rank"),y=on.getState("topRank"),(zo||Vo())&&+(null==t?void 0:t.reRank)>+v&&(on.dispatch("update",{rank:+t.reRank,curRankInfo:{rank:+t.reRank},qaPairIdDiff:+t.reRank}),b=null==(w=g[0])?void 0:w.useModel,Vo()&&b&&new Vi(on).handleSelectModel({id:b})),zo&&+t.reRank<+y&&on.dispatch("update",{topRank:+t.reRank}),_="",k=!1,S=ir(g,h,f),x=S.blocksList,I=S.independenBlocks,T=S.hideAlaCard,C=S.shareParams,L=S.deleteParams,D=S.hints,P=void 0===D?{}:D,E=S.aiEntryStyle,A=S.isSeparateBub,O=S.historyAskMessage,(R=null==(c=g[0].data)||null==(l=c.message)||null==(s=l.content)||null==(r=s.alaCards)?void 0:r.url)&&!T&&p?[4,Xo(R)]:[3,2];case 1:_=W.sent(),k=!0,W.label=2;case 2:h&&ha().emit(!1),N=[],M=Ho(x),W.label=3;case 3:if((q=M()).done)return[3,13];j=q.value,B=[],H=Ho(j),W.label=4;case 4:if(($=H()).done)return[3,11];if("uijson"!==(F=$.value).component)return[3,9];W.label=5;case 5:return W.trys.push([5,7,,8]),[4,No(F.agentInfo)];case 6:return 1===W.sent()&&B.push(F),[3,8];case 7:return W.sent(),[3,8];case 8:return[3,10];case 9:B.push(F),W.label=10;case 10:return[3,4];case 11:N.push(B),W.label=12;case 12:return[3,3];case 13:return U=!1,k?function(t){if(!t)return!1;var e=document.createElement("div");return e.innerHTML=t,"pc"===rt()?!!e.querySelectorAll(".result-op[tpl],.result[tpl]").length:!!e.querySelector(".se-page-bd")&&e.querySelectorAll(".c-result:not([tpl=ai_index])").length}(_)||(U=!0):T&&x.length||(U=!0),vt()&&(U=!0,P.parts||(P.parts=[{text:""}]),P.parts[0].text="暂不支持此类历史消息展示，请到网页版查看"),G=(null==(d=g[0])?void 0:d.qid)||"",[2,{question:m,answer:{blocksList:N,independenBlocks:I,cardHtml:_,shareParams:C,deleteParams:L,initShowHistory:h,aiEntryStyle:E,isSeparateBub:A,hints:U?P:{},historyAskMessage:O,isAiCall:f,historyQid:G}}]}}))})),lr.apply(this,Array.from(arguments))}function cr(t){var e=document.createElement("iframe");e.style.display="none",e.src=t;var n=document.body||document.getElementsByTagName("body")[0];n.appendChild(e),setTimeout((function(){n.removeChild(e),e=null}),0)}var dr,ur=17592352028333;function pr(){if(!lt()){var t=on.getState("chatParams").sse_host+"/aichat/api/impush",e={call_from:"aitab",logid:on.getState("lid"),pa_uid:ur,msg_readed:1};fetch(t,{headers:{"Content-Type":"application/json"},method:"post",mode:"cors",credentials:"include",body:JSON.stringify(e)})}}function hr(){if(ht()){var t=JSON.stringify({targetId:ur,category:0}),e=encodeURIComponent(t),n="im_callback_"+ +new Date,a="baiduboxapp://message/readAllMessagesWithCommand?params="+e+"&callback="+n; __set$(window,n,function(){}) ,cr(a)}}function fr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function gr(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function mr(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){gr(o,a,i,r,s,"next",t)}function s(t){gr(o,a,i,r,s,"throw",t)}r(void 0)}))}}function vr(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return fr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fr(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function yr(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function wr(){return new Promise((function(e,n){new Promise((function(e,n){t(["./baidubce-sdk.bundle.min.pc.DiNU-FrE"],e,n)})).then((function(t){return t.baidubceSdk_bundle_min})).then((function(t){e(t.default)})).catch((function(t){n(t)}))}))}!function(t){ __set$(t,t.INIT=-1,"INIT") , __set$(t,t.UPLOADING=0,"UPLOADING") , __set$(t,t.BOS_SUCCESS=1,"BOS_SUCCESS") , __set$(t,t.NETWORK_ERROR=2,"NETWORK_ERROR") , __set$(t,t.RISK_DENY=3,"RISK_DENY") , __set$(t,t.FILE_NUM_EXCEED_LIMIT=4,"FILE_NUM_EXCEED_LIMIT") , __set$(t,t.FILE_SIZE_EXCEED_LIMIT=5,"FILE_SIZE_EXCEED_LIMIT") , __set$(t,t.KNOWLEDGE_SUCCESS=6,"KNOWLEDGE_SUCCESS") , __set$(t,t.KNOWLEDGE_ERROR=7,"KNOWLEDGE_ERROR") , __set$(t,t.SET_FILE_NUM=8,"SET_FILE_NUM") , __set$(t,t.NOT_AVAILABLE=9,"NOT_AVAILABLE") }(dr||(dr={}));var br="https://chat.baidu.com",_r=".jpeg, .png, .jpg, .bmp, .webp",kr=".pdf, .doc, .docx, .txt, .xls, .xlsx, .csv, .ppt, .pptx",Sr=_r+", "+kr;var xr=function(){function t(t,e){this.inLoop=!1,this.preventUploadSet=new Set,this.uploadMap=new Map,this.options=t,this.sdk=e}var e=t.prototype;return e.getFile=function(t){var e=this;return mr((function(){return yr(this,(function(n){return[2,new Promise((function(n,a){try{var i=document.createElement("input"),o=e.options,r=o.type,s=o.maxNum;i.type="file",i.accept="all"===r?Sr:"image"===r?_r:kr,i.multiple=s>1,i.onchange=function(i){return e.handleFileChange(i,n,a,t)},i.click()}catch(t){a(t)}}))]}))}))()},e.getCouldUploadFiles=function(t){var e=t.filter((function(t){var e=t.name.split(".")||[],n=null==e?void 0: __get$(e,e.length-1) ;return n&&Sr.includes(n)}));return e.length!==t.length&&this.options.callback({status:9}),e},e.handleFileChange=function(t,e,n,a){var i=this;return mr((function(){var o,r,s,l,c,d,u;return yr(this,(function(p){switch(p.label){case 0:if(p.trys.push([0,2,,3]),o=null==t?void 0:t.target,r=Array.from(o.files||[]),s=i.getCouldUploadFiles(r),a&&!a(s))return[2];if(s.length>i.options.maxNum)return i.options.callback({status:4}),n(new Error("File selection failed")),[2];for(i.options.callback({status:8,num:s.length}),l=vr(s);!(c=l()).done;){if((d=c.value).size>1024*i.options.maxSize*1024)return i.options.callback({status:5}),n(new Error("File selection failed")),[2];if(0===d.size)return i.options.callback({status:3}),n(new Error("File selection failed")),[2]}return i.files=s,[4,Promise.all(s.map((function(t,e){return i.uploadFile(t,e)})))];case 1:return p.sent(),e(),[3,3];case 2:return u=p.sent(),n(u),[3,3];case 3:return[2]}}))}))()},e.uploadFiles=function(t){var e=this;return Promise.all(this.getCouldUploadFiles(t).map((function(t,n){return e.uploadFile(t,n)})))},e.uploadFile=function(t,e){void 0===e&&(e=0);var n=this;return mr((function(){var a;return yr(this,(function(i){return a=Date.now()+e+function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_",e="",n=new Uint8Array(6);crypto.getRandomValues(n);for(var a=0;a<6;a++)e+= __get$(t,__get$(n,a)%63) ;return e}(),[2,new Promise(mr((function(i,o){var r,s,l,c,d,u,p,h,f,g,m,v,y,w;return yr(this,(function(b){switch(b.label){case 0:return b.trys.push([0,3,,4]),t?(n.files||(n.files=[t]),t.size>1024*n.options.maxSize*1024?(n.options.callback({status:5}),o(new Error("File selection failed")),[2]):0===t.size?(n.options.callback({status:3}),o(new Error("File selection failed")),[2]):(n.sdk||navigator.onLine||n.options.callback({status:2,fileInfo:{fileIndex:e}}),[4,n.getSts()])):[2];case 1:return s=b.sent(),l=s.ak,c=s.sk,d=s.token,u=s.preFixPath,n.options.callback({status:-1,progress:0,fileInfo:{fileName:t.name,fileType:t.type,fileSize:t.size,fileIndex:e,fileToken:a}}),p=n.sdk.BosClient,h=new p({endpoint:"https://aisearch.bj.bcebos.com",credentials:{ak:l,sk:c},sessionToken:d}),f=null==(r=t.name)?void 0:r.split(".").pop(),g=n.sdk.MimeType.guess(f),m=a+"."+f,g.startsWith("text/")&&(g+="; charset=UTF-8"),v=h.putSuperObject({bucketName:"aisearch",objectName:""+u+m,chunkSize:1048576,ContentLength:t.size,ContentType:g,data:t,onProgress:function(t){var i=t.progress;n.options.callback({status:0,progress:i,fileInfo:{fileIndex:e,fileToken:a}})},onStateChange:mr((function(r,s){var l,c,d,u,p,h;return yr(this,(function(f){switch(f.label){case 0:if("completed"!==r)return[3,7];f.label=1;case 1:return f.trys.push([1,5,,6]),n.options.callback({status:0,progress:1,fileInfo:{fileIndex:e,fileToken:a}}),l=s.data.key,c=btoa(l.split("/").pop()),[4,n.upLoadConfirm({path:l,size:t.size,name:t.name,id:c,type:"all"===n.options.type?t.type.startsWith("image/")?"image":"file":n.options.type},e)];case 2:return d=f.sent(),u=d.file_url,n.options.callback({status:1,progress:1,fileInfo:{fileIndex:e,fileId:c,fileUrl:u,filePath:l,fileToken:a}}),!n.options.knowledgeId||n.preventUploadSet.has(a)?[3,4]:[4,n.getUploadKnowledgeStatus(c)];case 3:f.sent(),n.options.callback({status:6,fileInfo:{fileToken:a,fileUrl:u}}),f.label=4;case 4:return i(),[3,6];case 5:return p=f.sent(),h=p.status||2,n.options.callback({status:h,fileInfo:{fileIndex:e,fileToken:a}}),o(p),[3,6];case 6:return[3,8];case 7:"failed"===r&&(n.options.callback({status:2,fileInfo:{fileIndex:e,fileToken:a}}),o(new Error("Network disconnected"))),f.label=8;case 8:return[2]}}))}))}),[4,v.start()];case 2:return b.sent(),[3,4];case 3:return y=b.sent(),w=y.status||2,n.options.callback({status:w,fileInfo:{fileIndex:e,fileToken:a}}),o(y),[3,4];case 4:return[2]}}))})))]}))}))()},e.reTryUpload=function(){var t=this;return mr((function(){var e;return yr(this,(function(n){switch(n.label){case 0:return e=t.files,[4,Promise.all(e.map((function(e,n){return t.uploadFile(e,n)})))];case 1:return[2,n.sent()]}}))}))()},e.getSts=function(){var t=this;return mr((function(){return yr(this,(function(e){return[2,new Promise(mr((function(e,n){var a,i,o;return yr(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),vt()&&(t.options.sseHost=br),a=(t.options.sseHost||br)+Wt.uploadSts+"?tk="+sc()+(t.options.knowledgeId?"&knowledgeId="+t.options.knowledgeId:""),[4,fetch(a,{mode:"cors",credentials:"include"})];case 1:return(i=r.sent()).ok||n({status:2}),[4,i.json()];case 2:return 0===(o=r.sent()).status?e(o.data):n({status:2}),[3,4];case 3:return r.sent(),n({status:2}),[3,4];case 4:return[2]}}))})))]}))}))()},e.upLoadConfirm=function(t,e){var n=this;return mr((function(){return yr(this,(function(a){return[2, new Promise(mr(function(a,i){var o,r,s,l,c;return yr(this,function(d){switch(d.label){case 0:vt()&&(n.options.sseHost=br),d.label=1;case 1:return d.trys.push([1,4,,5]),o=(n.options.sseHost||br)+Wt.upload+"?tk="+sc(),[4,fetch(o,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(__call$(Object,"assign",[{},t,n.options.uploadBody,n.options.knowledgeId?{knowledgeId:n.options.knowledgeId,sort:e}:{}]))})];case 2:return[4,d.sent().json()];case 3:return r=d.sent(),l=(s=r||{}).status,c=s.data,0===l?a(c):i(-1===l||-5===l?{status:3}:{status:2}),[3,5];case 4:return d.sent(),i({status:2}),[3,5];case 5:return[2];}});})) ]}))}))()},e.loop=function(){var t=this;return mr((function(){var e,n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w;return yr(this,(function(b){switch(b.label){case 0:if(!t.uploadMap.size)return[2];for(e=1e3,n=Date.now(),a=vr(Array.from(t.uploadMap.keys()));!(i=a()).done;)o=i.value,r=t.uploadMap.get(o),s=r[0],l=r[2],n-s>1e4+e&&(l({status:7}),t.uploadMap.delete(o));c=Array.from(t.uploadMap.keys()),b.label=1;case 1:return b.trys.push([1,4,5,6]),d=""+(t.options.sseHost||br)+Wt.fileLoop+"?knowledgeId="+t.options.knowledgeId+"&fids="+c.join(",")+"&tk="+sc(),[4,fetch(d)];case 2:return[4,b.sent().json()];case 3:for(var _ in u=b.sent(),p=u.data.data)h=t.uploadMap.get(_),f=h[1],g=h[2],1=== __get$(p,_) ?f():g({status:7}),t.uploadMap.delete(_);return[3,6];case 4:for(b.sent(),m=vr(c);!(v=m()).done;)y=v.value,w=t.uploadMap.get(y),(0,w[2])({status:7}),t.uploadMap.delete(y);return[3,6];case 5:return t.uploadMap.size?setTimeout((function(){return t.loop()}),e):t.inLoop=!1,[7];case 6:return[2]}}))}))()},e.getUploadKnowledgeStatus=function(t){var e=this;return mr((function(){return yr(this,(function(n){return[2,new Promise(mr((function(n,a){return yr(this,(function(i){return e.uploadMap.set(t,[Date.now(),n,a]),e.inLoop||(e.inLoop=!0,e.loop()),[2]}))})))]}))}))()},t.create=function(e){return mr((function(){var n;return yr(this,(function(a){switch(a.label){case 0:return[4,wr()];case 1:return n=a.sent(),[2,new t(e,n)]}}))}))()},t.deleteFile=function(t,e,n){return mr((function(){var a,i,o,r,s;return yr(this,(function(l){switch(l.label){case 0:return l.trys.push([0,3,,4]),a=e.sseHost,i=e.knowledgeId,o=e.fileId,r=e.fileToken,s=""+(a||br)+Wt.fileDelete+"?knowledgeId="+i+"&fileId="+o+"&tk="+sc(),t&&(t.uploadMap.delete(o),r&&t.preventUploadSet.add(r)),o?[4,fetch(s)]:[3,2];case 1:l.sent(),n&&n(),l.label=2;case 2:return[3,4];case 3:return l.sent(),[3,4];case 4:return[2]}}))}))()},t}();function Ir(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Tr(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Ir(o,a,i,r,s,"next",t)}function s(t){Ir(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Cr(){return Cr=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Cr.apply(this,Array.from(arguments))}function Lr(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Dr(t){return Pr.apply(this,Array.from(arguments))}function Pr(){return Pr=Tr((function(t){var e,n,a,i,o,r;return Lr(this,(function(s){switch(s.label){case 0:e=on.getState("chatParams.sse_host")||Gt,n=""+e+Wt.knowledge,a={},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Di(n,Cr({},t,{tk:sc()}),{},5e3)];case 2:return a=s.sent(),i=a.status,o=a.data,0===i?((r=o.knowledgeList||[]).forEach((function(t){var e;(null==(e=t.chatList)?void 0:e.length)&&t.chatList.reverse()})),[2,{status:i,knowledgeList:r}]):[2,{status:-1,message:"Failed to get knowledge",error:a}];case 3:return[2,{status:-1,message:"Failed to get knowledge",error:s.sent()}];case 4:return[2]}}))})),Pr.apply(this,Array.from(arguments))}function Er(){return(Er=Tr((function(t){var e,n,a;return Lr(this,(function(i){switch(i.label){case 0:e=on.getState("chatParams.sse_host")||Gt,n=""+e+Wt.deletekl+"?tk="+sc(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Li(n,{method:"POST",body:JSON.stringify(t)},3e3)];case 2:return[2,{status:(a=i.sent()).status,message:a.message}];case 3:return[2,{status:-1,message:"Failed to delete knowledge",error:i.sent()}];case 4:return[2]}}))}))).apply(this,Array.from(arguments))}function Ar(t){return Or.apply(this,Array.from(arguments))}function Or(){return(Or=Tr((function(t){var n,a,i,o,r,s,l,c;return Lr(this,(function(d){switch(d.label){case 0:n=on.getState("chatParams.sse_host")||Gt,a=""+n+Wt.update+"?tk="+sc(),d.label=1;case 1:for(var u in d.trys.push([1,3,,4]),i=ti.getState("knowledgeMsg"),o={},t)r= __get$(i,u) ,s=r.title,l=r.instruction, __set$(o,u,Cr({},{title:s,instruction:l},__get$(t,u))) ;return[4,Li(a,{method:"POST",body:JSON.stringify(o)},5e3)];case 2:if(-1===(c=d.sent()).status)e.Toast.error({message:c.message});else for(var p in e.Toast.success({message:"已保存"}),t)ti.dispatch("updateItem",{knowledgeId:p,data: __get$(t,p) });return[2,{status:c.status,message:c.message}];case 3:return[2,{status:-1,message:"Failed to update knowledge",err:d.sent()}];case 4:return[2]}}))}))).apply(this,Array.from(arguments))}function Rr(){return(Rr=Tr((function(t){var e,n,a;return Lr(this,(function(i){switch(i.label){case 0:e=on.getState("chatParams.sse_host")||Gt,n=""+e+Wt.create+"?tk="+sc(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Li(n,{method:"POST",body:JSON.stringify(t)},5e3)];case 2:return[2,{status:(a=i.sent()).status,data:a.data}];case 3:return[2,{status:-1,message:"Failed to create knowledge",err:i.sent()}];case 4:return[2]}}))}))).apply(this,Array.from(arguments))}function Nr(){return"pc"===rt()&&"/knowledge"=== __get$Loc(location) .pathname}var Mr=function(){var t=ti.getState("knowledgeId");return Nr()?t:""};function qr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function jr(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Br(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){jr(o,a,i,r,s,"next",t)}function s(t){jr(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Hr(){return Hr=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Hr.apply(this,Array.from(arguments))}function $r(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return qr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qr(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Fr(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Ur=3e3,Gr="/aichat/api/aitabserver",Wr="Hi，初次见面很开心！我是你的智能搜索助手，我可以为你答疑解惑，还能进行绘画和文案创作，也能陪你聊聊天，有任何问题可以随时找我。",zr="pc"===rt(),Qr="wise"===rt(),Jr=!1;var Vr=0,Kr=0;function Xr(){return Yr.apply(this,Array.from(arguments))}function Yr(){return Yr=Br((function(t,e){var n,a,i,o;return Fr(this,(function(r){switch(r.label){case 0:return void 0===t&&(t=""),n=Date.now(),a=on.getState("urlInfo")||{},i=a.guideWordsUrl,(zr||!i||t||on.getState("messageReadStyle"))&&(i=function(t,e,n){void 0===t&&(t=""),void 0===n&&(n={});var a=on.getState("chatParams"),i=on.getState("agentInfo")||{},o=on.getState("helloInfo")||{},r=zr?on.getState("pcEnterType"):"",s=on.getState("messageReadStyle"),l=Hr({},o,{enter_type:r,messageReadStyle:s}),c=on.getState("isWiseNewCsaitab"),d=zr||c?sc(e):a.chat_token,u=t||on.getState("chatParams").sse_host+Gr;return u+(u.includes("?")?"&":"?")+new URLSearchParams(n).toString()+"&t="+(a.sge_lid||(new Date).getTime())+"&tk="+d+"&query="+encodeURIComponent(e)+"&agent_p="+(i.agentParams?encodeURIComponent(JSON.stringify(i.agentParams)):"")+"&extParamsJson="+(o.helloKey||s?encodeURIComponent(JSON.stringify(l)):"")+"&agent_id="+(i.agentSearchId||"")}(i,t,{ctl:"guidewords",work_enhance:1,from:vt()?"aichat_plugin":""})),lt()&&(i=Bt(i,{deepseek:1})),function(t){void 0===t&&(t=!1),zr||"message"===on.getState("enterType")||di(ci(),"13.80")<0||(t&&Kr++,Hn().container.guidewordsReqIntercept.on((function(t){t.params&&(1!==t.params.success?un.sendExcept({info:{msg:t.params.msg||"-",enterType:on.getState("enterType"),sa:on.getState("sa")},group:"guideword-intercept-fail",sample:1}):Vr++)})))}(e),[4,Li(i,{credentials:"include"},Ur).then((function(t){if(0!==t.status)return Promise.reject();var e=t.data;return{guideWord:e.guide_words,blocks:e.blocks,recFunctionalList:e.recFunctionalList,isNewUser:e.isNewUser||!1,hasPushMessage:e.hasPushMessage||!1,pushMessageQuery:e.pushMessageQuery||"",homeRec:e.home_rec||{},inputPanel:e.input_panel||[],usableModel:e.usableModel||[],promptPolish:e.promptPolish||{type:0}}})).catch((function(){return{guideWord:Wr,blocks:[],recFunctionalList:[],isNewUser:!1,hasPushMessage:!1,pushMessageQuery:"",homeRec:{},inputPanel:[],usableModel:[],promptPolish:{type:0}}})).finally((function(){ao()}))];case 1:return o=r.sent(),hn(Date.now()-n),Kr&&setTimeout((function(){un.sendCount({info:{all:Kr,success:Vr},group:"guideword-intercept",sample:1})}),1e3),[2,o]}}))})),Yr.apply(this,Array.from(arguments))}function Zr(){return ts.apply(this,Array.from(arguments))}function ts(){return ts=Br((function(){var t,e,n;return Fr(this,(function(a){return ha().emit(!0),t=on.getState("chatParams")||{},e={data:{from:"chat_search",sge_lid:t.sge_lid,token:sc(),pn:0,rn:1,search_before_lid:"",cur_ori_lid:"",landingPageSwitch:on.getState("landingPageSwitch"),landingPage:lt()?"deepseek":"aitab"}},n=new Promise((function(t){var e=function(n){var a=n.state;n.appendRender&&(a===Fo.SUCCESS?t(!0):a!==Fo.FAIL&&a!==Fo.NOMORE||t(!1),Zn().off(e))};Zn().on(e)})),tc(e,{appendRender:!0}),[2,n]}))})),ts.apply(this,Array.from(arguments))}function es(t){return ns.apply(this,Array.from(arguments))}function ns(){return ns=Br((function(t,e){var n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b,_,k,S,x,I,T,C,L,D,P,E,A,O,R,N,M,q,j,B,H,$,F,U;return Fr(this,(function(G){switch(G.label){case 0:return void 0===e&&(e=!1),t.notifyAppModelId&&Qs().emit({selectedId:t.notifyAppModelId}),i=t.clickTime||(zr||e)&&(null==(a=performance)||null==(n=a.timing)?void 0:n.navigationStart)||Date.now(),o=Date.now()-i,on.getState("chatPageInitialized")?[2]:(wr(),on.dispatch("update",{chatPageInitialized:!0}),r="",s=!1,l=0,c="",d="",Ie(t)?(r=t.query,s=t.initShowHistory,l=t.isShowHello,c=t.triggerType,d=t.oriLid):r=t,fs(u=ds()),hr(),p=on.getState("isWiseNewCsaitab"),h=on.getState("messageReadStyle"),f=!(!h||"0"===h),g=on.getState("subEnterType"),m=!("his_middle"!==g||!d),v=Nr(),y=ti.getState("knowledgeId"),Vo()||zr||(m=!1),m&&(w={},v&&(w=Hr({},w,{knowledgeId:y})),tc(Jo(Bo({reqType:"5"},w)))),v||ti.dispatch("update",{knowledgeId:""}),b=!1,f||!s?[3,2]:[4,Zr()]);case 1:(b=G.sent())||(p?oo(Yt):io(!0,Yt)),r=on.getState("query"),G.label=2;case 2:return _=!l||zr||b&&!f?r:"",v&&!m&&$l.renderKnowledgeHeader(),on.getState("hideTopAgentList")?[3,7]:((!m||Qr&&m)&&!v&&Zl({type:"guide",data:{id:"init",waitData:!0,triggerType:c}}),[4,Xr(_,l)]);case 3:return k=G.sent(),S=k.guideWord,x=k.blocks,I=void 0===x?[]:x,T=k.recFunctionalList,C=k.isNewUser,L=k.hasPushMessage,D=k.pushMessageQuery,P=k.homeRec,E=k.inputPanel,A=k.promptPolish,f&&L&&(p?oo(Yt):io(!0,Yt)),Ca().emit(E),La().emit(A),(O=on.getState("openInputPanel"))&&Ta().emit(O),R=on.getState("agentInfo"),((N=on.getState("upperSearchbox"))||R.agentName)&&(zn().emit(Hr({word:zr?"":"@"+R.agentName},N,R.agentName?{agentInfo:Hr({},qs(R),{startIndex:0,endIndex:R.agentName.length})}:{},{invokeKeyboard:0})),M=on.getState("sa"),N&&M&&Aa().emit({sa:M})),C&&!zr&&u||!m&&(Vo()||zr)?(Zn().emit({state:Fo.NOMORE,appendRender:!0}),[3,6]):[3,4];case 4:return Sa().emit({showHistoryLine:!0}),f?L||!s?[3,6]:[4,Zr()]:[3,6];case 5:!(b=G.sent())&&(p?oo(Yt):io(!0,Yt)),r=on.getState("query"),G.label=6;case 6:L&&l&&(on.dispatch("update",{sa:"message_push"}),Xl({query:D,showQuestion:!1})),q=function(t){void 0===t&&(t=[]);for(var e={},n=null,a={},i={},o={},r=0;r<t.length;r++)"multiRecommendWord"=== __get$(t,r) .component?o=e= __get$(t,r) .data.value[0]:"promptRecommend"=== __get$(t,r) .component?n= __get$(t,r) .data:"questionClosely"=== __get$(t,r) .component?a={component:"questionClosely",data:Hr({}, __get$(t,r) .data.value[0],{guideWord:"",type:"primary",componentArea:"agent_guide",showLoading:!1,jumpTypes:["multiSearch"],context:{app:"bdbox",scene:"chat-search"}})}:"modelGuideData"=== __get$(t,r) .component&&(i= __get$(t,r) .data.value[0])&&Ve.setGuideShowData({modelGuide:i,defaultGuide:o});return{multiRecommendWord:e,promptRecommend:n,recommendData:a,modelGuideData:i}}(I),j=q.multiRecommendWord,B=q.promptRecommend,H=q.recommendData,$=q.modelGuideData,lt()&&function(){var t=on.getState("modelList");if(Array.isArray(t)&&0!==t.length){var e=on.getState("chatParams");Li(on.getState("chatParams").sse_host+"/aichat/api/aitabserver?action=shortcuts&ctl=deepseek&t="+(e.sge_lid||(new Date).getTime())+"&tk="+sc(),{credentials:"include"},Ur).then((function(e){if(0===e.status&&e.data){var n,a,i,o=(null==(n=e.data.blocks)?void 0:n[0])||{},r=(null==(i=o.data)||null==(a=i.items)?void 0:a[0])||{};if("shortcuts"===o.component&&"deepseek_online"===r.type){var s={};try{var l=JSON.parse(localStorage.getItem(ye))||{};"DeepSeek-R1"===l.modelName&&(s=l)}catch(t){s=on.getState("usedModel")||{}}t=on.getState("modelList"),r.text&&t.forEach((function(t){var e;"DeepSeek-R1"===t.name&&(t.shortcuts=[r],t.modelFunction=Hr({},t.modelFunction,{internetSearch:(null==s||null==(e=s.modelFunction)?void 0:e.internetSearch)||"0"}))})),on.dispatch("update",{modelList:[].concat(t)})}}})).catch((function(){}))}}(),Qr&&(Q=on.getState("chatParams"),J=on.getState("landingPageSwitch"),Li(on.getState("chatParams").sse_host+"/aichat/api/aitabserver?action=wise&ctl=shortcuts&landingPageSwitch="+J+"&t="+(Q.sge_lid||(new Date).getTime())+"&tk="+sc(),{credentials:"include"},2e3).then((function(t){var e,n,a,i,o,r,s,l;if(0===t.status&&t.data){for(var c,d=t.data.shortcutsBlocks||{},u=on.getState("modelList")||[],p={DeepSeek:(null==(n=d.DeepSeek)||null==(e=n.data)?void 0:e.items)||{},smartMode:(null==(i=d.smartMode)||null==(a=i.data)?void 0:a.items)||{},ERINE:(null==(r=d.ERINE)||null==(o=r.data)?void 0:o.items)||{}},h=(null==(l=d.smartMode)||null==(s=l.data)?void 0:s.label)||"",f=$r(u);!(c=f()).done;)for(var g,m=c.value,v=m.id||"",y=$r(Object.entries(p));!(g=y()).done;){var w=g.value,b=w[0],_=w[1];v.includes(b)&&(m.modelFuncData=_)}var k=on.getState("modelList").find((function(t){return!0===t.checked})),S=(null==k?void 0:k.modelFuncData)||p.smartMode;on.dispatch("update",{modelList:[].concat(u),modelFuncData:S}),Wn().emit({modelFuncData:S,label:h})}})).catch((function(){}))),on.dispatch("update",{guideWord:S}),s&&ha().emit(!1),F=(null==j?void 0:j.recommendWord)?"":S,m||_a().emit({guideWord:F,id:"init",triggerType:c,recFunctionalList:T,multiRecommendWord:j,promptRecommend:B,recommendData:H,homeRec:P,modelGuideData:$}),G.label=7;case 7:return m&&_a().emit({id:"init"}),$l.showQAPair(),on.dispatch("update",{hasInitContext:!0}),l&&(Vs(on.getState("conversationLogId"),{lid:"",query:r,chatNum:1,perfInfo:{baseDataTime:String(Date.now())},startTimeList:on.getState("startTimeList"),naInjectTime:on.getState("naInjectTime")},"invoke",{}),ms&&(ys(0),gs())),Jr||(Jr=!0,U=on.getState("enterType")||on.getState("pcEnterType"),W={pageShowTime:o,contentPaintTime:Date.now()-i},z={isShowHello:l?1:0,platform:rt(),enterType:U,sync:e?1:0},!on.getState("isDev")&&W&&un.sendPerf({group:"chatPagePerf",info:W,dim:z}),"wise"===rt()&&function(t,e){st()&&un.sendCount({group:"async_count",info:t,dim:e})}({all:1,async:e?0:1},{enterType:U})),[2]}var W,z,Q,J}))})),ns.apply(this,Array.from(arguments))}var as=new Promise((function(t){}));function is(){return os.apply(this,Array.from(arguments))}function os(){return(os=Br((function(){return Fr(this,(function(t){switch(t.label){case 0:return vt()&&as?[4,as]:[3,2];case 1:t.sent(),t.label=2;case 2:return as=null,[4,Li(on.getState("chatParams").sse_host+Gr+"?ctl=userinfo&tk="+sc(),{credentials:"include"},Ur).then((function(t){return 0===t.status?t.data.userInfo:Promise.reject()})).catch((function(){return Promise.reject()}))];case 3:return[2,t.sent()]}}))}))).apply(this,Array.from(arguments))}function rs(){return ss.apply(this,Array.from(arguments))}function ss(){return ss=Br((function(){var t,e;return Fr(this,(function(n){switch(n.label){case 0:return vt()?[2,Promise.resolve({})]:(t=Date.now(),[4,Li("/csaitab/sidebar/list",{credentials:"include",mode:"cors"},Ur).then((function(t){if(0===t.status){var e=t.data||{},n=[],a={pcUrl:"https://agents.baidu.com/center",logo:"https://search-operate.cdn.bcebos.com/a274bece2eb8065f19aa1e3973b73435.png",name:"探索更多智能体",content:"海量智能体等你来聊"};e.agent&&(n=e.agent.historyList||[],a=e.agent.appSquare||a);var i=e.feedBack||{},o=e.shortcut;return{historyList:Array.isArray(n)?n:[],appSquare:a,feedback:i,shortcut:o}}return Promise.reject()})).catch((function(){return{historyList:[],appSquare:{},mainAgent:{}}}))]);case 1:return e=n.sent(),hn(Date.now()-t),[2,e]}}))})),ss.apply(this,Array.from(arguments))}function ls(){return ls=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},ls.apply(this,Array.from(arguments))}var cs=void 0;function ds(){return on.getState("user.isUserLogin")}function us(){Di(""+on.getState("chatParams").sse_host+Wt.loginConfirmation,{session_id:on.getState("oriLid")||"",tk:sc()},5e3)}function ps(t){var e;return(null==(e=window.passport)?void 0:e.pop)?(cs=window.passport.pop.init({loginVersion:"v5",composeTemplate:1,apiOpt:{staticPage:"https://chat.baidu.com/bot/v3Jump.html",loginType:1,product:"search_aichat",u: __get$(__get$(window,"location"),"href") ,safeFlag:0,memberPass:!0,sms:5},cache:!0,forgetLink:"https://passport.baidu.com/?getpass_index&tpl=mn&u="+encodeURIComponent( __get$(__get$(window,"location"),"href") ),registerLink:"https://passport.baidu.com/v2/?reg&regType=1&tpl=mn&u="+encodeURIComponent( __get$(__get$(window,"location"),"href") ),authsite:["tsina","weixin","qzone"],tangram:!0,onLoginSuccess:function(t){is().then((function(t){t.isUserLogin&&(on.dispatch("update",{user:t}),fa().emit({type:"loginSuccess"}),function(){var t=on.getState("agentInfo"),e="pc"===rt();t.agentName&&zn().emit({word:e?"":"@"+t.agentName,agentInfo:ks({startIndex:0,endIndex:t.agentName.length},qs(t)),invokeKeyboard:0})}(),us(),"/aichat/history"=== __get$Loc(location) .pathname&& __get$Loc(location) .reload())})),cs.hide(),t.returnValue=!1},onHide:function(){ds()||fa().emit({type:"loginCancel"})}}),t()):function(t){var e= __get$Loc(location) .protocol+"//passport.baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+(new Date).getTime(),n=document.createElement("script");n.setAttribute("src",e),n.onload=t,document.body.appendChild(n)}((function(){return ps(t)}))}function hs(){return cs?cs.show():ps((function(){return hs()}))}function fs(t){var e=on.getState("user");return on.dispatch("update",{user:ls({},e,{isUserLogin:t})})}function gs(t){return void 0===t&&(t=""), new Promise(function(e,n){if("pc"===rt()){if(ds()){var a=on.getState("user");return e(a);}if(!vt())return hs(),e();is().then(function(t){t.isUserLogin?(on.dispatch("update",{user:t}),e(t)):n();}).catch(function(){return n();});}else{if(gt()){if(on.getState("user.isUserLogin"))return e();window.addEventListener("pageshow",function(t){t.persisted&&__get$(window,"location").reload();});var i=__get$(__get$(window,"location"),"href"),r="https://wappass.baidu.com/passport/?login&sms=1&u="+encodeURIComponent(i)+"&tpl=wise";return __set$(__get$(window,"location"),"href",r),n(t);}if(ds()){var s=on.getState("user");return e(s);}if(!o.canIUse("account.login"))return console.error("模拟器环境未登录"),e();o.account.login({loginType:"fast",showThirdLogin:"1",loginSource:"search_ai",normalizeAccount:"0",success:function(t){0===t.status&&(fs(!0),us(),e());},fail:function(){n(t);}});}}) }var ms=ht()&&ot.isHuawei&&di(ci(),"15.6")>=0,vs=ms?1:9999;function ys(t){vs=t}var ws=function(){return rt(),vs};function bs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function _s(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function ks(){return ks=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},ks.apply(this,Array.from(arguments))}function Ss(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return bs(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bs(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function xs(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Is={agentInfo:{},data:{isShort:"0",isSingleCol:"1",recommendWord:[]},type:"entry",isFinished:!1,component:"questionClosely"};function Ts(t,e,n){return void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=-1),e=e||0,n=n||-1,{prefix:t.substring(0,e),keyword:t.substring(e,n+1),suffix:t.substring(n+1)}}function Cs(t,e){if(void 0===t&&(t={}),void 0===e&&(e="agent"),!t.agentSearchId)return on.dispatch("update",{agentInfo:t,agentSa:"agent"});var n=on.getState("agentInfo")||{},a={agentInfo:t};t.agentSearchId!==n.agentSearchId&&(Hn().conversation.agentChange.emit(),a.agentSa=e||"agent"),on.dispatch("update",a)}var Ls="";function Ds(t,e){var n,a=t.agentName;n=e,e=Array.isArray(n)&&0===(n=n.filter((function(t){return"TEXT"===t.type&&!!t.data.text.query}))).length?"":n;var i="pc"===rt();ds()&&zn().emit({word:i?"":"@"+a,agentInfo:ks({startIndex:0,endIndex:a.length},qs(t)),noClear:!e,invokeKeyboard:0}),e&&Xl({query:e,agentQuery:e});var o=(t.guides||[]).map((function(t){return{text:t}}));Is.data.recommendWord=o,Is.agentInfo=t,e&&on.dispatch("update",{agentRecData:Is,agentQuery:e})}function Ps(t,e){return e&&e.agentName? __call$(t=_t(t),"replace",["@"+e.agentName,""]) :t}function Es(t,e){if(!t||"string"!=typeof t)return"";if(!e)return t;var n=on.getState("apagelid"),a=on.getState("lid"),i=on.getState("tplname"),o=on.getState("srcid"),r=on.getState("order"),s=on.getState("agentInfo"),l=s.agentName,c=s.agentId,d=/(_baiduboxapp=)([^&]*)/.exec(t),u={};if(d){var p=decodeURIComponent(d[2]);try{u=p&&JSON.parse(p)}catch(t){u={}}}else u={};var h=function(t){var e=t.split("?")[1];if(!e)return"";for(var n,a=Ss(e.split("&"));!(n=a()).done;){var i=n.value.split("="),o=i[0],r=i[1];if("url"===o)return decodeURIComponent(r)}return""}(t),f=As(h,u),g={_baiduboxapp:ks({from:re.CHAT,lingjing_type:"1",ext:ks({agent_id:c,agnet_name:l,csaitab_lid:a||"10000",searchid:n||"10001"},i?{tplname:i}:{},o?{srcid:o}:{},r?{order:r}:{},{token:"swanubc",third_ext:{ivkSource:"h5_schema",token:"swanubc",pd:"csaitab"},referpd:"B"})},u)},m=e._baiduboxapp,v=e.chatExt,y=e._chatQuery,w=e.searchParams;if(m){var b=e._baiduboxapp,_=b.ext,k=function(t,e){if(null==t)return{};var n,a,i={},o=Object.keys(t);for(a=0;a<o.length;a++)n= __get$(o,a) ,e.indexOf(n)>=0||( __set$(i,n,__get$(t,n)) );return i}(b,["ext"]);g._baiduboxapp=_?ks({},g._baiduboxapp,k,{ext:ks({},g._baiduboxapp.ext,_)}):ks({},g._baiduboxapp,k)}v&&(g.chatExt=e.chatExt),y&&(g._chatQuery=e._chatQuery),w&&(g.searchParams=e.searchParams);var S=function(t,e,n){var a="";try{var i=new URL(t);n&&i.searchParams.set("url",n),Object.keys(e).forEach((function(t){var n=JSON.stringify( __get$(e,t) );i.searchParams.set(t,n)})),a=i.toString()}catch(t){console.error("[ERROR]：CREATE URL ERROR: "+t)}return a}(t,g,f);return S}function As(t,e){if(!t)return"";var n=_t(on.getState("query"))||"",a=on.getState("lid"),i=on.getState("apagelid"),o=on.getState("tplname"),r=on.getState("srcid"),s=on.getState("order"),l=ks({_chatQuery:encodeURIComponent(n),csaitab_lid:a||"",searchid:i||""},o?{tplname:o}:{},r?{srcid:r}:{},s?{order:s}:{},{_swebScene:re.CHAT,_chatExt:e?encodeURIComponent(JSON.stringify(e)):""}),c=(Object.entries(l)||[]).map((function(t){return t[0]+"="+t[1]})).join("&")||"",d=-1===t.indexOf("?")?"?":"&";return t+d+c}var Os=null;function Rs(t){var e,n;if(t.agentId){var a=new URL("https://chat.baidu.com/bot/runs/cancel?pd=9001");return Os=fetch(a.toString(),{body:JSON.stringify({agent_id:t.agentId,thread_id:t.sessionId,user_info:{uid:null==(n=on.getState("user"))||null==(e=n.userInfo)?void 0:e.uid},channel:{from:"aitab"},logid:t.lid}),method:"POST",mode:"cors",credentials:"include"}).catch((function(t){console.error(t)})).finally((function(){Os=null}))}}function Ns(){return Ms.apply(this,Array.from(arguments))}function Ms(){var t;return t=function(){var t;return xs(this,(function(e){switch(e.label){case 0:if(!Os)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.race([Os,new Promise((function(t){return setTimeout(t,2e3)}))])];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),console.error(t),[3,4];case 4:return[2]}}))},Ms=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){_s(o,a,i,r,s,"next",t)}function s(t){_s(o,a,i,r,s,"throw",t)}r(void 0)}))},Ms.apply(this,Array.from(arguments))}function qs(t){var e,n;"16"===(null==t?void 0:t.agentSearchId)&&((null==(t=ji(t))||null==(e=t.agentParams)?void 0:e.agent_id)&&(t.agentSearchId=t.agentParams.agent_id),(null==t||null==(n=t.agentParams)?void 0:n.app_key)&&(t.agentId=t.agentParams.app_key));return t}function js(t,e){return t.startIndex?e.slice(0,t.startIndex)+"@"+t.agentName+e.slice(t.startIndex):"@"+t.agentName+e}function Bs(){return Bs=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Bs.apply(this,Array.from(arguments))}function Hs(){return Hn().container.inputStart}function $s(){return Hn().container.inputCancel}function Fs(){return"pc"===rt()||lt()?Hn().conversation.deleteAgent:Hn().container.deleteAgent}function Us(){return"pc"===rt()||lt()?Hn().conversation.search:Hn().container.search}function Gs(){return Hn().conversation.search}function Ws(){return"pc"===rt()||lt()?Hn().conversation.hoverRespond:Hn().container.longPressRespond}function zs(){return Hn().conversation.updateInputBorder}function Qs(){return Hn().conversation.checkoutAiModel}function Js(){return Hn().container.updateCapsule}function Vs(t,e,n,a){var i,o,r=String((null==e||null==(i=e.errorInfo)?void 0:i.stack)||""),s=0;r&&(s=r.includes(zt.FETCH_FAIL)?1:r.includes(zt.FETCH_TIMEOUT_ERROR)?2:"error"===r?4:3);var l={conversationLogId:t,query:e.query,chatNum:e.chatNum,nextSearchTips:e.nextSearchTips||[],lid:e.lid,perfInfo:{paint_time:null==(o=e.perfInfo)?void 0:o.baseDataTime,fe_stage:e.perfInfo,fe_error_code:s,error_info:r,fe_ext:e.ext}};"invoke"===n&&Hn().conversation.complete.emit(l),"perf"===n&&0===s&&function(t,e){var n;void 0===e&&(e={});var a=t.perfInfo;if(!on.getState("isDev")&&a){var i=(on.getState("chatParams")||{}).setype||"other";un.sendPerf({group:"chatsearch",info:rn({request2RenderTime:+a.renderAfter-+a.renderStart,insertHtmlTime:+a.insertHtmlAfter-+a.insertHtmlBefore,parseHtmlTime:+a.parseHtmlAfter-+a.parseHtmlBefore,requestTime:+a.requestEnd-+a.requestStart,jsInsertTime:+a.insertJsAfter-+a.insertJsBefore,paintTime:(+a.generatingStartTime||+a.insertHtmlAfter)- __get$(t.startTimeList,t.chatNum) },t.naInjectTime?{naInjectTime:t.naInjectTime}:{}),dim:{type:"word",rank:1===t.chatNum?"first":"other",setype:i,entrance:e.entrance,isAgent:(null==(n=on.getState("agentInfo"))?void 0:n.agentName)?"1":"0",isSync:on.getState("isSync"),loadMode:1===t.chatNum?"1"===on.getState("isSync")?"first_sync":"first_async":"non_first_async"}})}}(e,a)}function Ks(t,e){if(void 0===e&&(e={}),"pc"!==rt()){var n=Ts(t,e.startIndex,e.endIndex),a=n.prefix,i=n.suffix,o=n.keyword,r=a+i,s=t;o&&(s=""+a+o+" "+i);var l={csaitab:{content:s,timestamp:Date.now()}};if(e&&e.agentId){var c,d,u=function(t,e,n){if(void 0===n&&(n={}),!t)return"";var a=/(_baiduboxapp=)([^&]*)/,i=t.match(a),o={from:""};if(i){var r=decodeURIComponent(i[2]);o=JSON.parse(r)}else o={from:""};return o.from=e,o=ks({},o,n), __call$(t,"replace",[a,"$1"+encodeURIComponent(JSON.stringify(o))]) }((null==(c=e.jumpUrl)?void 0:c.zbios)||(null==(d=e.jump_url)?void 0:d.zbios),re.SIDEBAR);l.agent=Bs({},e,{content:r,timestamp:Date.now(),scheme:u})}Hn().conversation.sidebarUpdate.emit(l)}}function Xs(){return Hn().component.handleMindMapAction}function Ys(){return Hn().component.handleWenkuAction}function Zs(){return Hn().component.handlePptDownloadAction}function tl(){return Hn().component.checkOutlineTitle}function el(){return Hn().component.handlePptViewerPack}function nl(){return Hn().component.hitHintsDanger}function al(){return Hn().component.updateChatEditor}function il(){return Hn().component.openChatEditor}function ol(){return Hn().component.closeChatEditor}function rl(){return Hn().component.closeWorkspaceStage}function sl(){return Hn().component.showCoverContent}function ll(){return Hn().component.userUpdateEditor}function cl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function dl(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function ul(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){dl(o,a,i,r,s,"next",t)}function s(t){dl(o,a,i,r,s,"throw",t)}r(void 0)}))}}function pl(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return cl(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cl(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function hl(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var fl=0,gl=!1,ml=40,vl=25,yl=200;function wl(){gl||(fl=document.documentElement.clientHeight,Hs().on(_l.bind(this)),gl=!0)}var bl=ul((function(t){return hl(this,(function(e){return t.target.closest('#tagItemId[class*="category-item"]')||Hn().conversation.closeInput.emit({conversationLogId:on.getState("conversationLogId")}),[2]}))}));function _l(t){for(var e,n=function(){var n=e.value;if(null==n?void 0:n.querySelector('span[class*="active"]'))return setTimeout(ul((function(){var e,a,o,r,s,l,c,d;return hl(this,(function(u){switch(u.label){case 0:if(e=Number(t.params.keyboardHeight)/i,a=Number(t.params.inputHeight||0)/i,o=n.getBoundingClientRect(),r=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,s=fl-document.documentElement.clientHeight>yl,l=s?document.documentElement.clientHeight:fl-e-a,!((c=document.documentElement.offsetHeight-o.bottom-r)<e+a)||s)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,document.body.animate([{marginBottom:"0px"},{marginBottom:e+a+ml+"px"}],{duration:10,fill:"forwards"}).finished];case 2:return u.sent(),[3,4];case 3:return u.sent(),document.body.style.marginBottom=e+a+ml+"px",[3,4];case 4:return setTimeout((function(){o=n.getBoundingClientRect(),window.scrollTo({top:r+o.bottom-l+vl,behavior:"smooth"})}),100),d=function(){if(c<e+a&&!s)try{document.body.animate([{marginBottom:e+a+ml+"px"},{marginBottom:"0px"}],{duration:200,fill:"forwards"})}catch(t){document.body.style.marginBottom=""}$s().off(d)},$s().on(d),n.addEventListener("click",bl),[2]}}))})),250),"break"},a=bn(Qt),i=Oi?window.devicePixelRatio:1,o=pl(a);!(e=o()).done;){if("break"===n())break}}var kl=a.defineComponent({trimWhitespace:"all",template:'\n        <div s-if="showDanger" class="cs-new-chat-tips">\n             <h3 s-if="showTitle" class="cs-new-chat-line">\n                <div class="new-chat-line new-chat-line-before"></div>\n                <div>新话题已开启</div>\n                <div class="new-chat-line new-chat-line-after"></div>\n            </h3>\n            <div class="cs-new-chat-bubble {{!showTitle ? \' new-chat-bubble-top\' : \'\'}}">\n                <div>\n                    <span>{{guideText}}</span>\n                </div>\n            </div>\n        </div>\n    ',initData:function(){return{showTitle:!0,queryIsDanger:"",showDanger:!1,rank:0,onlyOpenNewChat:!1,guideText:"让我们换个话题聊聊吧。"}},listenHitDanger:null,attached:function(){var t=this;this.data.get("onlyOpenNewChat")?setTimeout((function(){Kl({element:t.el,block:"start"})}),100):(this.watch("queryIsDanger",(function(e){"1"===e&&setTimeout((function(){t.data.set("showDanger",!0)}),100)})),this.listenHitDanger=function(e){e.rank===t.data.get("rank")&&"delete-rank-show-toast"!==e.type&&t.nextTick((function(){t.data.set("showDanger",!0)}))},Gn().on(this.listenHitDanger))},disposed:function(){this.listenHitDanger&&Gn().off(this.listenHitDanger),this.listenHitDanger=null}});function Sl(t,e){return Sl=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Sl(t,e)}var xl=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Sl(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{timestamp:16832412e5}},n.attached=function(){},e}(a.Component);xl.components={},xl.computed={timestampText:function(){return function(t){if(!t)return"";var e=Qa(t),n=Qa(+new Date),a=e.year,i="星期";switch(e.week){case 1:i+="一";break;case 2:i+="二";break;case 3:i+="三";break;case 4:i+="四";break;case 5:i+="五";break;case 6:i+="六";break;case 0:i+="日"}var o=Ja(e.monthe),r=Ja(e.day),s=Ja(e.hour),l=Ja(e.minute);return Math.abs(e.year-n.year)>0?a+"-"+o+"-"+r+" "+s+":"+l:e.dayDiff>7?o+"-"+r+" "+s+":"+l:e.dayDiff>1?i+" "+s+":"+l:1===e.dayDiff?"昨天 "+s+":"+l:"今天 "+s+":"+l}(+this.data.get("timestamp"))}};var Il={};Il= __call$(Object,"assign",[Il,{timestamp:"timestamp_4zha3_1"}]) ,xl.template="\n    <div class=\"{{$style['timestamp']}}\">\n        {{timestampText}}\n    </div>\n";var Tl="function"==typeof xl?xl.prototype.initData||Cl:xl.initData||Cl;function Cl(){return{$style:Il}}function Ll(){return  __call$(Object,"assign",[{},Tl.call(this),{$style:Il}]) }"function"==typeof xl?xl.prototype.initData=Ll:xl.initData=Ll;var Dl=Tt.connect(on,{user:"user"})(a.defineComponent({components:{"answer-timestamp":xl},computed:{tipText:function(){var t=this.data.get("loadingText"),e=this.data.get("loadingFailText"),n=this.data.get("noMoreText");switch(this.data.get("loadState")){case 1:return t;case 2:return e;case 3:return n;default:return""}},historyLineText:function(){var t=this.data.get("user.isUserLogin"),e=this.data.get("showTimestamp"),n=this.data.get("isHeader");return t||!n?"以上为历史消息":e?"登录后查看更多历史消息":"登录后查看历史消息"}},initData:function(){return{showHistoryLine:!1,isHistoryLine:!0,loadingText:"正在加载...",loadingFailText:"加载失败，请重试",noMoreText:"没有更多消息了",loadState:0,scrollToHeader:!1,createTime:+new Date,showTimestamp:!1,isPulldownLoading:!1,listenRenderfinished:!1,isPulldown:!1,moveState:"",isHeader:!0,isPc:"pc"===rt()}},listenBeforeCreateNewContext:null,attached:function(){var t=this;this.data.get("scrollToHeader")&&this.nextTick((function(){Kl({element:t.el,block:"start"})})),this.listenBeforeCreateNewContext=function(e){void 0===e&&(e={}),!e.agentGuide&&t.data.set("showTimestamp",!0)},Xn().on(this.listenBeforeCreateNewContext),this.data.get("isPulldownLoading")&&this.listenHistoryStateChange(),this.data.get("listenRenderfinished")&&this.listenRenderfinished()},listenHistoryRenderFinished:null,listenRenderfinished:function(){var t=this;this.listenHistoryRenderFinished=function(e){e.initShowHistory?t.listenRenderfinished():t.data.set("listenRenderfinished",!1)},ta().on(this.listenHistoryRenderFinished,{once:!0})},listenGetHistoryStateChange:null,listenShowHistoryTips:null,listenHistoryStateChange:function(){var t=this,e=this.data.get("isPc"),n=Vo();e||n||this.nextTick((function(){Zl({type:"historyTips",data:{isHistoryLine:!0,loadState:0,scrollToHeader:!1,isPulldownLoading:!1,showTimestamp:t.data.get("showTimestamp"),listenRenderfinished:!0,isHeader:!1,showHistoryLine:!0}},"ahead")})),this.listenGetHistoryStateChange=function(e){var n=e.state;if(e.appendRender)n===Fo.NOMORE&&(on.dispatch("update",{pulldownDisabled:!0}),t.data.set("showHistoryLine",!1));else{if(t.data.set("isPulldown",!0),n===Fo.SUCCESS)return ta().on((function(){t.setLoadState(Fo.NORMAL)}),{once:!0}),void(t.data.get("isHistoryLine")&&t.data.set("isHistoryLine",!1));t.setLoadState(n),n!==Fo.FAIL&&n!==Fo.NOMORE||setTimeout((function(){t.setLoadState(Fo.NORMAL)}),2e3)}},Zn().on(this.listenGetHistoryStateChange),this.listenShowHistoryTips=function(e){var n=e.showHistoryLine;t.data.set("showHistoryLine",n)},Sa().on(this.listenShowHistoryTips)},disposed:function(){this.listenBeforeCreateNewContext&&(Xn().off(this.listenBeforeCreateNewContext),this.listenBeforeCreateNewContext=null),this.listenHistoryRenderFinished&&(ta().off(this.listenHistoryRenderFinished),this.listenHistoryRenderFinished=null),this.listenGetHistoryStateChange&&(Zn().off(this.listenGetHistoryStateChange),this.listenGetHistoryStateChange=null),this.listenShowHistoryTips&&(Sa().off(this.listenShowHistoryTips),this.listenShowHistoryTips=null)},setLoadState:function(t){var e=this;this.data.get("isHistoryLine")||t!==Fo.LOADING?(this.data.set("moveState","tips-leave"),setTimeout((function(){e.data.set("loadState",t),e.data.set("moveState","tips-enter")}),100)):this.data.set("loadState",t)}})),Pl={};Pl= __call$(Object,"assign",[Pl,{tipsContainer:"tips-container_1mw3o_1","tips-container":"tips-container_1mw3o_1",tipsLeave:"tips-leave_1mw3o_29","tips-leave":"tips-leave_1mw3o_29",historyTextMove:"historyTextMove_1mw3o_1",tipsEnter:"tips-enter_1mw3o_32","tips-enter":"tips-enter_1mw3o_32",historyTextEnter:"historyTextEnter_1mw3o_1",tipText:"tip-text_1mw3o_35","tip-text":"tip-text_1mw3o_35",tipsContainerHeader:"tips-container-header_1mw3o_41","tips-container-header":"tips-container-header_1mw3o_41",tipsContainerContent:"tips-container-content_1mw3o_45","tips-container-content":"tips-container-content_1mw3o_45",historyLine:"history-line_1mw3o_50","history-line":"history-line_1mw3o_50",historyLineBefore:"history-line-before_1mw3o_54","history-line-before":"history-line-before_1mw3o_54",historyLineAfter:"history-line-after_1mw3o_58","history-line-after":"history-line-after_1mw3o_58",loadingIcon:"loading-icon_1mw3o_73","loading-icon":"loading-icon_1mw3o_73",historyIconRotate:"historyIconRotate_1mw3o_1",loadingText:"loading-text_1mw3o_91","loading-text":"loading-text_1mw3o_91",historyTextOpacity:"historyTextOpacity_1mw3o_1",historyTextLeave:"historyTextLeave_1mw3o_1"}]) ,Dl.template="\n    <div>\n        <div\n            s-if=\"!listenRenderfinished && showHistoryLine\"\n            class=\"{{$style['tips-container']}}\n                {{!isHistoryLine && loadState === 0 ? '' :\n                (isPulldownLoading ? $style['tips-container-header'] : $style['tips-container-content'])}}\n                {{$style[moveState]}}\"\n        >\n            <fragment s-if=\"isHistoryLine && loadState === 0\">\n                <fragment s-if=\"showTimestamp && user.isUserLogin\">\n                    <answer-timestamp\n                        timestamp=\"{{createTime}}\"\n                    />\n                </fragment>\n                <fragment s-else>\n                    <div s-transition=\"moveTransition\" class=\"{{$style['tip-text']}}\">\n                        <div class=\"{{$style['history-line']}} {{$style['history-line-before']}}\"></div>\n                        <span>{{historyLineText}}</span>\n                        <div class=\"{{$style['history-line']}} {{$style['history-line-after']}}\"></div>\n                    </div>\n                </fragment>\n            </fragment>\n\n            <fragment s-else>\n                <div class=\"{{$style['tip-text']}}\">\n                    <div s-if=\"loadState === 1\" class=\"{{$style['loading-icon']}}\"></div>\n                    <span class=\"{{loadState === 1 ? $style['loading-text'] : ''}}\">{{tipText}}</span>\n                </div>\n            </fragment>\n        </div>\n    </div>\n";var El="function"==typeof Dl?Dl.prototype.initData||Al:Dl.initData||Al;function Al(){return{$style:Pl}}function Ol(){return  __call$(Object,"assign",[{},El.call(this),{$style:Pl}]) }"function"==typeof Dl?Dl.prototype.initData=Ol:Dl.initData=Ol;var Rl=function(){var t=on.getState("chatStatus");return t===Pi.WAITING||t===Pi.SENDING||t===Pi.GENERATING};function Nl(t,e){var n,a;if(void 0===e&&(e=!1),e&&Date.now()-((null==(a=performance)||null==(n=a.timing)?void 0:n.navigationStart)||Date.now())<864e5)return!1;var i=new URL(document.URL),o=on.getState("agentInfo"),r=on.getState("landingPageSwitch"),s=on.getState("chatSearchAcitonId"),l="pc"===rt();return i.search="",l||(i.pathname=on.getState("isWiseNewCsaitab")?lt()?_e.DEEPSEEK.path:_e.CHAT.path:"/searchframe",i.searchParams.set("chatsearch_action_id",s),i.searchParams.set("do_not_intercept","1"),ds()&&i.searchParams.set("isLoggedIn","1")),!e&&i.searchParams.set("k_tag","1"),i.searchParams.set("word",t),i.searchParams.set("setype","csaitab"),r&&i.searchParams.set("landingPageSwitch",r),Object.keys(o).length&&(o.isUpperBox=!0,i.searchParams.set("agentInfo",encodeURIComponent(JSON.stringify(o)))),i.searchParams.set("extParamsJson",JSON.stringify({ori_word:t,ori_lid:on.getState("oriLid")})),window.history.replaceState(null,"",i.toString()), __get$Loc(location) .reload(),!0}function Ml(t){Hn().conversation.updateSearchtips.emit({nextSearchTips:t})}function ql(){Qn().emit({text:ne,type:"warn"}),$l.renderTip({type:"dangerTip",data:{showDanger:!0}}),Ml([])}var jl="kunlun_popup",Bl=0;function Hl(t){if(!Bl){Bl=1;var e="pc"===rt();Qn().emit({text:e?"为保证服务安全，请验证后重试":"抱歉，出了点小问题，请稍后重试",type:"warn"}),setTimeout((function(){Nl(t)}),700)}}var $l,Fl={prerenderConfirmPromise:null};function Ul(t){return  __get$(Fl,t) }function Gl(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Wl(){return Wl=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Wl.apply(this,Array.from(arguments))}function zl(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function Ql(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Jl,Vl="pc"===rt();function Kl(t){return $l.scrollElementIntoView(t)}function Xl(t){return Yl.apply(this,Array.from(arguments))}function Yl(){var t;return t=function(t,e,n){var a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b,_,k,S,x,I,T,C,L,D,P,E,A,O,R,N,M,q,j,B,H,$,F,U,G,W,z,Q,J,V,K,X,Y,Z,tt,et;return Ql(this,(function(nt){switch(nt.label){case 0:if(a=t.query,i=t.extParams,o=void 0===i?{}:i,r=t.conversationLogId,s=t.agentQuery,l=void 0===s?"":s,c=t.showQAPair,d=void 0===c||c,u=t.showQuestion,p=void 0===u||u,h=t.clickTime,void 0===e&&(e=!1),m=on.getState("curRankInfo.rank"),v=on.getState("isWiseNewCsaitab"),y=Ul("prerenderConfirmPromise"),w=on.getState("agentInfo"),b=+on.getState("isShowHello"),_=pt(),k=ot.isHarmonyPad,S=on.getState("oriLid"),x=Nr(),I=ti.getState("knowledgeId"),!(Vl&&(null==w?void 0:w.agentName)&&(!S||m>=1)||m>=ws()||vt()))return[3,4];nt.label=1;case 1:return nt.trys.push([1,3,,4]),[4,gs()];case 2:return T=nt.sent(),!Vl&&!_||T?[3,4]:[2];case 3:return nt.sent(),vt()?[2,Hn().component.login.emit()]:[2,Qn().emit({text:"登录失败，请稍后再试"})];case 4:if(!ds()&&(!Vl||k)&&(Hn().component.showLoginToast.emit(3e3),ms&&(gs(),ys(0)),(_||k)&&(ys(0),!o.fromNa&&!e)))return gs(),[2];if(Oo(),on.getState("rank")&&on.dispatch("update",{hideTopAgentList:!1}),p||0!==m||on.dispatch("update",{firstRankHideQuery:!0}),x&&$l.removeKnowledgeHeader(),C=on.getState("iosSlipPrefetchEnable"),L=(null==(g=performance)||null==(f=g.timing)?void 0:f.navigationStart)||+new Date,D=e?L:h||+new Date,P=on.getState("startTimeList")||{},Rl()&&(E=on.getState("curRankInfo"),A=E.rank,O=E.timstamp,R=E.agentInfo,N=E.lid,M=E.oriLid,Ua({type:"click",value:"stop_create_send_new",ext:{re_rank:String(A),agent_id:null==R?void 0:R.agentSearchId,agent_name:null==R?void 0:R.agentName,lid:N,query_time_stamp:O,ori_lid:M,create_stage:on.getState("generateStatus")}})),q=[{type:"TEXT",data:{text:{query:"",text_type:""}}}],j=[{type:"text",data:{question:{question:""}}}],!v&&"wise"===rt()&&"string"==typeof a&&Nl(a,!0))return[2];if("string"==typeof a){q[0].data.text.query=a, __call$(Object,"assign",[j[0].data.question,{question:a,showQuestion:p}]) ,B=on.getState("csextdata"),H={};try{H=JSON.parse(B)}catch(t){H={}}($=H.query_text_type||"")&&(q[0].data.text.text_type=$)}return Array.isArray(a)&&(F="",U="",G=[],W=[],(q=a).forEach((function(t){var e=t.data;switch(t.type){case"TEXT":var n;F+=e.text.query,U+=null==(n=e.text)?void 0:n.text_type;break;case"IMAGE":var a,i;if(G.push(Wl({},e.image,{imageUrl:null==(a=e.image)?void 0:a.image_url,imageB64:null==(i=e.image)?void 0:i.image_b64})),e.image.imageInfo=void 0,Vl){var o,r=null==(o=e.image)?void 0:o.image_id;e.image={image_id:r}}break;case"FILE":var s=e.file||{};if(W.push(s?Va(s):{}),Vl){var l=s.file_id;e.file={file_id:l}}else{var c=function(t,e){return t||(e?e.split(".").pop():"")}(null==s?void 0:s.file_type,s.file_name);e.file={file_id:s.file_id,file_uri:s.file_uri,file_name:s.file_name,file_size:s.file_size,file_count:s.file_count,file_type:c}}}})), __call$(Object,"assign",[j[0].data.question,{question:F,showQuestion:p}]) ,U&&(j[0].data.question.text_type=U),G.length&&j.push({type:"image",data:{question:{question:G}}}),W.length&&j.push({type:"file",data:{question:{question:W}}})),j=(null==(at=j)?void 0:at.length)?at.filter((function(t){var e;return!("text"===(null==t?void 0:t.type)&&!(null==t||null==(e=t.data)?void 0:e.question.question))})):at,on.dispatch("update",{query:q,agentQuery:l}),function(t){var e,n,a=null==t?void 0:t.agentId,i=null==t?void 0:t.agentSearchId,o=(null==t||null==(e=t.agentParams)?void 0:e.app_key)||a,r=(null==t||null==(n=t.agentParams)?void 0:n.agent_id)||i;if(Ls!==o&&Ls!==r?(on.dispatch("update",{agentRank:1}),on.dispatch("update",{agentSessionCount:on.getState("agentSessionCount")+1}),Ls="16"===o?r:o):on.dispatch("update",{agentRank:on.getState("agentRank")+1}),t&&t.agentSearchId){var s=on.getState("agentSa"),l=on.getState("sa")||"",c=se.some((function(t){return l.startsWith(t)}))||""===l,d=le.some((function(t){return l.startsWith(t)})),u=ce.some((function(t){return s.startsWith(t)}));c&&u&&!d&&on.dispatch("update",{sa:l?l+"_"+s:s})}}(w),wl(), __set$(P,m+1,C?0:D||+new Date()) ,on.dispatch("update",{startTimeList:P,isSync:e?"1":"0"}),Jn().emit({fromNa:o.fromNa}),[4,Ns()];case 5:nt.sent(),r||(r="-1",on.dispatch("update",{conversationLogId:"-1"})),function(t,e){var n= new URLSearchParams(__get$(window,"location").search) ;n.set("word",e);var a={query:e,url: __get$Loc(location) .origin+ __get$Loc(location) .pathname+"?"+n.toLocaleString(),conversationLogId:t};Hn().conversation.launchSearch.emit(a)}(r,a),on.getState("syncTabData")&&di(ci(),"13.74")>=0&&(v?oo():io(!0)),z=on.getState("hasPullHistory"),Q=o.searchIntent,J=o.interactionType,V=o.searchInfo,delete o.searchIntent,delete o.interactionType,delete o.searchInfo,K=Wl({},o,{rank:m+1}),X=K.csextdata||on.getState("csextdata");try{X=X&&"string"==typeof X?JSON.parse(X):X}catch(t){console.error(t)}return on.dispatch("update",{implicitAgentInfo:{agentId:K.agent_id||"",agentP:K.agent_p||""}}),on.dispatch("update",{chatStatus:Pi.SENDING}),y?[4,y]:[3,7];case 6:nt.sent(),nt.label=7;case 7:return Y=on.getState("subSession"),Z=on.getState("withoutStopSseRanks"),tt=on.getState("rank"),et=!!(null==Z?void 0:Z.includes(tt)),setTimeout((function(){$l.sendPrompt({question:j,sseExtraData:Wl({},K,{message:Wl({},{content:Wl({},K.agent_id?{agentInfo:{agent_id:[K.agent_id||""],params:K.agent_p||""}}:{},K.aitab_ct?{aitab_ct:K.aitab_ct}:{},"object"===(void 0===X?"undefined":zl(X))&&null!==X?{extData:X}:{})},{searchInfo:Wl({},V,{out_enter_type:on.getState("outEnterType"),showMindMap:on.getState("showMindMap"),sa:o.sa||on.getState("sa")},Q&&{search_intent:Q},o.usedModel?{usedModel:o.usedModel}:{},b&&{isShowHello:b},o.share_id?{share_id:o.share_id}:{},J?{interaction_type:J}:{},(null==Y?void 0:Y.entrance)?{sub_session:{entrance:Y.entrance,ori_lid:Y.oriLid,re_rank:String(Y.reRank+1)}}:{},x?{knowledgeId:I}:{})}),withoutStopLastSse:et}),promptContent:o.queryPromise?o.queryPromise:q,extraData:Wl({},o,{rank:m+1}),scrollToTop:0!==m||0===m&&z||Vl},n||"SSE",on.getState("hasInitContext")||d)}),0),on.dispatch("update",{curRankInfo:{rank:m+1,timstamp:String(Date.now()),agentInfo:w,lid:on.getState("lid"),oriLid:on.getState("oriLid")},subSession:Wl({},Y,{reRank:Y.reRank+1})}),[2]}var at}))},Yl=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Gl(o,a,i,r,s,"next",t)}function s(t){Gl(o,a,i,r,s,"throw",t)}r(void 0)}))},Yl.apply(this,Array.from(arguments))}function Zl(t,e){$l.renderTip(t,e)}function tc(t,e,n){return $l.getHistory(t,e,n)}function ec(){$l.startBottomAlign(rt())}function nc(){return $l.stopBottomAlign()}function ac(){return $l.stopChangeBottomAlign()}function ic(t){return $l.contentHasOverflow(t)}function oc(t,e){var n,a="";0!==t&&"16"===(null==e?void 0:e.agentSearchId)&&(a=null==e||null==(n=e.agentParams)?void 0:n.agent_id);return a}function rc(t,e){void 0===e&&(e=!1),t=_t(t);var n=on.getState("apagelid"),a=on.getState("oriLid"),i=on.getState("sgeLid"),o=on.getState("chatParams"),r=on.getState("sid"),s=on.getState("rank"),l=on.getState("connectPreQuery"),c=on.getState("iosSlipPrefetchEnable"),d=on.getState("appUrlParams"),u=s+1,p=on.getState("agentInfo"),h=on.getState("aitab_ct"),f=on.getState("actiontype"),g=on.getState("landingPageSwitch"),m=on.getState("csextdata"),v=on.getState("sa"),y=on.getState("enterType"),w={};try{w=JSON.parse(m)}catch(t){w={}}w.enter_type=y;var b=!!(null==w?void 0:w.operationPlatform);m="{}"===(m=JSON.stringify(w))?"":m,w&&"aicc"in w&&delete w.aicc,!e&&on.dispatch("update",{aitab_ct:"",actiontype:"",csextdata:b?JSON.stringify({operationPlatform:null==w?void 0:w.operationPlatform}):JSON.stringify(w)});var _=on.getState("clientHeaders"),k=on.getState("cosmicVersion"),S=on.getState("scVersion");if(p&&Object.keys(p).length>0&&-1!==t.indexOf(p.agentName)){var x=Ts(t,p.startIndex,p.endIndex);t=x.prefix+x.suffix}var I=qt( new URL(__get$(__get$Loc(location),"href")) .searchParams);return{data: __call$(Object,"assign",[I,d,qe(Wl({word:l?l+" "+t:t,apagelid:n,ori_lid:a,sge_lid:o.sge_lid||i,setype:o.setype,pd:o.pdvalue,sid:r,re_rank:u,cstabpage:1,mod:c?1:"",sa:v,chat_token:o.chat_token,agent_id:oc(s,p)||(null==p?void 0:p.agentSearchId)||"",agent_p:JSON.stringify(Wl({},(null==p?void 0:p.agentSearchId)?Wl({isUpperBox:!!(null==p?void 0:p.isUpperBox)},(null==p?void 0:p.agentParams)||{},{noRewrite:+!!on.getState("agentRecData")}):{},{agt_rk:on.getState("agentRank"),agt_sess_cnt:on.getState("agentSessionCount")})),aitab_ct:h,actiontype:f},u>1?{cv:k,scv:S}:{},{agt_rk:on.getState("agentRank"),agt_sess_cnt:on.getState("agentSessionCount"),a_srcid:on.getState("srcid")||"",a_order:on.getState("order")||"",a_tplname:on.getState("tplname")||"",csextdata:Wl({},JSON.parse(m),{blockCmpt:__get$(on.getState("blockCmptList"),a)||[]}),enterType:y}))]) ,headers:Wl({},_,{landingPageSwitch:g})}}function sc(t){var e=_t(t||""),n=on.getState("searchframeLid"),a=on.getState("token");return window.btoa(a+"|"+encodeURIComponent(e)+"|"+Date.now()+"|"+n)+"-"+n}function lc(t,e){for(var n in e)e.hasOwnProperty(n)&&("object"===zl( __get$(e,n) )&&null!== __get$(e,n) ?"object"===zl( __get$(t,n) )&&null!== __get$(t,n) ?lc( __get$(t,n) , __get$(e,n) ): __set$(t,n,Wl({},__get$(e,n))) : __set$(t,n,__get$(e,n)) );return t}function cc(t){var e,n=on.getState("agentInfo")||{},a=on.getState("pcClickInfo"),i=on.getState("searchParams"),o=on.getState("sa"),r=on.getState("landingPageSwitch"),s=on.getState("connectPreQuery"),l=Ft(i.extParams||i.extParamsJson||"{}"),c={};try{c=JSON.parse(l)}catch(t){console.error(t),c=$t(l)}var d,u=on.getState("chatParams"),p=on.getState("rank"),h=p+1,f=on.getState("aitab_ct"),g=function(t){var e=1;return Array.isArray(t)&&t.forEach((function(t){"IMAGE"===t.type&&(e=3,t.data.image.ext&&(e=2))})),e}(t),m={},v="pc"===rt()?"pc_csaitab":"wise_csaitab",y=on.getState("cosmicVersion"),w=on.getState("scVersion"),b=on.getState("oriLid"),_=on.getState("pluginPromptType"),k=s?function(t,e){var n=e.prefix,a=void 0===n?"":n,i=e.suffix,o=void 0===i?"":i,r=""+a+t+o;if(Array.isArray(t))try{r=JSON.parse(JSON.stringify(t)).map((function(t){return t.data.text&&(t.data.text.query=""+a+t.data.text.query+o),t}))}catch(e){r=t,console.error(e)}return r}(t,{prefix:s+" "}):t,S=1===g?String(_t(k)):"",x=_t(t),I=on.getState("usedModel"),T=on.getState("aPageWord"),C=+on.getState("isShowHello"),L=+on.getState("apagelid"),D=T&&T!==x||C||p>1||!L?2:T&&T===x?1:0;window.page&&window.page.amd&&window.page.amd.version&&(d=window.page.amd.version.searchUi);var P=function(t){ __get$(c,t) &&( __set$(m,t,__get$(c,t)) ,delete c[t],i.extParams=encodeURIComponent(JSON.stringify(c)),on.dispatch("update",{searchParams:i}))};P("aicc"),P("his_key"),P("aPageWord"),_&&on.dispatch("update",{pluginPromptType:0});var E= new URLSearchParams(__get$(__get$Loc(location),"href")) .get("minjie_id");E&& __call$(Object,"assign",[m,{minjie_id:E}]) ;var A,O,R={message:{inputMethod:"chat_search",isRebuild:!1,content:Wl({query:"",agentInfo:{agent_id:[oc(p,n)||(null==n?void 0:n.agentSearchId)||""],params:JSON.stringify(Wl({},(null==n?void 0:n.agentSearchId)?Wl({isUpperBox:!!n.isUpperBox},n.agentParams||{},{noRewrite:+!!on.getState("agentRecData")}):{},{agt_rk:on.getState("agentRank"),agt_sess_cnt:on.getState("agentSessionCount")}))}},_&&{pluginQuery:{promptType:_}}),searchInfo:{srcid:String(on.getState("srcid")||""),order:on.getState("order")||"",tplname:on.getState("tplname")||"",re_rank:String(+on.getState("rank")+1),ori_lid:on.getState("oriLid"),sa:o,chatParams:{setype:"csaitab"},blockCmpt: __get$(on.getState("blockCmptList"),b) ||[],usedModel:I,landingPageSwitch:on.getState("landingPageSwitch"),landingPage:lt()?"deepseek":"aitab"},from:vt()?"aichat_plugin":"",source:"wise_csaitab",query:t}};switch(g){case 1:lc(R.message,{content:{qtype:0,aitab_ct:f},searchInfo:Wl({},m,{isInnovate:D,applid:c.applid||on.getState("applid")||"",a_lid:c.apagelid||on.getState("apagelid")||"",enter_type:Vl?on.getState("pcEnterType")||"ai_tab_url":on.getState("enterType")},h>1?{cv:y,scv:w}:{},{suv:d,chatParams:{chat_samples:"WISE_NEW_CSAITAB",sge_lid:u.sge_lid,chat_token:sc(s?s+" "+x:x),scene:""}}),source:v,anti_ext:{inputT:on.getState("pcInputTime"),ck1:a.clickTimeDiff,ck9:a.clientX,ck10:a.clientY},query:k});break;case 2:lc(R.message,{inputMethod:"graph_search",searchInfo:{lid:"",srcid:""},content:{agentInfo:void 0},agent_id:""});break;case 3:lc(R.message,{content:{agentInfo:{params:(null==n?void 0:n.agentSearchId)?JSON.stringify(Wl({isUpperBox:!!n.isUpperBox,forceGen:1},n.agentParams||{},{noRewrite:+!!n.noRewrite})):""}},source:v,searchInfo:{lid:"",chatParams:{sge_lid:u.sge_lid,chat_token:sc(s?s+" "+x:x)}},agent_id:""})}return{data:R,headers:Wl({source:v,landingPageSwitch:r,"X-Chat-Message":(A={query:S.slice(0,500),anti_ext:R.message.anti_ext,enter_type:R.message.searchInfo.enter_type,re_rank:R.message.searchInfo.re_rank,modelName:null==(e=R.message.searchInfo.usedModel)?void 0:e.modelName},O=[],Object.keys(A).forEach((function(t){var e= __get$(A,t) ;e&&("object"===(void 0===e?"undefined":zl(e))&&(e=JSON.stringify(e)),O.push(t+":"+encodeURIComponent(e)))})),O.join(","))},lt()||(null==I?void 0:I.modelName)?{isDeepseek:"1"}:{},nt?{"debug-user-agent":ot.debugUA}:{})}}function dc(t){var e=on.getState("chatParams");return{data:{query:"string"==typeof(t=_t(t))?t:"",sge_lid:e.sge_lid,token:sc(t)}}}function uc(t){0!==t.status&&Qn().emit({text:"删除失败，请稍后再试"})}function pc(t){if(!nt)return t;var e= new URL(__get$(__get$Loc(location),"href")) ,n={};return pe.forEach((function(t){var a=e.searchParams.get(t);a&&( __set$(n,t,a) )})),Bt(t,n)}!function(t){ __set$(t,t.TEXT_SEARCH=1,"TEXT_SEARCH") , __set$(t,t.GRAPH_SEARCH=2,"GRAPH_SEARCH") , __set$(t,t.PIC_SEARCH=3,"PIC_SEARCH") }(Jl||(Jl={}));var hc=null;function fc(t,e){return fc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fc(t,e)}var gc=function(t){function e(){return t.apply(this,Array.from(arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fc(t,e)}(e,t),e.prototype.initData=function(){return{boxCount:3,animationDelay:400}},e}(a.Component);gc.computed={boxes:function(){var t=this.data.get("boxCount");return new Array(t).fill(null)}};var mc={};mc= __call$(Object,"assign",[mc,{skLoading:"sk-loading_x915f_1","sk-loading":"sk-loading_x915f_1",skLoadingGenerating:"sk-loading-generating_x915f_5","sk-loading-generating":"sk-loading-generating_x915f_5",box:"box_x915f_9",loadingBar:"loading-bar_x915f_31","loading-bar":"loading-bar_x915f_31",borealisBar:"borealisBar_x915f_1"}]) ,gc.template='\n    <div class="{{$style[\'sk-loading\']}}">\n        <span class="{{$style[\'sk-loading-generating\']}}" >\n            <span \n                s-for="item, index in boxes"\n                class="{{$style[\'box\']}}"\n            >\n                <span \n                    class="{{$style[\'loading-bar\']}}"\n                    style="animation-delay: {{index * animationDelay}}ms"\n                ></span>\n            </span>\n        </span>\n    </div>\n';var vc="function"==typeof gc?gc.prototype.initData||yc:gc.initData||yc;function yc(){return{$style:mc}}function wc(){return  __call$(Object,"assign",[{},vc.call(this),{$style:mc}]) }function bc(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function _c(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){bc(o,a,i,r,s,"next",t)}function s(t){bc(o,a,i,r,s,"throw",t)}r(void 0)}))}}function kc(){return kc=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},kc.apply(this,Array.from(arguments))}function Sc(t,e){return Sc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Sc(t,e)}function xc(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof gc?gc.prototype.initData=wc:gc.initData=wc;var Ic=function(t){function n(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Sc(t,e)}(n,t);var a=n.prototype;return a.initData=function(){return{historyList:[],isLoading:!0,sessionId:"",retryCount:0}},a.attached=function(){this.getAndProcessHistoryData(),this.setupKnowledgeListener()},a.setupKnowledgeListener=function(){var t=this;Ha().on((function(e){t.data.set("sessionId",e.sessionId),"his-chat"===e.updateType?t.getAndProcessHistoryData():"deleteHistoryItem"===e.updateType&&t.removeHistoryItem(e.sessionId)}))},a.removeHistoryItem=function(t){var e=this;return _c((function(){var n,a,i,o;return xc(this,(function(r){switch(r.label){case 0:return n=e.data.get("historyList")||[],-1===(a=n.findIndex((function(e){return e.sessionId===t})))?[3,2]:(e.data.splice("historyList",[a,1]),[4,e.fetchHistoryList()]);case 1:o=r.sent(),e.data.set("historyList",(null==o||null==(i=o.data)?void 0:i.historyData)?[].concat(o.data.historyData).reverse():e.data.get("historyList")),r.label=2;case 2:return[2]}}))}))()},a.getAndProcessHistoryData=function(){var t=this;return _c((function(){var e;return xc(this,(function(n){switch(n.label){case 0:return[4,t.fetchHistoryList()];case 1:return e=n.sent(),t.processHistoryResponse(e),[2]}}))}))()},a.fetchHistoryList=function(t){return void 0===t&&(t={}),_c((function(){var e,n,a,i;return xc(this,(function(o){switch(o.label){case 0:e=on.getState("chatParams.sse_host")||Gt,n=""+e+Wt.history,a={},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Di(n,kc({rn:16,pn:0,req_type:4,from:"chat_search",token:sc()},t),{},5e3)];case 2:return a=o.sent(),[3,4];case 3:return i=o.sent(),console.error(i),[3,4];case 4:return[2,a]}}))}))()},a.processHistoryResponse=function(t){var n=t.status,a=t.data;if(0===n){var i=(null==a?void 0:a.historyData)||[];if(this.handleCurrentSession(i))return;this.updateHistoryList(i),this.notifyHistoryCount(i.length)}else e.Toast.error({message:"网络异常，请稍后再试"});this.data.set("isLoading",!1)},a.handleCurrentSession=function(t){var e=this.data.get("sessionId");if(!e)return!1;if(!t.some((function(t){return t.sessionId===e})))return this.retryFetchIfNeeded();var n=t.find((function(t){return t.sessionId===e}));return!!n&&(this.addSessionToTop(n),!0)},a.retryFetchIfNeeded=function(){var t=this,e=this.data.get("retryCount")||0;return e<10?(this.data.set("retryCount",e+1),setTimeout((function(){t.getAndProcessHistoryData()}),500),!0):(this.data.set("retryCount",0),!1)},a.addSessionToTop=function(t){var e=kc({},t,{updateTime:(new Date).getTime()});this.data.unshift("historyList",e),ti.dispatch("update",{selectedHistoryItemId:e.sessionId,selectedItemId:""});var n=this.data.get("historyList");return n.length>15&&this.data.splice("historyList",[15,n.length-15]),this.data.set("retryCount",0),!0},a.updateHistoryList=function(t){var e=t.reverse().slice(0,15);this.data.set("historyList",e)},a.notifyHistoryCount=function(t){this.fire("historyListLoaded",{total:t})},a.handleHistoryMore=function(){ti.dispatch("update",{selectedItemId:"",selectedHistoryItemId:""}),Ua({type:"click",value:"catalogue_his_more"}),Dn.router.push({path:_e.HISTORY.path})},n}(a.Component);Ic.components={"history-list":Ti,"sk-loading":gc},Ic.template='\n        <div class="history-chat">\n            <div class="history-chat-title">对话</div>\n            <sk-loading class="history-chat-loading" s-if="{{isLoading}}"/>\n            <history-list\n                s-else\n                class="history-chat-list"\n                is-side-bar="{{true}}"\n                source="history"\n                history-list="{{historyList}}"\n            />\n            <div s-if="isMore" class="history-chat-more" on-click="handleHistoryMore">查看全部</div>\n        </div>\n    ',Ic.computed={isMore:function(){return this.data.get("historyList").length>=15}};var Tc=function(){function t(){}var e=t.prototype;return e.getLatestRoundInfo=function(){return{round_index:on.getState("rank"),lid:on.getState("lid")}},e.getAgentInfo=function(){return on.getState("agentInfo")},e.setAgentInfo=function(t){on.dispatch("update",{agentInfo:t})},e.isLogin=function(){return on.getState("user.isUserLogin")},e.getUserInfo=function(){return on.getState("user")},e.launchConversation=function(t){return Xl(t)},e.showToast=function(t){Qn().emit(t)},t}();function Cc(t){var e=on.getState("pcEnterType"),n=on.getState("outEnterType");return{out_enter_type:Zt.includes(e)?n:e,enter_type:t||""}}function Lc(){return Lc=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Lc.apply(this,Array.from(arguments))}function Dc(t,e){return Dc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Dc(t,e)}var Pc=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dc(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{inSiderBar:!1,isShowOnly:!1,knowledgeId:"",inKnowledge:!1}},n.attached=function(){},n.handleNewChatClick=function(){var t=this.data.get("inSiderBar"),e=this.data.get("knowledgeId");Ua({type:"click",value:"sidebar_dialog",page:"resultpage",ext:{re_rank:String(on.getState("rank")),is_open:String(t?1:0)}}),ti.dispatch("update",{selectedItemId:"",selectedHistoryItemId:""});var n=Date.now();if(this.data.get("inKnowledge")){ai(Lc({knowledgeId:e,forceRefresh:n},Cc("catalogue_zsk_new"),{open_type:1}))}else{var a=Lc({},Cc("sidebar_dialog"),e?{knowledge_id:e}:{});si({isShowHello:"1",extParams:JSON.stringify(a)})}},e}(a.Component);function Ec(t,e){return Ec=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ec(t,e)}Pc.components={"cos-icon":e.Icon,"cos-tooltip":e.Tooltip},Pc.template='\n    <div\n      s-if="inSiderBar"\n      class="new-dialog-container"\n      on-click="handleNewChatClick"\n    >\n      <div class="new-dialog-container-button">\n        开启新对话\n      </div>\n    </div>\n    <div s-else s-bind="{{realShowData}}">\n        <cos-tooltip s-if="isShowOnly" position="right" content="开启新对话">\n            <cos-icon\n                on-click="native:handleNewChatClick"\n                class="new-dialog-icon"\n                name="new-dialog"\n            />\n        </cos-tooltip>\n        <cos-tooltip s-else position="top" content="新建库内对话">\n            <cos-icon\n                on-click="native:handleNewChatClick"\n                class="new-dialog-icon"\n                name="new-dialog"\n            />\n        </cos-tooltip>\n    </div>\n  ',Pc.computed={realShowData:function(){return this.data.get("isShowOnly")?{"data-show-area":"hudong","data-show-ext":JSON.stringify({value:"sidebar_dialog",is_open:0})}:{}}};var Ac=function(t){function n(){var e;return(e=t.apply(this,Array.from(arguments))||this).handleEscKey=function(t){"Escape"===t.key&&e.data.get("showDeleteDialog")&&e.handleDefaultCancel("esc")},e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ec(t,e)}(n,t);var a=n.prototype;return a.initData=function(){return{showPopover:!1,popoverList:[{type:"rename",icon:"input",name:"重命名"},{type:"delete",icon:"bin",name:"删除"}],showDeleteDialog:!1,getPopupContainer:function(){return document.body}}},a.handleItemClick=function(t,e){null==e||e.stopPropagation();var n=this.data.get("showData"),a=n.id,i=n.title;this.data.set("showPopover",!1),"rename"===t&&(this.fire("rename"),this.fire("popover-close")),"delete"===t&&(this.data.set("showDeleteDialog",!0),document.addEventListener("keydown",this.handleEscKey),Ua({type:"show",value:"zsk_delete_pop",ext:{zsk_name:i,zsk_id:a}})),Ua({type:"click",value:"catalogue_zsk_title_"+t})},a.handleDefaultOk=function(){var t=this,n=this.data.get("showData").id;this.data.set("showDeleteDialog",!1),document.removeEventListener("keydown",this.handleEscKey),function(t){return Er.apply(this,Array.from(arguments))}({knowledgeId:n}).then((function(){var a=ti.getState("knowledgeMsg");delete a[n],ti.dispatch("update",{knowledgeMsg:a}),t.data.set("showPopover",!1),t.fire("popover-close"),t.fire("knowledge-deleted",n),t.clickLogParams("yes"),e.Toast.show({message:"删除成功"}),n===ti.getState("knowledgeId")&&si({isShowHello:"1",extParams:JSON.stringify({enter_type:"sidebar_dialog",delete_knowledge:"1"})})}))},a.handleDefaultCancel=function(t){this.clickLogParams(t),this.data.set("showDeleteDialog",!1),document.removeEventListener("keydown",this.handleEscKey),this.data.set("showPopover",!1),this.fire("popover-close")},a.handleDefaultClose=function(){this.handleDefaultCancel("blank")},a.clickLogParams=function(t){var e=this.data.get("showData"),n=e.id;Ua({type:"click",value:"zsk_delete_pop",ext:{button:t,zsk_name:e.title,zsk_id:n}})},n}(a.Component);function Oc(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Rc(){return Rc=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Rc.apply(this,Array.from(arguments))}function Nc(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Ac.components={"cos-popover":e.Popover,"cos-icon":e.Icon,"cos-dialog":e.Dialog},Ac.template='\n        <template>\n            <div>\n                <cos-popover\n                    open="{=showPopover=}"\n                    class="kl-popover"\n                    getPopupContainer="{{getPopupContainer}}"\n                >\n                    <div\n                        class="kl-popover-item"\n                        s-for="item in popoverList"\n                        on-click="handleItemClick(item.type, $event)"\n                    >\n                        <cos-icon\n                            class="kl-popover-item-icon"\n                            name="{{item.icon}}"\n                        />\n                        <span class="kl-popover-item-text">{{item.name}}</span>\n                    </div>\n                </cos-popover>\n                \n                <cos-dialog\n                    open="{{showDeleteDialog}}"\n                    class="kl-popover-delete-dialog"\n                    appearance="info"\n                    title="{{dialogTitle}}"\n                    okText="确认"\n                    outsideClosable="true"\n                    on-ok="handleDefaultOk"\n                    on-close="handleDefaultClose"\n                    on-cancel="handleDefaultCancel(\'cancle\')"\n                >知识库内的文件、对话将被一起删除，不可恢复。</cos-dialog>\n            </div>\n        </template>\n    ',Ac.computed={dialogTitle:function(){return"确认删除知识库 "+this.data.get("showData").title+"？"}};var Mc={component:null,knowledgeId:""},qc=Tt.connect(ti,{knowledgeId:"knowledgeId",knowledgeMsg:"knowledgeMsg",selectedItemId:"selectedItemId"})(a.defineComponent({trimWhitespace:"all",template:'\n            <div class="knowledge-list-item {{!isMore ? \'nomore\' : \'\'}} {{isSelected ? \'selected\' : \'\'}}">\n                <div\n                    class="knowledge-list-item-header"\n                    on-mouseenter="handleItemBtn"\n                    on-mouseleave="handleItemBtn"\n                >\n                    <div class="knowledge-list-item-header-title" on-click="clickKnowledgeItem()">\n                        <cos-icon\n                            class="knowledge-list-item-header-title-icon"\n                            name="{{!isExpanded ? \'interpretation\' : \'estimated-score\'}}"\n                            on-click="native:handleItemExpanded($event)"\n                        />\n                        <span\n                            data-show-area\n                            data-show-ext="{{knowledgeTitleShowLogParams}}"\n                            s-if="!isTitleEditing" \n                        >\n                            {{item.title}}\n                        </span>\n                        <input \n                            s-else\n                            s-ref="knowledge-input"\n                            max-length="20"\n                            class="knowledge-list-item-header-title-editable-input"\n                            value="{{item.title}}"\n                            on-blur="handleTitleBlur"\n                            on-focus="handleTitleFocus"\n                            on-click="native:handleInputClick($event)"\n                            on-keyup="handleTitleKeyup"\n                            autofocus\n                        />\n                    </div>\n                    <div\n                        s-if="!isTitleEditing && showItemBtn"\n                        class="knowledge-list-item-header-btn"\n                        on-click="handleBtnClick($event)"\n                        data-show-area\n                        data-show-ext="{{funcBtnShowLog}}"\n                    >\n                        <new-dialog\n                            class="knowledge-list-item-header-btn-icon"\n                            in-knowledge="{{true}}"\n                            knowledge-id="{{item.id}}"\n                        />\n                        <cos-icon\n                            class="knowledge-list-item-header-btn-icon"\n                            name="feedback-new"\n                            on-click="native:handlePopover(item.id, $event)"\n                        />\n                        <kl-popover\n                            on-rename="handleRename"\n                            on-popover-close="handlePopoverClose"\n                            on-knowledge-deleted="handleKnowledgeDeleted"\n                            show-popover="{{showPopover}}"\n                            show-data="{{item}}"\n                        />\n                    </div>\n                </div>\n\n                <div\n                    s-if="item.chatList && item.chatList.length && isExpanded"\n                    class="knowledge-list-item-children"\n                >\n                    <history-list\n                        s-ref="knowledge-item"\n                        class="knowledge-list-item-children-content" \n                        source="knowledge"\n                        is-side-bar="{{true}}"\n                        history-list="{{limitedChatList}}"\n                        knowledge-his-id="{{item.id}}"\n                    />\n                    <div \n                        s-if="isMore"\n                        class="knowledge-list-item-children-button" \n                        on-click="handleViewAll(item.id)"\n                    >\n                        查看全部\n                    </div>\n                </div>\n            </div>\n        ',components:{"cos-icon":e.Icon,"new-dialog":Pc,"kl-popover":Ac,"history-list":Ti},initData:function(){var t=this.data&&this.data.get("item")&&this.data.get("item").id,e=!1;if(t){var n=localStorage.getItem("knowledge_expanded_"+t);null!==n&&(e="true"===n)}return{item:{chatList:[]},isExpanded:e,showItemBtn:!1,showPopover:!1,isTitleEditing:!1,lastFocusTime:0,funcBtnShowLog:JSON.stringify({type:"show",value:"catalogue_zsk_title_hover"})}},computed:{limitedChatList:function(){var t,e=this.data.get("item");return(null==e||null==(t=e.chatList)?void 0:t.length)?e.chatList.slice(0,5):[]},isSelected:function(){return this.data.get("selectedItemId")===this.data.get("item").id},isMore:function(){var t=this.data.get("item");return t.chatList&&t.chatList.length>=5},knowledgeTitleShowLogParams:function(){var t=this.data.get("item"),e=this.data.get("index");return JSON.stringify({value:"catalogue_zsk_name",pos:e+1,zsk_id:null==t?void 0:t.id,zsk_name:null==t?void 0:t.title,enter_type:on.getState("pcEnterType")})}},handleGlobalClick:function(t){var e,n,a=t.target;if(!(null==(e=this.el)?void 0:e.contains(a))&&(null==(n=this.data)?void 0:n.get("showPopover"))){var i,o,r=!!a.closest(".kl-popover"),s=!!a.closest(".kl-popover-delete-dialog");if(!r&&!s)null==(i=this.data)||i.set("showPopover",!1),null==(o=this.data)||o.set("showItemBtn",!1),Mc.component===this&&Mc.knowledgeId===this.data.get("item").id&&(Mc.component=null,Mc.knowledgeId="")}},exitEditMode:function(){return(t=function(){var t,e,n,a,i,o,r,s,l,c,d,u;return Nc(this,(function(p){switch(p.label){case 0:return(t=this.ref("knowledge-input"))?(o=t.value.trim(),r=null==(e=this.data)?void 0:e.get("item"),o===r.title?[3,2]:(s=r.id,l=r.instruction,[4,Ar((c={}, __set$(c,s,{title:o,instruction:l}) ,c))])):[3,3];case 1:-1!==p.sent().status&&(Ha().emit({updateType:"title",knowledgeId:s,currentTitle:o}),u=Rc({},r,{title:o||r.title}),null==(d=this.data)||d.set("item",u)),p.label=2;case 2:null==(n=this.data)||n.set("isTitleEditing",!1),null==(a=this.data)||a.set("showPopover",!1),null==(i=this.data)||i.set("showItemBtn",!1),p.label=3;case 3:return[2]}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Oc(o,a,i,r,s,"next",t)}function s(t){Oc(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var t},attached:function(){var t=this,e=this.data.get("item")&&this.data.get("item").id;if(e){var n=localStorage.getItem("knowledge_expanded_"+e);null!==n&&this.data.set("isExpanded","true"===n)}Ha().on((function(e){if("popoverStatus"===e.updateType&&t.data.get("showPopover")&&t.data.set("showPopover",!1),"title"===e.updateType&&e.knowledgeId===t.data.get("item").id&&t.data.set("item.title",e.currentTitle),"chat"===e.updateType&&e.knowledgeId===t.data.get("item").id&&Dr({knowledgeId:e.knowledgeId}).then((function(n){var a,i=null==n||null==(a=n.knowledgeList[0])?void 0:a.chatList;if(null==i?void 0:i.length){var o=i[0];if(t.data.get("item.chatList")){var r=t.data.get("item.chatList").findIndex((function(t){return t.sessionId===o.sessionId}));-1!==r&&t.data.splice("item.chatList",[r,1]),t.data.unshift("item.chatList",o)}else t.data.set("item.chatList",i); __get$Loc(location) .search.includes("knowledgeId")&&(ti.dispatch("update",{selectedItemId:"",selectedHistoryItemId:o.sessionId}),t.data.set("isExpanded",!0),localStorage.setItem("knowledge_expanded_"+e.knowledgeId,String(t.data.get("isExpanded"))))}})),"knowledge"===e.updateType&&e.knowledgeId===t.data.get("item").id){var n=ti.getState("knowledgeMsg."+e.knowledgeId+".chatList");t.data.set("item.chatList",n)}if("deleteChat"===e.updateType&&e.knowledgeId===t.data.get("item").id){var a=e.sessionId,i=(t.data.get("item.chatList")||[]).findIndex((function(t){return t.sessionId===a}));-1!==i&&t.data.splice("item.chatList",[i,1]),ti.getState("selectedHistoryItemId")===a&&ti.dispatch("update",{selectedHistoryItemId:""}),t.data.get("item.chatList").length||(t.data.set("isExpanded",!1),localStorage.setItem("knowledge_expanded_"+e.knowledgeId,String(t.data.get("isExpanded"))))}})),document.addEventListener("click",this.handleGlobalClick.bind(this))},detached:function(){document.removeEventListener("click",this.handleGlobalClick.bind(this))},clickKnowledgeItem:function(){var t,e=this.data.get("item"),n=this.data.get("index");ti.dispatch("update",{selectedItemId:e.id,selectedHistoryItemId:""});var a=Cc("catalogue_zsk_name");ai(Rc({knowledgeId:e.id},a,{open_type:2})),Ua({type:"click",value:"catalogue_zsk_name",ext:{pos:n+1,zsk_id:null==e?void 0:e.id,zsk_name:null==e?void 0:e.title,zsk_dialog_num:(null==(t=e.chatList)?void 0:t.length)||0,enter_type:on.getState("pcEnterType")}})},handleTitleFocus:function(){this.data.set("lastFocusTime",Date.now())},handleTitleBlur:function(){var t=this,e=this.data.get("lastFocusTime");Date.now()-e<200?setTimeout((function(){var e=t.ref("knowledge-input");e&&t.data.get("isTitleEditing")&&e.focus()}),0):this.exitEditMode()},handleTitleKeyup:function(t){"Enter"===t.key&&t.target.blur()},handleItemExpanded:function(t){var e;null==t||t.stopPropagation(),null==t||t.preventDefault();var n=this.data.get("item");if((null==n?void 0:n.chatList)&&0!==(null==n||null==(e=n.chatList)?void 0:e.length)){var a=!this.data.get("isExpanded");this.data.set("isExpanded",a);var i=this.data.get("item")&&this.data.get("item").id;i&&localStorage.setItem("knowledge_expanded_"+i,String(a)),this.fire("itemClick",{})}},handleItemBtn:function(){this.data.get("showPopover")||this.data.set("showItemBtn",!this.data.get("showItemBtn"))},handlePopover:function(t,e){null==e||e.stopPropagation(),Mc.component&&Mc.component!==this&&Mc.knowledgeId!==t&&(Mc.component.data.set("showPopover",!1),Mc.component.data.set("showItemBtn",!1));var n=!this.data.get("showPopover");this.data.set("showPopover",n),n?(this.data.set("showItemBtn",!0),Mc.component=this,Mc.knowledgeId=t):Mc.component===this&&(Mc.component=null,Mc.knowledgeId=""),this.data.get("showPopover")&&Ua({type:"show",value:"catalogue_zsk_title_more"})},handleViewAll:function(t){ti.dispatch("update",{selectedItemId:"",selectedHistoryItemId:""}),ai(Rc({knowledgeId:t},Cc("catalogue_zsk_more"),{open_type:3})),Ua({type:"click",value:"catalogue_zsk_dialog_more"})},handleBtnClick:function(t){null==t||t.stopPropagation(),null==t||t.preventDefault();var e=this.data.get("item");ti.dispatch("update",{selectedItemId:e.id,selectedHistoryItemId:""}),Ua({type:"click",value:"catalogue_zsk_title_new_zsk"})},handleRename:function(){var t=this;this.data.set("isTitleEditing",!0),this.nextTick((function(){var e=t.ref("knowledge-input");if(e){e.focus();var n=e.value.length;e.setSelectionRange(n,n),t.data.set("lastFocusTime",Date.now())}}))},handlePopoverClose:function(){this.data.set("showPopover",!1),this.data.set("showItemBtn",!1),Mc.component===this&&(Mc.component=null,Mc.knowledgeId="")},handleKnowledgeDeleted:function(t){this.fire("knowledge-deleted",t)},handleInputClick:function(t){t.stopPropagation()}}));function jc(){return jc=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},jc.apply(this,Array.from(arguments))}function Bc(t,e){return Bc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Bc(t,e)}var Hc=function(t){function n(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bc(t,e)}(n,t);var a=n.prototype;return a.initData=function(){return{knowledgeList:[],currentIndex:-1,isLoading:!0,isLogin:!0,knowledgeDescription:"使用知识库来组织对话或任务，支持添加各类文件"}},a.created=function(){var t=this;!(new Tc).isLogin()&&this.data.set("isLogin",!1),Dr({}).then((function(e){if(e&&e.knowledgeList&&e.knowledgeList.length){var n=e.knowledgeList;ti.dispatch("initKnowledgeMsg",Object.fromEntries(n.map((function(t){return[t.id,t]}))));var a=n.slice(0,5),i=t.data.get("knowledgeList");t.data.splice("knowledgeList",[].concat([i.length,0],a)),t.data.set("isLoading",!1),t.fire("knowledgeListLoaded",{total:e.knowledgeList.length,list:e.knowledgeList.map((function(t){return t.title}))}),Ha().emit({updateType:"knowledge"})}else t.data.set("isLoading",!1)}))},a.attached=function(){this.handleAddKnowledge=Ki(this.handleAddKnowledge,1e3,{leading:!0,trailing:!1})},a.handleItemClick=function(t,e){this.data.set("currentIndex",e),this.fire("knowledgeItemClick",t)},a.handleAddKnowledge=function(){var t=this;Ua({type:"click",value:"catalogue_new_zsk",ext:{button:"add",enter_type:on.getState("enterType")}});var n=ti.getState("knowledgeMsg")||{};Object.keys(n).length>=5?e.Toast.show({message:"最多创建5个知识库哦～"}):gs().then((function(){t.fire("create-state-update",!0),function(t){return Rr.apply(this,Array.from(arguments))}({title:"未命名知识库"}).then((function(e){if(e&&e.data){var n,a=e.data,i=a.knowledgeId,o=a.title,r=Cc("catalogue_zsk_name");ti.dispatch("update",( __set$(n={},"knowledgeMsg."+i+".title",o) ,n)),t.data.unshift("knowledgeList",{id:i,title:o}),ai(jc({knowledgeId:i,newKnowledge:!0},r)),ti.dispatch("update",{selectedItemId:i,selectedHistoryItemId:""})}})).finally((function(){t.fire("create-state-update",!1)}))})).catch((function(){e.Toast.error("请先登录")}))},a.handleKnowledgeDeleted=function(t){var e=(this.data.get("knowledgeList")||[]).findIndex((function(e){return e.id===t}));-1!==e&&this.data.splice("knowledgeList",[e,1]),Dr({}).then((function(t){t&&t.knowledgeList&&t.knowledgeList.length&&t.knowledgeList.forEach((function(t){var e;ti.dispatch("update",( __set$(e={},"knowledgeMsg."+t.id+".title",t.title) ,e))}))}))},n}(a.Component);function $c(t){var e,n,a,i,o=_n('.cs-rank-container[rank="'+t+'"]');if(!o)return"";var r=null==(e=_n("[data-share]",o))?void 0:e.getAttribute("data-share");null==(n=_n("[data-agent]",o))||n.getAttribute("data-agent");var s=null==(a=_n("[data-query]",o))?void 0:a.getAttribute("data-query"),l=null==(i=_n("[data-share-disabled]",o))?void 0:i.getAttribute("data-share-disabled");return r&&s&&!l?function(t){var e=t.shareParams,n=void 0===e?{}:e,a=t.query,i=void 0===a?"":a,o=t.extParams,r=void 0===o?"":o,s=t.shareToken,l=void 0===s?"":s,c=""+Gt+Wt.sharePage;return jt("https://mbd.baidu.com/ug_share/mbox/4a84ae9866/share",Mt({product:"default",tk:"665167314a3488d45738b9d218daebed",domain:"mbd.baidu.com",share_url:l?c+"?share_id="+encodeURIComponent(l)+"&v=2":c+"?share_id="+encodeURIComponent(n.shareId)+"&word="+encodeURIComponent(i),word:i,extParams:r}))}({shareParams:JSON.parse(r),query:s,extParams:encodeURIComponent("extParams="+encodeURIComponent(JSON.stringify({isShowHello:1,enter_type:"c_h5share"})))}):""}function Fc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Uc(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Gc(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Uc(o,a,i,r,s,"next",t)}function s(t){Uc(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Wc(){return Wc=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Wc.apply(this,Array.from(arguments))}function zc(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Fc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fc(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Qc(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Hc.components={"knowledge-list-item":qc,"cos-icon":e.Icon,"cos-tooltip":e.Tooltip,"sk-loading":gc},Hc.template='\n    <div class="knowledge-list">\n      <div class="knowledge-list-header {{!isLogin || !knowledgeList.length ? \'knowledge-list-header-no-login\' : \'\'}}">\n        <div class="knowledge-list-header-title">\n            知识库\n            <cos-tooltip\n                position="right"\n                content="{{knowledgeDescription}}"\n                bubble-class="knowledge-list-info-tooltip"\n            >\n                <cos-icon class="knowledge-list-info-tooltip-icon" name="info-circle" />\n            </cos-tooltip>\n        </div>\n        <cos-tooltip\n            position="right"\n            content="新建知识库"\n            bubble-class="knowledge-list-header-tooltip"\n        >\n          <cos-icon class="knowledge-list-header-tooltip-icon" name="plus" on-click="native:handleAddKnowledge"/>\n        </cos-tooltip>\n      </div>\n      <div class="knowledge-list-container">\n        <sk-loading\n          s-if="{{isLoading}}"\n          class="knowledge-list-loading"\n        />\n        <knowledge-list-item\n          s-else\n          s-for="item, index in knowledgeList"\n          item="{{item}}"\n          index="{{index}}"\n          on-itemClick="handleItemClick(item, index)"\n          on-knowledge-deleted="handleKnowledgeDeleted"\n        />\n      </div>\n    </div>\n  ';var Jc="CHAT_SEARCH_USED_GUIDE",Vc=[{type:"input-model"},{type:"input-panel-ai_ppt"},{type:"quick-entrance"}],Kc=function(){function t(){this.taskQueue=[],this.isProcessing=!1,this.currentTask=null,this.runFlag=!1,this.toolTipMap=ji(Vc),this.initLocalStorage()}var e=t.prototype;return e.initLocalStorage=function(){var t=localStorage.getItem(Jc);if(t)try{var e=JSON.parse(t);(null==e?void 0:e.selectModelGuide)&&this.setItem(Jc,JSON.stringify(Wc({},e,{"input-model":!0})))}catch(t){console.error("初始化本地存储失败:",t),this.setItem(Jc,JSON.stringify({}))}else this.setItem(Jc,JSON.stringify({}))},e.init=function(t){var e=t.type,n=this.toolTipMap.findIndex((function(t){return t.type===e}));n>-1&&( __set$(this.toolTipMap,n,Wc({},t,{init:!0})) ),this.toolTipMap.every((function(t){return t.init}))&&this.action()},e.getToolTipMap=function(){return this.toolTipMap},e.closeToolTip=function(t){var e;if((null==(e=this.currentTask)?void 0:e.type)===t){var n=this.currentTask,a=n.close,i=n.resolve,o=n.timeoutId;null==a||a(),null==i||i(),o&&clearTimeout(o)}},e.action=function(){if(!this.runFlag){this.runFlag=!0;for(var t,e=zc(this.toolTipMap);!(t=e()).done;){var n=t.value,a=n.type,i=(null==n?void 0:n.localStorageKey)||a;this.getLocalStorage(i)||this.taskQueue.push(n)}var o=this.taskQueue.shift();o&&this.processTask(o)}},e.getLocalStorage=function(t){try{var e=localStorage.getItem(Jc);return __get$(e?JSON.parse(e):{},t) }catch(t){return console.error("读取本地存储失败:",t),{}}},e.setLocalStorage=function(t){try{var e,n=localStorage.getItem(Jc),a=n?JSON.parse(n):{};this.setItem(Jc,JSON.stringify(Wc({},a,( __set$(e={},t,!0) ,e))))}catch(e){var i;console.error("设置本地存储失败:",e);var o=( __set$(i={},t,!0) ,i);this.setItem(Jc,JSON.stringify(o))}},e.setItem=function(t,e){try{var n="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(t,n)}catch(t){console.error("设置本地存储失败:",t)}},e.reset=function(){this.taskQueue=[],this.isProcessing=!1,this.currentTask=null},e.processNextTask=function(){var t=this;return Gc((function(){var e;return Qc(this,(function(n){switch(n.label){case 0:return t.isProcessing||0===t.taskQueue.length?[2]:(t.isProcessing=!0,(e=t.taskQueue.shift())?[4,t.processTask(e)]:[3,2]);case 1:n.sent(),n.label=2;case 2:return t.isProcessing=!1,t.processNextTask(),[2]}}))}))()},e.processTask=function(t){var e=this;return Gc((function(){var n,a,i,o,r,s;return Qc(this,(function(l){switch(l.label){case 0:n=t.type,a=t.close,i=t.open,o=t.autoCloseTime,l.label=1;case 1:return l.trys.push([1,3,,4]),i(),r=(null==t?void 0:t.localStorageKey)||n,e.setLocalStorage(r),[4,new Promise((function(n){var i=setTimeout((function(){a(),n()}),o||3e3);e.currentTask=Wc({},t,{timeoutId:i,resolve:n})}))];case 2:return l.sent(),[3,4];case 3:return s=l.sent(),console.error("处理ToolTip任务失败:",s),[3,4];case 4:return[2]}}))}))()},t}(),Xc=new Kc;function Yc(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Zc(t,e){return Zc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Zc(t,e)}function td(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var ed=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zc(t,e)}(e,t);var n=e.prototype;return n.initCurrentPage=function(){var t= __get$(window,"location") .pathname;this.handleUrlPathChange(t)},n.handleUrlPathChange=function(t){if(t)switch(t){case _e.CHAT.path:this.data.set("currentPage","main");break;case _e.SQUARE.path:this.data.set("currentPage","square");break;case _e.HISTORY.path:this.data.set("currentPage","history");break;default:this.data.set("currentPage","main")}},n.getSideData=function(){var t,e=this;return(t=function(){var t,n,a,i;return td(this,(function(o){switch(o.label){case 0:return[4,rs()];case 1:return t=o.sent(),n=t.appSquare,t.historyList,a=t.feedback,i=t.shortcut, __call$(e.data,"assign",[{appSquare:n,feedback:a,shortcut:i}]) ,[2]}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Yc(o,a,i,r,s,"next",t)}function s(t){Yc(o,a,i,r,s,"throw",t)}r(void 0)}))})()},n.created=function(){var t=this;this.getSideData().then((function(){t.initCurrentPage()})),Ea().on((function(){t.handleSquareClick()})),ma().on((function(t){var e=null==t?void 0:t.linkUrl,n=new URL(e);n.searchParams.delete("_chatSource");var a=As( __get$(n,"href") );window.open(a)})),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then((function(){}))},n.initData=function(){return{appSquare:null,currentPage:"main",lastIndex:-1,feedback:{},shortcut:null,showGuide:!1,deferredPrompt:null,installSuccessShow:!1,showGuideControl:!1}},n.attached=function(){var t=this;this.listenRouteChange(),this.initToolTip(),window.addEventListener("beforeinstallprompt",(function(e){t.data.set("deferredPrompt",e)}))},n.listenRouteChange=function(){var t=this;this.unListenRouteChange(),this.routeChange=function(e){t.handleUrlPathChange(e.path)},Dn.router.listen(this.routeChange)},n.unListenRouteChange=function(){this.routeChange&&Dn.router.unlisten(this.routeChange),this.routeChange=null},n.agentShowLog=function(t,e){return"square"===e?JSON.stringify({value:"agent_center_entrance"}):JSON.stringify({value:"agent_list",agent_id:t.agentId,agent_name:t.agentName,agent_pos:+t.sequence+1})},n.agentClickLog=function(t,e){return"square"===e?JSON.stringify({value:"agent_center_entrance"}):JSON.stringify({value:"agent_list",ubcExt:{agent_id:t.agentId,agent_name:t.agentName,agent_pos:+t.sequence+1}})},n.handleSquareClick=function(){if("square"!==this.data.get("currentPage")){ti.dispatch("update",{selectedItemId:"",selectedHistoryItemId:""});var t=this.data.get("appSquare");1==+t.jump_discovery_page&&t.pcSquareUrl?(this.data.set("currentPage","square"),function(t){Dn.router.push({path:_e.SQUARE.path,query:{appSquare:encodeURIComponent(JSON.stringify(t))}})}(t)):window.open(t.pcUrl,"_blank")}},n.handleMainClick=function(){"main"!==this.data.get("currentPage")&&(this.data.set("currentPage","main"),ii?Dn.router.push(ii):si({isShowHello:"1",extParams:JSON.stringify({enter_type:"sidebar_dialog"})}))},n.handleNewChatClick=function(){this.data.set("currentPage","main"),Ua({type:"click",value:"sidebar_dialog",page:"resultpage",ext:{re_rank:String(on.getState("rank"))}}),si({isShowHello:"1",extParams:JSON.stringify({enter_type:"sidebar_dialog"})})},n.initToolTip=function(){Xc.init({type:"quick-entrance",open:function(){this.data.set("showGuide",!0)}.bind(this),close:function(){this.data.set("showGuide",!1)}.bind(this)})},n.handleInstallChat=function(){var t=this,e=this.data.get("deferredPrompt");e&&(e.prompt(),e.userChoice.then((function(e){"accepted"===e.outcome&&(t.closeInstallGuideTip(),t.data.set("installSuccessShow",!0),setTimeout((function(){t.data.set("installSuccessShow",!1)}),5e3)),t.data.set("deferredPrompt",null)})))},n.handleInstallChatFromTip=function(){this.handleInstallChat(),Ua({type:"click",value:"add_desk_tips",page:"resultpage",ext:{setype:"csaitab",is_plugin:0}})},n.handleInstallPlugin=function(){window.open(this.data.get("shortcut").plugin.jumpUrl,"_blank")},n.handleFeedbackClick=function(){var t,e,n,a=on.getState("rank"),i=$c(a),o=on.getState("query"),r=Array.isArray(o)?null==(n=o[0])||null==(e=n.data)||null==(t=e.text)?void 0:t.query:"";Ua({type:"click",value:"cust_qrcode",ext:{setype:"csaitab",lid:on.getState("lid"),ori_lid:on.getState("oriLid"),sa:on.getState("oriSa"),re_rank:String(a),a_lid:on.getState("apagelid"),query:on.getState("query")||"",enter_type:on.getState("pcEnterType")||"ai_tab_url"}});var s=on.getState("queryIndustry"),l=on.getState("queryIntent"),c=on.getState("agentInfo").agentName,d="https://ufosdk.baidu.com/ufosdk/report/99gI0SpRFv2dCvY9eEbr1g%3D%3D/294248?question="+encodeURIComponent(r)+"&answer_url="+encodeURIComponent(i)+"&extend_is_znt="+(c?1:2)+"&extend_industry="+encodeURIComponent(s)+"&extend_intention="+encodeURIComponent(l);window.open(d,"_blank")},n.handleMouseEnter=function(){Ua({type:"show",value:"cust_qrcode",ext:{setype:"csaitab",enter_type:on.getState("pcEnterType")||"ai_tab_url",lid:on.getState("lid"),sa:on.getState("oriSa"),re_rank:String(on.getState("rank")),a_lid:on.getState("apagelid"),query:on.getState("query")||"",ori_lid:on.getState("oriLid"),title:this.data.get("feedback").guideTitle,content:this.data.get("feedback").guideWord}})},n.handleInstallGuideMouseEnter=function(){this.data.set("showGuideControl",!0)},n.handleInstallGuideMouseLeave=function(){var t=this;setTimeout((function(){t.closeInstallGuideTip()}),3e3)},n.closeInstallGuideTip=function(){this.data.set("showGuide",!1),this.data.set("showGuideControl",!1)},n.handleEntranceMouseEnter=function(){this.closeInstallGuideTip(),this.data.set("installSuccessShow",!1)},n.disposed=function(){this.unListenRouteChange()},e}(a.Component);function nd(t,e){return nd=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},nd(t,e)}ed.components={"cos-tooltip":e.Tooltip,"cos-icon":e.Icon,"cos-button":e.Button},ed.computed={ubcClickLog:function(){var t=this.data.get("lastIndex")===(this.data.get("historyListLength")||0)-1?"find_agent":"";return JSON.stringify({type:"click",value:"ai_helper_title",ubcExt:{enter_type:t}})},ubcShowLog:function(){return JSON.stringify({type:"show",value:"ai_helper"})},installDesktopShowLog:function(){return JSON.stringify({type:"show",value:"add_desk"})},installDesktopClickLog:function(){return JSON.stringify({type:"click",value:"add_desk"})},installPluginShowLog:function(){return JSON.stringify({type:"show",value:"add_plugin"})},installPluginClickLog:function(){return JSON.stringify({type:"click",value:"add_plugin"})},installDesktopTipShowLog:function(){return JSON.stringify({type:"show",value:"add_desk_tips"})},installDesktopSuccessShowLog:function(){return JSON.stringify({type:"show",value:"add_desk_success"})},historyBtnShowLog:function(){return JSON.stringify({value:"his_dialog"})},installGuideShow:function(){return this.data.get("showGuide")&&this.data.get("deferredPrompt")||this.data.get("showGuideControl")},installDesktopShow:function(){return!!this.data.get("deferredPrompt")}},ed.template='\n      <div class="chat-left-bar">\n        \x3c!-- 智能体广场按钮 --\x3e\n        <div\n          s-if="{{appSquare}}"\n          class="\n            agent-item\n            agent-tool-item\n            {{currentPage === \'square\' ? \'agent-item-active\' : \'\'}}\n          "\n        >\n          <div\n              class="agent-tool-item-icon-wrapper"\n              s-ref="agent-square"\n              need-click-log\n              data-click-log="{{agentClickLog(item, \'square\')}}"\n              data-show-ext="{{agentShowLog(item, \'square\')}}"\n              data-show-area\n              on-click="handleSquareClick(appSquare)"\n          >\n              <div class="agent-tool-item-icon-content">\n                <cos-icon name="dqa"/>\n              </div>\n              <span>智能体</span>\n          </div>\n        </div>\n\n        \x3c!-- 反馈hover按钮 --\x3e\n        <div\n            class="agent-item agent-tool-item feedback-hover-show"\n            on-mouseenter="handleMouseEnter"\n            on-mouseleave="handleMouseLeave"\n        >\n            <div class="agent-tool-item-icon-wrapper">\n              <div class="agent-tool-item-icon-content">\n                <cos-icon name="suggestion"/>\n              </div>\n              <span>反馈</span>\n            </div>\n            <div class="agent-tool-feedback-group-wrapper">\n                <div class="agent-tool-feedback-group">\n                    <div class="agent-tool-feedback-group-title">{{ feedback.guideTitle }}</div>\n                    <div class="agent-tool-feedback-group-subtitle">\n                      {{ feedback.guideWord }}\n                    </div>\n                    <div class="agent-tool-feedback-group-img">\n                        <img class="agent-tool-feedback-group-img-qrcode" src="{{feedback.wxCode}}" />\n                        <img\n                            class="agent-tool-feedback-group-img-wx"\n                            src="https://gips0.baidu.com/it/u=3991094743,1489192704&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f67_67"\n                        />\n                    </div>\n                    <div class="agent-tool-feedback-group-text" on-click="handleFeedbackClick">\n                        <span class="agent-tool-feedback-group-text-feedback">意见反馈</span>\n                        <div class="agent-tool-feedback-group-text-icon"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- 快捷入口 --\x3e\n        <div \n            class="agent-item agent-tool-item quick-entrance-hover-show" \n            s-if="{{shortcut}}" \n            on-mouseenter="handleEntranceMouseEnter"\n        >\n            <div \n              class="quick-entrance-tooltip-wrapper\n                {{\'quick-entrance-tooltip-wrapper\' + (installDesktopShow ? \'\' : \'-not-install\')}}\n                {{installSuccessShow \n                  ? \'quick-entrance-tooltip-wrapper-not-show\' \n                  : \'\'}}\n              "\n            >\n              <div class="quick-entrance-tooltip-content">\n                  <p\n                    on-click="handleInstallChat"\n                    data-click-log="{{installDesktopClickLog}}"\n                    need-click-log\n                    data-show-ext="{{installDesktopShowLog}}"\n                    data-show-area\n                  >\n                    <img\n                        src="https://gips2.baidu.com/it/u=1783332912,1715332304&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f54_54"\n                        alt="{{shortcut.desktop.hoverText}}"\n                    />\n                    {{ shortcut.desktop.hoverText }}\n                  </p>\n                  <div class="cos-divider quick-entrance-divider"></div>\n                  <p\n                    on-click="handleInstallPlugin"\n                    data-show-ext="{{installPluginShowLog}}"\n                    data-show-area\n                    data-click-log="{{installPluginClickLog}}"\n                    need-click-log\n                  >\n                    <img\n                        src="https://gips1.baidu.com/it/u=2560855318,313272763&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f54_54"\n                        alt="{{shortcut.plugin.hoverText}}"\n                    />\n                    {{ shortcut.plugin.hoverText }}\n                  </p>\n              </div>\n            </div>\n            <cos-tooltip\n                position="right"\n                bubbleClass="quick-entrance-guide-tooltip"\n                trigger="custom"\n                open="{{installGuideShow}}"\n            >\n                <div\n                    slot="content"\n                    class="quick-entrance-guide-tooltip-content"\n                    data-show-area\n                    data-show-ext="{{installDesktopTipShowLog}}"\n                    on-mouseenter="handleInstallGuideMouseEnter"\n                    on-mouseleave="handleInstallGuideMouseLeave"\n                >\n                    {{ shortcut.desktop.tipsText }}\n                    <cos-button\n                        size="sm"\n                        appearance="plain"\n                        class="quick-entrance-add-btn"\n                        on-click="handleInstallChatFromTip"\n                    >\n                        添加\n                    </cos-button>\n                </div>\n                <div class="agent-tool-item-icon-wrapper">\n                    <div class="agent-tool-item-icon-content">\n                      <cos-icon name="quick-entry"/>\n                    </div>\n                    <span>快捷入口</span>\n                </div>\n            </cos-tooltip>\n            <div\n                s-if="{{installSuccessShow}}"\n                class="quick-entrance-install-success"\n                data-show-ext="{{installDesktopSuccessShowLog}}"\n                data-show-area\n                style="{{\'background-image: url(\' + shortcut.desktop.installBg + \')\'}}"\n            >\n              <span>\n                  {{ shortcut.desktop.installText }}\n              </span>\n            </div>\n        <div/>\n      <div/>\n    ';var ad=function(t){function e(){return t.apply(this,Array.from(arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nd(t,e)}(e,t),e.prototype.handleScroll=function(){Ha().emit({updateType:"popoverStatus"})},e}(a.Component);function id(t,e){return id=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},id(t,e)}ad.template='\n    <div \n      class="aside-scroll-container" \n      on-scroll="handleScroll"\n    >\n      <slot />\n    </div>\n  ';var od=function(t){function e(){return t.apply(this,Array.from(arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&id(t,e)}(e,t),e.prototype.attached=function(){var t={container:this.el.children[0],renderer:"svg",loop:!0,autoplay:!0,path:"https://psstatic.cdn.bcebos.com/basics/aichat/knowledge_loading_1746599336000.json"};s.loadAnimation(t)},e}(a.Component);od.template='\n        <div class="create-knowledge-mask">\n            <div class="create-knowledge-loading"></div>\n            <div class="create-knowledge-label">知识库创建中...</div>\n        </div>\n    ';var rd=Tt.connect(on,{showWorkspaceType:"showWorkspaceType"})(a.defineComponent({trimWhitespace:"all",components:{"knowledge-area":Hc,"new-dialog":Pc,"bottom-list":ed,"history-area":Ic,"aside-scroll":ad,"cos-icon":e.Icon,"cos-tooltip":e.Tooltip,"create-mask":od},template:'\n            <div class="chat-aside-wrapper {{isFolded || isAsideFloat ? \'folded\' : \'\'}}">\n                <div\n                    s-show="!isFolded"\n                    s-ref="asideContent"\n                    class="{{isAsideFloat ? \'chat-aside-float\' : \'chat-aside\'}}"\n                >\n                    <div class="chat-aside-header">\n                        <div class="chat-aside-header-title">\n                            <div class="chat-aside-header-title-left">\n                                <img\n                                    src="{{asideLogoUrl}}"\n                                    class="chat-aside-header-title-left-logo"\n                                />\n                                <span class="chat-aside-header-title-left-text">百度AI</span>\n                            </div>\n                            <cos-tooltip\n                                s-if="!isFolded"\n                                s-ref="foldedTooltip"\n                                position="right"\n                                content="收起"\n                            >\n                                <cos-icon\n                                    s-if="!isFolded"\n                                    attr-data-show-area\n                                    attr-data-show-ext="{{foldShowLogParams}}"\n                                    name="stowed-panel"\n                                    on-click="native:toggleAside"\n                                    class="chat-aside-header-title-icon {{isFolded ? \'folded\' : \'\'}}"\n                                />\n                            </cos-tooltip>\n                        </div>\n                        <new-dialog\n                            in-sider-bar="true"\n                            class="chat-aside-header-new-dialog"\n                        />\n                    </div>\n                    <aside-scroll class="chat-aside-scroll">\n                        <div class="chat-aside-scroll-content">\n                            <knowledge-area\n                                on-knowledgeListLoaded="handleKnowledgeListLoaded"\n                                on-create-state-update="toggleShowCreateMask"\n                            />\n                            <history-area on-historyListLoaded="handleHistoryListLoaded"/>\n                        </div>\n                    </aside-scroll>\n                    <bottom-list class="chat-aside-bottom"/>\n                </div>\n                <div s-if="isFolded" class="chat-aside-wrapper-icon-container">\n                    <cos-tooltip position="right" content="展开">\n                        <span data-show-area data-show-ext="{{foldShowLogParams}}">\n                            <cos-icon\n                                name="expand-panel"\n                                on-click="native:toggleAside"\n                                class="chat-aside-wrapper-icon {{isFolded ? \'folded\' : \'\'}}"\n                            />\n                        </span>\n                    </cos-tooltip>\n                    <new-dialog is-show-only="{{true}}" class="chat-aside-wrapper-icon chat-aside-wrapper-dialog"/>\n                </div>\n                <create-mask s-if="showCreateMask" />\n            </div>\n        ',computed:{isAsideFloat:function(){return"editor"===this.data.get("showWorkspaceType")||"wenku"===this.data.get("showWorkspaceType")||this.data.get("isNarrowViewport")}},initData:function(){var t=!1;return t="true"===localStorage.getItem("chat_aside_folded"),"editor"===on.getState("showWorkspaceType")&&(t=!0),{isFolded:t,isNarrowViewport:!1,historyList:[],pn:0,currentPage:"main",asideLogoUrl:"https://gips0.baidu.com/it/u=1125504705,2263448440&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f72_72",knowledgeTotal:0,knowledgeContent:[],historyDialogNum:0,knowledgeLoaded:!1,historyLoaded:!1,logSent:!1,openType:"refresh",foldShowLogParams:JSON.stringify({type:"show",value:"catalogue_open"}),showCreateMask:!1}},attached:function(){var t=this;this.listenRouteChange(),this.watch("showWorkspaceType",(function(e){"editor"!==e&&"wenku"!==e||t.data.get("isFolded")||(t.data.set("isFolded",!0),localStorage.setItem("chat_aside_folded","true"))})),document.addEventListener("click",this.handleDocumentClick.bind(this)),this.initIntersectionObserver()},initIntersectionObserver:function(){var t=this;this.checkViewportWidth=function(){var e=window.innerWidth;t.nextTick((function(){var n,a=null==(n=document.querySelector(".chat-container-main-area"))?void 0:n.offsetWidth;if(a){var i=e<a;t.data.set("isNarrowViewport",i),i&&!t.data.get("isFolded")&&t.data.set("isFolded",!0)}}))},this.checkViewportWidth(),window.addEventListener("resize",this.checkViewportWidth)},detached:function(){this.unListenRouteChange(),document.removeEventListener("click",this.handleDocumentClick.bind(this)),this.checkViewportWidth&&(window.removeEventListener("resize",this.checkViewportWidth),this.checkViewportWidth=null)},handleDocumentClick:function(t){if(this.data.get("isAsideFloat")&&!this.data.get("isFolded")){var e=this.ref("asideContent"),n=this.el.querySelector(".chat-aside-wrapper-icon-container");!e||e.contains(t.target)||n&&n.contains(t.target)||(this.data.set("isFolded",!0),localStorage.setItem("chat_aside_folded","true"))}},routeChange:null,listenRouteChange:function(){var t=this;this.unListenRouteChange(),this.routeChange=function(e){t.handleUrlPathChange(e.path)},Dn.router.listen(this.routeChange)},handleUrlPathChange:function(t){if(t)switch(t){case _e.CHAT.path:this.data.set("currentPage","main");break;case _e.SQUARE.path:this.data.set("currentPage","square");break;case _e.HISTORY.path:this.data.set("currentPage","history");break;default:this.data.set("currentPage","main")}},unListenRouteChange:function(){this.routeChange&&Dn.router.unlisten(this.routeChange),this.routeChange=null},toggleAside:function(){var t=this.data.get("isFolded"),e=!t;this.data.set("isFolded",e),localStorage.setItem("chat_aside_folded",String(e)),t&&!e&&(this.data.set("openType","open"),this.data.set("logSent",!1),this.sendLog()),Ua({type:"click",value:"catalogue_"+(t?"open":"close")})},handleKnowledgeListLoaded:function(t){var e=t.total,n=t.list;this.data.set("knowledgeTotal",e),this.data.set("knowledgeContent",n),this.data.set("knowledgeLoaded",!0),this.sendLog()},handleHistoryListLoaded:function(t){var e=t.total;this.data.set("historyDialogNum",e),this.data.set("historyLoaded",!0),this.sendLog()},sendLog:function(){this.data.get("logSent")||this.data.get("knowledgeLoaded")&&this.data.get("historyLoaded")&&(Ua({type:"show",value:"catalogue",ext:{open_type:this.data.get("openType"),zsk_total_num:this.data.get("knowledgeTotal"),zsk_content:this.data.get("knowledgeContent"),his_dialog_num:this.data.get("historyDialogNum")}}),this.data.set("logSent",!0))},toggleShowCreateMask:function(t){this.data.set("showCreateMask",t)}}));function sd(){return sd=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},sd.apply(this,Array.from(arguments))}var ld=Tt.connect(on,{query:"query",userInfo:"user"})(a.defineComponent({trimWhitespace:"all",template:'\n        <div class="chat-container-header" need-click-log>\n            <a\n                href=\'//www.baidu.com\'\n                target="_self"\n                class="chat-header-logo"\n                data-click-log="{{getOtherLogInfo(\'baidu_logo\')}}"\n            >\n                <img\n                    class="index-logo-srcnew"\n                    src="//www.baidu.com/img/flexible/logo/pc/result@2.png"\n                    alt="到百度首页"\n                    title="到百度首页"\n                >\n            </a>\n           <div class="chat-header-tab">\n                <a\n                    s-for="item, index in tabList"\n                    href="{{item.realUrl || item.orig_link}}"\n                    target="_self"\n                    class="\n                        chat-header-tab-item\n                        {{!item.tabImgUrl ? \'chat-header-tab-\' + item.log : \'\'}}\n                    "\n                    data-click-log="{{getTabLogInfo(item.log)}}"\n                >\n                    <img s-if="item.tabImgUrl" src="{{item.tabImgUrl}}" class="header-tab-image" />\n                    <span s-else>{{item.text}}</span>\n\n                    \x3c!-- 底部线条 --\x3e\n                    <div s-if="{{item.log === \'csaitab\'}}"\n                        class="{{[\'bottom-line\', getBottomLineClass(aiTabSample)]}}"\n                    ></div>\n                </a>\n            </div>\n            <div class="chat-header-nav" data-show-area>\n                <a\n                    class="chat-header-nav-item"\n                    href="//www.baidu.com"\n                    target="_self"\n                    data-click-log="{{getOtherLogInfo(\'baidu_home\')}}"\n                >\n                    百度首页\n                </a>\n                <div\n                    s-if="userInfo.isUserLogin"\n                    class="user-mask"\n                    on-mouseenter="handleShowLogInfo"\n                >\n                    <div class="user-info">\n                        <div class="avatar">\n                            <cos-avatar\n                                class="avatar-content"\n                                src="{{userInfo.headImg}}"\n                                size="sm"\n                            />\n                        </div>\n                        <span class="cos-line-clamp-1">{{userInfo.name}}</span>\n                    </div>\n                    <div\n                        class="user-menu"\n                    >\n                        <div class="user-menu-content">\n                            <a\n                                href="//www.baidu.com/my/index"\n                                target="_self"\n                                class="user-menu-item cos-link"\n                                data-click-log="{{getMenuLogInfo(\'tjucent\')}}"\n                            >个人中心</a>\n                            <a\n                                href="//passport.baidu.com"\n                                target="_self"\n                                class="user-menu-item cos-link"\n                                data-click-log="{{getMenuLogInfo(\'tjuser\')}}"\n                            >账号设置</a>\n                            <div\n                                class="user-menu-item cos-link"\n                                data-click-log="{{getMenuLogInfo(\'tjlogout\')}}"\n                                on-click="handleLogout"\n                            >退出登录</div>\n                        </div>\n                    </div>\n                </div>\n                <div s-else class="login-btn">\n                    <div\n                        on-click="handleLogin"\n                        data-click-log="{{getOtherLogInfo(\'login_button\')}}"\n                        data-show-ext="{{getOtherLogInfo(\'login_button\')}}"\n                    >登录</div>\n                </div>\n            </div>\n        </div>\n    ',components:{"cos-avatar":e.Avatar},initData:function(){var t,e;return{tabList:on.getState("tabList"),userInfo:on.getState("user"),sample:on.getState("sample"),aiTabSample:null==(e=on.getState("sample"))||null==(t=e.variables)?void 0:t.PC_INDEX_EXP,aiTabImages:{AsstOne:"https://gips1.baidu.com/it/u=2324779682,4137008596&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f147_42",AsstThree:"https://gips3.baidu.com/it/u=1372663774,1923026649&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f105_42",AsstFour:"https://gips2.baidu.com/it/u=758713753,2013802961&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f147_42"}}},attached:function(){var t=this,e=_t(this.data.get("query")||"");this.changeTabListLink(e||""),this.watch("query",(function(e){var n=_t(e);t.changeTabListLink(n)})),this.watch("userInfo",(function(e){t.data.set("userInfo",e)}))},getTabLogInfo:function(t){return JSON.stringify({value:"tab",ubcExt:{goal_tab:t}})},getOtherLogInfo:function(t){return JSON.stringify({value:t})},handleShowLogInfo:function(){Ua({type:"show",value:"head_icon_pop"})},getMenuLogInfo:function(t){return JSON.stringify({value:"head_icon_pop",ubcExt:{module:t}})},getBottomLineClass:function(t){return"AsstOne"===t||"AsstFour"===t?"bottom-line-long":"AsstThree"===t?"bottom-line-short":""},changeTabListLink:function(t){var e=this.data.get("tabList")||[];try{var n=e.filter((function(t){return t.orig_link})).map((function(e){return sd({},e,{realUrl: __call$(e.orig_link,"replace",[/_QUERY_/g,t]) ||""})}));this.data.set("tabList",n)}catch(t){}},handleLogin:function(){this.fire("login")},handleLogout:function(){!function(){if(vt())fetch("https://passport.baidu.com/?logout&u=https://chat.baidu.com",{mode:"cors"}).catch((function(){})).then((function(){on.dispatch("update",{user:{isUserLogin:!1}})}));else{var t= __get$(__get$(window,"location"),"href") ; __set$(__get$(window,"location"),"href","https://passport.baidu.com/?logout&u="+encodeURIComponent(t)) }}()}}));function cd(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function dd(){return dd=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},dd.apply(this,Array.from(arguments))}function ud(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var pd=Tt.connect(on,{topRank:"topRank"})(a.defineComponent({components:{},initData:function(){return{agentSugList:[],textSugList:[],type:"agent",showSug:!1}},computed:{sugList:function(){return"agent"===this.data.get("type")?this.data.get("agentSugList"):this.data.get("textSugList")}},created:function(){this.getSugList=Ki(this.getSugList.bind(this),300)},attached:function(){},clickSug:function(t){this.dispatch("sug-click",dd({},t,{type:this.data.get("type")})),this.closeSug()},openSug:function(t){var e=this;void 0===t&&(t="common"),this.data.set("type",t),!this.data.get("showSug")&&this.nextTick((function(){e.data.set("showSug",!0)}))},closeSug:function(){this.data.set("showSug",!1),this.data.set("textSugList",[]),this.data.set("agentSugList",[])},updateSug:function(t){},getSugList:function(t,e){return(n=function(){var n;return ud(this,(function(a){switch(a.label){case 0:return n=this,t||"common"!=e?(on.getState("chatParams"),[4,Li(on.getState("chatParams").sse_host+"/aichat/api/aitabserver?ctl=sug&action="+e+"&tk="+sc(t)+"&query="+t+"&lid="+(on.getState("lid")||"")+"&ori_lid="+(on.getState("oriLid")||""),{credentials:"include"},2e3).then((function(t){if(1003===t.status&&n.closeSug(),0!==t.status||!t.data)return Promise.reject();"common"===e?n.data.set("textSugList",t.data.common_sugs):"agent"===e&&n.data.set("agentSugList",t.data.agent_input_sugs)})).catch((function(t){}))]):(this.closeSug(),[2]);case 1:return a.sent(),[2]}}))},function(){var t=this,e=Array.from(arguments);return new Promise((function(a,i){var o=n.apply(t,e);function r(t){cd(o,a,i,r,s,"next",t)}function s(t){cd(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var n}})),hd={};hd= __call$(Object,"assign",[hd,{sugWarp:"sug-warp_1mqhe_1","sug-warp":"sug-warp_1mqhe_1",sugContainer:"sug-container_1mqhe_5","sug-container":"sug-container_1mqhe_5",sugList:"sug-list_1mqhe_18","sug-list":"sug-list_1mqhe_18",sugTitle:"sug-title_1mqhe_24","sug-title":"sug-title_1mqhe_24",textSugItem:"text-sug-item_1mqhe_31","text-sug-item":"text-sug-item_1mqhe_31",agentSugItem:"agent-sug-item_1mqhe_48","agent-sug-item":"agent-sug-item_1mqhe_48",avatar:"avatar_1mqhe_61",right:"right_1mqhe_70",top:"top_1mqhe_76",name:"name_1mqhe_81",tag:"tag_1mqhe_90",description:"description_1mqhe_100"}]) ,pd.template='\n    <div class="{{$style[\'sug-warp\']}}">\n        <div s-show="{{\n            showSug\n            && (\n                type === \'agent\' && agentSugList.length \n                || type === \'common\' && textSugList.length\n            )\n            }}" class="{{$style[\'sug-container\']}}"\n        >\n            <div class="{{$style[\'sug-list\']}}">\n                <div s-if="{{type === \'agent\'}}" class="{{$style[\'sug-title\']}}">选择智能体</div>\n                <fragment s-for="item, index in sugList">\n                    <div\n                        s-if="{{type === \'common\'}}"\n                        class="{{$style[\'text-sug-item\']}}"\n                        on-click="clickSug(item)"\n                    >\n                        {{item.word}}\n                    </div>\n                    <div s-else class="{{$style[\'agent-sug-item\']}}" on-click="clickSug(item)">\n                        <img\n                            class="{{$style[\'avatar\']}}"\n                            src="{{item.logo}}"\n                            size="md"\n                        />\n                        <div class="{{$style[\'right\']}}">\n                            <div class="{{$style[\'top\']}}">\n                                <div class="{{$style[\'name\']}} c-fwb">\n                                    <div class="cos-line-clamp-1">\n                                        {{item.source_name}}\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="{{$style[\'description\']}} cos-line-clamp-1">{{item.description}}</div>\n                        </div>\n                    </div>\n                </fragment>\n            </div>\n        </div>\n    </div>\n';var fd="function"==typeof pd?pd.prototype.initData||gd:pd.initData||gd;function gd(){return{$style:hd}}function md(){return  __call$(Object,"assign",[{},fd.call(this),{$style:hd}]) }function vd(){return vd=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},vd.apply(this,Array.from(arguments))}function yd(){var t=document.getElementById("chat-input-box");t&&(t.focus(),requestAnimationFrame((function(){var e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),n.collapse(!1),e.removeAllRanges(),e.addRange(n)})))}function wd(t){for(var e=[],n=0;n<t.length;n+=4)e.push(t.slice(n,n+4));return e}function bd(t,e){try{fetch(t).then((function(t){return t.text()})).then((function(t){e&&(e.innerHTML=t)})).catch((function(t){console.error("获取prompt-optimize按钮失败",t)}))}catch(t){}}"function"==typeof pd?pd.prototype.initData=md:pd.initData=md;var _d=a.defineComponent({template:'\n        <div class="input-panel-header {{title ? \'\' : \'input-panel-header-no-title\'}}">\n            <div s-if="title" class="input-panel-header-title">{{title}}</div>\n            <cos-icon on-click="native:handleClose" class="input-panel-header-close" name="close" />\n        </div>\n    ',components:{"cos-icon":e.Icon},initData:function(){return{title:""}},handleClose:function(){this.dispatch("ui:input-panel-header-close"),this.fire("close")}}),kd=a.defineComponent({template:'\n        <div s-ref="creatItem" class="input-panel-creat-item {{selected ? \'input-panel-creat-item-selected\' : \'\'}}">\n            <img class="input-panel-creat-item-icon" src="{{data.icon}}" />\n            <div class="input-panel-creat-item-title cos-line-clamp-1">{{data.text}}</div>\n            <div class="input-panel-creat-item-desc cos-line-clamp-1">\n                <img class="input-panel-creat-item-logo" s-if="data.descIcon" src="{{data.descIcon}}" />\n                {{data.desc}}\n            </div>\n        </div>\n    ',initData:function(){return{data:{},selected:!1,order:-1}},attached:function(){this.observer()},observer:function(){var t=this,e=this.el,n=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){var n=t.data.get("data"),a=t.data.get("order");n.order=a,t.dispatch("ui:input-panel-creat-item-show",n)}}))}),{root:null,threshold:.6});e&&n.observe(e)}});function Sd(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function xd(){return xd=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},xd.apply(this,Array.from(arguments))}function Id(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Sd(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sd(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Td=a.defineComponent({template:'\n        <div class="input-panel-creat">\n            <header\n                title="{{title}}"\n                on-close="handleClose"\n            />\n\n            <div class="input-panel-creat-tab">\n                <cos-swiper s-ref="swiper" spaceBetween="{{8}}">\n                    <cos-swiper-item\n                        s-for="item in tabList"\n                    >\n                        <div\n                            class="input-panel-creat-tab-item\n                                {{selectedTab === item.tabId ? \'input-panel-creat-tab-item-selected\' : \'\'}}\n                            "\n                            on-click="handleTabClick(item.tabId)"\n                        >\n                            {{item.tabName}}\n                        </div>\n                    </cos-swiper-item>\n                </cos-swiper>\n            </div>\n\n            <div class="input-panel-creat-content">\n                <div\n                    s-for="itemList, index in showContentList"\n                    class="input-panel-creat-content-list"\n                >\n                    <creae-item\n                        s-for="item, itemIndex in itemList"\n                        data="{{item}}"\n                        order="{{index * 4 + itemIndex}}"\n                        selected="{{selectedBtn === item.buttonId}}"\n                        on-click="native:handleItemClick(item, index * 4 + itemIndex)"\n                        class="input-panel-creat-content-list-item"\n                    />\n                </div>\n            </div>\n        </div>\n    ',components:{"creae-item":kd,header:_d,"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem},initData:function(){return{data:{},selectedTab:"all",selectedBtn:"",showBtnList:[],triggerType:""}},messages:{"ui:input-panel-creat-item-show":function(t){this.collectShowBtn(t.value)}},computed:{title:function(){return this.data.get("data.jumpPanel.data.officeCreate.title")||""},tabList:function(){var t=this.data.get("data.jumpPanel.data.officeCreate.tabList")||[],e=[].concat(t);return e.unshift({tabId:"all",tabName:"全部"}),e},showContentList:function(){var t=this.data.get("selectedTab"),e=this.data.get("data.jumpPanel.data.officeCreate.list")||[];return wd("all"===t?e:e.filter((function(e){return(null==e?void 0:e.tabId)===t})))}},attached:function(){var t=this;this.nextTick((function(){var e;null==(e=t.ref("swiper"))||e.updatedWidth()})),this.watch("selectedTab",(function(e,n){var a=n.oldValue;t.sendShowLog(a)}))},detached:function(){this.sendShowLog()},handleTabClick:function(t){this.data.get("selectedTab")!==t&&this.data.set("selectedTab",t)},handleItemClick:function(t,e){this.data.set("selectedBtn",t.buttonId);var n=(null==t?void 0:t.function)||{};if("input"===n.type){var a,i=(null==(a=n.data)?void 0:a.input)||{},o=null==i?void 0:i.interactionType;Aa().emit({sa:"functab_office_"+Xa(null==t?void 0:t.buttonId)}),zn().emit(xd({agentInfo:i.agentInfo,inputCustom:null==i?void 0:i.inputCustom},o?{interactionType:o}:{}))}this.sendClickLog(t,e)},getBtnLogData:function(t,e){var n={function_click_type:"text",function_name:t.buttonId,function_pos:String((null!=e?e:t.order)+1)};return t.agentInfo&&(n.agent_id=t.agentInfo.agentId,n.agent_name=t.agentInfo.agentName),n},sendClickLog:function(t,e){var n=this.data.get("selectedTab"),a=this.data.get("triggerType");Ua({ubcId:"17132",type:"click",value:"function_panel",ext:{setype:"csaitab",function_type:"text",function_tab:n,valueInfo:[this.getBtnLogData(t,e)],trigger_type:a}})},collectShowBtn:function(t){for(var e,n=Id(this.data.get("showBtnList"));!(e=n()).done;){if(e.value.buttonId===t.buttonId)return}this.data.push("showBtnList",t)},sendShowLog:function(t){var e=this,n=this.data.get("showBtnList"),a=[],i=this.data.get("selectedTab");n.forEach((function(t){a.push(e.getBtnLogData(t))})),this.data.set("showBtnList",[]);var o=this.data.get("triggerType");Ua({ubcId:"17132",type:"show",value:"function_panel",ext:{setype:"csaitab",function_type:"text",function_tab:t||i,valueInfo:a,trigger_type:o}})}}),Cd=a.defineComponent({template:'\n        <div class="input-panel-draw-item" on-click="handleBtnClick">\n            <img class="input-panel-draw-item-img" src="{{data.icon}}" />\n            <div class="input-panel-draw-item-text cos-line-clamp-1">{{desc}}</div>\n            <div class="input-panel-draw-item-mark"></div>\n            <div class="input-panel-draw-item-btn">\n                <img class="input-panel-draw-item-btn-icon" src="{{editIcon}}" />\n                <span class="input-panel-draw-item-btn-text">画同款</span>\n            </div>\n        </div>\n    ',computed:{desc:function(){var t=this.data.get("data.text"),e=this.data.get("data.agentInfo");return(null==e?void 0:e.agentName)?"@"+e.agentName:t}},initData:function(){return{data:{},editIcon:"https://gips0.baidu.com/it/u=4283482391,4095503797&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f43_43",order:-1}},attached:function(){this.observer()},handleBtnClick:function(){this.fire("btn-click")},observer:function(){var t=this,e=this.el,n=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){var n=t.data.get("data"),a=t.data.get("order");n.order=a,t.dispatch("ui:input-panel-draw-item-show",n)}}))}),{root:null,threshold:.6});e&&n.observe(e)}});function Ld(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Dd(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ld(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ld(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Pd="CHAT_SEARCH_DRAW_ITEM_SHUFFLE",Ed="CHAT_SEARCH_DRAW_ITEM_SHUFFLE_TIME",Ad=a.defineComponent({template:'\n        <div class="input-panel-draw">\n            <header title="{{title}}"></header>\n            <div class="cos-divider cos-space-mt-md input-panel-draw-divider"></div>\n\n            <div class="input-panel-draw-tools">\n                <div class="input-panel-draw-tools-title">{{toolsData.title}}</div>\n                <cos-swiper class="input-panel-draw-tools-list" spaceBetween="9">\n                    <cos-swiper-item\n                        s-for="item, index in toolsData.list"\n                        class="input-panel-draw-tools-list-item"\n                        on-click="native:handleToolsBtnClick(item, index)"\n                    >\n                        <img class="input-panel-draw-tools-list-item-icon" src="{{item.icon}}" />\n                        {{item.text}}\n                    </cos-swiper-item>\n                </cos-swiper>\n            </div>\n\n            <div class="input-panel-draw-content">\n                <div class="input-panel-draw-content-title">{{contentTitle}}</div>\n                <div class="input-panel-draw-content-list">\n                    <div\n                        s-for="itemList, index in showContentList"\n                        class="input-panel-draw-content-list-item"\n                    >\n                        <fragment s-for="item, itemIndex in itemList">\n                            <div s-if="itemIndex !== 0" class="input-panel-draw-content-list-item-space"></div>\n                            <draw-item\n                                class="input-panel-draw-content-list-item-btn"\n                                data="{{item}}"\n                                order="{{index * 4 + itemIndex}}"\n                                on-btn-click="handleDrawBtnClick(item, index * 4 + itemIndex)"\n                            />\n                        </fragment>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',components:{header:_d,"draw-item":Cd,"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem},messages:{"ui:input-panel-draw-item-show":function(t){this.collectShowBtn(t.value)}},computed:{title:function(){return this.data.get("data.jumpPanel.data.photoEditing.title")||""},toolsData:function(){return this.data.get("data.jumpPanel.data.photoEditing.tools")||[]},contentTitle:function(){return this.data.get("data.jumpPanel.data.photoEditing.sameStyle.title")||""}},initData:function(){return{triggerType:"",showBtnList:[],showContentList:[[]]}},attached:function(){this.data.set("showContentList",this.getRandomContentList())},detached:function(){this.sendShowLog(),this.data.set("showContentList",this.getRandomContentList())},getRandomContentList:function(){var t=[],e=0;try{t=JSON.parse(window.localStorage.getItem(Pd)||"[]"),e=Number(window.localStorage.getItem(Ed)||0)}catch(n){t=[],e=0}var n=wd(this.data.get("data.jumpPanel.data.photoEditing.sameStyle.list")||[]);(!e||t.length!==n.length||za(e)>0)&&(t=function(t){if(!Te(t))return[];for(var e=t.slice(),n=e.length-1;n>0;n--){var a,i=Math.floor(Math.random()*(n+1));a=[ __get$(e,i) , __get$(e,n) ], __set$(e,n,a[0]) , __set$(e,i,a[1]) }return e}(Array.from({length:n.length},(function(t,e){return e}))),window.localStorage.setItem(Pd,JSON.stringify(t)),window.localStorage.setItem(Ed,String(+new Date)));var a=[];return t.forEach((function(t,e){ __set$(a,t,__get$(n,e)) })),a},handleToolsBtnClick:function(t,e){var n,a,i=(null==t?void 0:t.function)||{};"link"===i.type&&(this.sendClickLog(t,e),window.open(null==(a=i.data)||null==(n=a.link)?void 0:n.url))},handleDrawBtnClick:function(t,e){var n,a,i=(null==t?void 0:t.function)||{};"input"===i.type&&(Aa().emit({sa:"functab_pic_"+Xa(null==t?void 0:t.buttonId)}),zn().emit({inputCustom:null==(a=i.data)||null==(n=a.input)?void 0:n.inputCustom}));this.sendClickLog(t,e)},getBtnLogData:function(t,e){var n,a={function_click_type:"link"===(null==t||null==(n=t.function)?void 0:n.type)?"click":"text",function_name:t.buttonId,function_pos:String((null!=e?e:t.order)+1)};return t.agentInfo&&(a.agent_id=t.agentInfo.agentId,a.agent_name=t.agentInfo.agentName),a},sendClickLog:function(t,e){var n=this.data.get("triggerType");Ua({ubcId:"17132",type:"click",value:"function_panel",ext:{setype:"csaitab",function_type:"pic",function_tab:"all",valueInfo:[this.getBtnLogData(t,e)],trigger_type:n}})},collectShowBtn:function(t){for(var e,n=Dd(this.data.get("showBtnList"));!(e=n()).done;){if(e.value.buttonId===t.buttonId)return}this.data.push("showBtnList",t)},sendShowLog:function(){var t=this,e=this.data.get("showBtnList"),n=this.data.get("toolsData"),a=[];e.forEach((function(e){a.push(t.getBtnLogData(e))})),n.list.forEach((function(e,n){a.push(t.getBtnLogData(e,n))})),this.data.set("showBtnList",[]);var i=this.data.get("triggerType");Ua({ubcId:"17132",type:"show",value:"function_panel",ext:{setype:"csaitab",function_type:"pic",function_tab:"all",valueInfo:a,trigger_type:i}})}}),Od=a.defineComponent({template:'\n        <div class="input-panel-read">\n            <header title="{{title}}" />\n\n            <div class="input-panel-read-content">\n                <div\n                    on-click="handleBtnClick(item, index)"\n                    s-for="item, index in list"\n                    class="input-panel-read-content-btn"\n                >\n                    <img class="input-panel-read-content-btn-img" src="{{item.icon}}" />\n                    <div class="input-panel-read-content-btn-name">{{item.text}}</div>\n                    <div class="input-panel-read-content-btn-desc">{{item.desc}}</div>\n                    <div class="input-panel-read-content-btn-limit">{{item.limit}}</div>\n                </div>\n            </div>\n        </div>\n    ',components:{header:_d},computed:{title:function(){return this.data.get("data.jumpPanel.data.aiRead.title")||""},list:function(){return this.data.get("data.jumpPanel.data.aiRead.list")||[]}},detached:function(){this.sendShowLog()},handleBtnClick:function(t,e){if("upload"===t.function.type)this.dispatch("ui:input-upload",0===e?"file":"image");else if("input"===t.function.type){var n,a;zn().emit({inputCustom:null==(a=t.function.data)||null==(n=a.input)?void 0:n.inputCustom})}"readPanel_tianjialianjie"===t.buttonId&&this.dispatch("ui:input-panel-button-click",t),Aa().emit({sa:"functab_read_"+Xa(null==t?void 0:t.buttonId)}),this.sendBtnClickLog(t,e)},sendBtnClickLog:function(t,e){var n=this.data.get("triggerType");Ua({ubcId:"17132",type:"click",value:"function_panel",ext:{setype:"csaitab",function_type:"read",function_tab:"all",valueInfo:[this.getBtnLogData(t,e)],trigger_type:n}})},getBtnLogData:function(t,e){var n,a={function_click_type:"upload"===(null==t||null==(n=t.function)?void 0:n.type)?"upload":"text",function_name:t.buttonId,function_pos:String((null!=e?e:t.order)+1)};return t.agentInfo&&(a.agent_id=t.agentInfo.agentId,a.agent_name=t.agentInfo.agentName),a},sendShowLog:function(){var t=this,e=this.data.get("list"),n=[];e.forEach((function(e,a){n.push(t.getBtnLogData(e,a))}));var a=this.data.get("triggerType");Ua({ubcId:"17132",type:"show",value:"function_panel",ext:{setype:"csaitab",function_type:"read",function_tab:"all",valueInfo:n,trigger_type:a}})}});function Rd(){return Rd=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Rd.apply(this,Array.from(arguments))}var Nd="CHAT_SEARCH_INPUT_PANEL_GUIDE";function Md(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function qd(){return qd=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},qd.apply(this,Array.from(arguments))}function jd(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Md(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Md(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Bd,Hd={office_create:"cs-input-creat",photo_editing:"cs-input-draw",ai_read:"cs-input-read"},$d={7:"office_create",8:"photo_editing"},Fd=a.defineComponent({resizeObservers:new Map,template:'\n        <div s-if="panelData && panelData.length" class="input-panel-wapper" data-show-area >\n            <div s-if="isShowPanelBtn" class="input-panel-btn-list">\n            <template s-for="item in panelData">\n                <cos-tooltip\n                    s-ref="{{\'tooltip\' + item.type}}"\n                    content="{{item.guide}}"\n                    position="top-start"\n                    trigger="custom"\n                    open="{{showGuide[item.type] && item.guide}}"\n                    bubbleClass="cs-input-panel-guide-tip"\n                >\n                    <div\n                        class="\n                            input-panel-btn\n                            {{\n                                item.guide && !hasClickGuide[item.type]\n                                    ? \'input-panel-btn-guide\'\n                                    : \'\'\n                            }}\n                        "\n                        on-click="handleBtnClick(item)"\n                        data-show-ext="{{item | inputPanelBtnRealShowExt}}"\n                    >\n                        <img class="input-panel-btn-icon" src="{{item.icon}}" />\n                        <div class="input-panel-btn-text">{{item.text}}</div>\n                    </div>\n                </cos-tooltip>\n            </template>\n            <div s-if="showPanel" class="input-panel-container {{showPanelTrans ? \'input-panel-show\' : \'\'}}">\n                <fragment s-for="panelItem in panelData">\n                    <div\n                        s-if="showPanel === panelItem.type"\n                        s-is="{{panelComponents[panelItem.type]}}"\n                        data="{{panelItem}}"\n                        is-show="{{showPanel === panelItem.type}}"\n                        trigger-type="{{triggerType}}"\n                    ></div>\n                </fragment>\n            </div>\n        </div>\n    ',messages:{"ui:input-panel-header-close":function(){this.closePanel()}},components:(Bd={}, __set$(Bd,Hd.office_create,Td) , __set$(Bd,Hd.photo_editing,Ad) , __set$(Bd,Hd.ai_read,Od) ,Bd["cos-tooltip"]=e.Tooltip,Bd),computed:{},filters:{inputPanelBtnRealShowExt:function(t){return JSON.stringify({value:"capsule_office",valueInfo:[{component_name:"shortcuts",component_content:t.buttonId}]})}},initData:function(){return{showPanel:"",panelComponents:Hd,panelData:[],isShowPanelBtn:!vt(),triggerType:"",showGuide:{},hasClickGuide:{}}},attached:function(){this.listener(),this.data.get("isShowPanelBtn")&&this.setChatContainerPaddingBottom(49)},initClickGuide:function(t){var e=function(t){try{var e=localStorage.getItem(Nd);return __get$(e?JSON.parse(e):{},t) }catch(t){return console.error("读取本地存储失败:",t),{}}}(t);this.data.set("hasClickGuide."+t,e)},initToolTip:function(t){var e=this,n="input-panel-"+t,a=Xc.getLocalStorage(n);if(Xc.init({type:n,init:!0,open:function(){e.data.set("showGuide."+t,!0)},close:function(){e.data.set("showGuide."+t,!1)}}),!a&&window.ResizeObserver){var i=new ResizeObserver(Xi((function(n){var a=e.resizeObservers.get(t);(null==a?void 0:a.rafId)&&cancelAnimationFrame(a.rafId);var o=requestAnimationFrame((function(){for(var a,i=jd(n);!(a=i()).done;){if(a.value.target.classList.value.includes("chat-container-main-wrapper")){var o=e.ref("tooltip"+t);o&&o.pagePositionChange()}}}));e.resizeObservers.set(t,{observer:i,rafId:o})}),50)),o=document.querySelector("[class*=chat-container-main-wrapper]");o&&(i.observe(o),this.resizeObservers.set(t,{observer:i,rafId:null}))}},detached:function(){this.setChatContainerPaddingBottom(18)},listenSendInputPanelData:null,listenOpenInputPanel:null,listenCloseInputPanel:null,listener:function(){var t=this;this.watch("isShowPanelBtn",(function(e){e&&!vt()?t.setChatContainerPaddingBottom(49):t.setChatContainerPaddingBottom(18)})),this.watch("showPanel",(function(e){e?setTimeout((function(){t.data.set("showPanelTrans",!0)}),0):t.data.set("showPanelTrans",!1)})),this.listenSendInputPanelData=function(e){t.data.set("panelData",Ka(e));var n=on.getState("searchParams").openInputMode;n&& __get$($d,n) &&t.openPanel( __get$($d,n) );for(var a,i=jd(t.data.get("panelData"));!(a=i()).done;){var o=a.value;o.guide&&(t.initToolTip(o.type),t.initClickGuide(o.type))}},Ca().on(this.listenSendInputPanelData),this.listenOpenInputPanel=function(e){var n=e.type,a=e.triggerType;t.openPanel(n,a)},Ta().on(this.listenOpenInputPanel),this.listenCloseInputPanel=function(e){"Escape"===e.key&&t.closePanel()},document.addEventListener("keydown",this.listenCloseInputPanel)},disposed:function(){this.clickListener&&document.removeEventListener("click",this.clickListener),this.listenSendInputPanelData&&(Ca().off(this.listenSendInputPanelData),this.listenSendInputPanelData=null),this.listenOpenInputPanel&&(Ta().off(this.listenOpenInputPanel),this.listenOpenInputPanel=null),this.listenCloseInputPanel&&(document.removeEventListener("keydown",this.listenCloseInputPanel),this.listenCloseInputPanel=null),this.resizeObservers&&(this.resizeObservers.forEach((function(t){t.rafId&&cancelAnimationFrame(t.rafId),t.observer&&t.observer.disconnect()})),this.resizeObservers.clear())},setChatContainerPaddingBottom:function(t){var e=document.querySelector("[class*='chat-container-main-stream']");e&&(e.style.paddingBottom=t+"px")},handleBtnClick:function(t){if(Ua({ubcId:"17132",type:"click",value:"capsule_office",ext:{setype:"csaitab",valueInfo:[{component_name:"shortcuts",component_content:t.buttonId}]}}),t.jumpPanel?this.openPanel(t.type,"search_box"):this.handlePptBtnClick(t),t.guide){Xc.closeToolTip("input-panel-"+t.type),function(t){try{var e,n=localStorage.getItem(Nd),a=n?JSON.parse(n):{};localStorage.setItem(Nd,JSON.stringify(Rd({},a,( __set$(e={},t,!0) ,e))))}catch(e){var i;console.error("设置本地存储失败:",e);var o=( __set$(i={},t,!0) ,i);localStorage.setItem(Nd,JSON.stringify(o))}}(t.type);var e,n=this.data.get("hasClickGuide");this.data.set("hasClickGuide",qd({},n,( __set$(e={},t.type,!0) ,e)))}},handlePptBtnClick:function(t){var e=null==t?void 0:t.buttonId;this.data.set("selectedBtn",e);var n=(null==t?void 0:t.function)||{};if("input"===n.type){var a,i=(null==(a=n.data)?void 0:a.input)||{},o=null==i?void 0:i.interactionType;Aa().emit({sa:"aippt_capsule"}),zn().emit(qd({agentInfo:i.agentInfo,inputCustom:null==i?void 0:i.inputCustom},o?{interactionType:o}:{})),this.dispatch("ui:ai-ppt-active")}},openPanel:function(t,e){var n,a=this;void 0===e&&(e="search_box"),this.data.set("triggerType",e),this.data.set("showPanel",t);var i=null==(n=this.data.get("panelData"))?void 0:n.find((function(e){return e.type===t}));i&&this.dispatch("ui:input-panel-change",{type:"open",showPanelData:i});this.clickListener&&document.removeEventListener("click",this.clickListener),this.clickListener=function(t){t.target&&!t.target.closest(".chat-input-box-pc")&&a.closePanel()},document.addEventListener("click",this.clickListener,!0)},closePanel:function(){var t,e=this.data.get("showPanel");this.data.set("showPanel","");var n=null==(t=this.data.get("panelData"))?void 0:t.find((function(t){return t.type===e}));n&&this.dispatch("ui:input-panel-change",{type:"close",showPanelData:n}),this.clickListener&&document.removeEventListener("click",this.clickListener),this.clickListener=null}}),Ud=a.defineComponent({template:'\n        <div class="cs-input-file-container">\n            <fragment s-for="fileItem, index in fileList">\n                \x3c!-- 文件类型 --\x3e\n                <div\n                    s-if="fileItem.uploadType === \'file\'"\n                    class="cs-input-file\n                        {{fileItem.status === 0 ? \'cs-input-file-uploading\' : \'\'}}\n                        {{fileItem.status === 2 ? \'cs-input-file-failed\' : \'\'}}\n                    "\n                    on-click="handleFileClick($event, fileItem)"\n                >\n                    <div class="cs-input-file-icon">\n                        <img\n                            class="cs-input-file-icon-img"\n                            src="{{getFileIcon(fileItem)}}"\n                        />\n                        <img\n                            s-if="{{fileItem.status === 0}}"\n                            class="cs-input-file-icon-loading"\n                            src="{{loadingIcon}}"\n                        />\n                    </div>\n                    <div class="cs-input-file-content">\n                        <div class="cs-input-file-name cos-line-clamp-1">{{fileItem.fileName}}</div>\n                        <div class="cs-input-file-desc">\n                            <div s-if="{{fileItem.status === 1}}" class="cs-input-file-desc-success">\n                                <div class="cs-input-file-desc-success-name cos-line-clamp-1">{{fileItem.fileType}}</div>\n                                <div class="cs-input-file-desc-success-size cos-line-clamp-1">{{formatBytes(fileItem.fileSize)}}</div>\n                            </div>\n                            <div s-else class="cos-line-clamp-1">{{getFileDesc(fileItem)}}</div>\n                        </div>\n                    </div>\n                    <div on-click="handleDelete($event, fileItem)" class="cs-input-file-delete">\n                        <img class="cs-input-file-delete-icon" src="{{deleteIcon}}" />\n                    </div>\n                </div>\n\n                \x3c!-- 图片类型 --\x3e\n                <div\n                    class="cs-input-image\n                        {{fileItem.status === 0 ? \'cs-input-image-uploading\' : \'\'}}\n                        {{fileItem.status === 2 ? \'cs-input-image-uploading\' : \'\'}}"\n                    s-elif="fileItem.uploadType === \'image\'"\n                >\n                    <img\n                        on-click="handleFileClick($event, fileItem)"\n                        class="cs-input-image-bg"\n                        src="{{getImageUrl(fileItem)}}"\n                    />\n                    <img\n                        s-if="{{fileItem.status === 0}}"\n                        class="cs-input-file-icon-loading"\n                        src="{{loadingIcon}}"\n                    />\n                    <div on-click="handleDelete($event, fileItem)" class="cs-input-file-delete">\n                        <img class="cs-input-file-delete-icon" src="{{deleteIcon}}" />\n                    </div>\n                </div>\n            </fragment>\n        </div>\n    ',components:{},initData:function(){return{fileList:[],deleteIcon:"https://gips2.baidu.com/it/u=3959794902,1704569041&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f40_40",uploadIcon:"https://gips3.baidu.com/it/u=4026099389,3432486988&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f108_108",loadingIcon:"https://gips0.baidu.com/it/u=1698361030,3674932214&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f48_48",imgLoadingIcon:"https://gips2.baidu.com/it/u=2243689421,1478809053&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f180_180",reuploadIcon:"https://gips0.baidu.com/it/u=3781075682,3319294780&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f108_108",reuploadImgIcon:"https://gips3.baidu.com/it/u=3971192352,3667158809&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f180_180"}},created:function(){},attached:function(){this.preload()},preload:function(){!function(t){void 0===t&&(t=[]),t.forEach((function(t){var e=new Image;e.src=t,e.onerror=function(e){console.error("Failed to preload "+t,e)}}))}([this.data.get("deleteIcon"),this.data.get("uploadIcon"),this.data.get("loadingIcon"),this.data.get("imgLoadingIcon"),this.data.get("reuploadIcon"),this.data.get("reuploadImgIcon")])},handleDelete:function(t,e){t.stopPropagation(),t.preventDefault(),this.dispatch("ui:input-delete-file",e)},getFileIcon:function(t){return 0===t.status?this.data.get("uploadIcon"):1===t.status? __get$(me,t.fileType) :(t.status,this.data.get("reuploadIcon"))},getFileDesc:function(t){return 0===t.status?"上传中 "+Math.round(1e4*t.progress)/100+"%":1===t.status?t.fileType+" "+mi(t.fileSize):2===t.status?"点击图标重新上传":void 0},formatBytes:function(t){return mi(t)},handleFileClick:function(t,e){this.dispatch("ui:input-file-click",e)},getImageUrl:function(t){return 1===t.status?t.url:2===t.status?this.data.get("reuploadImgIcon"):this.data.get("imgLoadingIcon")}});function Gd(t){var e=/https?:\/\/(?:www\.)?[a-zA-Z0-9\-._~:/?#[\]@!$&'()*+,;=%]+/g,n=(null==t?void 0:t.match(e))||[],a=(null==t?void 0:t.split(e))||[],i=[];return a.forEach((function(t,e){if(i.push({type:"text",content:t}), __get$(n,e) ){var a= __get$(n,e) .length>50? __get$(n,e) .slice(0,50)+"...": __get$(n,e) ;i.push({type:"link",content: __get$(n,e) ,displayText:"pc"===rt()? __get$(n,e) :a})}})),i}function Wd(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function zd(){return zd=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},zd.apply(this,Array.from(arguments))}function Qd(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Jd=Tt.connect(on,{usableModel:"usableModel",usedModel:"usedModel"})(a.defineComponent({trimWhitespace:"all",template:'\n            <div class="model-select-wrapper">\n                \x3c!--模型切换面板--\x3e\n                <cos-popover open="{=open=}">\n                    <div class="input-capsules-model-list">\n                        <div s-for="item, index in modelList">\n                            <div\n                                s-if="{{index !== 0}}"\n                                class="cos-divider input-capsules-model-list-item-divider">\n                            </div>\n                            <div\n                                class="input-capsules-model-list-item\n                                    {{ item.disabled ? \'input-capsules-model-list-item-disabled\' : \'\' }}"\n                                on-click="handleModelChange($event, item)"\n                            >\n                                <div class="input-capsules-model-list-item-text">\n                                    <div class="input-capsules-model-list-item-title">{{ item.title }}</div>\n                                    <div class="input-capsules-model-list-item-desc">{{ item.desc }}</div>\n                                </div>\n                                <cos-icon\n                                    s-if="item.checked"\n                                    name="check-circle-fill"\n                                    class="input-capsules-model-list-item-icon"\n                                />\n                                <cos-icon\n                                    s-if="{{ loadingModel === item.name }}"\n                                    name="loading"\n                                    class="input-capsules-model-list-item-icon\n                                           input-capsules-model-list-item-icon-loading"\n                                />\n                            </div>\n                        </div>\n                    </div>\n                </cos-popover>\n                \x3c!--模型切换--\x3e\n                <cos-tooltip\n                    content="{{ guideTip }}"\n                    position="top-start"\n                    trigger="custom"\n                    open="{{showGuide && guideTip}}"\n                    bubbleClass="cs-input-model-guide-tip"\n                    getPopupContainer="{{getPopupContainer}}"\n                >\n                    <div class="cs-input-model" on-click="handleChangePopover">\n                        <div\n                            class="cs-input-model-button cs-input-model-button-active"\n                            data-show-ext="{{usableModelShowLog}}"\n                        >\n                            <img class="cs-input-model-icon" src="{{currentModel.modelIcon}}" />\n                            {{ currentModel.modelTitle }}\n                            <cos-icon\n                                name="{{open ? \'caret-down\' : \'caret-up\' }}"\n                                class="cs-input-model-icon-caret"\n                            />\n                        </div>\n                    </div>\n                </cos-tooltip>\n                \x3c!--联网按钮--\x3e\n                <div\n                    s-if="{{currentModel.internetShow}}"\n                    on-click="handleInternetChange"\n                    class="\n                        cs-input-model-button\n                        cos-space-ml-xxs\n                        {{\'cs-input-model-button-\' + (currentModel.internetCheck ? \'active\' : \'inactive\')}}\n                    "\n                >\n                    <cos-tooltip content="{{ currentModel.internetCheck ? \'已开启联网\' : \'开启联网\' }}"\n                                 position="{{open ? \'right\' : \'top\'}}">\n                        <div class="internet-search-icon" data-show-ext="{{internetSearchShowLog}}">\n                            <cos-icon\n                                name="original"\n                                class="\n                                    cs-input-model-icon\n                                "\n                            ></cos-icon>\n                            联网搜索\n                        </div>\n                    </cos-tooltip>\n                </div>\n                \x3c!--深度思考按钮--\x3e\n                <div\n                    s-if="{{currentModel.deepThinkShow}}"\n                    on-click="handleDeepThinkChange"\n                    class="\n                        cs-input-model-button\n                        cos-space-ml-xxs\n                        {{\'cs-input-model-button-\' + (currentModel.deepThinkCheck ? \'active\' : \'inactive\')}}\n                    "\n                >\n                    <cos-tooltip\n                        content="{{ currentModel.deepThinkCheck ? \'已开启深度思考\' : \'开启深度思考\' }}"\n                        position="{{open ? \'right\' : \'top\'}}"\n                    >\n                        <div class="internet-search-icon">\n                            <img\n                                class="cs-input-model-icon"\n                                src="{{currentModel.deepThinkCheck ?\n                                    iconMap[\'deepThink\'].active : iconMap[\'deepThink\'].inactive}}"\n                            />\n                            深度思考\n                        </div>\n                    </cos-tooltip>\n                </div>\n            </div>\n        ',components:{"cos-icon":e.Icon,"cos-popover":e.Popover,"cos-tooltip":e.Tooltip},initData:function(){return{iconMap:{deepThink:{active:"https://gips1.baidu.com/it/u=2131022959,2083152099&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f60_60",inactive:"https://gips2.baidu.com/it/u=3008689286,1786773582&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f48_48"}},popOpen:!1,loadingModel:"",showGuide:!1,modelAction:new Gi(on),getPopupContainer:function(){return document.querySelector(".chat-input-box-pc")},baseData:{a_lid:on.getState("apagelid"),enter_type:on.getState("pcEnterType")||"ai_tab_url"}}},attached:function(){var t=this;window.addEventListener("click",(function(){t.closeInputModelToolTip()}),{once:!0}),this.initToolTip()},computed:{usableModelShowLog:function(){var t=on.getState("usedModel");return t?JSON.stringify(zd({},this.data.get("baseData"),{value:"ask_model_btn",current_model:t.modelName})):{}},internetSearchShowLog:function(){var t,e;return JSON.stringify(zd({},this.data.get("baseData"),{value:"online_btn",is_open:"1"===(null==(e=on.getState("usedModel"))||null==(t=e.modelFunction)?void 0:t.internetSearch)?"1":"0"}))},modelList:function(){var t=this.data.get("usableModel"),e=this.data.get("usedModel");return t&&t.length&&e?t.map((function(t){var n;return{title:t.modelTitle,desc:null!=(n=t.modelSubTitle)?n:"",name:t.modelName,disabled:!t.hasModelPermissions&&!t.modelAvailable,checked:t.modelName===e.modelName}})):[]},currentModel:function(){var t,e,n=this.data.get("usedModel"),a=this.data.get("usableModel");if(!n||!a)return{};var i=a.find((function(t){return t.modelName===n.modelName}))||{};return zd({},n,{modelTitle:i.modelTitle,modelIcon:i.modelIcon,internetShow:(null==(t=i.modelFunction)?void 0:t.internetSearch)===De.OPEN,internetCheck:(null==(e=n.modelFunction)?void 0:e.internetSearch)===De.OPEN,deepThinkShow:!1,deepThinkCheck:!1})},guideTip:function(){return this.data.get("modelAction")?this.data.get("modelAction").getGuideTip():""}},initToolTip:function(){Xc.init({type:"input-model",localStorageKey:this.data.get("guideTip"),open:function(){this.data.set("showGuide",!0)}.bind(this),close:function(){this.data.set("showGuide",!1)}.bind(this)})},handleClickInputModel:function(t){null==t||t.stopPropagation(),this.fire("handleBlur")},closeInputModelToolTip:function(){Xc.closeToolTip("input-model")},handleChangePopover:function(t){var e;(t&&this.handleClickInputModel(t),this.closeInputModelToolTip(),this.data.set("open",!this.data.get("open")),this.data.get("open"))&&Ua({type:"click",value:"ask_model_btn",ext:zd({},this.data.get("baseData"),{current_model:null==(e=on.getState("usedModel"))?void 0:e.modelName})})},handleModelChange:function(t,e){return(n=function(){var n,a;return Qd(this,(function(i){switch(i.label){case 0:return this.handleClickInputModel(t),(null==e?void 0:e.disabled)?[2]:!["ERINE-4.5","ERINE-X1"].includes(null==e?void 0:e.name)||ds()?[3,2]:[4,gs()];case 1:return i.sent(),[2];case 2:return n=on.getState("usedModel"),(null==e?void 0:e.name)===n.modelName?[2]:(this.data.set("loadingModel",null==e?void 0:e.name),[4,this.data.get("modelAction").handleSelectModel(e)]);case 3:return i.sent(),this.data.set("loadingModel",""),this.handleChangePopover(),a=on.getState("usedModel"),Ua({type:"click",value:"model_pop",ext:zd({},this.data.get("baseData"),{current_model:null==n?void 0:n.modelName,goal_model:null==e?void 0:e.name,status:(null==n?void 0:n.modelName)===(null==a?void 0:a.modelName)?0:1})}),[2]}}))},function(){var t=this,e=Array.from(arguments);return new Promise((function(a,i){var o=n.apply(t,e);function r(t){Wd(o,a,i,r,s,"next",t)}function s(t){Wd(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var n},handleInternetChange:function(t){this.handleClickInputModel(t);var e=this.data.get("usedModel"),n=e.modelFunction,a=e.modelName;Ua({type:"click",value:"online_btn",ext:zd({},this.data.get("baseData"),{is_open:n.internetSearch===De.OPEN?De.OPEN:De.CLOSE})});var i={modelFunction:zd({},n,{internetSearch:n.internetSearch===De.OPEN?De.CLOSE:De.OPEN})};this.data.get("modelAction").handleChangeUsedModelStatus(a,i),Ua({type:"show",value:"online_btn",ext:zd({},this.data.get("baseData"),{is_open:i.modelFunction.internetSearch})})},handleDeepThinkChange:function(t){this.handleClickInputModel(t);var e=this.data.get("usedModel"),n=e.modelFunction,a=e.modelName,i={modelFunction:zd({},n)};this.data.get("modelAction").handleChangeUsedModelStatus(a,i)}})),Vd="https://psstatic.cdn.bcebos.com/basics/chat/upload_file_icon_1745934357000.svg",Kd="https://psstatic.cdn.bcebos.com/basics/chat/upload_img_icon_1745934317000.svg",Xd="https://psstatic.cdn.bcebos.com/basics/chat/prompt_optimize_btn2_1745936575000.svg",Yd="prompt-optimizer",Zd=a.defineComponent({timeoutId:null,guideTimeoutId:null,components:{"cos-tooltip":e.Tooltip},attached:function(){!!Xc.getLocalStorage(Yd)||this.openGuide(),bd(Xd,document.getElementById("prompt-optimizer-icon"))},initData:function(){return{showGuide:!1,inputContent:"",disabled:!1}},computed:{promptExceedMaxLength:function(){return this.data.get("inputContent").length>4e3},tooltipContent:function(){return this.data.get("disabled")?"优化已完成":this.data.get("promptExceedMaxLength")?"超出最大优化字符限制":"智能优化输入内容"},ubcClickLog:function(){return JSON.stringify({value:"input_function",ubcExt:{button:"refine"}})},ubcShowLog:function(){return JSON.stringify({value:"input_function",button:"refine"})}},openGuide:function(){var t=this;Xc.setLocalStorage(Yd),this.timeoutId=setTimeout((function(){t.data.set("showGuide",!0),t.guideTimeoutId=setTimeout((function(){t.closeGuide()}),3e3)}),3e3)},closeGuide:function(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=null,this.guideTimeoutId&&clearTimeout(this.guideTimeoutId),this.guideTimeoutId=null,this.data.set("showGuide",!1)},handleMouseEnter:function(){this.closeGuide()},handleClick:function(){this.data.get("disabled")||this.data.get("promptExceedMaxLength")||this.fire("optimizer-btn-click")},disposed:function(){this.closeGuide()}}),tu={};tu= __call$(Object,"assign",[tu,{promptOptimizerBtnWrapper:"prompt-optimizer-btn-wrapper_fuhkv_1","prompt-optimizer-btn-wrapper":"prompt-optimizer-btn-wrapper_fuhkv_1",promptOptimizerButton:"prompt-optimizer-button_fuhkv_5","prompt-optimizer-button":"prompt-optimizer-button_fuhkv_5",buttonIcon:"button-icon_fuhkv_17","button-icon":"button-icon_fuhkv_17",disabled:"disabled_fuhkv_22"}]) ,Zd.template='\n    <span\n        data-show-area\n        data-show-ext="{{ubcShowLog}}"\n        class="{{$style[\'prompt-optimizer-btn-wrapper\']}}"\n    >\n        <cos-tooltip\n            content="点击这里，一键优化输入内容"\n            trigger="custom"\n            open="{{showGuide}}"\n            style="width: 30px; height: 24px; display: inline-block"\n        >\n            <cos-tooltip\n                content="{{tooltipContent}}"\n                trigger="hover"\n                style="width: 30px; height: 24px; display: inline-block"\n            >\n                <div\n                    need-click-log\n                    data-click-log="{{ubcClickLog}}"\n                    class="\n                        {{$style[\'prompt-optimizer-button\']}}\n                        {{disabled || promptExceedMaxLength ? $style.disabled : \'\'}}\n                    "\n                    on-click="handleClick"\n                    on-mouseenter="handleMouseEnter"\n                    on-touchstart="handleMouseEnter"\n                >\n                    <div class="{{$style[\'button-icon\']}}" id="prompt-optimizer-icon">\n                    </div>\n                </div>\n            </cos-tooltip>\n        </cos-tooltip>\n    </span>\n';var eu,nu,au="function"==typeof Zd?Zd.prototype.initData||iu:Zd.initData||iu;function iu(){return{$style:tu}}function ou(){return  __call$(Object,"assign",[{},au.call(this),{$style:tu}]) }function ru(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function su(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function lu(t){return cu.apply(this,Array.from(arguments))}function cu(){var t;return t=function(t){var e,n,a,i,o,r;return su(this,(function(s){switch(s.label){case 0:return e=on.getState("chatParams").sse_host+"/aichat/api/promptpolish?tk="+sc()+"&ori_lid="+on.getState("oriLid"),[4,fetch(e,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})})];case 1:return[4,s.sent().json()];case 2:return n=s.sent(),i=(a=n||{}).status,o=a.data,r=a.logid,0===i&&o?[2,{res:o,logid:r}]:[2,Promise.reject()]}}))},cu=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){ru(o,a,i,r,s,"next",t)}function s(t){ru(o,a,i,r,s,"throw",t)}r(void 0)}))},cu.apply(this,Array.from(arguments))}function du(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function uu(){return uu=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},uu.apply(this,Array.from(arguments))}function pu(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Zd?Zd.prototype.initData=ou:Zd.initData=ou,function(t){t.HIT_DANGER="hit_danger",t.API_ERROR="api_error",t.BTN_CLICK="btn_click",t.INPUT_PANEL_OPEN="input_panel_open",t.INPUT_CLEAR="input_clear",t.AI_PPT_ACTIVE="ai_ppt_active"}(eu||(eu={})),function(t){t.CANCEL="cancel",t.DELETE_QUERY="delete_query",t.CAPSULE="capsule"}(nu||(nu={}));var hu=a.defineComponent({filters:{indexToChinese:function(t){return __get$(["一","二","三"],t) ||t+1}},initData:function(){return{originalPrompt:"",data:[],activeIndex:0,promptPolish:{},cancelStatus:"loading",alive:!0}},attached:function(){this.data.set("originalPrompt",this.data.get("inputContent")),this.init()},computed:{ubcShowLog:function(){return JSON.stringify({value:"refine_result"})}},updateCancelStatus:function(t){this.data.set("cancelStatus",t)},init:function(){return(t=function(){var t,e,n,a,i,o,r;return pu(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,lu(this.data.get("originalPrompt"))];case 1:return e=s.sent(),n=e.res,a=e.logid,this.data.get("alive")?(this.data.set("data",null==n||null==(t=n.list)?void 0:t.slice(0,3)),this.data.set("promptPolish",{original_query:this.data.get("originalPrompt"),refine_status:(null==n?void 0:n.status)||0,refine_content:null==n?void 0:n.list,refine_lid:a,select_index:0,is_edit:0}),this.fire("optimizer-loading-finish",this.data.get("promptPolish")),1===(null==n?void 0:n.status)?this.cancel(eu.HIT_DANGER):(this.handleClickItem(null==n||null==(o=n.list)||null==(i=o[0])?void 0:i.query,1,!0),this.updateCancelStatus("no_refine")),[3,3]):[2];case 2:throw r=s.sent(),this.cancel(eu.API_ERROR),r;case 3:return[2]}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){du(o,a,i,r,s,"next",t)}function s(t){du(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var t},cancel:function(t){switch(this.fire("optimizer-close"),t){case eu.HIT_DANGER:e.Toast.show({message:"请修改内容后重试"});break;case eu.BTN_CLICK:this.sendOriginPrompt(!0),this.cancelLog(nu.CANCEL);break;case eu.INPUT_PANEL_OPEN:this.sendOriginPrompt(),this.cancelLog(nu.CAPSULE);break;case eu.AI_PPT_ACTIVE:this.cancelLog(nu.CAPSULE);break;case eu.INPUT_CLEAR:this.cancelLog(nu.DELETE_QUERY);break;case eu.API_ERROR:e.Toast.show({message:"请稍后重试"})}},cancelLog:function(t){Ua({type:"click",value:"refine_cancel",ext:{status:this.data.get("cancelStatus"),area:t}})},sendOriginPrompt:function(t){void 0===t&&(t=!1),zn().emit({word:this.data.get("originalPrompt"),userHasInput:!0,noClear:t})},handleClickItem:function(t,e,n){void 0===n&&(n=!1),!n&&this.updateCancelStatus("refine"),this.data.set("activeIndex",e),this.data.set("promptPolish",uu({},this.data.get("promptPolish"),{select_index:e,is_edit:0})),this.fire("optimizer-item-click",this.data.get("promptPolish")),zn().emit({word:t,userHasInput:!0,noClear:!0})},getUbcClickLog:function(t){return JSON.stringify({value:"refine_result",ubcExt:{pos:t+1}})},disposed:function(){this.data.set("alive",!1)}}),fu={};fu= __call$(Object,"assign",[fu,{promptOptimizer:"prompt-optimizer_q70wc_1","prompt-optimizer":"prompt-optimizer_q70wc_1",divider:"divider_q70wc_5",header:"header_q70wc_11",title:"title_q70wc_17",cancel:"cancel_q70wc_23",loading:"loading_q70wc_30",loader:"loader_q70wc_33",loaderBar:"loader-bar_q70wc_41","loader-bar":"loader-bar_q70wc_41",borealisBar:"borealisBar_q70wc_1",loader1:"loader1_q70wc_54",loader2:"loader2_q70wc_57",loader3:"loader3_q70wc_60",content:"content_q70wc_71",promptOptimizerItem:"prompt-optimizer-item_q70wc_76","prompt-optimizer-item":"prompt-optimizer-item_q70wc_76",active:"active_q70wc_88",promptOptimizerItemContent:"prompt-optimizer-item-content_q70wc_93","prompt-optimizer-item-content":"prompt-optimizer-item-content_q70wc_93",originPrompt:"origin-prompt_q70wc_99","origin-prompt":"origin-prompt_q70wc_99"}]) ,hu.template='\n    <div\n        data-show-area\n        data-show-ext="{{ubcShowLog}}"\n        class="{{$style[\'prompt-optimizer\']}}"\n    >\n        <div class="{{$style.header}}">\n            <div class="{{$style.title}}">优化方案</div>\n            <div\n                class="{{$style.cancel}}"\n                on-click="cancel(\'btn_click\')"\n            >\n                取消\n            </div>\n        </div>\n        <div\n            s-show="!data.length"\n            class="{{$style.loading}}"\n        >\n            <div class="{{$style.loader}} {{$style.loader1}}">\n                <div class="{{$style[\'loader-bar\']}}"></div>\n            </div>\n            <div class="{{$style.loader}} {{$style.loader2}}">\n                <div class="{{$style[\'loader-bar\']}}"></div>\n            </div>\n            <div class="{{$style.loader}} {{$style.loader3}}">\n                <div class="{{$style[\'loader-bar\']}}"></div>\n            </div>\n        </div>\n        <div\n            s-show="data.length"\n            class="{{$style.content}}"\n            need-click-log\n        >\n            <div\n                class="\n                    {{$style[\'prompt-optimizer-item\']}}\n                    {{$style[\'origin-prompt\']}}\n                    {{activeIndex === 0 ? $style.active : \'\'}}\n                "\n                on-click="handleClickItem(originalPrompt, 0)"\n                data-click-log="{{getUbcClickLog(0)}}"\n            >\n                <div\n                    class="{{$style[\'prompt-optimizer-item-content\']}}"\n                >\n                    原始内容\n                </div>\n            </div>\n            <div\n                s-for="item, index in data"\n                class="\n                    {{$style[\'prompt-optimizer-item\']}}\n                    {{activeIndex === index + 1 ? $style.active : \'\'}}\n                "\n                on-click="handleClickItem(item.query, index + 1)"\n                data-click-log="{{getUbcClickLog(index + 1)}}"\n            >\n                <div class="{{$style[\'prompt-optimizer-item-content\']}}">\n                    方案{{ index | indexToChinese }}：{{ item.description || item.title || item.query }}\n                </div>\n            </div>\n        </div>\n        <div class="{{$style.divider}}"></div>\n    </div>\n';var gu="function"==typeof hu?hu.prototype.initData||mu:hu.initData||mu;function mu(){return{$style:fu}}function vu(){return  __call$(Object,"assign",[{},gu.call(this),{$style:fu}]) }function yu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function wu(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return yu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yu(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}"function"==typeof hu?hu.prototype.initData=vu:hu.initData=vu;var bu="input-custom-item",_u="input-custom-placeholder",ku="input-custom-no-width",Su="&nbsp;",xu="deletion",Iu="chat-input-box",Tu="input-custom-need-clear-text";function Cu(){var t=document.createElement("div");return t.innerHTML='<span contentEditable="'+(mt()||ot.isQQBrowser?"true":"false")+'" \n        class="'+ku+'">'+Su+"</span>",t.childNodes[0]}function Lu(t){var e;return!!(null==t||null==(e=t.className)?void 0:e.includes(bu))}function Du(t){var e;return!!(null==t||null==(e=t.className)?void 0:e.includes(ku))}function Pu(t){if(t){var e=t.parentNode;if(e&&e.isContentEditable){var n=document.createRange();if(t.nodeType===Node.TEXT_NODE)n.setStart(t,t.length);else if(t.childNodes.length>0){var a=t.lastChild;a.nodeType===Node.TEXT_NODE?n.setStart(a,a.length):n.setStart(t,t.childNodes.length)}else n.setStart(t,0);n.collapse(!0);var i=window.getSelection();i.removeAllRanges(),i.addRange(n),e.focus()}}}function Eu(t){return document.createTextNode(t.content||t.value||"")}function Au(t){var e=[];return t.forEach((function(t,n){"text"===t.type?e.push(Eu(t)):"input"===t.type&&(e.push(Cu()),e.push(function(t,e){var n=document.createElement("span");n.id="cs-custom-input-"+e,n.contentEditable="true",n.innerText=t.value||t.default||"",n.setAttribute("placeholder",t.placeHolder||"填写内容"),t.value||t.default||n.setAttribute(xu,"1");var a=[bu];return t.value||t.default?a.push(Tu):a.push(_u),n.className=a.join(" "),n.addEventListener("click",(function(t){mt()&&t.target&&!t.target.innerText&&Pu(t.target),t.target&&t.target.classList.contains(Tu)&&(t.target.innerText="",t.target.classList.remove(Tu),Pu(t.target),t.stopPropagation())})),n}(t,n)),e.push(Cu()))})),e}function Ou(t){var e;(null==t||null==(e=t.childNodes)?void 0:e.length)&&t.childNodes.forEach((function(t){var e,n;Lu(t)&&(t.innerText&&"\n"!==t.innerText?(null==(e=t.classList)||e.remove(_u),function(t){(null==t?void 0:t.setAttribute)&&t.setAttribute(xu,"0")}(t)):(t.innerText="",null==(n=t.classList)||n.add(_u)));Du(t)&&(Lu(t.previousSibling)||Lu(t.nextSibling)||t.remove())}))}function Ru(t){var e;if(t&&"Backspace"===t.key){var n,a,i={startContainer:(e=window.getSelection().getRangeAt(0)).startContainer,startOffset:e.startOffset,endOffset:e.endOffset},o=i.startContainer,r=i.startOffset,s=i.endOffset,l=null,c=null;if(o.nodeType===Node.TEXT_NODE?(l=o.parentElement,c=0===r?o.previousSibling:o):c=null==(l=o)?void 0: __get$(l.childNodes,r-1) ,function(t){return(null==t?void 0:t.id)===Iu}(l)&&Du(c)){t.preventDefault&&t.preventDefault();var d,u=null==c?void 0:c.previousSibling;if(Lu(u))if(null==u?void 0:u.innerText)u.innerText=null==u||null==(d=u.innerText)?void 0:d.slice(0,-1),Pu(u);else!function(t){if(Lu(t)){var e=null==t?void 0:t.nextSibling,n=null==t?void 0:t.previousSibling;Du(e)&&e.remove(),Du(n)&&n.remove(),t.remove()}}(u)}if(Lu(l))if(1===(null==l||null==(n=l.innerText)?void 0:n.length)||0===r&&(null==(a=l.innerText)?void 0:a.length)===s&&r!==s)t.preventDefault&&t.preventDefault(),l.innerText="",setTimeout((function(){Pu(l)}),0);else if(0===r&&0===s){var p;t.preventDefault&&t.preventDefault();var h,f=null==l||null==(p=l.previousSibling)?void 0:p.previousSibling;if((null==f?void 0:f.nodeType)===Node.TEXT_NODE)f.textContent=null==f||null==(h=f.textContent)?void 0:h.slice(0,-1),Pu(f);else Du(f)&&Pu(f)}}}function Nu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Mu(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function qu(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Mu(o,a,i,r,s,"next",t)}function s(t){Mu(o,a,i,r,s,"throw",t)}r(void 0)}))}}function ju(){return ju=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},ju.apply(this,Array.from(arguments))}function Bu(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Nu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nu(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Hu(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var $u=[],Fu=it().isSafari?"&nbsp;":"&#xFEFF;",Uu=Tt.connect(on,{topRank:"topRank",usableModel:"usableModel",usedModel:"usedModel"})(a.defineComponent({agentDom:null,agentEmptyDom:null,richEditor:null,trimWhitespace:"all",template:'\n        <div class="cs-rich-input {{hasHomeIndicator ? \'has-home-indicator\' : \'\'}}">\n            \x3c!-- 输入框面板弹起时不展示 --\x3e\n            <sug s-ref="sug" />\n            <cs-input-panel\n                s-ref="inputPanel"\n            />\n            <div\n                on-click="onInputWrapClick"\n                on-drop="onInputWrapDrop"\n                class="\n                    input-wrap {{isSafariOrQQBrower ? \'safari-qq-spec\' : \'\'}}\n                    {{usableModel.length > 0 ? \'input-wrap-multi-line\' : \'input-wrap-single-line\'}}\n                "\n            >\n                \x3c!-- 文件和图片组件 --\x3e\n                <file\n                    s-if="fileList && fileList.length"\n                    class="input-file"\n                    file-list="{{fileList}}"\n                />\n                \x3c!-- 输入框 --\x3e\n                <div\n                    class="\n                        input-container\n                        {{usableModel.length > 0 ? \'input-container-multi-line\' : \'input-container-single-line\'}}\n                    "\n                >\n                    \x3c!-- optimizer loading遮罩：禁止编辑 --\x3e\n                    <div \n                        s-if="promptOptimizerVisible && promptOptimizerLoading" \n                        class="optimizer-loading-mask" \n                        on-click="handleOptimizerMaskClick" \n                    />\n                    <prompt-optimizer \n                        s-if="promptOptimizerVisible" \n                        s-ref="promptOptimizer"\n                        input-content="{{inputContent}}" \n                        on-optimizer-close="handleOptimizerClose"\n                        on-optimizer-item-click="updatePromptPolish"\n                        on-optimizer-loading-finish="handleOptimizerLoadingFinish"\n                    />\n                    <div\n                        id="chat-input-box"\n                        s-ref="inputField"\n                        class="\n                            cs-pc-input-custom\n                            input-fields\n                            {{!textContent ? \'empty-input\' : \'no-empty-input\'}}\n                            {{usableModel.length > 0 ? \'empty-input-multi-line\' : \'\'}}\n                            {{showPlaceholderOnce ? \'show-placeholder-once\' : \'\'}}\n                            {{usableModel.length > 0 ? \'input-fields-multi-line\' : \'input-fields-single-line\'}}\n                        "\n                        contenteditable="{{contenteditable}}"\n                        enterkeyhint="send"\n                        placeholder="{{realPlaceholder}}"\n                        on-click="handleClick"\n                        on-focus="handleFocused"\n                        on-input="handleInput($event)"\n                        on-blur="handleBlur"\n                        on-keydown="handleKeyDown($event)"\n                        on-keyup="handleKeyUp($event)"\n                        on-touchmove="handleTouchMove($event)"\n                        on-compositionstart="handleCompositionStart"\n                        on-compositionend="handleCompositionEnd"\n                        on-paste="handlePaste($event)"\n                    >\n                    </div>\n                    \x3c!-- 功能按钮 --\x3e\n                    <div class="{{\n                            usableModel.length > 0 ? \'cs-input-function-wrapper\' : \'cs-input-function-wrapper-no-model\'\n                        }}"\n                    >\n                        \x3c!-- 接入模型按钮 --\x3e\n                        <cs-input-model />\n                        <div class="cs-input-function-btn">\n                            <div\n                                s-show="!inputPanelOpenType\n                                    && !agentInfo\n                                    && !(fileList && fileList.length)\n                                    && !isCustomInput\n                                "\n                                class="cs-input-upload"\n                                data-show-area\n                            >\n                                <prompt-optimizer-btn \n                                    s-if="promptOptimizerType === 1 && inputContent"\n                                    disabled="{{!promptOptimizerLoading && promptOptimizerVisible}}"\n                                    input-content="{{inputContent}}"\n                                    on-optimizer-btn-click="handleOptimizerBtnClick"\n                                />\n                                <cos-tooltip\n                                    s-for="btnItem, index in funcBtn"\n                                    trigger="hover"\n                                    content="{{btnItem.tooltipText}}"\n                                    style="\n                                        width: 30px; \n                                        height: 24px; \n                                        display: inline-block;\n                                        margin-left: 4px;\n                                        {{usableModel.length > 0 ? \'margin-top: -1px;\' : \'\'}}\n                                    "\n                                >\n                                    <div\n                                        class="cs-input-upload-btn"\n                                        on-click="handleUplaodBtnClick(btnItem.type)"\n                                        data-show-ext="{{btnItem.type | uploadBtnRealShowExt}}"\n                                    >\n                                        <div class="\n                                            cs-input-upload-icon\n                                            {{btnItem.type === \'file\' ? \'file-icon\' : \'image-icon\'}}    \n                                            "\n                                            id="{{btnItem.type === \'file\' ? \'upload-file-icon\' : \'upload-img-icon\'}}"\n                                        >\n                                        </div>\n                                    </div>\n                                </cos-tooltip>\n                                <div class="cos-divider-vertical-inverse cos-space-ml-xs" style="height: 18px"></div>\n                            </div>\n                            \x3c!-- pc场景发送按钮会在生成时展示为暂停按钮 --\x3e\n                            <cos-icon s-if="isPc && isShowPauseButton && !textContent && !fileReady" name="pause-dqa"\n                                class="pause-icon" on-click="native:handlePauseClick()"\n                            />\n                            <cos-icon s-else name="arrow-up-circle-fill"\n                                class="send-icon {{\n                                    (textContent || fileReady === 1) && fileReady < 2 ? \'active-send-icon\' : \'\'\n                                }}"\n                                on-click="native:handleIconInputClick()"\n                            />\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="tip">内容由AI生成，仅供参考</div>\n        </div>\n    ',components:{"cos-icon":e.Icon,sug:pd,"cs-input-panel":Fd,file:Ud,"cos-tooltip":e.Tooltip,"cs-input-model":Jd,"prompt-optimizer-btn":Zd,"prompt-optimizer":hu},messages:{"sug-click":function(t){"common"===t.value.type?this.launchSearch({query:t.value.word},"sug"):(this.data.set("agentInfo",{agentName:t.value.source_name,agentSearchId:t.value.agent_search_id,agentId:t.value.agent_id}),this.data.set("currentAgentFirstSearch",!0),this.upperPcInput(t.value,"agent"),yd())},"ui:input-panel-change":function(t){this.handlePanelChange(t.value)},"ui:ai-ppt-active":function(){var t;null==(t=this.ref("promptOptimizer"))||t.cancel(eu.AI_PPT_ACTIVE)},"ui:input-upload":function(t){this.handleUplaod(t.value)},"ui:input-file-click":function(t){this.handleFileClick(t.value)},"ui:input-delete-file":function(){var t,e;(this.data.get("inputCopyInfo").isInputCopy&&this.data.set("inputCopyInfo.isInputCopyModified",!0),this.data.set("fileList",[]),null==(t=this.data.get("inputContent"))?void 0:t.length)||(null==(e=this.ref("promptOptimizer"))||e.cancel(eu.INPUT_CLEAR))},"ui:input-panel-button-click":function(t){this.handlePanelButtonClick(t.value)}},initData:function(){return{funcBtn:[{type:"file",tooltipText:"上传文件：支持PDF/Word/Excel/PPT/txt等，最大50MB"},{type:"image",tooltipText:"上传图片：支持jpg/png/jpeg等，最大10MB"}],placeholder:"Shift+Enter换行",showPlaceholder:!0,inputContent:"",textContent:"",agentContent:"",maxLength:5e3,inputStatus:"blur",sendType:"text",hasAgent:!1,contenteditable:!0,needInvokeSug:!1,isCustomInput:!1,initFocusIndex:"",removeTargetIndex:"",customInputData:[],preContent:"",currentAgentFirstSearch:!1,isComposing:!1,lastInputPanelOpenType:"",inputPanelOpenType:"",isShowPauseButton:!1,isPc:"pc"===rt(),panelPlaceholder:"",filePlaceholder:"描述想要了解的内容",existCustomNode:!1,userHasInput:!1,defaultContent:"",showPlaceholderOnce:!1,updatedSa:"",agentSa:"",isExtension:vt(),usableModel:[],hasHomeIndicator:yt(),inputCopyInfo:{isInputCopy:!1,isInputCopyModified:!1},promptOptimizerVisible:!1,promptOptimizerLoading:!0,promptOptimizerType:0,searchInfo:{}}},filters:{uploadBtnRealShowExt:function(t){return JSON.stringify({value:"input_function",button:"image"===t?"pic":"file"})}},computed:{realPlaceholder:function(){if(this.data.get("isCustomInput"))return"";if(this.data.get("inputContent")&&this.data.get("inputContent")===this.data.get("agentContent")&&"blur"===this.data.get("inputStatus"))return" 继续问";var t=this.data.get("panelPlaceholder")||this.data.get("placeholder"),e=this.data.get("fileList");return(null==e?void 0:e.length)&&(t=this.data.get("filePlaceholder")),this.data.get("showPlaceholder")?t:""},sendType:function(){return this.data.get("hasAgent")&&this.data.get("agentInfo")?"agent":"text"},isSafariOrQQBrower:function(){var t=it();return t.isQQBrowser||t.isSafari},isFirefox:function(){return it().isFirefox},fileReady:function(){for(var t,e=this.data.get("fileList")||[],n=Number(!!e.length),a=Bu(e);!(t=a()).done;){var i=t.value;if(-1===i.status||0===i.status){n=2;break}if(1!==i.status){n=3;break}}return n},usableModelShowLog:function(){var t;return JSON.stringify({value:"ds_btn",is_open:(null==(t=on.getState("usedModel"))?void 0:t.modelName)?"1":"0",enter_type:on.getState("pcEnterType")||"ai_tab_url",a_lid:on.getState("apagelid")})},internetSearchShowLog:function(){var t,e;return JSON.stringify({value:"online_btn",is_open:"1"===(null==(e=on.getState("usedModel"))||null==(t=e.modelFunction)?void 0:t.internetSearch)?"1":"0",enter_type:on.getState("pcEnterType")||"ai_tab_url",a_lid:on.getState("apagelid")})},hasContent:function(){var t=this.data.get("fileList")||[],e=this.data.get("inputContent");return Boolean(e||t.length)}},created:function(){},attached:function(){var t=this;this.richEditor=this.ref("inputField"),this.inputPanel=this.ref("inputPanel"),this.nextTick((function(){yd(),t.observer=new MutationObserver(t.handleInputChange.bind(t)),t.observer.observe(t.richEditor,{childList:!0,subtree:!0,characterData:!0})})),this.listener(),La().on((function(e){t.data.set("promptOptimizerType",(null==e?void 0:e.type)||0)})),bd(Vd,document.getElementById("upload-file-icon")),bd(Kd,document.getElementById("upload-img-icon")),bd(Xd)},onInputWrapClick:function(){document.activeElement!==this.richEditor&&yd()},handleOptimizerBtnClick:function(){var t,e;null==(t=this.inputPanel)||t.closePanel(),null==(e=this.ref("sug"))||e.closeSug(),this.data.set("promptOptimizerVisible",!0)},handleOptimizerClose:function(){this.data.set("promptOptimizerVisible",!1),this.data.set("promptOptimizerLoading",!0)},handleOptimizerLoadingFinish:function(t){this.data.set("promptOptimizerLoading",!1),this.updatePromptPolish(t)},updatePromptPolish:function(t){var e=this.data.get("searchInfo");t?e.prompt_polish=t:delete e.prompt_polish,this.data.set("searchInfo",e)},handleOptimizerMaskClick:function(t){t.stopPropagation()},onInputWrapDrop:function(t){var e;t.preventDefault();var n=Array.from((null==(e=t.dataTransfer)?void 0:e.files)||[]);n.length&&!this.data.get("fileList").length&&this.handleUplaod(n[0].type.startsWith("image/")?"image":"file",n[0])},handleUplaodBtnClick:function(t){this.handleUplaod(t),Ua({ubcId:"17132",type:"click",value:"input_function",ext:{a_lid:on.getState("apagelid"),setype:"csaitab",button:"image"===t?"pic":"file"}}),this.data.get("inputCopyInfo").isInputCopy?this.data.set("inputCopyInfo.isInputCopyModified",!0):"file"===t?this.data.set("updatedSa","searchbox_file"):"image"===t&&this.data.set("updatedSa","searchbox_pic")},handleUplaod:function(t,n){return qu((function(){var a,i,o,r,s,l;return Hu(this,(function(c){switch(c.label){case 0:return a=this,i=+new Date,o=null,r=function(n){var r=n.status,s=n.fileInfo,l=n.progress,c=a.data.get("fileList")||[];if(r===dr.INIT){1<=$u.length&&($u.shift(),a.data.shift("fileList"),c.shift());var d=!1;if($u.forEach((function(t){t.timeStamp===i&&(d=!0)})),!d){var u;$u.push({uploadFileIns:o,timeStamp:i}),null==(u=a.inputPanel)||u.closePanel();var p=a.data.get("agentInfo"),h=a.data.get("userHasInput");!p&&h||a.clearInput(),yd()}!c.length&&s&&c.push({status:dr.UPLOADING,timeStamp:i,fileName:s.fileName,uploadType:t,fileType:gi(s.fileName),fileSize:s.fileSize,progress:l,fileId:s.fileId})}else if(r===dr.UPLOADING)c.forEach((function(t,e){t.timeStamp===i&&( __get$(c,e) .status=r, __get$(c,e) .progress=l)}));else if(r===dr.BOS_SUCCESS)c.forEach((function(t,e){t.timeStamp===i&&( __get$(c,e) .progress=l, __get$(c,e) .status=r, __get$(c,e) .url=null==s?void 0:s.fileUrl, __get$(c,e) .fileId=null==s?void 0:s.fileId, __get$(c,e) .filePath=null==s?void 0:s.filePath)}));else if(r===dr.NETWORK_ERROR)c.forEach((function(t,e){t.timeStamp===i&&( __get$(c,e) .status=r)})),e.Toast.show({message:"网络错误，请重试"});else{if(r===dr.RISK_DENY)return e.Toast.show({message:"当前文件暂不支持，换个文件试试吧"}),$u.pop(),void a.data.shift("fileList");if(r===dr.FILE_SIZE_EXCEED_LIMIT)return e.Toast.show({message:"file"===t?"文件超过50M，请重新选择后上传":"图片超过10M，请重新选择后上传"}),$u.pop(),void a.data.shift("fileList")}a.data.set("fileList",JSON.parse(JSON.stringify(c)))},s=on.getState("chatParams"),l={type:t,maxSize:50,maxNum:1,sseHost:null==s?void 0:s.sse_host,callback:r},"image"===t&&(l.maxSize=10),[4,xr.create(l)];case 1:return o=c.sent(),n?o.uploadFile(n).catch((function(){})):o.getFile().catch((function(){})),[2]}}))})).apply(this)},handleFileClick:function(t){t.status===dr.NETWORK_ERROR&&$u.forEach((function(e){var n;e.timeStamp===t.timeStamp&&(null==(n=e.uploadFileIns)||n.reTryUpload())}))},handlePanelChange:function(t){var e=this,n=t.type,a=t.showPanelData;if("open"===n&&a){var i,o,r,s,l,c;null==(i=this.ref("promptOptimizer"))||i.cancel(eu.INPUT_PANEL_OPEN);var d=Xa(a.type);if(this.data.set("panelPlaceholder",null==(r=a.jumpPanel)||null==(o= __get$(r.data,d) )?void 0:o.placeHolder),this.data.set("inputPanelOpenType",d),this.data.get("lastInputPanelOpenType")!==d)!this.data.get("userHasInput")&&this.clearInput();var u=null==(l=a.jumpPanel)||null==(s= __get$(l.data,d) )?void 0:s.defaultContent;if(!(null==(c=this.richEditor)?void 0:c.innerText)&&u){var p,h=Eu({content:u});this.data.set("defaultContent",u),null==(p=this.richEditor)||p.appendChild(h);var f=this.data.get("isSafariOrQQBrower");setTimeout((function(){e.data.set("showPlaceholder",!0),e.data.set("showPlaceholderOnce",!0)}),f?50:0)}this.nextTick((function(){yd()}))}else if("close"===n){this.data.set("panelPlaceholder",""),this.data.set("interactionType",0);var g=this.data.get("inputPanelOpenType");g&&this.data.set("lastInputPanelOpenType",g),this.data.set("inputPanelOpenType","");var m=this.data.get("defaultContent"),v=this.data.get("textContent");this.data.get("realPlaceholder")&&v&&m===v&&this.clearInput()}},handlePanelButtonClick:function(t){var e;"readPanel_tianjialianjie"===t.buttonId&&(this.data.set("interactionType",3),null==(e=this.inputPanel)||e.closePanel())},listenUpperSearchbox:null,listenShowPauseButton:null,listenOpenInputUpload:null,listenGetUpdatedSa:null,listener:function(){var t=this;this.listenUpperSearchbox=Xi((function(e){var n,a,i,o=t.data.get("hasContent");e.showCover&&o&&e.showCover.show?sl().emit({id:e.showCover.id}):(e.noClear||(t.clearTextInput(),t.clearFile()),(null==(n=e.agentInfo)?void 0:n.agentName)&&!t.data.get("isExtension")?(t.data.set("agentInfo",e.agentInfo),t.upperPcInput(e,"agent")):(null==(a=e.agentInfo)?void 0:a.agentName)||t.clearInput(),e.isUserInput&&t.data.set("userHasInput",!0),e.file&&t.upperPcInput(e,"file"),e.image&&t.upperPcInput(e,"image"),(null==(i=e.inputCustom)?void 0:i.length)?t.upperPcInput(e.inputCustom,"input-custom"):e.word&&t.upperPcInput(e,"text"),e.interactionType&&t.data.set("interactionType",e.interactionType),e.isInputCopy&&t.data.set("inputCopyInfo",{isInputCopy:!0,isInputCopyModified:!1}),e.userHasInput&&t.data.set("userHasInput",e.userHasInput),t.nextTick((function(){!function(t){for(var e,n=(null==t?void 0:t.childNodes)||[],a=-1,i=wu(n);!(e=i()).done;){var o,r=e.value;if((null==r||null==(o=r.className)?void 0:o.includes(bu))&&!(null==r?void 0:r.innerText)){a=Array.prototype.indexOf.call(n,r);break}}(null==n?void 0:n.length)&&-1!==a?Pu( __get$(n,a) ):yd()}(t.richEditor)})))}),500),zn().on(this.listenUpperSearchbox),this.listenShowPauseButton=function(e){var n=e.isShowButton,a=void 0!==n&&n;t.data.set("isShowPauseButton",a)},ga().on(this.listenShowPauseButton),this.listenOpenInputUpload=function(e){t.handleUplaod(e)},Da().on(this.listenOpenInputUpload),this.listenGetUpdatedSa=function(e){var n=e.sa;e.isAgent?t.data.set("agentSa",n):t.data.set("updatedSa",n)},Aa().on(this.listenGetUpdatedSa)},clearFile:function(){this.data.set("fileList",[]),this.data.get("inputCopyInfo.isInputCopy")&&this.data.set("inputCopyInfo.isInputCopyModified",!0),$u=[]},clearCustomInput:function(){this.data.set("isCustomInput",!1),this.data.set("customInputdata",[]),function(t){if(null==t?void 0:t.childNodes){var e=[];t.childNodes.forEach((function(t){var n,a;((null==t||null==(n=t.className)?void 0:n.includes(ku))||(null==t||null==(a=t.className)?void 0:a.includes(bu)))&&e.push(t)})),e.forEach((function(t){t.remove()}))}}(this.richEditor)},clearInput:function(){this.clearCustomInput(),this.richEditor.innerText="",this.recoveryStatus(),this.data.set("userHasInput",!1),this.data.set("interactionType",0),0===(this.data.get("fileList")||[]).length&&this.data.set("inputCopyInfo.isInputCopy",!1)},clearTextInput:function(){this.clearCustomInput();for(var t=this.richEditor.childNodes,e=t.length-1;e>=0;e--)(3=== __get$(t,e) .nodeType||"FONT"=== __get$(t,e) .nodeName||"BR"=== __get$(t,e) .nodeName|| __get$(t,e) ===this.agentEmptyDom&& __get$(t,e) .innerHTML.length>1||it().isSafari&&"DIV"=== __get$(t,e) .nodeName)&& __get$(t,e) .remove();this.data.set("userHasInput",!1),this.data.set("interactionType",0)},clearAgentStatus:function(){this.data.set("hasAgent",!1),this.agentDom=null,Fs().emit({name:"delete-agent",params:{agentInfo:this.data.get("agentInfo")}}),this.data.set("agentInfo",null)},recoveryStatus:function(){this.data.get("hasAgent")&&this.clearAgentStatus()},launchSearch:function(t,n){return void 0===t&&(t={}),void 0===n&&(n="notSug"),qu((function(){var a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b;return Hu(this,(function(_){switch(_.label){case 0:if(!((null==(o=this.data.get("agentInfo")||{})?void 0:o.agentName)||on.getState("rank")>=ws()||this.data.get("isExtension")))return[3,5];r=null,_.label=1;case 1:return _.trys.push([1,3,,4]),[4,gs()];case 2:return r=_.sent(),[3,4];case 3:return _.sent(),this.data.get("isExtension")?(Hn().component.login.emit(),[2,Promise.resolve()]):[3,4];case 4:if(!r)return[2,Promise.resolve()];_.label=5;case 5:if(on.dispatch("update",{pcInputTime:Date.now()-on.getState("pcInputFocusTime")}),s=t.query||this.data.get("textContent"),l=s.trim(),(c=this.data.get("isCustomInput"))&&(l= __call$(l,"replace",[/\s+/g,""]) ),this.data.get("currentAgentFirstSearch")&&(l=l||"你好",this.data.set("currentAgentFirstSearch",!1)),d=this.data.get("fileReady"),u="",2===d?u="文件上传中":d>2?u="请重新上传文件":l||1===d||(u="请输入你的问题"),u)return e.Toast.show({message:u}),[2,Promise.resolve()];if(o.agentName&&(o.startIndex=0,o.endIndex=o.agentName.length,o.forceUpperBox=!0,o.isUpperBox=!0),p=this.data.get("fileList")||[],h=[],4!==(f=this.data.get("interactionType"))||ds())return[3,10];_.label=6;case 6:return _.trys.push([6,8,,9]),[4,gs()];case 7:return _.sent(),[3,9];case 8:return _.sent(),Qn().emit({text:"登录失败，请稍后再试"}),[3,9];case 9:return[2,Promise.resolve()];case 10:return p.length>0&&(h=function(t,e){var n=[];return t&&n.push({type:"TEXT",data:{text:{query:t,text_type:""}}}),e.forEach((function(t){"image"===t.uploadType?n.push({type:"IMAGE",data:{image:{image_url:t.url,image_id:t.fileId}}}):"file"===t.uploadType&&n.push({type:"FILE",data:{file:{file_id:t.fileId,file_name:t.fileName,file_path:t.filePath,file_size:t.fileSize,file_type:t.fileType,file_url:t.url}}})})),n}(l,p),"file"===(null==(g=p[0])?void 0:g.uploadType)?f=1:"image"===(null==(m=p[0])?void 0:m.uploadType)&&(f=2)),v=this.data.get("updatedSa"),y=this.updateSa(n,l,v),w=this.data.get("agentSa"),b=ji(this.data.get("searchInfo")),Us().emit({name:"search",params:ju({query:h.length?h:l,sa:y,agentInfo:o},w?{agentSa:w}:{},f?{interactionType:f}:{},{searchInfo:b})}),c&&this.data.set("isCustomInput",!1),this.clearTextInput(),null==(a=this.ref("sug"))||a.closeSug(),yd(),this.data.set("fileList",[]),this.data.set("interactionType",0),this.updatePromptPolish(null),null==(i=this.inputPanel)||i.closePanel(),this.handleOptimizerClose(),this.data.set("agentSa",""),this.data.set("updatedSa",""),this.data.set("sa",""),this.data.set("inputCopyInfo",{isInputCopy:!1,isInputCopyModified:!1}),[2,Promise.resolve()]}}))})).apply(this)},updateSa:function(t,e,n){var a;void 0===n&&(n="");var i=this.data.get("isCustomInput"),o="",r="sug"!==t?"bkb":"bks",s=this.data.get("userHasInput"),l="link"===(null==(a=(Gd(e)||[])[1])?void 0:a.type),c=this.data.get("fileReady");o=l?"searchbox_link":o;var d=this.data.get("inputCopyInfo");return"copyinput"===n&&d.isInputCopy?d.isInputCopyModified?r+"_"+n:n:(n&&(i||c)?o=s?r+"_"+n:n:o&&(c||l)?s&&(o=r+"_"+o):o=o||r,o)},upperPcInput:function(t,e){var n=this;if(this.data.set("needInvokeSug",!1),"text"===e){var a=document.createTextNode(t.word),i=this.richEditor;"query"===t.type?i.appendChild(a):i.insertBefore(a,i.firstChild)}else if("agent"===e){if(!this.richEditor.querySelector(".cs-pc-input-agent")){this.agentDom=document.createElement("span"),this.agentDom.className="cs-pc-input-agent",this.agentDom.setAttribute("contenteditable",!1),this.richEditor.appendChild(document.createElement("span")),this.data.get("isCustomInput")?this.richEditor.insertBefore(this.agentDom,this.richEditor.firstChild):this.richEditor.appendChild(this.agentDom);var o=it();(o.isFirefox||o.isQQBrowser||o.isSafari)&&setTimeout((function(){n.addAgentHolder()}),0)}this.agentDom.innerText="@"+this.data.get("agentInfo.agentName"),this.data.get("hasAgent")||this.removeUserInputSugText(),this.data.set("hasAgent",!0)}else if("input-custom"===e){this.data.set("isCustomInput",!0);var r=function(t){return t.map((function(t){return vd({},t,{realValue:t.value||t.default})}))}(t);this.data.set("customInputData",r,{force:!0}),Au(r).forEach((function(t){n.richEditor.appendChild(t)}))}else if("file"===e){this.data.get("agentInfo")&&this.clearInput(),t.file&&this.data.set("fileList",[{status:1,timeStamp:+new Date,fileName:t.file.fileName,uploadType:"file",fileType:gi(t.file.fileName),fileSize:t.file.fileSize,fileId:t.file.fileId,url:t.file.fileUrl,filePath:t.file.filePath}])}else if("image"===e){this.data.get("agentInfo")&&this.clearInput(),t.image&&this.data.set("fileList",[{status:1,timeStamp:+new Date,uploadType:"image",fileType:"PNG",fileId:t.image.image_id||t.image.imageId,url:t.image.image_url||t.image.imageUrl}])}},addAgentHolder:function(){var t,e=this;this.agentEmptyDom?this.agentEmptyDom.innerHTML=Fu:(this.agentEmptyDom=document.createElement("span"),this.agentEmptyDom.innerHTML=Fu,null==(t=this.agentDom)||t.insertAdjacentElement("afterend",this.agentEmptyDom));requestAnimationFrame((function(){var t=document.createRange(),n=window.getSelection();null==t||t.setStartAfter(e.agentDom),null==t||t.setEndAfter(e.agentDom),null==n||n.removeAllRanges(),null==n||n.addRange(t)}))},removeUserInputSugText:function(){var t,e=this,n=null!=(t=this.richEditor.childNodes)?t:[],a=Array.from(n).findIndex((function(t){return t===e.agentDom}));if(!(a<=0))for(var i=a-1;i>=0;i--)if( __get$(n,i) && __get$(n,i) .nodeType===Node.TEXT_NODE){var o= __get$(n,i) .textContent.lastIndexOf("@");if(-1!==o){ __get$(n,i) .textContent= __get$(n,i) .textContent.substring(0,o);break} __get$(n,i) .textContent=""}},updatedSug:function(t,e){var n,a,i,o;if(!this.data.get("existCustomNode")&&!this.data.get("promptOptimizerVisible")){var r=this.data.get("fileList");if("agent"!==e||!(null==r?void 0:r.length)){var s=null==(n=this.inputPanel)?void 0:n.data.get("showPanel");"common"===e&&s||(null==(a=this.inputPanel)||a.closePanel(),null==(i=this.ref("sug"))||i.getSugList(t,e),this.data.get("needInvokeSug")&&(null==(o=this.ref("sug"))||o.openSug(e)))}}},handleInputChange:function(){var t=this;Ou(this.richEditor),this.nextTick((function(){var e,n,a,i=t.richEditor,o=i.innerText||"",r=function(t){if(!(null==t?void 0:t.childNodes))return!1;for(var e,n=wu(t.childNodes);!(e=n()).done;){var a,i=e.value;if(null==i||null==(a=i.className)?void 0:a.includes(bu))return!0}return!1}(i);(t.data.set("existCustomNode",r),t.data.set("showPlaceholderOnce",!1),t.data.get("hasAgent"))?(t.data.set("agentContent",null==(e=t.agentDom)?void 0:e.innerText),t.data.set("textContent", __call$(o,"replace",[null==(n=t.agentDom)?void 0:n.innerText,""]) )):t.data.set("textContent",o);if(t.data.get("breakRowStatus")||"\n"!==o&&0!==o.length)if(t.data.set("showPlaceholder",!1),t.data.get("hasAgent")){var s,l=t.el.querySelector(".cs-pc-input-agent");if(!l||!l.innerText)null==(s=t.agentEmptyDom)||s.remove(),t.agentEmptyDom=null,t.clearAgentStatus();var c,d=it(),u=t.data.get("isComposing");if(l&&!l.nextSibling)u&&yd(),null==(c=t.agentEmptyDom)||c.remove(),t.agentEmptyDom=null,d.isSafari&&t.addAgentHolder();t.updatedSug(t.data.get("textContent"),"common")}else if(o.includes("@")&&!t.data.get("isExtension")){var p=o.substring(o.lastIndexOf("@")+1);t.updatedSug(p,"agent")}else t.updatedSug(o,"common");else t.clearInput(),t.data.set("showPlaceholder",!0),null==(a=t.ref("sug"))||a.closeSug();t.data.set("inputContent",o)}))},handleClick:function(){if(this.emitInputActive(),"focus"===this.data.get("inputStatus")){this.data.set("needInvokeSug",!0);var t=this.data.get("inputContent");if(this.data.get("hasAgent"))this.updatedSug(this.data.get("textContent"),"common");else if(-1===this.data.get("inputContent").indexOf("@")||this.data.get("isExtension"))this.updatedSug(t,"common");else{var e=t.substring(t.lastIndexOf("@")+1);this.updatedSug(e,"agent")}}},emitInputActive:function(){document.querySelector(".global-feedback-form")&&qa().emit()},handleFocused:function(){var t=it(),e=this.el.querySelector(".cs-pc-input-agent");t.isSafari&&e&&!(null==e?void 0:e.nextSibling)&&setTimeout((function(){yd()}),0),on.dispatch("update",{pcInputFocusTime:Date.now()}),this.data.set("inputStatus","focus")},isElementInViewport:function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},handleInput:function(t){var e,n,a,i,o;(this.data.get("inputCopyInfo.isInputCopy")&&this.data.set("inputCopyInfo.isInputCopyModified",!0),this.data.set("needInvokeSug",!0),this.data.set("userHasInput",!0),this.emitInputActive(),(null==(e=this.data.get("searchInfo"))?void 0:e.prompt_polish)&&this.data.set("searchInfo.prompt_polish.is_edit",1),null==(n=this.ref("promptOptimizer"))||n.updateCancelStatus("edit"),""!==(null==t||null==(a=t.target)?void 0:a.textContent)||(null==(i=this.data.get("fileList"))?void 0:i.length))||(null==(o=this.ref("promptOptimizer"))||o.cancel(eu.INPUT_CLEAR))},handleBlur:function(){var t=this;this.data.set("inputStatus","blur"),setTimeout((function(){var e;null==(e=t.ref("sug"))||e.closeSug()}),200)},handleKeyUp:function(t){var e=this;this.nextTick((function(){var n=e.data.get("inputContent").trim();if("@"!==t.key||e.data.get("hasAgent")||e.data.get("isExtension")){if(n.includes("@")&&!e.data.get("hasAgent")&&!e.data.get("isExtension")){var a=n.substring(n.lastIndexOf("@")+1);e.updatedSug(a,"agent")}}else e.updatedSug("","agent");"Shift"!==t.key&&"Meta"!==t.key&&"Control"!==t.key||setTimeout((function(){e.data.set("breakRowStatus",!1)}),100)}))},handleKeyDown:function(t){var e=this;if(Ru(t),"Enter"===t.key){if(!this.data.get("isCustomInput")&&(this.data.get("breakRowStatus")||t.shiftKey||t.metaKey||t.ctrlKey)){var n,a=this.richEditor.scrollHeight;setTimeout((function(){e.richEditor.scrollHeight<=a&&e.insertAtRange(document.createElement("br"))}),50),null==(n=this.ref("sug"))||n.closeSug()}else if(!this.data.get("isComposing")){t.preventDefault();var i=this.data.get("inputContent").trim();if(!this.data.get("isCustomInput")&&this.data.get("breakRowStatus"))return;if(this.sendInputLog("input"),this.data.get("hasAgent")){var o=this.data.get("agentInfo");this.launchSearch({query:this.data.get("textContent"),extParams:{agentInfo:o}})}else t.preventDefault(),this.launchSearch({query:i})}}else"Shift"===t.key||"Meta"===t.key||"Control"===t.key?this.data.set("breakRowStatus",!0):this.data.set("breakRowStatus",!1)},handleTouchMove:function(t){t.stopPropagation&&t.stopPropagation()},handleCompositionStart:function(){this.data.set("isComposing",!0)},handleCompositionEnd:function(){var t=this;this.nextTick((function(){t.data.set("isComposing",!1)}))},handleIconInputClick:function(){this.sendInputLog("ask"),this.launchSearch()},handlePauseClick:function(){Xn().emit(),this.data.set("isShowPauseButton",!1)},handlePaste:function(t){var n=this;t.preventDefault();var a=t.clipboardData||window.clipboardData;if(a){for(var i,o,r,s={},l="",c=Bu(a.items||[]);!(i=c()).done;){var d=i.value;if("file"===d.kind){s=d.getAsFile();var u=(o=s.name,r=void 0,(r=fi.exec(o))?r[0]:"");fe.includes(u)?l="file":he.includes(u)&&(l="image")}}l&&this.handleUplaod(l,s);var p="";t.clipboardData?p=t.clipboardData.getData("text/plain"):window.clipboardData&&(p=window.clipboardData.getData("Text")),p.length&&this.handleInput();var h=this.richEditor,f=this.data.get("maxLength");h.innerText.length+p.length>f&&(p=p.slice(0,f-h.innerText.length),e.Toast.show({message:"最多发送5000字符内容"}));var g=p.split("\n");g.forEach((function(t,e){var a=document.createTextNode(t);n.insertAtRange(a),e!==g.length-1&&n.insertAtRange(document.createElement("br"))})),this.isCursorAtEnd()&&(this.richEditor.scrollTop=this.richEditor.scrollHeight)}},insertAtRange:function(t){var e=document.getSelection();if(e.rangeCount){var n=e.getRangeAt(0);n.deleteContents(),n.insertNode(t),n.setStartAfter(t),n.setEndAfter(t),e.removeAllRanges(),e.addRange(n)}},isCursorAtEnd:function(){var t=window.getSelection().getRangeAt(0),e=t.cloneRange();return e.selectNodeContents(this.richEditor),e.setStart(t.endContainer,t.endOffset),0===e.toString().length},sendInputLog:function(t){Ua({ubcId:"17132",type:"click",value:"nonala_cpt",ext:{re_rank:String(on.getState("rank")),a_lid:on.getState("apagelid"),lid:on.getState("lid"),ori_lid:on.getState("oriLid"),setype:"csaitab",action:t,valueInfo:[{component_name:"input"}]}})},disposed:function(){this.listenUpperSearchbox&&zn().off(this.listenUpperSearchbox),this.listenShowPauseButton&&ga().off(this.listenShowPauseButton),this.listenOpenInputUpload&&Da().off(this.listenOpenInputUpload),this.listenGetUpdatedSa&&Aa().off(this.listenGetUpdatedSa),this.listenUpperSearchbox=null,this.listenShowPauseButton=null,this.listenOpenInputUpload=null,this.listenGetUpdatedSa=null}}));function Gu(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Wu(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var zu=Tt.connect(on,{topRank:"topRank",rank:"rank",userInfo:"user"})(a.defineComponent({agentDom:null,richEditor:null,trimWhitespace:"all",screenHeight:window.innerHeight,template:'\n        <div class="cs-rich-input {{inputStatus === \'focus\' ? \'input-wrap-focus\' : \'input-wrap-blur\'}}">\n            \x3c!-- 联网搜索按钮 --\x3e\n            <div\n                s-if="showOnlineBtn && !isHarmony"\n                class="\n                    cs-input-model-button\n                    {{ internetChecked ? \'cs-input-model-button-active\' : \'cs-input-model-button-inactive\' }}\n                "\n                on-click="handleInternetSearch()"\n            >\n                <div>\n                    <cos-icon\n                        name="original"\n                        class="cs-input-model-icon"\n                    />\n                    {{onlineText}}\n                </div>\n            </div>\n            <div s-if="inputStatus !== \'focus\'" class="cs-input-go-back-wrap" on-click="back">\n                <cos-icon name="left" />\n            </div>\n            <div\n                s-ref="inputWrap"\n                class="\n                    input-wrap\n                    {{inputStatus === \'focus\' ? \'input-wrap-focus\' : \'\'}}\n                "\n            >\n                \x3c!-- 未登录mask --\x3e\n                <div s-if="!userInfo.isUserLogin" class="input-wrap-unlogin-mask" on-click="handleUnLoginClick($event)">\n                </div>\n                \x3c!-- 输入框 --\x3e\n                <div class="input-container input-container-single-line" >\n                    <textarea\n                        id="chat-input-box"\n                        s-ref="inputField"\n                        class="cs-pc-input-custom input-fields {{!textContent ? \'empty-input\' : \'no-empty-input\'}}\n                            {{inputStatus !== \'focus\' ? \'input-fields-blur\' : \'input-fields-focus\'}}\n                        "\n                        enterkeyhint="send"\n                        rows="{{rows}}"\n                        on-click="handleClick"\n                        on-focus="handleFocused"\n                        on-input="handleInput($event)"\n                        on-blur="handleBlur"\n                        on-keydown="handleKeyDown($event)"\n                        on-keyup="handleKeyUp($event)"\n                        on-touchmove="handleTouchMove($event)"\n                        on-paste="handlePaste($event)"\n                    ></textarea>\n                    <div s-if="!textContent" class="input-fields-placeholder">\n                        {{isHarmony ? harmonyPlaceHolder : placeholder}}\n                    </div>\n                    <div s-ref="hideContent" class="input-hide-content">{{textContent}}</div>\n\n                    <div class="cs-input-ds-btn-wrap {{inputStatus === \'focus\' ? \'cs-input-ds-hide-btn-wrap\' : \'\'}}">\n                        <div s-if="showCloseBtn" class="cs-input-ds-close-btn" on-click="native:handleCloseClick()">\n                            <cos-icon name="close-circle-fill">\n                        </div>\n                        <div\n                            s-if="showSendBtn"\n                            class="cs-input-ds-send-btn cs-input-function-btn {{!textContent ? \'empty-input-btn\' : \'\'}}"\n                            on-click="native:handleIconInputClick($event)"\n                        >发送</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',components:{"cos-icon":e.Icon},initData:function(){return{placeholder:"可以问我任何问题",showPlaceholder:!0,textContent:"",maxLength:2e3,inputStatus:"blur",initFocusIndex:"",removeTargetIndex:"",currentAgentFirstSearch:!1,isComposing:!1,userHasInput:!1,defaultContent:"",updatedSa:"",rows:1,internetChecked:!1,onlineText:"联网搜索",showOnlineBtn:!1,rank:0,isHarmony:pt()}},computed:{showSendBtn:function(){var t=this.data.get("textContent");return this.data.get("isHarmony")?!!t:"focus"===this.data.get("inputStatus")||t},showCloseBtn:function(){return this.data.get("isHarmony")&&"focus"===this.data.get("inputStatus")&&this.data.get("textContent")},harmonyPlaceHolder:function(){return this.data.get("userInfo.isUserLogin")?"可以问我任何问题...":"点击登录即可高效解答"}},created:function(){var t=this,e=on.getState("chatParams"),n=on.getState("chatParams").sse_host+"/aichat/api/aitabserver?action=shortcuts&ctl=deepseek&t="+(e.sge_lid||(new Date).getTime())+"&tk="+sc();!this.data.get("isHarmony")&&Li(n,{credentials:"include"},2e3).then((function(e){if(0===e.status&&e.data){var n,a,i,o=(null==(n=e.data.blocks)?void 0:n[0])||{},r=(null==(i=o.data)||null==(a=i.items)?void 0:a[0])||{};if("shortcuts"===o.component&&"deepseek_online"===r.type){var s;r.text&&t.data.set("onlineText",r.text),t.data.set("showOnlineBtn",!0);var l={};try{var c=JSON.parse(localStorage.getItem(ye))||{};"DeepSeek-R1"===c.modelName&&(l=c)}catch(t){l=on.getState("usedModel")||{}}t.data.set("internetChecked","1"===(null==l||null==(s=l.modelFunction)?void 0:s.internetSearch))}}})).catch((function(){on.dispatch("update",{usedModel:{modelName:"DeepSeek-R1"}}),localStorage.setItem(ye,'{"modelName":"DeepSeek-R1"}')}))},attached:function(){var t=this;this.richEditor=this.ref("inputField"),this.listener(),this.dsInputBlur=this.dsInputBlur.bind(this),this.watch("rank",(function(e){e&&t.data.set("placeholder","你可以继续问")}))},listenUpperSearchbox:null,listenShowPauseButton:null,listenGetUpdatedSa:null,listener:function(){var t=this;this.listenUpperSearchbox=Xi((function(e){e.noClear||t.clearTextInput(),t.clearInput(),t.upperPcInput(e,"text")}),500),zn().on(this.listenUpperSearchbox),this.listenShowPauseButton=function(e){var n=e.isShowButton,a=void 0!==n&&n;t.data.set("isShowPauseButton",a)},ga().on(this.listenShowPauseButton),this.listenGetUpdatedSa=function(e){var n=e.sa;e.isAgent?t.data.set("agentSa",n):t.data.set("updatedSa",n)},Aa().on(this.listenGetUpdatedSa),window.visualViewport.addEventListener("resize",this.resizeHandler)},resizeHandler:function(){var t=this;setTimeout((function(){window.innerHeight===t.screenHeight&&t.dsInputBlur()}),300)},disposed:function(){this.listenUpperSearchbox&&(zn().off(this.listenUpperSearchbox),this.listenUpperSearchbox=null),this.listenShowPauseButton&&(ga().off(this.listenShowPauseButton),this.listenShowPauseButton=null),this.listenGetUpdatedSa&&(Aa().off(this.listenGetUpdatedSa),this.listenGetUpdatedSa=null),window.visualViewport.removeEventListener("resize",this.resizeHandler)},clearInput:function(){this.richEditor.innerText="",this.data.set("userHasInput",!1)},clearTextInput:function(){var t=this.richEditor;t.value="",this.data.set("textContent",""),this.data.set("rows",1);for(var e=t.childNodes,n=e.length-1;n>=0;n--)3!== __get$(e,n) .nodeType&&"FONT"!== __get$(e,n) .nodeName|| __get$(e,n) .remove();this.data.set("userHasInput",!1)},handleCloseClick:function(){this.richEditor.focus(),this.richEditor.value="",this.data.set("textContent",""),this.data.set("rows",1)},handleUnLoginClick:function(t){t.stopPropagation(),t.preventDefault(),gs()},launchSearch:function(t,n){return void 0===t&&(t={}),void 0===n&&(n="notSug"),(a=function(){var a,i,o,r,s,l;return Wu(this,(function(c){switch(c.label){case 0:if(!(on.getState("rank")>=ws()))return[3,5];a=null,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,gs()];case 2:return a=c.sent(),[3,4];case 3:return i=c.sent(),console.error(i),[3,4];case 4:if(!a)return[2];c.label=5;case 5:return on.dispatch("update",{pcInputTime:Date.now()-on.getState("pcInputFocusTime")}),o=t.query||this.data.get("textContent"),(r=o.trim())?(s=this.data.get("updatedSa"),l=this.updateSa(n,r,s),(this.data.get("isHarmony")?Gs:Us)().emit({name:"search",params:{query:r,sa:l}}),this.clearTextInput(),this.richEditor.blur(),this.data.set("agentSa",""),this.data.set("updatedSa",""),this.data.set("sa",""),[2]):(e.Toast.show({message:"请输入你的问题"}),[2])}}))},function(){var t=this,e=Array.from(arguments);return new Promise((function(n,i){var o=a.apply(t,e);function r(t){Gu(o,n,i,r,s,"next",t)}function s(t){Gu(o,n,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var a},updateSa:function(t,e){var n,a="",i="sug"!==t?"bkb":"bks",o=this.data.get("userHasInput"),r="link"===(null==(n=(Gd(e)||[])[1])?void 0:n.type);return(a=r?"searchbox_link":a)&&r?o&&(a=i+"_"+a):a=a||i,a},upperPcInput:function(t){var e=document.createTextNode(t.word),n=this.richEditor;"query"===t.type?n.appendChild(e):n.insertBefore(e,n.firstChild)},handleFocused:function(){var t=this;this.updateRowNum(),on.dispatch("update",{pcInputFocusTime:Date.now()}),this.nextTick((function(){t.data.set("inputStatus","focus"),t.dispatch("toggle-input-mask",{showMask:!0})})),setTimeout((function(){!t.data.get("isHarmony")&&window.scroll({top:document.body.scrollHeight,left:0,behavior:"smooth"}),window.addEventListener("touchmove",t.dsInputBlur)}),500),Ma().emit({focus:!0,height:this.data.get("showOnlineBtn")&&!this.data.get("isHarmony")?141:99})},isElementInViewport:function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},handleInput:function(t){var e,n,a=this.richEditor.value||"";this.data.set("textContent",a),this.updateRowNum(),"\n"===a||0===a.length?(this.clearInput(),this.data.set("showPlaceholder",!0)):this.data.set("showPlaceholder",!1),this.data.set("needInvokeSug",!0),this.data.set("userHasInput",!0);var i=window.getSelection().getRangeAt(0).startOffset,o=null==t||null==(e=t.target)?void 0:e.innerText;if(o){var r= __call$(o,"replace",[/[\r\n]+/g," "]) ;(null==t?void 0:t.target)&&(t.target.innerText=r);var s=document.createRange(),l=window.getSelection();s.setStart((null==t||null==(n=t.target)?void 0:n.firstChild)||(null==t?void 0:t.target),i),s.collapse(!0),l.removeAllRanges(),l.addRange(s)}},handleBlur:function(){var t=this;this.data.set("rows",1),this.richEditor.scrollTop=0,this.nextTick((function(){t.data.set("inputStatus","blur"),t.dispatch("toggle-input-mask",{showMask:!1})})),window.removeEventListener("touchmove",this.dsInputBlur),Ma().emit({focus:!1,height:this.data.get("showOnlineBtn")&&!this.data.get("isHarmony")?119:77})},handleKeyUp:function(t){var e=this;this.nextTick((function(){var n=e.data.get("textContent").trim();"Enter"!==t.key||e.data.get("isComposing")||(e.sendInputLog("input"),e.launchSearch({query:n}))}))},handleKeyDown:function(t){"Enter"===t.key&&t.preventDefault()},handleTouchMove:function(t){t.stopPropagation&&t.stopPropagation()},handleIconInputClick:function(t){t.stopPropagation(),this.sendInputLog("ask"),this.launchSearch()},handlePaste:function(){this.updateRowNum()},handleInternetSearch:function(){"focus"===this.data.get("inputStatus")&&this.richEditor.focus();var t=!this.data.get("internetChecked"),e={modelName:"DeepSeek-R1",modelFunction:{internetSearch:t?"1":"0"}};this.data.set("internetChecked",t),on.dispatch("update",{usedModel:e}),localStorage.setItem(ye,JSON.stringify(e)),Ua({type:"click",value:"online_btn",ext:{is_open:t?"1":"0",enter_type:on.getState("enterType"),a_lid:on.getState("apagelid")}})},insertAtRange:function(t){var e=document.getSelection();if(e.rangeCount){var n=e.getRangeAt(0);n.deleteContents(),n.insertNode(t),n.setStartAfter(t),n.setEndAfter(t),e.removeAllRanges(),e.addRange(n)}},isCursorAtEnd:function(){var t=window.getSelection().getRangeAt(0),e=t.cloneRange();return e.selectNodeContents(this.richEditor),e.setStart(t.endContainer,t.endOffset),0===e.toString().length},sendInputLog:function(t){Ua({ubcId:"17132",type:"click",value:"nonala_cpt",ext:{re_rank:String(on.getState("rank")),a_lid:on.getState("apagelid"),lid:on.getState("lid"),ori_lid:on.getState("oriLid"),setype:"csaitab",action:t,valueInfo:[{component_name:"input"}]}})},updateRowNum:function(){var t=this;this.nextTick((function(){var e=t.ref("hideContent"),n=parseInt(getComputedStyle(e).lineHeight||"20",10),a=Math.ceil(e.offsetHeight/n);t.data.set("rows",a>4?4:a<1?1:a)}))},dsInputBlur:function(){"focus"===this.data.get("inputStatus")&&this.richEditor.blur()},back:function(){this.data.get("isHarmony")?Hn().conversation.goBack.emit():history.back()}})),Qu=Tt.connect(on,{inputBox:"manifest.inputBox"})(a.defineComponent({template:'\n        \x3c!--输入框默认结构 语音 + 文本--\x3e\n        <div class="chat-input-box-pc">\n            <ds-input s-if="isDeepSeekPage || isHarmony" />\n            <text-input s-else />\n        </div>\n    ',components:{"text-input":Uu,"ds-input":zu},initData:function(){return{isDeepSeekPage:lt(),isHarmony:pt()}}}));function Ju(t){return"font-size-"+(t<1?"0":1===t?"1":t>1&&t<1.1?"2":"3")}function Vu(){return Vu=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Vu.apply(this,Array.from(arguments))}function Ku(t){var e,n,a="baiduboxapp://searchframe/transportDurationParams?params=",i={};Object.keys(t).forEach((function(e){ __get$(t,e) &&( __set$(i,e,__get$(t,e)) )})),a+=encodeURIComponent(JSON.stringify({extClickParams:i})),e=a,(n=document.createElement("iframe")).style.display="none",n.src=e,document.body.appendChild(n),setTimeout((function(){document.body.removeChild(n),n=null}),200)}function Xu(t,e){var n=t,a=function(t){var e=document.body,n=t.closest("a");if(n&&n.getAttribute("href"))return n;var a=null,i=t;for(;i&&i!==e;){var o=i.hasAttribute("rl-node"),r=i.getAttribute("rl-type"),s=i.getAttribute("rl-link-href");if("stop"===r||"button"===r)break;if(o&&s){a=i;break}i=i.parentNode}return a}(t);if(!a||!a.classList.contains("WA_LOG_XCX")){var i={t:Date.now(),vd_cyc:"0"},o=function(t,e,n){e=e||document.documentElement;var a=[];for(;t&&t!==e;){var i=Yu(t),o=t.getAttribute("data-module");a.push(t.nodeName.toLowerCase()+(i>0?i+1:"")+(o?"("+o+")":"")),t=t.parentNode}return a.reverse().join("-").slice(0,n)}(t,n,150);o&&-1!==o.indexOf("vd-cyc")&&(i.vd_cyc="1"),Ku(Vu({},function(t){var e={};for(;t&&t!==document.body;){var n=t.getAttribute("data-time-log");if(n)try{e= __call$(Object,"assign",[JSON.parse(n),e]) }catch(t){console.error(t)}t=t.parentNode}return e}(t),i,e||{}))}}function Yu(t){for(var e=0,n=t.previousSibling;n;)n.tagName===t.tagName&&e++,n=n.previousSibling;return e}function Zu(){return Zu=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Zu.apply(this,Array.from(arguments))}var tp={},ep=!1,np="https://m.baidu.com/tc?";function ap(t){if("pc"===rt()){var e=t.ubcId,n=t.page,a=t.type,i=t.source,o=t.value,r=t.ubcExt;Ua(Zu({ubcId:e||"17132",page:n||"resultpage",type:a||"click"},i?{source:i}:{},{value:o,ext:Zu({setype:"csaitab",ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(on.getState("rank")),a_lid:on.getState("apagelid")},r)}))}else{delete t.ubcExt;var s=t.clk_info||{};ip(t.clk_info)&&(t.clk_info=t.clk_info||{},t.clk_info.t=Date.now(),t.clk_info=JSON.stringify(t.clk_info)),ip(t.extra)&&(t.extra=JSON.stringify(t.extra)),s.tplname&&t.order&&(t.ala_clk=[s.tplname,t.order,0,10,"o"].join("_"));var l=[];Object.keys(t).forEach((function(e){l.push(e+"="+encodeURIComponent( __get$(t,e) ))}));var c=l.join("&"),d=new Image;d.onload=d.onerror=d.onabort=function(){d.onload=d.onerror=d.onabort=null,d=null},d.src=np+c}}function ip(t){return"[object Object]"===Object.prototype.toString.call(t)}function op(t,e){var n={};n=ip(t.clk_info)&&ip(e.clk_info)? __call$(Object,"assign",[{},t.clk_info,e.clk_info]) :t.clk_info||e.clk_info;var a={};a=ip(t.extra)&&ip(e.extra)? __call$(Object,"assign",[{},t.extra,e.extra]) :t.extra||e.extra;var i={};return i=ip(t.ubcExt)&&ip(e.ubcExt)? __call$(Object,"assign",[{},t.ubcExt,e.ubcExt]) :t.ubcExt||e.ubcExt, __call$(Object,"assign",[t,e,{extra:a,clk_info:n,ubcExt:i}]) }function rp(t,e){if(!t)return!1;for(var n={},a="",i=e,o=[],r=0;t&&t!==document.body;){if("1"===t.getAttribute("data-nolog"))return!1;var s=t.getAttribute("data-click-log");if(s)try{n=op(JSON.parse(s),n)}catch(t){console.error(t)} __get$(t,"href") &&(a= __get$(t,"href") ),t.hasAttribute("need-click-log")&&(i=!0);var l=1;if(t.previousSibling){var c=t.previousSibling;do{1===c.nodeType&&c.tagName===t.tagName&&l++,c=c.previousSibling}while(c)}var d=t.getAttribute("data-module");d=d?"("+d+")":"", __set$(o,r++,t.tagName+(l>1?l:"")+d) ,t=t.parentNode}if(!i)return!1;"a"===t.tagName.toLowerCase()&&(a= __get$(t,"href") ||a);var u=o.reverse().join("-").toLowerCase();return n.clk_info=n.clk_info||{},n.clk_info.xpath=u,n}function sp(t){var e,n=rp(t.target,!1);!1!==n&&(op(n,tp),"pc"===rt()||!t.target||1==+n.tcreq4log&&1!=+(null==(e=n.clk_info)?void 0:e.cyc)||Xu(t.target,{}),ap(n))}function lp(t,e,n){t=function(t,e){var n={};return t&&(n.clk_info=t,n.extra=t.extra,n.ubcExt=t.ubcExt),void 0!==(null==e?void 0:e.tplname)&&(n.clk_info.tplname=e.tplname),void 0!==(null==e?void 0:e.srcid)&&(n.clk_info.srcid=e.srcid),void 0!==(null==e?void 0:e.order)&&(n.order=e.order),void 0!==(null==t?void 0:t.cyc)&&(n.cyc=t.cyc),n.clk_info.extra&&delete n.clk_info.extra,n.clk_info.cyc&&delete n.clk_info.cyc,"pc"===rt()&&t&&t.value&&(n.value=t.value),n}(t||{},e);var a={};n&&(a=rp(n,!0)),op(a,op(t,tp)),"pc"===rt()||!n||1==+a.tcreq4log&&1!=+a.cyc||Xu(n,{srcid:e.srcid,tplname:e.tplname,order:e.order,lid:e.lid}),ap(a)}var cp="aitab_tool_tip_shown",dp=a.defineComponent({trimWhitespace:"all",computed:{ubcShowLog:function(){var t;return JSON.stringify(((t={value:"questionClosely_toast",ori_lid:on.getState("oriLid"),lid:on.getState("lid")}).ori_lid=on.getState("oriLid"),t.re_rank=String(+on.getState("rank")),t.setype="csaitab",t))}},initData:function(){return{visible:!1,text:"",position:{x:0,y:0},autoHideTimer:null}},attached:function(){this.checkShouldShow(),this.documentClickHandler=this.handleDocumentClick.bind(this),document.addEventListener("click",this.documentClickHandler)},disposed:function(){document.removeEventListener("click",this.documentClickHandler);var t=this.data.get("autoHideTimer");t&&clearTimeout(t)},checkShouldShow:function(){var t=localStorage.getItem(cp);Boolean(t)||(this.show(),localStorage.setItem(cp,"true"))},show:function(){var t=this;this.data.set("visible",!0);var e=setTimeout((function(){t.hide()}),3e3);this.data.set("autoHideTimer",e)},hide:function(){this.data.set("visible",!1)},handleDocumentClick:function(t){var e=this.el;e&&e.contains(t.target)?(this.hide(),this.fire("tooltip-click")):this.hide()}}),up={};up= __call$(Object,"assign",[up,{tooltip:"tooltip_a2aa3_1",tooltipContent:"tooltip-content_a2aa3_6","tooltip-content":"tooltip-content_a2aa3_6",tooltipArrow:"tooltip-arrow_a2aa3_19","tooltip-arrow":"tooltip-arrow_a2aa3_19"}]) ,dp.template='\n    <div\n        s-if="visible"\n        data-show-area\n        data-show-ext="{{ubcShowLog}}"\n        class="{{$style[\'tooltip\']}}"\n        style="left: {{position.x}}px; top: {{position.y}}px"\n    >\n        <div class="{{$style[\'tooltip-content\']}}">\n            {{text}}\n            <div class="{{$style[\'tooltip-arrow\']}}"></div>\n        </div>\n    </div>\n';var pp="function"==typeof dp?dp.prototype.initData||hp:dp.initData||hp;function hp(){return{$style:up}}function fp(){return  __call$(Object,"assign",[{},pp.call(this),{$style:up}]) }function gp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function mp(){return mp=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},mp.apply(this,Array.from(arguments))}function vp(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return gp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gp(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}"function"==typeof dp?dp.prototype.initData=fp:dp.initData=fp;var yp="h5",wp="aiSearch",bp="chatSearch",_p="multiSearch",kp=a.defineComponent({trimWhitespace:"all",computed:{ubcClickLog:function(){var t,e=this.data.get("componentArea")||((null==(t=on.getState("agentInfo"))?void 0:t.agentName)?"agent_answer":"answer");return JSON.stringify({type:"click",value:"nonala_cpt",ubcExt:{valueInfo:[{component_name:"questionClosely",component_type:"long",component_area:e}]}})},multiRecommendWord:function(){var t=this.data.get("recommendWord")||[],e=t.length,n=Math.floor(e/2);if(!e)return[];t.forEach((function(t,a){t.index=a,a===n-1&&(t.rowLastItem=!0),a===e-1&&(t.rowLastItem=!0)}));var a=[t.slice(0,n),t.slice(n)];return a[0].rowIndex=1,a}},components:{"cos-icon":e.Icon,"cos-image":e.Image,"tool-tip":dp},initData:function(){var t,e;return{url:"",recommendWord:[],stk:"",sa:"re_dl_prob",word:"",context:{},isSingleCol:"1",isShort:"0",logExt:{},jumpTypes:[bp,wp],urlParams:null,componentArea:"",isPc:"pc"===rt(),logExtParams:{},aiTabWeatherExperiment:!1,hideTopAgentList:on.getState("hideTopAgentList"),dataShowExt:"",deepThinkData:"",startShowLog:"false",isRight:"1"===(null==(e=on.getState("sample"))||null==(t=e.variables)?void 0:t.AI_TAB_RIGHT),isExtension:vt(),tipPosition:{x:25,y:-50},prefix:""}},attached:function(){this.checkLineWrapping()},getImgURL:function(t){if(!(null==t?void 0:t.img))return"";var e=window.matchMedia("(prefers-color-scheme: dark)"),n=t.img;return e.matches?n=t.imgDark||n:Mi()&&(n=t.imgNight||n),n},checkLineWrapping:function(){var t=this,e=this.data,n=[];e.get("recommendWord").forEach((function(a,i){var o="item"+i,r=t.ref(o);if(r){var s="",l=0;if("agentRec"===a.type?(s=r.querySelector(".cs-question-closely-agent-content"),l=25):(s=r.querySelector(".cs-question-closely-agent-text"),l=23),s){var c=s.offsetHeight>l;e.set("recommendWord["+i+"].isWrapped",c),c&&n.push(String(i+1))}}})),this.data.set("qFoldPos",n),this.updateShowExt()},getGuideWordType:function(t,e){return t?"agent":e?"mcp":"common"},updateShowExt:function(){var t,e=this.data.get("recommendWord"),n= __get$(e,e.length-1) ,a=!!Array.isArray(e)&&e.some((function(t){return t.isMcp})),i=(null==n?void 0:n.agentInfo)||on.getState("agentInfo")||{},o=i.agentSearchId,r=i.agentName,s=this.data.get("logExt")||{},l=this.data.get("logExtParams")||{},c=[],d=[],u=!1;e.forEach((function(t){if("agentRec"===t.type){u=!0;var e=t.agentInfo;e&&c.push(e.agentName+e.label)}else c.push(t.text);d.push(String(t.modelType))}));var p=this.data.get("componentArea")||((null==(t=on.getState("agentInfo"))?void 0:t.agentName)?"agent_answer":"answer"),h="";if(this.data.get("hideTopAgentList")&&(h="weather"),this.data.set("dataShowExt",JSON.stringify(mp({component_content:{component_name:"questionClosely",component_area:h||p,component_type:this.data.get("recommendWord").length?"1"===this.data.get("isShort")?"short":"long":"text",component_strategy:d},agent_id:o,agent_name:r,guide_word_type:this.getGuideWordType(u,a),scene:s.scene||l.scene,scene_1st:s.scene_1st||l.scene_1st,scene_2nd:s.scene_2nd||l.scene_2nd,rec_strategy:s.rec_strategy,value:"nonala_cpt",photoQuestions:this.data.get("photoQuestions"),text:c,q_fold_pos:this.data.get("qFoldPos"),mingliInfo:l.mingliInfo},l.current_model?{current_model:l.current_model}:{}))),e.length&&e[0].usedModel){var f=e[0].usedModel.modelName||"";this.data.set("deepThinkData",JSON.stringify({value:"deep_think",satisfy_model:f,enter_type:on.getState("pcEnterType")}))}this.data.set("startShowLog","true"),this.nextTick((function(){ho()}))},handleClick:function(t,e,n){this.data.get("urlParams")||(e.stopPropagation(),e.preventDefault());var a=(null==t?void 0:t.url)||this.data.get("url")||"",i=(null==t?void 0:t.jumpType)||"",r="linkText"===(null==t?void 0:t.theme),s=r?"":(null==t?void 0:t.text)||"",l=this.data.get("word")||"",c=(this.data.get("context")||{}).scene||"",d=this.data.get("sa")||"",u=this.data.get("stk")||"",p=(null==t?void 0:t.urlQuery)||"",h=(null==t?void 0:t.value)||"",f=this.data.get("recommendWord["+n+"].isWrapped"),g=t.diyUrl||"",m=(null==t?void 0:t.isMcp)||!1,v={ubcExt:{q_fold_pos:f?String(n+1):void 0}},y=this.data.get("prefix"),w={asyncApi:null==t?void 0:t.asyncApi,url:a,text:h||s,word:l,index:n,sa:d,stk:u,component:"questionClosely"};if(h&&(w.showText=s),g)o.canIUse("search.open")?o.search.open({url:g,notShowLandingTopBar:0,isContainer:"1",statusBarStyle:2,config:'{"immersed":1,"hideBack":1,"background":"#09090A"}'}):window.open(g,"_blank");else{p&&(w.urlQuery=p),y&&(w.prefix=y),(null==t?void 0:t.agentInfo)&&(w.agentInfo=t.agentInfo,v.ubcExt={agent_name:t.agentInfo.agentName,agent_id:t.agentInfo.agentSearchId});var b,_=mp({},(null==t?void 0:t.scene)&&{scene:t.scene},(null==t?void 0:t.extData)&&{extData:t.extData},(null==t?void 0:t.interaction_type)&&{extData:{searchInfo:{interaction_type:t.interaction_type}}});if( __call$(Object,"assign",[w,_]) ,null==t?void 0:t.usedModel)w.usedModel=t.usedModel,v.ubcExt={query:w.text,satisfy_model:null==(b=t.usedModel)?void 0:b.modelName,enter_type:on.getState("pcEnterType")};"pc"===rt()?lp(v,{},e.target):t?this.handleLog("na",r?"hat":"bub",{index:n,text:s,agentInfo:t.agentInfo,scene:t.scene,q_fold_pos:f?String(n+1):void 0,isMcp:m}):this.handleLog("na","ask");var k,S=this.data.get("jumpTypes")||[],x=( __set$(k={},wp,"aiSearch.open") , __set$(k,bp,"search.chatSearchOpen") ,k);if("a-page"===c||"chat-search"===c){if( __get$(x,i) &&o.canIUse( __get$(x,i) )||i===_p||i===yp)return void this.dispatch("ai-question-closely:click",{data:w,type:i});for(var I,T=vp(S);!(I=T()).done;){var C=I.value;if( __get$(x,C) &&o.canIUse( __get$(x,C) )||C===_p||C===yp){this.dispatch("ai-question-closely:click",{data:w,type:C});break}}}}},handleLog:function(t,e,n){var a=n||{},i=a.index,o=a.text,r=a.agentInfo,s=a.scene,l=a.q_fold_pos,c=a.isMcp,d=r||on.getState("agentInfo")||{},u=this.data.get("logExt")||{},p=this.data.get("logExtParams")||{},h=this.data.get("componentArea"),f= __get$(this.data.get("recommendWord"),i) .modelType,g=mp({action:e,agent_id:d.agentSearchId,agent_name:d.agentName,guide_word_type:this.getGuideWordType(null==r?void 0:r.agentName,c),scene:u.scene||p.scene,scene_1st:u.scene_1st||p.scene_1st,scene_2nd:u.scene_2nd||p.scene_2nd,rec_strategy:u.rec_strategy,q_fold_pos:l},p.current_model?{current_model:p.current_model}:{});u.groupStyle&&(g.groupStyle=u.groupStyle);var m=this.data.get("recommendWord").length?"1"===this.data.get("isShort")?"short":"long":"text";"na"===t&&(g.bub_pos="bub"===e?i:"",g.zhuiwen_content="bub"===e?o:"",g.bot_pos="bub"===e?"bubble":"hat"===e?"hat":"",this.data.get("hideTopAgentList")?(g.component_content={component_name:"questionClosely",component_area:"weather",component_type:m},g.area="weather"):g.component_type=m),this.fire("action-log-event",{component:"questionClosely",strategy:String(f),type:m,componentType:"",componentArea:p.componentArea||h,actionType:t,ext:g,scene:s})},ubcClickLog:function(t){var e,n,a=this.data.get("componentArea")||((null==(e=on.getState("agentInfo"))?void 0:e.agentName)?"agent_answer":"answer"),i=this.data.get("logExtParams")||{},o= __get$(this.data.get("recommendWord"),t) .modelType,r=this.data.get("recommendWord");return 0===t&&r.length&&(null==(n=r[0])?void 0:n.usedModel)?JSON.stringify({type:"click",value:"deep_think",ubcExt:{}}):JSON.stringify({type:"click",value:"nonala_cpt",ubcExt:mp({bub_pos:t,valueInfo:[{component_name:"questionClosely",component_type:"long",component_area:a,component_strategy:String(o)}]},i)})}}),Sp={};Sp= __call$(Object,"assign",[Sp,{closelyMultiContainer:"closely-multi-container_1ap7s_1","closely-multi-container":"closely-multi-container_1ap7s_1",firstRowContainer:"first-row-container_1ap7s_4","first-row-container":"first-row-container_1ap7s_4",rowContainer:"row-container_1ap7s_7","row-container":"row-container_1ap7s_7",guideWord:"guide-word_1ap7s_10","guide-word":"guide-word_1ap7s_10",multiCloselyWordItem:"multi-closely-word-item_1ap7s_15","multi-closely-word-item":"multi-closely-word-item_1ap7s_15",imgBox:"img-box_1ap7s_24","img-box":"img-box_1ap7s_24",img:"img_1ap7s_24",text:"text_1ap7s_33",rowLastItemStyle:"row-last-item-style_1ap7s_38","row-last-item-style":"row-last-item-style_1ap7s_38",closelyMultiStyle:"closely-multi-style_1ap7s_41","closely-multi-style":"closely-multi-style_1ap7s_41",csQuestionCloselyAgentContent:"cs-question-closely-agent-content_1ap7s_97","cs-question-closely-agent-content":"cs-question-closely-agent-content_1ap7s_97",aiIndexAgentLine:"ai-index-agent-line_1ap7s_106","ai-index-agent-line":"ai-index-agent-line_1ap7s_106",agentInfo:"agent-info_1ap7s_115","agent-info":"agent-info_1ap7s_115",modelImg:"model-img_1ap7s_133","model-img":"model-img_1ap7s_133",questionCloselyImg:"question-closely-img_1ap7s_137","question-closely-img":"question-closely-img_1ap7s_137",csQuestionCloselyAnimation0:"cs-question-closely-animation-0_1ap7s_186","cs-question-closely-animation-0":"cs-question-closely-animation-0_1ap7s_186",questionCloselyShow1:"questionCloselyShow1_1ap7s_1",csQuestionCloselyAnimation1:"cs-question-closely-animation-1_1ap7s_190","cs-question-closely-animation-1":"cs-question-closely-animation-1_1ap7s_190",questionCloselyShow2:"questionCloselyShow2_1ap7s_1",csQuestionCloselyAnimation2:"cs-question-closely-animation-2_1ap7s_193","cs-question-closely-animation-2":"cs-question-closely-animation-2_1ap7s_193",questionCloselyShow3:"questionCloselyShow3_1ap7s_1",followQuestionRight:"follow-question-right_1ap7s_196","follow-question-right":"follow-question-right_1ap7s_196",agentAvatarWrapper:"agent-avatar-wrapper_1ap7s_200","agent-avatar-wrapper":"agent-avatar-wrapper_1ap7s_200",agentAvatarWrapperImg:"agent-avatar-wrapper-img_1ap7s_205","agent-avatar-wrapper-img":"agent-avatar-wrapper-img_1ap7s_205"}]) ,kp.template='\n    <div\n        data-module="ai_questionClosely"\n        data-show-area\n        need-show-log="{{startShowLog}}"\n        data-show-ext="{{aiTabWeatherExperiment && hideTopAgentList ? \'\' : dataShowExt}}"\n        class="cs-question-closely-container cs-question-closely-wrapper"\n    >\n        <div s-if="{{isSingleCol ===\'1\' && !aiTabWeatherExperiment}}">\n            <div\n                s-for="item, index in recommendWord"\n                class="\n                    {{$style[\'cs-question-closely-animation-\' + index]}}\n                    {{isRight ? $style[\'follow-question-right\'] : \'\'}}\n                "\n                data-click-log="{{ubcClickLog(index)}}"\n                s-ref="{{\'item\' + index}}"\n            >\n                <tool-tip\n                    s-if="{{item.tipText}}"\n                    text="{{item.tipText}}"\n                    position="{{tipPosition}}"\n                />\n                <div\n                    s-if="{{item.type === \'agentRec\'}}"\n                    class="\n                        cs-question-closely-agent\n                        cs-question-closely-single-bub\n                    "\n                    on-click="handleClick(item, $event, index)"\n                >\n                    \x3c!-- 此dom里面只能使用 inline 元素，不然会导致2行溢出截断失效 --\x3e\n                    <span class="cs-question-closely-agent-content cos-line-clamp-2">\n                        <span\n                            class="{{$style[\'agent-avatar-wrapper\']}}"\n                        >\n                            <img class="{{$style[\'agent-avatar-wrapper-img\']}}" src="{{item.agentInfo.logo}}" />\n                        </span>\n                        {{item.agentInfo.agentName}}\n                        <span class="{{$style[\'ai-index-agent-line\']}}"></span>\n                        {{item.agentInfo.label}}\n                    </span>\n                </div>\n                <div\n                    s-else\n                    class="cs-question-closely-single-bub"\n                    style="{{item.color ?\n                    \'color:\' + item.color + \';\'\n                    + \'--common-color-border:\' + recommendWord[0].color + \';\' :\n                    \'\'}}"\n                    data-show-ext="{{item.usedModel ? deepThinkData : \'\'}}"\n                    on-click="handleClick(item, $event, index)"\n                >\n                    <div s-if="item.img || item.icon" class="cos-space-mr-xxs {{$style[\'question-closely-img\']}}">\n                        <cos-image\n                            s-if="item.img"\n                            src="{{getImgURL(item)}}"\n                            class="\n                                cos-image-fit-contain\n                                cos-image-position-center\n                                cos-image-1-1\n                                cs-question-closely-single-bub-img\n                                {{item.usedModel ? $style[\'model-img\'] : \'\'}}\n                            "\n                        />\n                        <cos-icon\n                            s-if="{{item.icon}}"\n                            name="{{item.icon}}"\n                            class="cs-question-closely-bub-icon"\n                        />\n                    </div>\n                    <span\n                        class="cs-question-closely-agent-text cos-line-clamp-{{isExtension ? \'1\' : \'2\'}}"\n                    >\n                        {{item.text}}\n                    </span>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- AI助手首页天气入口实验: 追问区域 --\x3e\n        <div\n            s-else-if="{{aiTabWeatherExperiment && hideTopAgentList && multiRecommendWord.length}}"\n            class="{{$style[\'closely-multi-container\']}}"\n        >\n            <div class="{{$style[\'guide-word\']}}">\n                <p\n                    class="cos-line-clamp-2 cos-text-body-lg cos-color-text cos-space-mt-none cos-space-mb-none"\n                >{{guideWord}}</p>\n            </div>\n            <div class="ai-question-closely-multi {{$style[\'closely-multi-style\']}}">\n                <div\n                    s-for="dataListItem in multiRecommendWord"\n                    class="\n                        ai-question-closely-multi-row\n                        {{dataListItem.rowIndex === 1 ? $style[\'first-row-container\'] : \'\'}}\n                        {{$style[\'row-container\']}}\n                    "\n                >\n                    <div\n                        data-show-ext="{{dataShowExt}}"\n                        s-for="item in dataListItem"\n                        on-click="handleClick(item, $event, item.index)"\n                        class="\n                            {{$style[\'multi-closely-word-item\']}}\n                            {{item.rowLastItem ? $style[\'row-last-item-style\'] : \'\'}}\n                        "\n                    >\n                        <div class="{{$style[\'img-box\']}}">\n                            <img src="{{item.img}}" class="{{$style[\'img\']}}"/>\n                        </div>\n                        <div class="{{$style[\'text\']}}">\n                            {{item.text}}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n';var xp="function"==typeof kp?kp.prototype.initData||Ip:kp.initData||Ip;function Ip(){return{$style:Sp}}function Tp(){return  __call$(Object,"assign",[{},xp.call(this),{$style:Sp}]) }function Cp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Lp(){return Lp=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Lp.apply(this,Array.from(arguments))}function Dp(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Cp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cp(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pp(t){var e=document.createElement("iframe");e.style.display="none",e.src=t;var n=document.body||document.getElementsByTagName("body")[0];n.appendChild(e),setTimeout((function(){n.removeChild(e),e=null}),0)}function Ep(t){var e=function(t){return  __call$(__call$(t,"replace",[/^[\u200C]/,""]),"replace",[/(\r?\n)[\u200C]/g,"$1"]) }(t);return new Promise((function(t,n){var a=document.createElement("textarea");a.style.background="transparent",a.setAttribute("readonly","readonly"),a.value=e,document.body.appendChild(a),a.select(),a.setSelectionRange(0,e.length);try{document.execCommand("copy",!1)?t("复制成功"):n(new Error("复制失败"))}catch(t){n(t)}finally{document.body.removeChild(a),setTimeout((function(){}),0)}}))}function Ap(t,e,n){for(var a,i=Dp(t.querySelectorAll(e));!(a=i()).done;){var o=a.value;!n&&(null==o?void 0:o.parentNode)&&o.parentNode.removeChild(o),o.innerHTML=n}return t}"function"==typeof kp?kp.prototype.initData=Tp:kp.initData=Tp;var Op=function(t,e,n){if(void 0===e&&(e=""),void 0===n&&(n=-1),!t)return"";if(t.children&&t.children.length&&t.children[0].tagName){if("IMG"===t.children[0].tagName)return"下面是一张图片。";if("IFRAME"===t.children[0].tagName)return"下面是一张卡片。"}var a=t.cloneNode(!0);-1!==n&&(a.innerHTML=a.innerHTML.substring(0,n));a.innerHTML= __call$(a.innerHTML,"replace",[/<style(.*?)<\/style>/g,""]) ;var i,o=Ap(a,"[out-audio]",""),r=Ap(o,"[disable-tts],[disable-audio]",""),s=Ap(r,"pre code","下面是一段代码。"),l=Ap(s,"table","下面是一个表格。"),c=Ap(l,"svg","下面是一个图表。"),d=Ap(c,"sup",""),u=(i=null==d?void 0:d.innerText.trim(),/。|？|\?|!|！|;|；|\t|\r|\v|\n/.test( __get$(i,i.length-1) )?i.substring(0,i.length-1):i);return e&&e===u.slice(0,e.length)&&(u=u.slice(e.length)),u};function Rp(t,e,n,a){void 0===e&&(e=0),void 0===n&&(n="1"),void 0===a&&(a=2),t&&(t.startsWith("baiduboxapp:")?Pp(t):o.canIUse("search.open")?o.search.open({url:t,notShowLandingTopBar:e,isContainer:n,statusBarStyle:a,config:'{"immersed":1,"hideBack":1}'}):window.open(t,"_blank"))}function Np(t,e,n,a){if(void 0===n&&(n={}),e&&(null==t?void 0:t.component)&&(null==t?void 0:t.actionType)){var i=["na","sf","xcx","mip","l"].indexOf(t.actionType)>-1,o={component_content:Lp({component_name:t.component,component_strategy:t.strategy,component_type:t.type},t.componentType?{component_type:t.componentType}:{},t.componentArea?{component_area:t.componentArea}:{})},r=Lp({type:t.actionType},i?{cyc:1}:{},i&&n.launchMultiSearch?{ol_rec:1}:{});if(t.ext){n.action&&i?r.action=n.action:t.ext.action&&(r.action=t.ext.action);var s=t.ext;delete s.action, __call$(Object,"assign",[o,s]) }"markdown"===t.component&&"reference"===t.componentType&&"na"===t.actionType&&(r.action="sup"),r.extra=o,lp(r,e,a)}}function Mp(t,e){var n=e.trim(),a=t.trim(),i=/[\u4e00-\u9fa5]/.test(a),o=/[\u4e00-\u9fa5]/.test(n);return(i? __call$(a,"replace",[/\s+/g,""]) .length:a?a.split(/\s+/).length:0)+(o? __call$(n,"replace",[/\s+/g,""]) .length:n?n.split(/\s+/).length:0)}function qp(){return qp=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},qp.apply(this,Array.from(arguments))}var jp=a.defineComponent({recordHeight:0,computed:{componentType:function(){switch(this.data.get("askComponentData").component){case"askBack":return"sc-ask-back";case"questionClosely":return"ai-question-closely";case"input":return"sc-ai-input"}return"div"},agentInfo:function(){var t;return null==(t=this.data.get("askComponentData"))?void 0:t.agentInfo}},components:{"ai-question-closely":kp,"sc-ask-back":n.AIAskBack},messages:{"ai-ask-back:input-send":function(t){this.launchSearch(t.value.targetStr,"re_dl_reply")},"ai-ask-back:input-change":function(){this.prefetchAiTab("re_dl_reply")},"ai-ask-back:change":function(t){if(this.prefetchAiTab("re_dl_reply"),this.data.get("chatSearchAiTabInfo").isAiTab){var e=t.value;Hn().conversation.updataTag.emit(qp({cardId:this.data.get("tplInfo.lid"),categoryName:e.categoryName,categoryId:e.categoryId,tagList:e.tagList},e.extra))}else{var n="select"===t.value.selectionStatus,a=this.data.get("askBackSelectCount");this.data.set("askBackSelectCount",n?a+1:a-1)}},"ai-question-closely:click":function(t){this.dispatch("ai-question-closely:click",t.value);var e,n,a=t.value.data.text,i=t.value.data,o=i.agentInfo,r=i.index,s=i.asyncApi,l=i.url,c=i.scene,d=i.extData,u=i.usedModel,p=i.prefix,h=void 0===p?"":p;if("numerologyForm"===c&&(on.dispatch("update",{truncQueryIndexRange:[h.length,h.length+a.length]}),a=h+a),o)return"jumpLink"===o.actionType&&(null==(e=o.jump_url)?void 0:e.zbios)?void Pp(o.jump_url.zbios):(Cs(qp({},o,{startIndex:0,endIndex:null==(n=o.agentName)?void 0:n.length}),"prob_agent"),void Ds(o,on.getState("query")));if(s&&l)Hn().conversation.asyncBubClick.emit({asyncApi:s,url:l,rank:this.data.get("rank")});else{if("photoQuestion"===c)ca().emit();else{var f=r+1,g=this.data.get("sa")?this.data.get("sa")+"_"+f:"re_dl_prob";this.launchSearch(a,g,u,d)}this.prefetchAiTab("re_dl_prob")}},"ai-input:input-send":function(t){this.launchSearch(t.value.data.text,"re_dl_input"),this.fire("ai-input-send")},"ai-input:input-change":function(){this.prefetchAiTab("re_dl_input")}},initData:function(){return{sa:"",askComponentData:[],tplInfo:{},canLaunchMultiSearch:!0,isSingleCard:!1,askBackSelectCount:0,theme:null,tabName:"",initRank:1,chatSearchAiTabInfo:{isChatSearchAiTabExperiment:!1,isAiTab:!1},hasPreScrollLogic:!1,chatParams:{},curAgentInfo:null}},listenTag:null,attached:function(){this.data.get("chatSearchAiTabInfo").isAiTab&&(this.listenTag=this.askTagEventHandle.bind(this),Hn().container.deleteTag.on(this.listenTag),Hn().container.submitTag.on(this.listenTag)),this.data.get("hasPreScrollLogic")&&this.observeAskBack()},disposed:function(){this.listenTag&&(Hn().container.deleteTag.off(this.listenTag),Hn().container.submitTag.off(this.listenTag),this.listenTag=null)},observeAskBack:function(){var t=this,e=this.ref("askComponent").ref("inputField").el;if(e){new MutationObserver((function(){var n=e.clientHeight;0!==n&&n!==t.recordHeight&&(t.dispatch("update-swiper-height"),t.recordHeight=n)})).observe(e,{childList:!0,subtree:!0,characterData:!0,attributes:!0})}},askTagEventHandle:function(t){this.fire("tag-event",{data:t,el:this.ref("askComponent")})},launchSearch:function(t,e,n,a){void 0===n&&(n={}),void 0===a&&(a=null);var i=this.data.get("askComponentData.data"),o=i.jumpType,r=i.baseUrl,s=i.xcxParams;if(o&&r)this.openPage(o,{baseUrl:r,xcxParams:s},t);else{var l=this.data.get("chatSearchAiTabInfo"),c=l.isChatSearchAiTabExperiment,d=l.isAiTab;c&&(d?this.launchMultiRoundSearch(t,e,n,a):this.jumpToAiTab(t,e)),t&&this.data.get("canLaunchMultiSearch")&&this.launchMultiRoundSearch(t,e,n,a)}},launchMultiRoundSearch:function(t,n,a,i){var o,r,s=this;void 0===a&&(a={}),void 0===i&&(i=null),this.data.get("tabName")&&(window.sgeSpringTab=this.data.get("tabName")),this.data.set("askComponentData.data.showLoading",!0);this.data.get("isSingleCard");var l=this.data.get("tplInfo");l.order,this.data.get("askBackSelectCount"),this.data.get("theme");var c,d=this.data.get("agentInfo"),u=null==(o=this.data.get("askComponentData"))?void 0:o.actionLid,p=this.data.get("curAgentInfo");p&&this.fire("update-agent-info",{agentInfo:qp({},p,{startIndex:0,endIndex:null==(c=p.agentName)?void 0:c.length})});(null==d||null==(r=d.agent_id)?void 0:r[0])&&this.fire("update-agent-info",{agentInfo:{agentSearchId:d.agent_id[0],agentParams:u?{actionLid:u}:{}}});var h={sa:l.srcid?n+"_"+l.srcid:n,usedModel:a,searchInfo:null==i?void 0:i.searchInfo};a.modelName&&(h.sa="deepthink"),i&&(h.csextdata=i),Xl({query:t,extParams:h}).then((function(){s.data.set("askComponentData.data.showLoading",!1)})).catch((function(t){if(s.data.set("askComponentData.data.showLoading",!1),!t||"string"!=typeof t)throw t;e.Toast.show({message:t})}))},beforeScrollUnderSGE:function(){var t=this;return new Promise((function(e){t.dispatch("update-swiper-height"),setTimeout((function(){e()}),400)}))},jumpToAiTab:function(t,n){var a=this;this.data.set("askComponentData.data.showLoading",!0);var i=this.data.get("tplInfo");this.chatSearch.jumpAiTab({appendQuery:t,sa:n+"_"+i.srcid}).then((function(){a.data.set("askComponentData.data.showLoading",!1)})).catch((function(t){a.data.set("askComponentData.data.showLoading",!1),t&&e.Toast.show({message:t})}))},prefetchAiTab:function(t){var e=this.data.get("chatSearchAiTabInfo"),n=e.isChatSearchAiTabExperiment,a=e.isAiTab;n&&!a&&this.chatSearch.aiTabPrefetch({sa:"no_pv_"+t+"_"+this.data.get("tplInfo").srcid})},handleUbcLog:function(t){var e=this.data.get("agentInfo"),n=e.agentSearchId,a=e.agentName,i=t.ext,o=i.bub_pos,r=i.zhuiwen_content;Ua({rank:on.getState("rank"),type:"click",value:"agent_guide",ext:{agent_id:n,agent_name:a,guide_info:r,guide_pos:o+1}})},handleActionLogEvent:function(t){var e;if("pc"!==rt()&&this.data.get("isAgentGreeting"))this.handleUbcLog(t);else{var n=this.data.get("canLaunchMultiSearch"),a=this.data.get("chatSearchAiTabInfo").isChatSearchAiTabExperiment,i="";n&&"askBack"===t.component?i="invokesge":a&&"askBack"===t.component&&(i="invokecsaitab"),this.data.get("askComponentData.data.jumpType")&&(t.actionType=this.data.get("askComponentData.data.jumpType")),t.ext||(t.ext={});var o=0;"photoQuestion"===t.scene&&(o=1),t.ext.is_photo_questions=o,t.ext.photo_questions=this.data.get("askComponentData.data.photoQuestions"),this.data.get("askComponentData.data.action")&&(i=this.data.get("askComponentData.data.action"));var r=this.data.get("askComponentData.data"),s=r.jumpType,l=r.baseUrl;Np(t,this.data.get("tplInfo"),{action:i,launchMultiSearch:!s||!l},null==(e=this.ref("askComponent"))?void 0:e.el)}}}),Bp={aiQuestionCloselySingleBubIcon:"ai-question-closely-single-bub-icon_bfwq8_1","ai-question-closely-single-bub-icon":"ai-question-closely-single-bub-icon_bfwq8_1"},Hp={};jp.template='\n    <component\n        s-ref="askComponent"\n        s-if="{{askComponentData.data}}"\n        s-is="{{componentType}}"\n        styles="{{$sAskBack}}"\n        s-bind="{{askComponentData.data}}"\n        log-ext-params="{{askComponentData.logExt}}"\n        on-action-log-event="handleActionLogEvent"\n    />\n';var $p,Fp="function"==typeof jp?jp.prototype.initData||Up:jp.initData||Up;function Up(){return{$style:Hp,$sAskBack:Bp}}function Gp(){return  __call$(Object,"assign",[{},Fp.call(this),{$style:Hp,$sAskBack:Bp}]) }function Wp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function zp(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Qp(){return Qp=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Qp.apply(this,Array.from(arguments))}function Jp(t,e){return Jp=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Jp(t,e)}function Vp(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Wp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wp(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Kp(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof jp?jp.prototype.initData=Gp:jp.initData=Gp,function(t){t.MODEL="model",t.FUNCTION="function"}($p||($p={}));var Xp="chat-search-model-function-tip-show",Yp=[{key:"isShowModelTooltip",type:$p.MODEL},{key:"isShowFunctionTooltip",type:$p.FUNCTION}],Zp=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).cancelTargetClickSign=!1,e.tempCloseListFunc=null,e.tempCloseTipFunc=null,e.tempScrollFunc=null,e.listenCheckoutChatModel=null,e.listenModelFuncData=null,e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jp(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{haveDocumentListener:null,capsuleData:[],modelFuncData:[],modelList:[],useInnerUploader:!0,isModelListOpen:!1,logExtParams:{},isShowModelTooltip:!1,isShowFunctionTooltip:!1,shouldModelListEnter:!1,modelQuotaTips:Se,loadingModelId:"",modelTip:"",hideCapsule:!1,selectedModelId:"",isModelInNA:Wi(),getPopupContainer:function(){return document.querySelector(".capsules-box")},openDelay:0,needShowLog:"false",capsulesShowUbcLog:""}},n.inited=function(){var t=Ve.getModelTip(),e=this.getFunctionTip();if(t&&(this.data.set("modelTip",t),this.data.set("isShowModelTooltip",!0)),e){var n=this.data.get("isShowModelTooltip")?5e3:0;this.data.set("openDelay",n),this.data.set("isShowFunctionTooltip",!0)}this.useModelAction=new Vi(on)},n.attached=function(){var t=this;this.fire("rendered"),this.tempCloseListFunc=this.handleCloseModelList.bind(this),this.tempCloseTipFunc=this.handleCloseToolTip.bind(this),this.tempScrollFunc=Xi(this.handleCloseModelList,1e3,{trailing:!1,leading:!0}).bind(this),Hs().on(this.handleCloseModelList.bind(this)),$s().on(this.handleCloseModelList.bind(this)),Js().on(this.handleCloseModelList.bind(this)),Ma().on(this.handleInputFocus.bind(this)),this.autoCloseTooltip(),this.globalClickHandler=function(e){var n;(null==(n=e.target)?void 0:n.closest(".capsules-model-list"))||t.tempCloseListFunc()},this.watch("isModelListOpen",(function(e){e?(document.addEventListener("click",t.globalClickHandler,!0),t.fire("model-list-show")):(document.removeEventListener("click",t.globalClickHandler,!0),t.cancelTargetClickSign=!0,t.nextTick((function(){t.cancelTargetClickSign=!1})))})),document.addEventListener("touchmove",this.tempScrollFunc),document.addEventListener("click",this.tempCloseTipFunc,!0),this.listenModelFuncData=function(e){t.data.set("modelFuncData",e.modelFuncData),t.data.set("needShowLog","true"),t.onCardShow()},Hn().component.showModelFunData.on(this.listenModelFuncData),this.data.get("isModelInNA")&&(this.listenCheckoutChatModel=function(e){var n,a=null==(n=e.params)?void 0:n.selectedId;try{localStorage.setItem(we,JSON.stringify(a))}catch(t){}t.data.set("selectedModelId",a);for(var i,o=Vp(t.data.get("modelList"));!(i=o()).done;){var r=i.value;if(r.checked=r.id===a,r.id===a){t.useModelAction.handleSelectModel(r),t.data.set("modelFuncData",r.modelFuncData);break}}t.handleCloseToolTip()},Hn().container.checkoutChatModel.on(this.listenCheckoutChatModel)),di(ci(),"15.12.0")>=0&&this.watch("modelList",(function(e){var n,a=t.data.get("selectedModelId"),i=null==e?void 0:e.find((function(t){return t.id===a})),o="1"===(null==i||null==(n=i.modelFunction)?void 0:n.mcpSwitch);Hn().conversation.enableLocation.emit({enable:o?1:0})}))},n.detached=function(){document.removeEventListener("click",this.tempCloseListFunc,!0),document.removeEventListener("click",this.tempCloseTipFunc,!0),document.removeEventListener("touchmove",this.tempScrollFunc)},n.disposed=function(){this.listenCheckoutChatModel&&(Hn().container.checkoutChatModel.off(this.listenCheckoutChatModel),this.listenCheckoutChatModel=null),this.listenModelFuncData&&(Hn().component.showModelFunData.off(this.listenModelFuncData),this.listenModelFuncData=null)},n.onCardShow=function(){var t=this,e=this.data.get("tplInfo")||{},n=e.tplname,a=void 0===n?"":n,i=e.srcid,o=void 0===i?"":i,r=this.data.get("modelFuncData").map((function(t){return t.text})),s=JSON.stringify({value:"capsule_bub",capsule_content:r,action_type:this.data.get("modelFuncData").map((function(t){return t.type})),tplname:a,srcid:o,valueInfo:[{component_name:"shortcuts"}],is_query:this.data.get("isQuery"),enter_type:this.data.get("enterType")});this.data.set("capsulesShowUbcLog",s),this.nextTick((function(){var e;ho(),(e=t.el.parentElement)&&e.querySelectorAll&&e.querySelectorAll("[data-show-area]").forEach((function(t){uo.forceTrigger(t)}))}))},n.handleCloseModelList=function(){var t=this;this.data.set("shouldModelListEnter",!1),setTimeout((function(){t.data.set("isModelListOpen",!1)}),150)},n.handleCloseToolTip=function(){var t=this;Yp.forEach((function(e){t.data.get(e.key)&&t.data.set(e.key,!1)}))},n.autoCloseTooltip=function(){var t=this;Yp.forEach((function(e){var n=t.data.get(e.key),a=t.data.get("openDelay"),i="isShowModelTooltip"===e.key?5e3:5e3+a;n&&(t.fire("tooltip-show",e.type),setTimeout((function(){t.data.set(e.key,!1)}),i))}))},n.realShowExt=function(t,e){return JSON.stringify(Qp({component_content:{component_name:"shortcuts"},value:"capsule_bub",capsule_content:[{agent_id:null==t?void 0:t.agentId,agent_name:null==t?void 0:t.text,agent_pos:e+""}]},this.data.get("logExtParams")))},n.handleCapsuleClick=function(t,e){this.handleCloseToolTip(),this.fire("click",Qp({},t,{itemIndex:e}))},n.handleInternetSearch=function(){var t=this.data.get("internetChecked");this.useModelAction.toggleInternetSearch(),this.fire("function-click",{status:!t,value:"online_btn"})},n.handleDeepThink=function(){var t=this.data.get("deepThinkChecked");this.useModelAction.toggleDeepThink(),this.fire("function-click",{status:!t,value:"ds_btn"})},n.handleMcp=function(){var t=this.data.get("mcpChecked");this.useModelAction.toggleMcp(),this.fire("function-click",{status:!t,value:"mcp_btn"})},n.handleModelFuncDataClick=function(t,e){"deep_think"===t.type?this.handleDeepThink():"internet_search"===t.type?this.handleInternetSearch():"mcp_switch"===t.type?this.handleMcp():this.fire("click",Qp({},t,{itemIndex:e}))},n.handleOpenModelList=function(){var t=this;this.data.get("isModelListOpen")||this.cancelTargetClickSign||(this.data.set("isModelListOpen",!0),setTimeout((function(){t.data.set("shouldModelListEnter",!0)}),50))},n.handleSelectModel=function(t,e){var n,a=this;return(n=function(){var n,i;return Kp(this,(function(o){switch(o.label){case 0:return(null==t?void 0:t.checked)||!(null==t?void 0:t.enable)?[2]:(a.data.set("loadingModelId",t.id),n=a.data.get("curModel"),[4,a.useModelAction.handleSelectModel(t)]);case 1:return i=o.sent(),a.data.set("loadingModelId",""),a.handleCloseToolTip(),a.handleCloseModelList(),i&&(a.fire("select-model",{model:t,oldModel:n,curIndex:e}),a.data.set("modelFuncData",t.modelFuncData)),[2]}}))},function(){var t=this,e=Array.from(arguments);return new Promise((function(a,i){var o=n.apply(t,e);function r(t){zp(o,a,i,r,s,"next",t)}function s(t){zp(o,a,i,r,s,"throw",t)}r(void 0)}))})()},n.handleCapsuleMouseenter=function(t,e){this.fire("mouseenter",{event:t,data:e})},n.handleCapsuleMouseleave=function(t,e){this.fire("mouseleave",{event:t,data:e})},n.handleUploadSuccess=function(t){this.fire("img-upload-success",t)},n.handleInputFocus=function(t){this.data.set("hideCapsule",t.focus)},n.capsuleBackground=function(t){if(!(null==t?void 0:t.background))return"";var e=null==t?void 0:t.background.split("-")[0];return"background:\n            radial-gradient(96.47% 101.09% at 1.47% 1.52%,"+e+" 0%, "+((null==t?void 0:t.background.split("-")[1])||e)+" 100%);"},n.getDarkURL=function(t){if(!(null==t?void 0:t.icon))return"";var e=window.matchMedia("(prefers-color-scheme: dark)"),n=t.icon;return e.matches&&dt()?n=t.iconNight||n:ot.isDarkMode&&ct()&&(n=t.iconDark||n),n},n.iconUrl=function(t){return"background-image: url("+this.getDarkURL(t)+")"},n.modelIconUrl=function(t){return this.getDarkURL(t)},n.getFunctionTip=function(){return!localStorage.getItem(Xp)&&(localStorage.setItem(Xp,"1"),!0)},e}(a.Component);function th(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function eh(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function nh(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){eh(o,a,i,r,s,"next",t)}function s(t){eh(o,a,i,r,s,"throw",t)}r(void 0)}))}}function ah(){return ah=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},ah.apply(this,Array.from(arguments))}function ih(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return th(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?th(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function oh(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Zp.template='\n        <div\n            s-show="{{!hideCapsule}}"\n            class="capsules-box"\n            data-show-area\n            need-show-log="{{needShowLog}}"\n            data-show-ext="{{capsulesShowUbcLog}}"\n        >\n            <slot name="prefix" />\n            <div\n                s-if="{{isShowModelList}}"\n                class="\n                    capsules-model-list\n                    {{ shouldModelListEnter ? \'capsules-model-list-enter\' : \'\'}}\n                "\n            >\n                <div\n                    s-for="item, index in modelList"\n                    class="{{item.enable || item.hasPermission ? \'\' : \'capsules-model-list-item-disabled\'}}"\n                >\n                    <div s-if="{{index !== 0}}" class="cos-divider capsules-model-list-item-divider"></div>\n                    <div\n                        class="capsules-model-list-item"\n                        on-click="handleSelectModel(item, index)"\n                    >\n                        <div class="capsules-model-list-item-text">\n                            <div class="capsules-model-list-item-title">{{item.name}}</div>\n                            <div class="capsules-model-list-item-desc">\n                                {{item.enable || item.hasPermission ? item.desc : (item.failText || modelQuotaTips)}}\n                            </div>\n                        </div>\n                        <cos-icon s-if="item.checked" name="check-circle-fill" class="capsules-model-list-item-icon" />\n                        <span s-if="loadingModelId === item.id" class="capsules-model-list-item-icon-loading"></span>\n                    </div>\n                </div>\n            </div>\n            <cos-swiper class="capsules-container">\n                <cos-swiper-item s-if="{{showModelCapsules}}">\n                    <cos-tooltip\n                        trigger="custom"\n                        open="{{isShowModelTooltip}}"\n                        content="{{modelTip}}"\n                        bubbleClass="capsules-model-tip"\n                    >\n                        <div\n                            class="capsules-item-tag-model cos-font-medium"\n                            on-click="handleOpenModelList"\n                            data-show-ext="{{modelSelectShowLog}}"\n                        >\n                            <img class="capsules-item-tag-model-icon" src="{{curModel.icon}}"/>\n                            <div class="capsules-item-tag-model-title">{{curModel.title}}</div>\n                            <cos-icon\n                                class="\n                                    capsules-item-tag-model-arrow\n                                    {{shouldModelListEnter ? \'\' : \'capsules-item-tag-model-arrow-rotated\'}}\n                                "\n                                name="caret-down"\n                            />\n                        </div>\n                    </cos-tooltip>\n                </cos-swiper-item>\n                <fragment s-if="modelFuncData.length > 0">\n                    <cos-swiper-item\n                        s-for="item, index in modelFuncData"\n                        class="capsules-item"\n                    >\n                        <cos-tooltip\n                            trigger="custom"\n                            open="{{item.tooltip && isShowFunctionTooltip}}"\n                            openDelay="{{openDelay}}"\n                            content="{{item.tooltip}}"\n                            bubbleClass="capsules-function-tip"\n                            getPopupContainer="{{getPopupContainer}}"\n                        >\n                            <div\n                                s-if="!item.iconSelected\n                                    && (!item.type ||\n                                        (\n                                            item.type !== \'deep_think\' &&\n                                            item.type !== \'internet_search\' &&\n                                            item.type !== \'mcp_switch\'\n                                        )\n                                    )"\n                                class="\n                                    {{item.icon ? \'\' : \'capsules-item-text\'}}\n                                    capsules-model-button cos-font-medium\n                                    capsules-click-opacity\n                                "\n                                on-click="handleModelFuncDataClick(item, index)"\n                            >\n                                <i\n                                    s-if="item.type === \'link\' && !item.iconDark"\n                                    style="{{iconUrl(item)}}"\n                                    class="capsules-link-icon"\n                                />\n                                <img\n                                    s-else\n                                    src="{{modelIconUrl(item)}}"\n                                    class="capsules-model-img {{getClassByIconSize(item)}}"\n                                />\n                                {{item.text}}\n                            </div>\n                            <div\n                                s-elif="\n                                    item.type === \'deep_think\' ||\n                                    item.type === \'internet_search\' ||\n                                    item.type === \'mcp_switch\'\n                                "\n                                class="{{item.icon ? \'\' : \'capsules-item-text\'}} cos-font-medium"\n                                on-click="handleModelFuncDataClick(item, index)"\n                                data-show-area\n                                data-show-ext="{{\n                                    item.type === \'deep_think\' ? deepThinkShowLog\n                                    : (item.type === \'mcp_switch\' ? mcpShowLog : \'\')\n                                }}"\n                            >\n                                <div\n                                    class="capsules-model-button {{getButtonClassByIconSize(item)}}\n                                        {{ (item.type === \'deep_think\' && deepThinkChecked) || \n                                        (item.type === \'internet_search\' && internetChecked) ||\n                                        (item.type === \'mcp_switch\' && mcpChecked)\n                                        ? \'capsules-model-button-active\' \n                                        : \'\' }}"\n                                >\n                                    <img\n                                        src="{{ \n                                            (item.type === \'deep_think\' && deepThinkChecked) || \n                                            (item.type === \'internet_search\' && internetChecked) ||\n                                            (item.type === \'mcp_switch\' && mcpChecked)\n                                            ? item.iconSelected \n                                            : modelIconUrl(item)\n                                        }}"\n                                        class="capsules-model-img"\n                                    />\n                                    {{item.text}}\n                                </div>\n                            </div>\n                            <div s-elif="{{(item.type === \'uploadImage\' || item.type === \'imageUpload\')\n                                && useInnerUploader}}"\n                            >\n                                <cos-image-uploader\n                                    max-count="{{item.options && item.options.maxCount || \'1\'}}"\n                                    max-compressed-dimension="1000"\n                                    on-success="handleUploadSuccess"\n                                >\n                                    <div\n                                        on-click="handleCapsuleClick(item, index)"\n                                        class="\n                                            {{item.icon ? \'\' : \'capsules-item-text\'}}\n                                            capsules-model-button cos-font-medium\n                                        "\n                                    >\n                                        <i s-if="item.icon" style="{{iconUrl(item)}}"></i>\n                                        {{ item.text }}\n                                    </div>\n                                </cos-image-uploader>\n                            </div>\n                        </cos-tooltip>\n                    </cos-swiper-item>\n                </fragment>\n            </cos-swiper>\n        </div>\n    ',Zp.components={"cos-tooltip":e.Tooltip,"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem,"cos-image-uploader":e.ImageUploader,"cos-icon":e.Icon},Zp.computed={deepThinkShowLog:function(){var t=this.data.get("curModel")||{};return JSON.stringify({type:"show",value:"ds_btn",current_model:t.id,is_open:this.data.get("deepThinkChecked")?1:0})},mcpShowLog:function(){var t=this.data.get("curModel")||{};return JSON.stringify({type:"show",value:"mcp_btn",current_model:t.id,is_open:this.data.get("mcpChecked")?1:0})},selectedModelId:function(){var t=this.data.get("modelList"),e="";return t.forEach((function(t){t.checked&&(e=t.id)})),e},isShowModelList:function(){if(this.data.get("isModelInNA"))return!1;var t=this.data.get("modelList"),e=this.data.get("isModelListOpen");return Array.isArray(t)&&0!==t.length&&e},showModelCapsules:function(){return!this.data.get("isModelInNA")&&!!(this.data.get("curModel")||{}).id},curModel:function(){var t=this.data.get("modelList"),e=this.data.get("selectedModelId");return null==t?void 0:t.find((function(t){return t.id===e}))},internetChecked:function(){var t,e=this.data.get("modelList"),n=this.data.get("selectedModelId"),a=null==e?void 0:e.find((function(t){return t.id===n}));return"1"===(null==a||null==(t=a.modelFunction)?void 0:t.internetSearch)},deepThinkChecked:function(){var t,e=this.data.get("modelList"),n=this.data.get("selectedModelId"),a=null==e?void 0:e.find((function(t){return t.id===n}));return"1"===(null==a||null==(t=a.modelFunction)?void 0:t.deepThink)},mcpChecked:function(){var t,e=this.data.get("modelList"),n=this.data.get("selectedModelId"),a=null==e?void 0:e.find((function(t){return t.id===n}));return"1"===(null==a||null==(t=a.modelFunction)?void 0:t.mcpSwitch)},modelSelectShowLog:function(){var t=this.data.get("selectedModelId");return JSON.stringify({value:"ask_model_btn",current_model:t})}};var rh,sh,lh=1048576,ch="/aichat/api/pic_upload",dh="upload failed",uh=function(){function t(){this.queryPromiseResolve=null,this.queryPromiseReject=null,this.index=0,this.SparkMD5=null}var e=t.prototype;return e.handleImageUpload=function(t){var e=this;return nh((function(){var n;return oh(this,(function(a){switch(a.label){case 0:return t&&Array.isArray(t)?"pc"!==rt()?[3,2]:(e.showB64Image(t),[4,e.uploadBase64(t)]):[2];case 1:return n=a.sent(),e.updateImage(n),[3,3];case 2:t[0].src?setTimeout((function(){e.updateImage(t)}),50):e.showB64Image(t),a.label=3;case 3:return[2]}}))}))()},e.updateImage=function(t){var e=this.queryPromiseResolve,n=this.queryPromiseReject;if(e&&n){var a=this.index;if(!t||!Array.isArray(t)||!t.length)return n(),wa().emit({action:"abort",index:a}),this.queryPromiseResolve=null,void(this.queryPromiseReject=null);var i=[],o=[];t.forEach((function(t){var e=t.src,n=t.height,a=t.width,r="success";e||(r="error"),o.push({imageUrl:e,width:a,height:n,status:r}),i.push({type:"IMAGE",data:{image:{image_url:e,width:a,height:n}}})})),wa().emit({query:o,index:a}),e({asyncPromptContent:i}),this.queryPromiseResolve=null,this.queryPromiseReject=null}},e.showB64Image=function(t){var e=this,n=this.index+1,a=[];t.forEach((function(t){var e=t.base64,i=t.height,o=t.width;a.push({type:"IMAGE",data:{image:{image_b64:e,width:o,height:i,status:"loading",index:n}}})})),on.dispatch("update",{sa:"image"});var i=this.queryPromiseReject;i&&(i(),wa().emit({action:"abort",index:n-1}));var o=new Promise((function(t,n){e.queryPromiseResolve=t,e.queryPromiseReject=n}));Xl({query:a,extParams:{queryPromise:o}},!1,"SSE"),this.index=n},e.uploadBase64=function(t){var e=this;return nh((function(){var n,a,i,o,r,s;return oh(this,(function(l){switch(l.label){case 0:if(!t||!Array.isArray(t))return[2];n=[],a=!1,i=ih(t),l.label=1;case 1:return(o=i()).done?[3,4]:(r=o.value,[4,e.uploadImage(r.base64)]);case 2:(s=l.sent())&&(a=!0),n.push(ah({},r,{src:s,status:s?"success":"error"})),l.label=3;case 3:return[3,1];case 4:return a?[2,n]:[2,null]}}))}))()},e.getRandomFileName=function(){var t=new Date,e=Math.floor(t.getTime()/1e3),n=1e3*t.getMilliseconds();return((2147483648|1e5*e+Math.floor(n/10)&2147483647)>>>0)+""+(Math.floor(9e4*Math.random())+1e4)},e.uploadImage=function(t){var e=this;return nh((function(){var n,a,i,o,r,s,l,c,d,u,p,h,f,g,m;return oh(this,(function(v){switch(v.label){case 0:return n=e.getRandomFileName(),1!==(a=Math.ceil(t.length/lh))?[3,2]:[4,e.uploadPicToBos(t)];case 1:return[2,v.sent()];case 2:for(i=[],o=0;o<a;o++)r=o*lh,s=Math.min((o+1)*lh,t.length),l=t.slice(r,s),i.push(e.uploadSingleSlice(l,n,o));d=new Promise((function(t){c=setTimeout((function(){t(!1)}),3e4)})),v.label=3;case 3:return v.trys.push([3,7,,8]),u=Promise.all(i),[4,Promise.race([u,d])];case 4:return v.sent()||console.error("upload timeout"),clearTimeout(c),p=Date.now(),(h=new URLSearchParams).append("filename",n),h.append("isfin","1"),h.append("ischunk","1"),h.append("scene","pic_edit"),h.append("timestamp",p.toString()),f=h.append,g=["token"],[4,e.getToken(t,p)];case 5:return f.apply(h,g.concat([v.sent()])),[4,fetch(ch,{method:"POST",body:h}).then((function(t){return t.json()})).then((function(t){var e;if(!(null==t||null==(e=t.data)?void 0:e.url))throw new Error(dh);if(0===t.status)return t.data.url;throw new Error(dh)}))];case 6:return[2,v.sent()];case 7:return m=v.sent(),console.error(m),[3,8];case 8:return[2]}}))}))()},e.uploadSingleSlice=function(t,e,n){return nh((function(){var a,i,o;return oh(this,(function(r){switch(r.label){case 0:(a=new URLSearchParams).append("picInfo",t),a.append("filename",e),a.append("chunknum",n.toString()),a.append("ischunk","1"),a.append("scene","pic_edit"),a.append("isfin","0"),a.append("timestamp",Date.now().toString()),i=3,o=0,r.label=1;case 1:if(!(o<i+1))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,fetch(ch,{method:"POST",body:a}).then((function(t){return t.json()}))];case 3:return 0===r.sent().status?[2,!0]:[3,5];case 4:return r.sent(),[3,5];case 5:return++o,[3,1];case 6:throw new Error(dh)}}))}))()},e.uploadPicToBos=function(t){var e=this;return nh((function(){var n,a,i,o,r,s;return oh(this,(function(l){switch(l.label){case 0:n=!1,a=setTimeout((function(){n=!0}),3e4),l.label=1;case 1:return l.trys.push([1,4,,5]),i=new URLSearchParams,o=Date.now(),r=i.append,s=["token"],[4,e.getToken(t,o)];case 2:return r.apply(i,s.concat([l.sent()])),i.append("scene","pic_edit"),i.append("picInfo",t),i.append("timestamp",o.toString()),i.append("ischunk","0"),[4,fetch(ch,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()}).then((function(t){return t.json()})).then((function(t){return n?"":(clearTimeout(a),0===t.status?t.data.url:"")})).catch((function(){return""}))];case 3:return[2,l.sent()];case 4:return l.sent(),n?[2,""]:(clearTimeout(a),[2,""]);case 5:return[2]}}))}))()},e.getToken=function(t,e){var n=this;return nh((function(){var a,i;return oh(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),n.SparkMD5?[3,2]:[4,Promise.resolve().then((function(){return af}))];case 1:n.SparkMD5=o.sent(),o.label=2;case 2:return a=n.SparkMD5.hash(t),[2,n.SparkMD5.hash(a+"pic_edit"+e.toString()).slice(0,5)];case 3:return i=o.sent(),console.error(i),[2,""];case 4:return[2]}}))}))()},t}(),ph=new uh;function hh(){return hh=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},hh.apply(this,Array.from(arguments))}!function(t){t.H5="h5",t.CONVERSATION="conversation",t.UPLOAD_IMAGE="uploadImage",t.IMAGE_UPLOAD="imageUpload",t.Drawer="drawer",t.link="link",t.AGENT="agent",t.PANEL="panel",t.CAMERA="camera",t.CAMERA_QUESTION="cameraQuestion"}(rh||(rh={}));var fh=((sh={}).camera="CAMERA",sh.cameraQuestion="QUESTION",sh),gh=Tt.connect(on,{modelList:"modelList",usedModel:"usedModel"})(a.defineComponent({capsuleElement:null,components:{"cos-capsules":Zp},listenInputStart:null,listenInputCancel:null,listenUpdateCapsule:null,listenModelFuncData:null,attached:function(){var t=this;this.nextTick((function(){t.capsuleElement=t.el})),this.setBottomPadding(!0),this.handleCapsuleClick=Xi(this.handleCapsuleClick,300,{trailing:!1,leading:!0}),document.addEventListener("visibilitychange",(function(){document.hidden||t.data.set("capsuleData",t.data.get("capsuleData"))})),this.listenInputStart=function(){t.capsuleElement&&(t.capsuleElement.style.visibility="hidden",t.setBottomPadding(!1))},Hs().on(this.listenInputStart),this.listenInputCancel=function(){t.capsuleElement&&(t.capsuleElement.style.visibility="visible",t.setBottomPadding(!0))},$s().on(this.listenInputCancel),ht()&&di(ci(),"13.79")>=0&&(zs().emit({hide:1}),this.data.set("showTopBorder",!0));var e=on.getState("searchBoxPanel"),n=this.data.get("capsuleData");e&&(n&&n.length?this.invokeDefaultCapsule(n,e):this.watch("capsuleData",(function(n){n&&n.length&&t.invokeDefaultCapsule(n,e)}))),this.listenModelFuncData=function(e){t.data.set("modelFuncData",e.modelFuncData),t.data.set("label",e.label)},Wn().on(this.listenModelFuncData)},invokeDefaultCapsule:function(t,e){var n=this,a=t.find((function(t){var n="";return e===ie.WRITE?n="AI写作":e===ie.PAINT&&(n="AI画图"),"panel"===t.type&&t.text===n}));this.nextTick((function(){a&&n.handleCapsuleClick(a),on.dispatch("update",{searchBoxPanel:""})}))},disposed:function(){this.listenInputStart&&(Hs().off(this.listenInputStart),this.listenInputStart=null),this.listenInputCancel&&($s().off(this.listenInputCancel),this.listenInputCancel=null)},detached:function(){this.setBottomPadding(!1)},sendCapsulesLog:function(t,e){var n,a,i=this.data.get("tplInfo"),o=i.lid,r=i.tplname,s=i.srcid;Ua({ubcId:"17132",page:"resultpage",type:"click",value:"capsule_bub",ext:{agent_id:null==(n=on.getState("agentInfo"))?void 0:n.agentSearchId,agent_name:null==(a=on.getState("agentInfo"))?void 0:a.agentName,capsule_content:t,action_type:e,lid:o,tplname:r,srcid:s,ori_lid:on.getState("oriLid"),re_rank:on.getState("rank"),valueInfo:[{component_name:"shortcuts"}],is_query:this.data.get("isQuery"),enter_type:this.data.get("enterType")}})},initData:function(){return{label:"",capsuleData:[],tplInfo:{},baseData:{},queryPromise:null,showHelloIndex:"",showTopBorder:!1,imageNotInInput:!1,modelFuncData:[]}},computed:{enterType:function(){return"pc"===rt()?on.getState("pcEnterType")||"ai_tab_url":on.getState("enterType")},isQuery:function(){return on.getState("isShowHello")&&0===on.getState("rank")?"0":"1"},logExtParams:function(){var t,e;return{agent_id:null==(t=on.getState("agentInfo"))?void 0:t.agentSearchId,agent_name:null==(e=on.getState("agentInfo"))?void 0:e.agentName,is_query:this.data.get("isQuery"),enter_type:this.data.get("enterType")}}},handleCapsuleClick:function(t){var e=t.type,n=t.text,a=t.agentId,i=t.agentParams,o=void 0===i?{}:i,r=t.options,s=t.itemIndex,l=r||t,c=l.sendText,d=l.url,u=void 0===d?"":d,p=l.title,h=void 0===p?"":p,f=l.link,g=void 0===f?"":f,m=l.percent,v=l.isDeepSeek,y=void 0===v?"":v,w="agent"!==e?n:[{agent_id:a,agent_name:n,agent_pos:s+""}];switch(this.sendCapsulesLog(w,e),this.fire("click"),e){case"conversation":a&&on.dispatch("update",{agentInfo:{agentSearchId:a,agentParams:hh({actionLid:this.data.get("baseData").lid},o)}}),Xl({query:c||n});break;case"h5":Rp(u);break;case"link":var b=g;"1"===y&&(st()&&un.sendCount({group:"deepseek_btn_click",info:{show:1}}),b=this.deepSeekUrlProcess(g)),Rp(b);break;case"drawer":u&&this.dispatch("open-half-screen",{url:u,title:h,halfScreenPercent:m,board_from:"capsule"});break;case"uploadImage":break;case"agent":var _=hh({actionType:"launchConversation",agentId:a,agentSearchId:a,agentName:n,logo:t.icon,startIndex:0,endIndex:n.length},o),k=on.getState("agentQuery")||on.getState("query");k||0!==on.getState("rank")||(Yn().emit(),Zl({type:"agentGreeting",data:{sa:"capsule_agent_"+(s+1),agentInfo:_}})),Cs(_,"capsule_agent_"+(s+1)),Ds(_,k||"");break;case"panel":var S=t.options,x=t.panelType||"",I=x&&Object.values(ie).includes(x)?x:"";S.callback={panelId:"",type:I};for(var T=0;T<S.items.length;T++)for(var C=0;C< __get$(S.items,T) .data.length;C++){var L= __get$(__get$(S.items,T).data,C) ;L.callback={id:C,isSelect:L.isSelect,name:L.name,prefix:L.prefix||"",sa:L.sa||""}}Hn().conversation.openExtendPanel.emit(S);break;case"camera":case"cameraQuestion":ca().emit({type: __get$(fh,t.type) })}},handleUploadSuccess:function(t){t&&Array.isArray(t)&&(t.some((function(t){return t.hasOwnProperty("dataType")}))?ph.handleImageUpload(t):this.handleSingalUploadSuccess(t))},handleSingalUploadSuccess:function(t){var e=t[0],n=e.base64,a=e.src,i=e.height,o=e.width;on.dispatch("update",{sa:"image"}),Xl({query:[{type:"IMAGE",data:{image:{image_b64:n,image_url:a,width:o,height:i}}}]},!1,"SSE")},setBottomPadding:function(t){void 0===t&&(t=!0);var e="pc"===rt()?document.querySelector("[class*='chat-container-main-stream']"):document.querySelector("[class*='index_scroll-content']"),n=getComputedStyle(e),a="pc"===rt()?31:pt()?48:42,i=t?a:-1*a;e.style.paddingBottom=parseFloat(n.paddingBottom)+i+"px"},deepSeekUrlProcess:function(t){var e=Ht.parse(t),n=_t(on.getState("query")),a=on.getState("curRankInfo.rank"),i=Bt(decodeURIComponent(e.query.url),n&&a>0?{word:n,enterType:"deepseek_capsule"}:{word:"百度AI助手",isShowHello:1,enterType:"deepseek_capsule"});return o.canIUse("search.open")&&(i=Bt(""+e.protocol+e.pathname,hh({},e.query,{url:i}))),i},handleModelListShow:function(){var t=on.getState("usedModel");Ua({type:"click",value:"ask_model_btn",ext:{current_model:t.modelName}}),Ua({type:"show",value:"model_pop",ext:{current_model:t.modelName}})},handleModelSelect:function(t){var e=t.model,n=t.oldModel;Ua({type:"click",value:"model_pop",ext:{goal_model:e.id,current_model:n.id}});var a={selectedId:e.id,fullFeature:e.fullFeature};Qs().emit(a);try{localStorage.setItem(we,JSON.stringify(a.selectedId))}catch(t){}},handleSendFunctionLog:function(t){var e=t.status;Ua({type:"click",value:t.value,ext:{is_open:e?"1":"0",enter_type:on.getState("enterType"),a_lid:on.getState("apagelid"),current_model:this.data.get("usedModel").modelName}})},handleTooltipShow:function(t){Ua({type:"show",value:"model"===t?"new_func_guide":"mcp_first_toast"})}})),mh={};mh= __call$(Object,"assign",[mh,{capsulesWrapper:"capsules-wrapper_m01b5_1","capsules-wrapper":"capsules-wrapper_m01b5_1",capsulesLabel:"capsules-label_m01b5_22","capsules-label":"capsules-label_m01b5_22",capsulesWrapperBorder:"capsules-wrapper-border_m01b5_32","capsules-wrapper-border":"capsules-wrapper-border_m01b5_32",capsulesWrapperLabel:"capsules-wrapper-label_m01b5_35","capsules-wrapper-label":"capsules-wrapper-label_m01b5_35",capsulesItemTagModelWrapper:"capsules-item-tag-model-wrapper_m01b5_73","capsules-item-tag-model-wrapper":"capsules-item-tag-model-wrapper_m01b5_73"}]) ,gh.template='\n    <cos-capsules\n        s-ref="capsules"\n        class="\n            {{$style[\'capsules-wrapper\']}}\n            {{label ? $style[\'capsules-wrapper-label\'] : \'\'}}\n            {{showTopBorder ? $style[\'capsules-wrapper-border\'] : \'\'}}\n            cs-capsules\n        "\n        capsuleData="{{capsuleData}}"\n        modelFuncData="{{modelFuncData}}"\n        modelList="{{modelList}}"\n        log-ext-params="{{logExtParams}}"\n        on-click="handleCapsuleClick"\n        on-select-model="handleModelSelect"\n        on-model-list-show="handleModelListShow"\n        on-function-click="handleSendFunctionLog"\n        on-img-upload-success="handleUploadSuccess"\n        on-tooltip-show="handleTooltipShow"\n        tpl-info="{{tplInfo}}"\n        is-query="{{isQuery}}"\n        enter-type="{{enterType}}"\n    >\n        <span\n            s-if="label" slot="prefix"\n            class="{{$style[\'capsules-label\']}}"\n        >{{ label }}</span>\n    </cos-capsules>\n';var vh="function"==typeof gh?gh.prototype.initData||yh:gh.initData||yh;function yh(){return{$style:mh}}function wh(){return  __call$(Object,"assign",[{},vh.call(this),{$style:mh}]) }function bh(t,e){return bh=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},bh(t,e)}"function"==typeof gh?gh.prototype.initData=wh:gh.initData=wh;var _h=function(t){function e(){return t.apply(this,Array.from(arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bh(t,e)}(e,t),e}(a.Component),kh={};kh= __call$(Object,"assign",[kh,{}]) ,_h.template="\n\n\t<div></div>\n";var Sh="function"==typeof _h?_h.prototype.initData||xh:_h.initData||xh;function xh(){return{$style:kh}}function Ih(){return  __call$(Object,"assign",[{},Sh.call(this),{$style:kh}]) }function Th(t,e){return Th=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Th(t,e)}"function"==typeof _h?_h.prototype.initData=Ih:_h.initData=Ih;var Ch=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Th(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{multiRecommendWord:{}}},n.attached=function(){this.onRecommendWordClick=Xi(this.handleRecommendWordClick.bind(this),1e3,{leading:!0,trailing:!1})},n.singleShowLog=function(t,e,n){return JSON.stringify({type:"show",value:"new_guide_single",valueInfo:{component_name:"multiRecommendWord",component_content:[t.text]},pos:String(5*e+n+1),enter_type:on.getState("enterType")})},n.isShareMode=function(){return document.body.classList.contains("cos-share-selected")||!1},n.handleRecommendWordClick=function(t,e,n,a){if(this.isShareMode())return null==a||a.preventDefault(),void(null==a||a.stopPropagation());Ua({type:"click",value:"new_guide",ext:{valueInfo:[{component_name:"multiRecommendWord",component_content:[t.text]}],pos:String(5*e+n+1),enter_type:on.getState("enterType")}}),Xl({query:t.text,extParams:{sa:"new_guide"}})},e}(a.Component);function Lh(t,e){return Lh=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Lh(t,e)}Ch.template='\n        <div class="cs-multi-recommend-word">\n            <div\n                s-if="titleText"\n                class="cs-multi-recommend-word-title cos-font-medium"\n            >\n                <span>{{titleEmoji}}</span>\n                <span class="cs-multi-recommend-word-title-text">{{titleText}}</span>\n            </div>\n            <div\n                s-if="desc"\n                class="cs-multi-recommend-word-desc"\n            >\n                {{desc}}\n            </div>\n            <div\n                class="cs-multi-recommend-word-list-wrapper"\n                data-show-ext="{{realShowData}}"\n            >\n                <div class="cs-multi-recommend-word-list-scroll">\n                    <div\n                        s-for="list, listIndex in recommendList"\n                        class="cs-multi-recommend-word-list"\n                    >\n                        <div\n                            s-for="recommendItem, index in list"\n                            class="cs-multi-recommend-word-list-item"\n                            on-click="onRecommendWordClick(recommendItem, listIndex, index, $event)"\n                        >\n                            <div\n                                data-show-ext="{{singleShowLog(recommendItem, listIndex, index)}}"\n                                data-show-area\n                                class="cs-multi-recommend-word-list-text cos-font-medium"\n                            >\n                                <span \n                                    s-if="{{recommendItem.prefix}}}"\n                                    class="cs-multi-recommend-word-list-prefix cos-font-medium"\n                                >\n                                    {{recommendItem.prefix}}\n                                </span>\n                                {{recommendItem.content}}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',Ch.computed={titleEmoji:function(){var t;return(null==(t=this.data.get("multiRecommendWord"))?void 0:t.guideTitleEmoji)||""},titleText:function(){var t;return(null==(t=this.data.get("multiRecommendWord"))?void 0:t.guideTitleText)||""},desc:function(){var t;return(null==(t=this.data.get("multiRecommendWord"))?void 0:t.guideWord)||""},recommendList:function(){var t,e=(null==(t=this.data.get("multiRecommendWord"))?void 0:t.recommendWord)||[],n=[];return e.forEach((function(t,e){e%1==0&&n.push([]),t.content=(t.emoji?t.emoji+" ":"")+t.text, __get$(n,n.length-1) .push(t)})),n.slice(0,3)},realShowData:function(){var t,e=((null==(t=this.data.get("multiRecommendWord"))?void 0:t.recommendWord)||[]).map((function(t){return t.text}));return JSON.stringify({value:"new_guide",valueInfo:{component_name:"multiRecommendWord",component_content:e},enter_type:on.getState("enterType")})}};var Dh=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).onRecommendWordClick=Xi((function(t,e,n){Ua({type:"click",value:"recom_content",ext:{valueInfo:[{title:e.classify,content:e.text,pos:String(n+1)}],sa:on.getState("oriSa"),a_lid:on.getState("apagelid")}}),Xl({query:e.text,extParams:{sa:""}})}),1e3,{leading:!0,trailing:!1}),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Lh(t,e)}(e,t),e.prototype.initData=function(){return{value:[]}},e}(a.Component);function Ph(t,e){return Ph=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ph(t,e)}Dh.template='\n        <div\n            class="cs-prompt-recommend"\n            data-show-ext="{{showLogExtData}}"\n        >\n            <div\n                class="cos-text-headline cs-prompt-recommend-title"\n            >\n                Hi，欢迎回来，一起探索吧！\n            </div>\n            <div\n                class="cs-prompt-recommend-wrapper cos-row cos-row-col-12 cos-flex-wrap cos-gutter"\n            >\n                <div\n                    s-for="item, index in value"\n                    class="cos-col-4 cos-space-mt-xxs cos-space-mb-xxs"\n                >\n                    <div\n                        class="cs-prompt-recommend-box"\n                        on-click="onRecommendWordClick($event, item, index)"\n                    >\n                        <div class="cs-prompt-recommend-box-title">\n                            <div class="cs-prompt-recommend-box-icon">{{item.icon}}</div>\n                            <div class="cs-prompt-recommend-box-classify cos-line-clamp-1">\n                                {{item.classify}}\n                            </div>\n                        </div>\n                        <div class="cs-prompt-recommend-box-text cos-line-clamp-1 cos-font-medium">\n                            {{item.text}}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',Dh.computed={showLogExtData:function(){var t=this.data.get("value");return JSON.stringify({value:"recom_content",valueInfo:t.map((function(t,e){return{title:t.classify,content:t.text,pos:String(e+1)}})),sa:on.getState("oriSa")})}};var Eh=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).unitDistance=49,e.lastTime=0,e.movedDistance=0,e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ph(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{scrollSpeed:15}},n.attached=function(){this.swiperSlides=this.ref("swiperSlides"),this.startPlay()},n.handleScroll=function(t){var e=t.target;if(e){var n=e.scrollTop,a=e.scrollHeight;n+e.clientHeight>=a&&(e.scrollTop=0)}},n.startPlay=function(){var t=this;if(!this.autoplayTimer){this.lastTime=0;var e=function(n){if(!t.lastTime)return t.lastTime=n,void(t.autoplayTimer=requestAnimationFrame(e));var a=(n-t.lastTime)/1e3*t.data.get("scrollSpeed");t.movedDistance-=a,t.swiperSlides.style.transform="translate(0, "+t.movedDistance+"px)",t.lastTime=n,t.movedDistance<-t.unitDistance&&t.moveChildToLast(),t.autoplayTimer=requestAnimationFrame(e)};this.autoplayTimer=requestAnimationFrame(e)}},n.stopPlay=function(){this.autoplayTimer&&(cancelAnimationFrame(this.autoplayTimer),this.autoplayTimer=null)},n.moveChildToLast=function(){var t=this.swiperSlides.children[0];this.swiperSlides.appendChild(t),this.movedDistance=0,this.swiperSlides.style.transform="translate(0, 0)"},n.destroyed=function(){this.stopPlay()},e}(a.Component);function Ah(){return Ah=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Ah.apply(this,Array.from(arguments))}function Oh(t,e){return Oh=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Oh(t,e)}Eh.trimWhitespace="all",Eh.template='\n        <div \n          class="swiper-wrapper"\n          on-scroll="handleScroll"\n          on-mouseenter="stopPlay"\n          on-mouseleave="startPlay"\n        >\n            <div\n                class="swiper-slide"\n            >\n                <div\n                    s-ref="swiperSlides"\n                    class="swiper-slide-frame"\n                >\n                    <slot></slot>\n                </div>\n            </div>\n        </div>\n    ';var Rh=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oh(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{funcArea:{},isWindows:ot.isWindows,isExtension:vt(),clsMap:{aiRead:"ai-read",photoEditing:"photo-editing",officeCreate:"office-create"}}},n.handleFuncTitle=function(t,e){var n;t.stopPropagation(),"featureShowcase"!==e&&("agent_rec"===(e=null==e||null==(n= __call$(e,"replace",[/([a-z])([A-Z])/g,"$1_$2"]) )?void 0:n.toLowerCase())?Ea().emit(!0):Ta().emit({type:e,triggerType:"guide"}),this.funcTitleLog())},n.funcTitleLog=function(){Ua({page:"resultpage",type:"click",value:"guide_function_blank",ext:{enter_type:on.getState("pcEnterType"),setype:"csaitab"}})},n.handleFuncButton=function(t,e,n){var a,i,o,r=e.function,s={},l="",c=(null==r||null==(a=r.data)?void 0:a.input)||{},d=null==c?void 0:c.interactionType;switch((null==c?void 0:c.agentInfo)&&Object.keys(null==c?void 0:c.agentInfo).length&&(s=Ah({startIndex:0,endIndex:r.data.input.agentInfo.agentName.length},c.agentInfo)),t){case"officeCreate":l="funcguide_office_"+(n+1);break;case"photoEditing":l="funcguide_pic_"+(n+1);break;case"aiRead":l="funcguide_read_"+(n+1);break;case"agentRec":l="funcguide_agent_"+(n+1);break;case"featureShowcase":l="funcguide_hintask_"+(n+1)}if(Aa().emit({sa:l,isAgent:"agentRec"===t}),"ask"===r.type){var u=r.data.ask,p=u.usedModel,h=on.getState("usedModel"),f=new Gi(on);return null==f||f.handleChangeUsedModelStatus(null==h?void 0:h.modelName,p),void Xl({query:u.query,extParams:{sa:l}})}if(zn().emit(Ah({agentInfo:s,inputCustom:null==c?void 0:c.inputCustom},d?{interactionType:d}:{})),"aiRead"===t&&"upload"===r.type){var g="上传文档"===(null==e?void 0:e.text)?"file":"image";Da().emit(g)}"link"===r.type&&window.open(null==(o=r.data)||null==(i=o.link)?void 0:i.url)},n.getFuncButtonLog=function(t,e,n){var a,i,o,r,s,l,c,d,u,p,h="",f="";switch(t){case"officeCreate":h="text",f="text";break;case"photoEditing":var g;h="pic",f="link"===(null==e||null==(g=e.function)?void 0:g.type)?"click":"text";break;case"aiRead":var m;h="read",f="input"===(null==e||null==(m=e.function)?void 0:m.type)?"text":"upload";break;case"agentRec":h="agent",f="";break;case"featureShowcase":h="hintask",f="ask"}return{valueItem:{function_name:e.buttonId||"",function_pos:""+(n+1),function_click_type:f,agent_id:(null==e||null==(a=e.agentInfo)?void 0:a.agentId)||(null==e||null==(s=e.function)||null==(r=s.data)||null==(o=r.input)||null==(i=o.agentInfo)?void 0:i.agentId)||"",agent_name:(null==e||null==(l=e.agentInfo)?void 0:l.agentName)||(null==e||null==(p=e.function)||null==(u=p.data)||null==(d=u.input)||null==(c=d.agentInfo)?void 0:c.agentName)||""},function_type:h}},n.funcButtonShowLog=function(t,e){var n,a=this,i=[],o="";return null==e||null==(n=e.list)||n.forEach((function(e,n){var r=a.getFuncButtonLog(t,e,n),s=r.valueItem,l=r.function_type;i.push(s),o=l||""})),JSON.stringify({page:"resultpage",type:"show",value:"guide_function",enter_type:on.getState("pcEnterType"),setype:"csaitab",function_type:o,valueInfo:i})},n.funcButtonLog=function(t,e,n,a){var i=this.getFuncButtonLog(t,e,n),o=i.valueItem,r=i.function_type;return JSON.stringify({page:"resultpage",type:a,value:"guide_function",ubcExt:{enter_type:on.getState("pcEnterType"),setype:"csaitab",function_type:r,valueInfo:[o]}})},e}(a.Component);function Nh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Mh(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function qh(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Mh(o,a,i,r,s,"next",t)}function s(t){Mh(o,a,i,r,s,"throw",t)}r(void 0)}))}}function jh(){return jh=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},jh.apply(this,Array.from(arguments))}function Bh(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Nh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nh(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Hh(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Rh.trimWhitespace="all",Rh.components={"cos-icon":e.Icon,"cos-avatar":e.Avatar,"circular-swiper":Eh},Rh.template='\n        <div data-show-area class="chat-home-page">\n            \x3c!--bca-disable-next-line--\x3e\n            <div class="welcome-text">{{welcomeTextWithEmoji | raw}}</div>\n            <div class="plugin-func">\n                <div\n                    s-if="{{isExtension}}"\n                    class="plugin-func-wrap {{\'func-\' + clsMap[func[0]]}}"\n                    s-for="func, index in funcAreaEntries"\n                >\n                    <div class="plugin-func-title">\n                        <span>{{func[1].title[0].data.text.value || func[1].title}}</span>\n                    </div>\n                    <div class="plugin-func-content" data-show-ext="{{funcButtonShowLog(func[0],func[1])}}">\n                        <div\n                            class="plugin-func-item-area"\n                            s-for="item,index in func[1].list"\n                            on-click="handleFuncButton(func[0], item, index)"\n                            need-click-log\n                            data-click-log="{{funcButtonLog(func[0], item, index, \'click\')}}"\n                        >\n                            <img s-if="{{item.icon || item.avatar}}" src="{{item.icon || item.avatar}}"/>\n                            <div class="cos-line-clamp-1">{{item.text}}</div>\n                        </div>\n                    </div>\n                </div>\n                <div\n                    s-else\n                    class="cos-row cos-flex-wrap cos-row-col-12 cos-gutter chat-function-box"\n                    style="--cos-grid-gutter: 12px"\n                >\n                    <div class="cos-col-6 func-area-entry" s-for="func, index in funcAreaEntries">\n                        <div class="function-box">\n                            \x3c!-- 功能标题 --\x3e\n                            <div\n                                class="\n                                    function-title\n                                    {{func[1].titleClickable ? \'hover-func-title\' : \'\'}}\n                                "\n                                style="font-size: {{isWindows ? \'15px\' : \'\'}}"\n                                on-click="handleFuncTitle($event, func[0])"\n                            >\n                                <span>{{func[1].title[0].data.text.value || func[1].title}}</span>\n                                <cos-icon\n                                    s-if="{{func[1].titleClickable}}"\n                                    class="right-icon"\n                                    name="right"\n                                />\n                            </div>\n                            \x3c!-- 功能内容 --\x3e\n                            \x3c!-- 轮播布局 --\x3e\n                            <div\n                                s-if="{{func[0] === \'featureShowcase\'}}"\n                                data-show-ext="{{funcButtonShowLog(func[0],func[1])}}"\n                                class="function-swiper-content"\n                            >\n                                <circular-swiper>\n                                    <div\n                                        s-for="item, index in func[1].list"\n                                        class="item"\n                                        need-click-log\n                                        data-click-log="{{funcButtonLog(func[0], item, index, \'click\')}}"\n                                        on-click="handleFuncButton(func[0], item, index)"\n                                    >\n                                        <span\n                                            class="item-tag"\n                                        >\n                                            {{item.tag}}\n                                        </span>\n                                        <span class="item-content">{{item.text}}</span>\n                                    </div>\n                                </circular-swiper>\n                            </div>\n                            \x3c!-- 功能按钮布局 --\x3e\n                            <div\n                                s-else\n                                class="cos-row cos-flex-wrap cos-row-col-12 cos-gutter cos-justify-between\n                                function-content\n                                {{func[0] === \'agentRec\' || func[0] === \'aiRead\' ? \'function-column-box\' : \'\'}}"\n                                style="--cos-grid-gutter: 9px"\n                                data-show-ext="{{funcButtonShowLog(func[0],func[1])}}"\n                            >\n                                <div class="cos-col-4"\n                                    s-for="item,index in func[1].list"\n                                    on-click="handleFuncButton(func[0], item, index)"\n                                    need-click-log\n                                    data-click-log="{{funcButtonLog(func[0], item, index, \'click\')}}"\n                                >\n                                    <div class="function-item-area {{func[0] === \'aiRead\' ? \'airead-item-area\' : \'\'}}">\n                                        <img s-if="{{item.icon && func[0] === \'aiRead\'}}" src="{{item.icon}}"\n                                            class="file-icon"\n                                            style="margin-bottom: var(--cos-space-xs, 9px)"\n                                        />\n                                        <cos-avatar\n                                            s-if="{{item.agentInfo.logo}}"\n                                            src="{{item.agentInfo.logo}}"\n                                            size="sm"\n                                            class="agent-icon"\n                                            style="margin-bottom: var(--cos-space-xs, 9px)"\n                                        />\n                                        <div\n                                            class="cos-line-clamp-1\n                                                {{item.function.type === \'link\' ? \'hover-link-text\' : \'\'}}"\n                                        >\n                                            {{item.text || item.agentInfo.agentName}}\n                                        </div>\n                                        <cos-icon\n                                            s-if="{{item.function.type === \'link\'}}"\n                                            name="arrow-right" class="hover-arrow"\n                                        />\n                                        <div s-if="{{(item.desc || item.agentInfo.count)}}"\n                                            class="item-desc cos-line-clamp-1"\n                                            style="height: {{func[0] === \'aiRead\' ? \'13px\' : \'\'}}"\n                                        >\n                                            {{item.desc || (item.agentInfo.count)}}\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',Rh.computed={funcAreaEntries:function(){var t,e=this.data.get("funcArea");if(!e||"object"!=(void 0===e?"undefined":(t=e)&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t))return e||[];var n=Object.keys(e).map((function(t){return[t,Ah({titleClickable:"featureShowcase"!==t}, __get$(e,t) )]}));return this.data.get("isExtension")&&(n[3]&&"agentRec"===n[3][1].title&&n.splice(3,1),n.forEach((function(t,e){"agentRec"===t[0]&&n.splice(e,1),t[1]&&t[1].list&&t[1].list.length>3&&t[1].list.splice(3)}))),n},welcomeTextWithEmoji:function(){var t,e,n;return __call$((null==(n=this.data.get("welcome")[0])||null==(e=n.data)||null==(t=e.text)?void 0:t.value)||this.data.get("welcome").text,"replace",[/[\uD800-\uDBFF][\uDC00-\uDFFF]|[\u2600-\u26FF]/g,'<span class="emoji">$&</span>']) }};var $h=Tt.connect(on,{showCapsules:"showCapsules"})(a.defineComponent({trimWhitespace:"all",template:'\n    <div\n        data-show-area\n        s-if="!waitData"\n    >\n        <cs-chat-home-page\n            s-if="isPc && isShowHomePage"\n            s-bind="chatHomePageData"\n        />\n        <cs-multi-recommend-word\n            class="{{fadeIn ? \'fade-in\' : \'\'}} {{fadeOut ? \'fade-out\' : \'\'}}"\n            s-if="latestMutiRecWord && latestMutiRecWord.recommendWord"\n            multi-recommend-word="{{latestMutiRecWord}}"\n        />\n        \x3c!-- pc新推荐 pc only --\x3e\n        <cs-prompt-recommend\n            s-if="{{promptRecommend}}"\n            s-bind="{{promptRecommend}}"\n            class="chat-guide-container"\n        >\n        </cs-prompt-recommend>\n        <div\n            s-else-if="{{!isPc && ((guideWord || agentList.length) && !hideTopAgentList || showInAnswerAsk)}}"\n            class="chat-guide-container {{showInAnswerAsk ? \'weather-exp-container-style\' : \'\'}}"\n            style="margin: {{hitGuideDown ? \'0 .12rem .12rem\' : \'\'}}"\n        >\n            <div\n                s-if="guideWord"\n                s-ref=\'guideTpl\'\n                class=\'cs-guide {{isShowRecFunctionalList ? "cs-guide-shortcuts" : ""}}\'\n            >\n                <div class=\'cs-guide-word\'>\n                    <span>{{guideWord}}</span>\n                </div>\n                <div\n                    s-if="isShowRecFunctionalList"\n                    style="--cos-grid-gutter: 8px"\n                    class=\'cs-guide-recommend cos-row cos-flex-wrap cos-row-col-12 cos-gutter\'\n                >\n                    <div\n                        s-for="item, index in recFunctionalList"\n                        class=\'cos-col-6\' on-click="handlerecFunctionalListClick(item)"\n                    >\n                        <div\n                            class=\'cs-guide-recommend-item\'\n                            need-click-log="{{true}}"\n                            data-show-ext="{{recFunctionalShow(item)}}"\n                            data-click-log="{{functionalClickLog(item, index)}}"\n                        >\n                            <div class=\'cs-guide-recommend-item-title\'>\n                                <img src="{{item.icon}}" class=\'cs-guide-recommend-item-icon\'/>\n                                <span class="cs-guide-recommend-item-name">{{item.name}}</span>\n                            </div>\n                            <div class="cs-guide-recommend-item-text cos-line-clamp-1">{{item.text}}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div s-if="{{showInAnswerAsk && agentList.length}}" class="ai-tab-weather-exp-guide-world">\n                <p class="cos-line-clamp-2 cos-text-body-lg cos-color-text cos-space-mt-none cos-space-mb-none">\n                    {{guideWord}}\n                </p>\n            </div>\n            <cos-swiper\n                s-if="{{agentList.length && !guideWord}}"\n                class="agent-list-container"\n                on-change="handleScroll"\n            >\n                <cos-swiper-item\n                    s-for="item, index in agentList"\n                    width="{{isPc ? \'42.5%\' : \'68%\'}}"\n                    on-click="native:handleClickAgent(item, index)"\n                    class="scroll-item-container"\n                >\n                    <div\n                        class="scroll-item"\n                        data-show-ext="{{agentLog(item, index)}}"\n                    >\n                        <div class="agent-item-avatar-container">\n                            <img\n                                class="agent-item-avatar"\n                                src="{{item.logo}}"\n                                size="md"\n                            />\n                        </div>\n                        <div class="agent-item-right">\n                            <div class="agent-item-top">\n                                <div class="agent-item-name c-fwb cos-line-clamp-1">\n                                    <div class="c-line-clamp1 cos-line-clamp-1">\n                                        {{item.agentName}}\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="agent-item-description c-line-clamp1 cos-line-clamp-1">\n                                {{item.description}}\n                            </div>\n                        </div>\n                    </div>\n                </cos-swiper-item>\n            </cos-swiper>\n        </div>\n        <div\n            s-if="helloTipComponentName !== \'div\'"\n            class="hello-tip-container"\n        >\n            <div\n                s-is="helloTipComponentName"\n                s-bind="helloTipComponent.data"\n            />\n        </div>\n        <div\n            s-if="showAskEntrance && recommendData && recommendData.data"\n            s-ref="ask-entrance"\n            class="cs-guide-agent-welcome"\n            data-show-area\n        >\n            <ai-ask-entrance\n                can-launch-multi-search="{{false}}"\n                ask-component-data="{{recommendData}}"\n                is-single-card="{{true}}"\n                chat-search-ai-tab-info="{{chatSearchAiTabInfo}}"\n            />\n        </div>\n        <capsules\n            s-show="isShowCapsules"\n            tplInfo="{{tplInfo}}"\n            on-click="handleNewConversation"\n        />\n        <div s-if="isShowBlankBox" style="height:{{blankHeight}}"></div>\n        <scribe />\n    </div>\n    ',components:{"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem,"ai-markdown":e.Markdown,"ai-ask-entrance":jp,capsules:gh,"cs-multi-recommend-word":Ch,"cs-prompt-recommend":Dh,"cs-chat-home-page":Rh,scribe:_h},computed:{isShowCapsules:function(){var t=this.data.get("isPc"),e=this.data.get("isDeepSeekPage"),n=this.data.get("showCapsules"),a=!t&&!e&&n;return a&&zs().emit({hide:1}),a},isShowRecFunctionalList:function(){var t=this.data.get("recFunctionalList");return t&&t.length>0},helloTipComponentName:function(){var t=this.data.get("helloTipComponent")||{};return t.component?"ai-"+t.component:"div"},enterType:function(){return this.data.get("isPc")?on.getState("pcEnterType")||"ai_tab_url":on.getState("enterType")},isQuery:function(){return on.getState("isShowHello")?"0":"1"},isShowHomePage:function(){var t=this.data.get("homeRec");return t&&Object.keys(t).length>0},chatHomePageData:function(){return Ka(this.data.get("homeRec"))},tplInfo:function(){return{srcid:"52567",order:-1,lid:on.getState("lid"),tplname:"nonala_chat",query:on.getState("query")}}},initData:function(){return{isDeepSeekPage:lt(),guideWord:"",agentList:[],recommendData:{},helloTipComponent:{},hitGuideRerverse:!1,hitGuideDown:!1,triggerType:ae.CONVERSATION,isPc:"pc"===rt(),chatSearchAiTabInfo:{isChatSearchAiTabExperiment:!0,isAiTab:!0},showAskEntrance:!bt(on.getState("query"))||"pc"!==rt()&&on.getState("isShowHello"),hideTopAgentList:on.getState("hideTopAgentList"),showInAnswerAsk:!1,waitData:!1,id:"",rank:on.getState("rank"),oriLid:on.getState("oriLid"),showShortcut:!0,recFunctionalList:[],multiRecommendWord:{},promptRecommend:null,homeRec:{},blankHeight:0,isShowBlankBox:!0,isTransitioning:!1,fadeIn:!1,fadeOut:!1,modelGuideData:{},latestMutiRecWord:{}}},attached:function(){this.data.get("waitData")?this.waitForData():this.handleData()},listenShowGuide:null,waitForData:function(){var t=this,e=this;this.listenShowGuide=qh((function(t){var n,a,i;return Hh(this,(function(o){for(n=Bh(Object.keys(t));!(a=n()).done;)i=a.value,e.data.set(i, __get$(t,i) );return e.data.set("waitData",!1),e.handleMutiRecWord(),[2]}))})),_a().on(this.listenShowGuide,{when:function(e){var n=t.data.get("id");return e.id===n}})},listenHandleNewConversation:null,handleData:function(){var t,e,n=this,a=this.data.get("agentList"),i=this.data.get("isPc"),o=this.data.get("homeRec");if(i){var r=a.map((function(t){return jh({},t,{span:6.5})}));this.data.set("agentList",r||[])}var s=a.map((function(t,e){return{agent_id:t.agentSearchId,agent_name:t.agentName,agent_pos:e+1}}));((null==(t=this.data.get("recFunctionalList"))?void 0:t.length)&&this.data.get("guideWord")||(null==(e=this.data.get("multiRecommendWord"))?void 0:e.recommendWord))&&on.dispatch("update",{query:""}),this.listenInit(),a.length&&Ua({rank:String(+on.getState("rank")),type:"show",value:"agent_greet",page:"resultpage",ext:{agent_content:s,greet_info:this.data.get("guideWord"),ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),a_lid:on.getState("apagelid"),is_query:this.data.get("isQuery"),enter_type:this.data.get("enterType"),component_area:this.data.get("showInAnswerAsk")?"weather":""}}),this.handleClickAgent=Xi(this.handleClickAgent,1e3,{leading:!0,trailing:!1}),this.handlerecFunctionalListClick=Xi(this.handlerecFunctionalListClick,300,{leading:!0,trailing:!1}),this.listenHandleNewConversation=function(){return n.handleNewConversation()},Jn().on(this.listenHandleNewConversation),Xn().on(this.listenHandleNewConversation),ea().on(this.listenHandleNewConversation),i&&Object.keys(o).length>0&&this.handleScrollToTop()},listenShowGuideBlankBox:null,listenDeleAgent:null,listenUpdateCapsule:null,listenInit:function(){var t=this;this.listenShowGuideBlankBox=function(){t.data.set("isShowBlankBox",!1)},Pa().on(this.listenShowGuideBlankBox),this.listenDeleAgent=function(t){var e,n,a=on.getState("agentInfo")||{},i=((null==(e=t.params)?void 0:e.agentInfo)||{}).agentSearchId||(null==(n=t.params)?void 0:n.agentSearchId)||"";a.agentSearchId===i&&on.dispatch("update",{agentInfo:{}})},Fs().on(this.listenDeleAgent),this.listenUpdateCapsule=function(t){var e,n=null==t||null==(e=t.params)?void 0:e.display;on.dispatch("update",{showCapsules:1===n})},Js().on(this.listenUpdateCapsule)},disposed:function(){this.listenShowGuide&&(_a().off(this.listenShowGuide),this.listenShowGuide=null),this.listenHandleNewConversation&&(Jn().off(this.listenHandleNewConversation),Xn().off(this.listenHandleNewConversation),ea().off(this.listenHandleNewConversation),this.listenHandleNewConversation=null),this.listenShowGuideBlankBox&&(Pa().off(this.listenShowGuideBlankBox),this.listenShowGuideBlankBox=null),this.listenDeleAgent&&(Fs().off(this.listenDeleAgent),this.listenDeleAgent=null),this.listenUpdateCapsule&&(Js().off(this.listenUpdateCapsule),this.listenUpdateCapsule=null)},handleNewConversation:function(){this.data.set("showAskEntrance",!1)},handleScroll:function(t){var e=this.data.get("isPc"),n=t.type||"";e&&"more"===n&&Ua({type:"click",value:"agent_greet_more",page:"resultpage",ext:{ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),a_lid:on.getState("apagelid"),setype:"csaitab",is_query:this.data.get("isQuery"),enter_type:this.data.get("enterType")}})},agentLog:function(t,e){return JSON.stringify({value:"agent_greet_real",agent_id:t.agentSearchId,agent_name:t.agentName,agent_pos:String(e+1),is_query:this.data.get("isQuery"),component_area:this.data.get("showInAnswerAsk")?"weather":"",enter_type:this.data.get("enterType")})},functionalClickLog:function(t,e){return JSON.stringify({type:"click",value:"wel_function",ubcExt:{button_text:t.text,button_order:e}})},handleScrollToTop:function(){var t=this;this.nextTick((function(){var e,n,a=null==(e=document.getElementById("conversation-flow-container"))?void 0:e.offsetHeight,i=null==(n=document.querySelector("[class='chat-home-page']"))?void 0:n.clientHeight;t.data.set("blankHeight",a-i-44+"px")}))},recFunctionalShow:function(t){return JSON.stringify({value:"wel_function",button_text:t.text})},handleClickAgent:function(t,e){this.weatherExpOnlyGreet();var n=t.agentSearchId,a=t.agentName,i={rank:String(+on.getState("rank")),type:"click",value:"agent_greet",ext:{agent_id:n,agent_name:a,agent_pos:String(e+1),greet_info:this.data.get("guideWord"),jump_type:"ask",component_area:this.data.get("showInAnswerAsk")?"weather":"",is_query:this.data.get("isQuery"),enter_type:this.data.get("enterType")}};if(this.data.get("triggerType")===ae.SHOW_AGENT_GREETING)return Xn().emit(),Zl({type:"agentGreeting",data:{agentInfo:t,sa:"greet_agent",scrollTop:!0}}),i.ext.jump_type="no_ask",void Ua(i);if(Ua({rank:String(+on.getState("rank")),type:"click",value:"agent_greet",page:"resultpage",ext:{agent_id:n,agent_name:a,agent_pos:String(e+1),greet_info:this.data.get("guideWord"),setype:"csaitab",ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),a_lid:on.getState("apagelid"),is_query:this.data.get("isQuery"),enter_type:this.data.get("enterType"),component_area:this.data.get("showInAnswerAsk")?"weather":""}}),"pc"===rt()&&on.getState("isShowHello")||"pc"!==rt()&&on.getState("isShowHello")&&0===on.getState("rank"))this.data.set("showAskEntrance",!1),Yn().emit(),Zl({type:"agentGreeting",data:{sa:"re_dl_greet_agent",agentInfo:t}}),Cs(t,"greet_agent_"+(e+1)),Ds(t,"");else{var o;if("jumpLink"===t.actionType&&(null==(o=t.jump_url)?void 0:o.zbios))return void Pp(t.jump_url.zbios);Cs(t,"greet_agent_"+(e+1)),Ds(t,on.getState("agentQuery")||on.getState("query"))}},weatherExpOnlyGreet:function(){on.getState("hideTopAgentList")&&this.data.set("triggerType",ae.SHOW_AGENT_GREETING)},handlerecFunctionalListClick:function(t){Xl({query:t.text,extParams:{word:t.text,sa:"wel_function"}}).catch((function(){}))},fadeInAnimation:function(){return qh((function(){return Hh(this,(function(t){switch(t.label){case 0:return this.data.set("fadeIn",!0),[4,new Promise((function(t){return setTimeout(t,240)}))];case 1:return t.sent(),this.data.set("fadeOut",!1),this.data.set("fadeIn",!1),this.data.set("isTransitioning",!1),[2]}}))})).apply(this)},fadeOutAnimation:function(){return qh((function(){return Hh(this,(function(t){switch(t.label){case 0:return this.data.get("isTransitioning")?[2]:(this.data.set("isTransitioning",!0),this.data.set("fadeOut",!0),[4,new Promise((function(t){return setTimeout(t,40)}))]);case 1:return t.sent(),[2]}}))})).apply(this)},handleMutiRecWord:function(){return qh((function(){var t,e,n,a,i,o,r,s,l,c;return Hh(this,(function(d){switch(d.label){case 0:if(e=this.data.get("waitData"),n=this.data.get("multiRecommendWord")||{},a=this.data.get("modelGuideData")||{},i=this.data.get("latestMutiRecWord")||{},o=!1,r={},s=n,e||!n.recommendWord||!a.isShowGuide)return this.data.set("latestMutiRecWord",s),this.handleData(),[2];try{r=JSON.parse(localStorage.getItem(ye)||"{}"),o=(null==r?void 0:r.modelName)===Ge.SMART_MODE&&"1"===(null==r||null==(l=r.modelFunction)?void 0:l.mcpSwitch)}catch(t){}return c=null==a||null==(t=a.modelGuideList)?void 0:t.find((function(t){return t.modelId===Ge.SMART_MODE&&"function"===t.level&&"mcp"===t.functionName})),s=o&&c?c:n,i.guideWord===s.guideWord?[2]:[4,this.fadeOutAnimation()];case 1:return d.sent(),this.data.set("latestMutiRecWord",s),this.handleData(),[4,this.fadeInAnimation()];case 2:return d.sent(),[2]}}))})).apply(this)}}));function Fh(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Uh(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Fh(o,a,i,r,s,"next",t)}function s(t){Fh(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Gh(t,e){return null!=e&&"undefined"!=typeof Symbol&& __get$(e,Symbol.hasInstance) ?!! __call$(e,Symbol.hasInstance,[t]) :t instanceof e}function Wh(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var zh;!function(t){ __set$(t,t.SUCCESS=0,"SUCCESS") , __set$(t,t.FAIL=1,"FAIL") }(zh||(zh={}));var Qh={SUCCESS:{status:0,message:"卡片资源加载成功"},FAIL:{status:1,message:"卡片资源加载失败"}},Jh=null;var Vh=!1;function Kh(t,e){return void 0===e&&(e=document.body), new Promise(function(n){if(Gh(t,HTMLScriptElement)&&(null==t?void 0:t.src))return function(t,e){return new Promise(function(n){var a=document.createElement("script"),i={};a.type="text/javascript",a.defer=!0,i.charset&&(a.charset=i.charset),i.id&&(a.id=i.id),a.readyState?a.onreadystatechange=function(){("loaded"!==a.readyState&&"complete"!==a.readyState)||(a.onreadystatechange=null,e&&e(a),n(a));}:a.onload=function(){e&&e(a),n(a);},a.src=t,document.body.appendChild(a);});}(t.src,n);if(Gh(t,HTMLStyleElement)||Gh(t,HTMLLinkElement)){var a=Jh||(Jh=document.head.firstElementChild),i=document.querySelectorAll("link"),o=/css\/bootstrap(\.[a-f0-9]+)?\.pc\.css/,r=Array.from(i).filter(function(t){return o.test(__get$(t,"href"));});r.length>0&&(null==t?void 0:t.hasAttribute("data-vue-ssr-id"))?__get$(r,r.length-1).insertAdjacentElement("afterend",t):a?document.head.insertBefore(t,a):document.head.prepend(t);}else t&&e.appendChild(t);n(t);}) }function Xh(t){return document.createRange().createContextualFragment(t)}var Yh=function(){function t(){this.resourceFetchQueue=[],this.cardResourceLoaded=!1,this.request=window.fetch.bind(window)}var e=t.prototype;return e.preloadCardStaticResource=function(){var t=this;return Uh((function(){return Wh(this,(function(e){switch(e.label){case 0:return t.cardResourceLoaded?[2,Promise.resolve({status:0,message:"卡片资源预加载成功"})]:(t.cardHost||(t.cardHost=on.getState("chatParams").card_host),[4,t.loadStaticResource(t.cardHost)]);case 1:return 0===e.sent().status?[2,Promise.resolve({status:0,message:"卡片资源预加载成功"})]:[2,Promise.reject({status:1,message:"卡片资源预加载失败"})]}}))}))()},e.render=function(t,e,n){var a=this;return Uh((function(){var i,o,r,s;return Wh(this,(function(l){switch(l.label){case 0:return a.cardHost||(a.cardHost=on.getState("chatParams").card_host),"card"!==t?[3,7]:(i={},o={},a.cardResourceLoaded?[4,a.cardRender(e,n)]:[3,2]);case 1:case 4:return o=l.sent(),[3,6];case 2:return[4,a.loadStaticResource(a.cardHost)];case 3:return 0!==(i=l.sent()).status?[3,5]:[4,a.cardRender(e,n)];case 5:return[2,Promise.reject(i)];case 6:return 0===o.status?("ins"===(null==(s=window.bds)||null==(r=s.comm)?void 0:r.tn)&&delete window.bds.comm.tn,[2,Promise.resolve(o)]):[2,Promise.reject(o)];case 7:return[2]}}))}))()},e.setCardResourceState=function(t){this.cardResourceLoaded=t,this.resourceFetchLoading=!1},e.processContextualFragment=function(t,e){var n,a,i,o=this,r="https://pss.bdstatic.com";if(null==(i=window)||null==(a=i.bds)||null==(n=a.comm)?void 0:n.staticUrl){var s,l,c,d=Ht.parse(null==(c=window)||null==(l=c.bds)||null==(s=l.comm)?void 0:s.staticUrl),u=d.protocol,p=d.host;r=u+"//"+p}t.querySelectorAll("[src], [href]").forEach((function(t){var e=t.getAttribute("src");e&&/^\/[\d\w-]/i.test(e)&&t.setAttribute("src",""+r+e);var n=t.getAttribute("href");n&&/^\/[\d\w-]/i.test(n)&&(Gh(t,HTMLAnchorElement)?o.setAnchorHref(t,n):t.setAttribute("href",""+r+n))}));var h=Array.from(t.querySelectorAll(Vh?"style[data-vue-ssr-id]":"style"));return Sn(bn("style:not([data-vue-ssr-id]),link",t)),h.forEach((function(t){return Kh(t,e)})),new Promise((function(n){Array.from(t.children).reduce((function(t,n){return t.then((function(){return Kh(n,e)}))}),Promise.resolve()).then(n)}))},e.loadStaticResource=function(t){var e=this;return Uh((function(){var n,a,i,o;return Wh(this,(function(r){switch(r.label){case 0:if(e.resourceFetchLoading)return[2,new Promise((function(t,n){e.resourceFetchQueue.push({resolve:t,reject:n})}))];n={},a=jt(t+"/s",Ht.params({sa:"chat_ala",data_type:"json",chat_ala_range:1,tn:"ins",source_type:"pc_resources",word:"百度股价"})),r.label=1;case 1:return r.trys.push([1,6,,7]),e.resourceFetchLoading=!0,[4,e.request(a,{mode:"cors",credentials:"include"})];case 2:return 200!==(n=r.sent()).status?[3,5]:[4,n.text()];case 3:return i=r.sent(),o=Xh(i),[4,e.processContextualFragment(o)];case 4:for(r.sent(),e.setCardResourceState(!0);e.resourceFetchQueue.length;)(0,e.resourceFetchQueue.shift().resolve)(Qh.SUCCESS);return[2,Qh.SUCCESS];case 5:return[2,Qh.FAIL];case 6:for(r.sent();e.resourceFetchQueue.length;)(0,e.resourceFetchQueue.shift().reject)(Qh.FAIL);return[2,Qh.FAIL];case 7:return[2]}}))}))()},e.cardRender=function(t,e){var n=this;return Uh((function(){var a,i,o,r,s,l;return Wh(this,(function(c){switch(c.label){case 0:if(a=t.value,i=t.url,o="",!i)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),[4,n.request(i,{mode:"cors",credentials:"include"})];case 2:return[4,c.sent().text()];case 3:return o=c.sent(),[3,5];case 4:return c.sent(),[2,{status:1,message:"卡片模板请求失败"}];case 5:return[3,7];case 6:o=a,c.label=7;case 7:return r={status:1,message:"卡片渲染失败"},s={status:0,message:"卡片渲染成功",singCardContent:o},o?(l=Xh(o),[4,n.processContextualFragment(l,e)]):[3,10];case 8:return c.sent(),n.checkCommonStyle(),[4,(d=100,new Promise((function(t){return setTimeout(t,d)})))];case 9:return c.sent(),[2,e.getBoundingClientRect().height?s:r];case 10:return[2,r]}var d}))}))()},e.checkCommonStyle=function(){Vh||_n('style[data-mirror="1"]')&&(Vh=!0)},e.setAnchorHref=function(t,e){var n="https://www.baidu.com"+ __call$(e,"replace",[/([?&])tn=[^&]*(&|$)/,function(t,e,n){return("?"===e?e:"")+(n?"&":"");}]) ;t.setAttribute("href",n)},t}(),Zh=new Yh,tf={exports:{}};!function(t){t.exports=function(t){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(t,e){var n=t[0],a=t[1],i=t[2],o=t[3];a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&i|~a&o)+e[0]-680876936|0)<<7|n>>>25)+a|0)&a|~n&i)+e[1]-389564586|0)<<12|o>>>20)+n|0)&n|~o&a)+e[2]+606105819|0)<<17|i>>>15)+o|0)&o|~i&n)+e[3]-1044525330|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&i|~a&o)+e[4]-176418897|0)<<7|n>>>25)+a|0)&a|~n&i)+e[5]+1200080426|0)<<12|o>>>20)+n|0)&n|~o&a)+e[6]-1473231341|0)<<17|i>>>15)+o|0)&o|~i&n)+e[7]-45705983|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&i|~a&o)+e[8]+1770035416|0)<<7|n>>>25)+a|0)&a|~n&i)+e[9]-1958414417|0)<<12|o>>>20)+n|0)&n|~o&a)+e[10]-42063|0)<<17|i>>>15)+o|0)&o|~i&n)+e[11]-1990404162|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&i|~a&o)+e[12]+1804603682|0)<<7|n>>>25)+a|0)&a|~n&i)+e[13]-40341101|0)<<12|o>>>20)+n|0)&n|~o&a)+e[14]-1502002290|0)<<17|i>>>15)+o|0)&o|~i&n)+e[15]+1236535329|0)<<22|a>>>10)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&o|i&~o)+e[1]-165796510|0)<<5|n>>>27)+a|0)&i|a&~i)+e[6]-1069501632|0)<<9|o>>>23)+n|0)&a|n&~a)+e[11]+643717713|0)<<14|i>>>18)+o|0)&n|o&~n)+e[0]-373897302|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&o|i&~o)+e[5]-701558691|0)<<5|n>>>27)+a|0)&i|a&~i)+e[10]+38016083|0)<<9|o>>>23)+n|0)&a|n&~a)+e[15]-660478335|0)<<14|i>>>18)+o|0)&n|o&~n)+e[4]-405537848|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&o|i&~o)+e[9]+568446438|0)<<5|n>>>27)+a|0)&i|a&~i)+e[14]-1019803690|0)<<9|o>>>23)+n|0)&a|n&~a)+e[3]-187363961|0)<<14|i>>>18)+o|0)&n|o&~n)+e[8]+1163531501|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a&o|i&~o)+e[13]-1444681467|0)<<5|n>>>27)+a|0)&i|a&~i)+e[2]-51403784|0)<<9|o>>>23)+n|0)&a|n&~a)+e[7]+1735328473|0)<<14|i>>>18)+o|0)&n|o&~n)+e[12]-1926607734|0)<<20|a>>>12)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a^i^o)+e[5]-378558|0)<<4|n>>>28)+a|0)^a^i)+e[8]-2022574463|0)<<11|o>>>21)+n|0)^n^a)+e[11]+1839030562|0)<<16|i>>>16)+o|0)^o^n)+e[14]-35309556|0)<<23|a>>>9)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a^i^o)+e[1]-1530992060|0)<<4|n>>>28)+a|0)^a^i)+e[4]+1272893353|0)<<11|o>>>21)+n|0)^n^a)+e[7]-155497632|0)<<16|i>>>16)+o|0)^o^n)+e[10]-1094730640|0)<<23|a>>>9)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a^i^o)+e[13]+681279174|0)<<4|n>>>28)+a|0)^a^i)+e[0]-358537222|0)<<11|o>>>21)+n|0)^n^a)+e[3]-722521979|0)<<16|i>>>16)+o|0)^o^n)+e[6]+76029189|0)<<23|a>>>9)+i|0,a=((a+=((i=((i+=((o=((o+=((n=((n+=(a^i^o)+e[9]-640364487|0)<<4|n>>>28)+a|0)^a^i)+e[12]-421815835|0)<<11|o>>>21)+n|0)^n^a)+e[15]+530742520|0)<<16|i>>>16)+o|0)^o^n)+e[2]-995338651|0)<<23|a>>>9)+i|0,a=((a+=((o=((o+=(a^((n=((n+=(i^(a|~o))+e[0]-198630844|0)<<6|n>>>26)+a|0)|~i))+e[7]+1126891415|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~a))+e[14]-1416354905|0)<<15|i>>>17)+o|0)|~n))+e[5]-57434055|0)<<21|a>>>11)+i|0,a=((a+=((o=((o+=(a^((n=((n+=(i^(a|~o))+e[12]+1700485571|0)<<6|n>>>26)+a|0)|~i))+e[3]-1894986606|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~a))+e[10]-1051523|0)<<15|i>>>17)+o|0)|~n))+e[1]-2054922799|0)<<21|a>>>11)+i|0,a=((a+=((o=((o+=(a^((n=((n+=(i^(a|~o))+e[8]+1873313359|0)<<6|n>>>26)+a|0)|~i))+e[15]-30611744|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~a))+e[6]-1560198380|0)<<15|i>>>17)+o|0)|~n))+e[13]+1309151649|0)<<21|a>>>11)+i|0,a=((a+=((o=((o+=(a^((n=((n+=(i^(a|~o))+e[4]-145523070|0)<<6|n>>>26)+a|0)|~i))+e[11]-1120210379|0)<<10|o>>>22)+n|0)^((i=((i+=(n^(o|~a))+e[2]+718787259|0)<<15|i>>>17)+o|0)|~n))+e[9]-343485551|0)<<21|a>>>11)+i|0,t[0]=n+t[0]|0,t[1]=a+t[1]|0,t[2]=i+t[2]|0,t[3]=o+t[3]|0}function a(t){var e,n=[];for(e=0;e<64;e+=4) __set$(n,e>>2,t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24)) ;return n}function i(t){var e,n=[];for(e=0;e<64;e+=4) __set$(n,e>>2,__get$(t,e)+(__get$(t,e+1)<<8)+(__get$(t,e+2)<<16)+(__get$(t,e+3)<<24)) ;return n}function o(t){var e,i,o,r,s,l,c=t.length,d=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)n(d,a(t.substring(e-64,e)));for(i=(t=t.substring(e-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<i;e+=1)o[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(o[e>>2]|=128<<(e%4<<3),e>55)for(n(d,o),e=0;e<16;e+=1) __set$(o,e,0) ;return r=(r=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(r[2],16),l=parseInt(r[1],16)||0,o[14]=s,o[15]=l,n(d,o),d}function r(t){var e,a,o,r,s,l,c=t.length,d=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=c;e+=64)n(d,i(t.subarray(e-64,e)));for(a=(t=e-64<c?t.subarray(e-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)o[e>>2]|= __get$(t,e) <<(e%4<<3);if(o[e>>2]|=128<<(e%4<<3),e>55)for(n(d,o),e=0;e<16;e+=1) __set$(o,e,0) ;return r=(r=8*c).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(r[2],16),l=parseInt(r[1],16)||0,o[14]=s,o[15]=l,n(d,o),d}function s(t){var n,a="";for(n=0;n<4;n+=1)a+= __get$(e,t>>8*n+4&15) + __get$(e,t>>8*n&15) ;return a}function l(t){var e;for(e=0;e<t.length;e+=1) __set$(t,e,s(__get$(t,e))) ;return t.join("")}function c(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function d(t,e){var n,a=t.length,i=new ArrayBuffer(a),o=new Uint8Array(i);for(n=0;n<a;n+=1) __set$(o,n,t.charCodeAt(n)) ;return e?o:i}function u(t){return String.fromCharCode.apply(null,new Uint8Array(t))}function p(t,e,n){var a=new Uint8Array(t.byteLength+e.byteLength);return a.set(new Uint8Array(t)),a.set(new Uint8Array(e),t.byteLength),a}function h(t){var e,n=[],a=t.length;for(e=0;e<a-1;e+=2)n.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,n)}function f(){this.reset()}return l(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(n,a){var i,o,r,s,l=this.byteLength,c=e(n,l),d=l;return a!==t&&(d=e(a,l)),c>d?new ArrayBuffer(0):(i=d-c,o=new ArrayBuffer(i),r=new Uint8Array(o),s=new Uint8Array(this,c,i),r.set(s),o)}}(),f.prototype.append=function(t){return this.appendBinary(c(t)),this},f.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var e,i=this._buff.length;for(e=64;e<=i;e+=64)n(this._hash,a(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},f.prototype.end=function(t){var e,n,a=this._buff,i=a.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)o[e>>2]|=a.charCodeAt(e)<<(e%4<<3);return this._finish(o,i),n=l(this._hash),t&&(n=h(n)),this.reset(),n},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},f.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(t,e){var a,i,o,r=e;if(t[r>>2]|=128<<(r%4<<3),r>55)for(n(this._hash,t),r=0;r<16;r+=1) __set$(t,r,0) ;a=(a=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(a[2],16),o=parseInt(a[1],16)||0,t[14]=i,t[15]=o,n(this._hash,t)},f.hash=function(t,e){return f.hashBinary(c(t),e)},f.hashBinary=function(t,e){var n=l(o(t));return e?h(n):n},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(t){var e,a=p(this._buff.buffer,t),o=a.length;for(this._length+=t.byteLength,e=64;e<=o;e+=64)n(this._hash,i(a.subarray(e-64,e)));return this._buff=e-64<o?new Uint8Array(a.buffer.slice(e-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(t){var e,n,a=this._buff,i=a.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i;e+=1)o[e>>2]|= __get$(a,e) <<(e%4<<3);return this._finish(o,i),n=l(this._hash),t&&(n=h(n)),this.reset(),n},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var t=f.prototype.getState.call(this);return t.buff=u(t.buff),t},f.ArrayBuffer.prototype.setState=function(t){return t.buff=d(t.buff,!0),f.prototype.setState.call(this,t)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(t,e){var n=l(r(new Uint8Array(t)));return e?h(n):n},f}()}(tf);var ef,nf=tf.exports,af=u({__proto__:null,default:n.getDefaultExportFromCjs(nf)},[nf]);function of(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function rf(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function sf(){return sf=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},sf.apply(this,Array.from(arguments))}function lf(t,e){return lf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lf(t,e)}function cf(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return of(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?of(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function df(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var uf,pf,hf={template:'\n        <div class="capsules-box">\n            <slot name="prefix" />\n            <cos-swiper class="capsules-container">\n                <cos-swiper-item\n                    s-for="item, index in capsuleData"\n                    class="capsules-item"\n                >\n                    <div data-show-ext="{{item.type === \'agent\' ? realShowExt(item,index) : \'\'}}">\n                        <div\n                            class="capsules-item-background"\n                            style="{{capsuleBackground(item)}}"\n                        >\n                        </div>\n                        <cos-image-uploader\n                            s-if="{{(item.type === \'uploadImage\' || item.type === \'imageUpload\') && useInnerUploader}}"\n                            max-count="{{item.options && item.options.maxCount || \'1\'}}"\n                            max-compressed-dimension="1000"\n                            on-success="handleUploadSuccess"\n                        >\n                            <div\n                                on-click="handleCapsuleClick(item, index)"\n                                class="{{item.icon ? \'\' : \'capsules-item-text\'}} capsules-item-tag cos-font-medium"\n                            >\n                                <i s-if="item.icon" style="{{iconUrl(item)}}"></i>\n                                {{ item.text }}\n                            </div>\n                        </cos-image-uploader>\n                        <div\n                            s-else\n                            class="{{item.icon ? \'\' : \'capsules-item-text\'}} capsules-item-tag cos-font-medium"\n                            on-click="handleCapsuleClick(item, index)"\n                            on-mouseenter="handleCapsuleMouseenter($event, item)"\n                            on-mouseleave="handleCapsuleMouseleave($event, item)"\n                        >\n                            <i s-if="item.icon" style="{{iconUrl(item)}}" class="capsules-item-tag-icon-{{item.type}}"></i>\n                            {{ item.text }}\n                        </div>\n                    </div>\n                </cos-swiper-item>\n            </cos-swiper>\n        </div>\n    ',initData:function(){return{capsuleData:[],useInnerUploader:!0,logExtParams:{}}},attached:function(){this.fire("rendered")},realShowExt:function(t,e){return JSON.stringify(sf({component_content:{component_name:"shortcuts"},value:"capsule_bub",capsule_content:[{agent_id:t.agentId,agent_name:t.text,agent_pos:e+""}]},this.data.get("logExtParams")))},handleCapsuleClick:function(t,e){this.fire("click",sf({},t,{itemIndex:e}))},handleCapsuleMouseenter:function(t,e){this.fire("mouseenter",{event:t,data:e})},handleCapsuleMouseleave:function(t,e){this.fire("mouseleave",{event:t,data:e})},handleUploadSuccess:function(t){this.fire("img-upload-success",t)},capsuleBackground:function(t){if(t.background){var e=null==t?void 0:t.background.split("-")[0];return"background: radial-gradient(96.47% 101.09% at 1.47% 1.52%, "+e+" 0%, "+((null==t?void 0:t.background.split("-")[1])||e)+" 100%);"}},iconUrl:function(t){if(t.icon)return"background-image: url("+t.icon+")"}},ff=a.defineComponent(sf({},hf,{components:{"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem,"cos-image-uploader":e.ImageUploader}})),gf=a.defineComponent(sf({},hf,{components:{"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem,"cos-image-uploader":e.ImageUploader}}));(pf=uf||(uf={})).LOADING="loading",pf.SUCCESS="success",pf.ERROR="error";var mf=function(){return!/swandevtools|Mobile|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)},vf=a.defineComponent({template:'\n        <div class="image-item-container" style="{{class === \'auto\' ? (_width > _height ? \'width: 265.5px\' : \'width: 177px\') : \'\'}} ">\n            <cos-image\n                src="{{src}}"\n                placeholder=""\n                class="cos-image-fit-cover cos-image-position-center {{class === \'default\' || _width === _height ? \'cos-image-1-1\' : (_width > _height ? \'cos-image-3-2\' : \'cos-image-3-4\')}}"\n            >\n                \x3c!-- 图片资源上传中的状态展示 --\x3e\n                <div\n                    s-if="{{status === \'loading\'}}"\n                    class="loading-block"\n                >\n                    <cos-loading text="" />\n                </div>\n\n                \x3c!-- 图片资源上传失败的状态展示 --\x3e\n                <div\n                    s-if="{{status === \'error\'}}"\n                    class="error-block"\n                >\n                    <cos-icon name="info-circle-fill" class="icon" />\n                </div>\n            </cos-image>\n        </div>\n    ',components:{"cos-image":(mf(),e.Image),"cos-loading":(mf(),e.Loading),"cos-icon":(mf(),e.Icon)},initData:function(){return{path:"",src:"",status:uf.SUCCESS,class:"default",_width:0,_height:0}},attached:function(){var t=this;if("auto"===this.data.get("class")){var e=this.data.get("src");e&&this.autoFitImage(e),this.watch("src",(function(e){t.autoFitImage(e)}))}},autoFitImage:function(t){var e=this,n=new Image;n.src=t,n.onload=function(){e.data.set("_width",(null==n?void 0:n.width)||0),e.data.set("_height",(null==n?void 0:n.height)||0)}}});function yf(t,e){for(var n=[],a=0;a<t.length;a+=e)n.push(t.slice(a,a+e));return n}a.defineComponent({template:'\n        <div class="image-group-container">\n            <div class="image-group-block">\n                <div s-if="_singleImage" class="image-group-single-item" on-click="handlePreview(_singleImage, 0, imageGroup)">\n                    <image-item class="auto" s-bind="{{_singleImage}}" />\n                </div>\n                <fragment s-for="rowItem, rowIndex in _imageRowGroup">\n                    <div class="cos-row cos-row-col-12 cos-justify-end cos-gutter {{rowIndex < _imageRowGroup.length - 1 ? \'image-group-row\' : \'\'}}" style="--cos-grid-gutter: 8px">\n                        <fragment s-for="item, itemIndex in rowItem">\n                            <div class="cos-col-4" on-click="handlePreview(item, _imageRowGroup[0].length * rowIndex + itemIndex, imageGroup)">\n                                <image-item s-bind="{{item}}" />\n                            </div>\n                        </fragment>\n                    </div>\n                </fragment>\n            <div>\n        </div>\n    ',components:{"image-item":vf},initData:function(){return{imageGroup:[],_singleImage:void 0,_imageRowGroup:[]}},computed:{_singleImage:function(){var t=this.data.get("imageGroup");if(t&&1===t.length)return sf({class:"auto"},t[0])},_imageRowGroup:function(){var t=this.data.get("imageGroup");return t&&t.length>1?4===t.length?yf(t,2):yf(t,3):[]}},handlePreview:function(t,e,n){t.status===uf.SUCCESS&&this.fire("preview-image",{urls:n.map((function(t){return t.src})),current:""+e})}});var wf=a.defineComponent({template:'\n        <div class="drawer">\n            <div\n                s-show="{{maskShow}}"\n                class="drawer-mask"\n                style="{{maskStyle}}"\n                on-click="onMaskClick"\n            ></div>\n            <div\n                s-ref="drawerContentRef"\n                class="drawer-content drawer-content-{{show ? \'show\' : \'hide\'}}"\n                style="height: {{height}}; {{translateYStyle}}"\n                on-touchstart="onContentTouchStart"\n                on-touchmove="onContentTouchMove"\n                on-touchend="onContentTouchEnd"\n            >\n                <div\n                    class="drawer-content-close"\n                    on-click="onButtonClick"\n                ></div>\n                <div class="drawer-content-header">\n                    <div class="drawer-content-header-title">{{title}}</div>\n                </div>\n                <div class="drawer-content-main">\n                    <iframe\n                        class="drawer-content-iframe"\n                        src="{{url}}"\n                        frameborder="none"\n                    >\n                    </iframe>\n                </div>\n            </div>\n        </div>\n    ',initData:function(){return{show:!1,maskShow:!1,url:"",title:"",heightPercent:.75,_drag:{isDragging:!1,startY:0,endY:0},_thresholdY:0,_translateY:"100%"}},computed:{height:function(){return 100*Math.min(.9,Math.max(.25,this.data.get("heightPercent")))+"vh"},showDuration:function(){return this.data.get("heightPercent")<.5?240:320},hideDuration:function(){return this.data.get("heightPercent")<.5?180:240},maskStyle:function(){var t=this.data.get("show");return"transition: background-color "+(t?this.data.get("showDuration"):this.data.get("hideDuration"))+"ms ease-in-out;background-color: rgba(0, 0, 0, "+(t?".5":"0")+");"},translateYStyle:function(){var t=this.data.get("_translateY"),e="number"==typeof t?t+"px":t,n=this.data.get("_drag"),a=this.data.get("show")?this.data.get("showDuration"):this.data.get("hideDuration");return"transform: translateY("+e+") translateZ(0);-webkit-transform: translateY("+e+") translateZ(0); animation-duration: "+(n.isDragging?160:a)+"ms"}},created:function(){this.calThresholdY(),this.listenOpen()},attached:function(){var t=this,e=this.ref("drawerContentRef");null==e||e.addEventListener("animationend",(function(e){"drawerSlideOut"===e.animationName&&t.data.set("_translateY",0)})),this.watch("show",(function(e){e?t.data.set("maskShow",!0):setTimeout((function(){t.data.set("maskShow",!1),t.data.set("drag.isDragging",!1)}),t.data.get("hideDuration"))}))},calThresholdY:function(){var t=window.innerHeight,e=this.data.get("heightPercent");this.data.set("_thresholdY",.25*e*t)},listenOpen:function(){var t=this;this.watch("show",(function(e){e&&t.fire("open")}))},close:function(t){this.data.set("show",!1),this.fire("close",{type:t})},onMaskClick:function(){this.close("mask")},onButtonClick:function(){this.close("button")},onContentTouchStart:function(t){var e,n=this.data.get("_drag");n.isDragging=!1,n.startY=(null==(e=t.changedTouches[0])?void 0:e.clientY)||0,this.data.set("_drag",n)},onContentTouchMove:function(t){var e;t.preventDefault();var n=this.data.get("_drag");n.isDragging=!0,this.data.set("_drag",n);var a=((null==(e=t.changedTouches[0])?void 0:e.clientY)||0)-n.startY;this.data.set("_translateY",Math.max(a,0))},onContentTouchEnd:function(t){var e,n=this.data.get("_drag"),a=this.data.get("_thresholdY");n.endY=(null==(e=t.changedTouches[0])?void 0:e.clientY)||0,this.data.set("_drag",n),n.endY-n.startY>a?this.close("slide"):this.data.set("_translateY",0)}}),bf={},_f={};var kf= new(function(){function t(){this.components=[];}var e=t.prototype;return e.register=function(t){this.components.push(t);},e.triggerEvent=function(t,e){var n,a=this;return(n=function(){var n,i,o;return df(this,function(r){switch(r.label){case 0:n=cf(a.components),r.label=1;case 1:return(i=n()).done?[3,5]:"function"==typeof __get$((o=i.value).chatEvents,t)?[4,__call$(o.chatEvents,t,[e])]:[3,3];case 2:r.sent(),r.label=3;case 3:r.label=4;case 4:return[3,1];case 5:return[2];}});},function(){var t=this,e=Array.from(arguments);return new Promise(function(a,i){var o=n.apply(t,e);function r(t){rf(o,a,i,r,s,"next",t);}function s(t){rf(o,a,i,r,s,"throw",t);}r(void 0);});})();},t;}())() ;function Sf(t){function e(e){t.call(this,e),function(t){for(var e,n=cf(Object.keys(t));!(e=n()).done;){var a=e.value,i= __get$(t,a) ;if("string"==typeof i){if(! __get$(_f,i) )throw new Error("组件"+i+"还未被注入"); __set$(t,a,__get$(_f,i)) }}}(t.prototype.constructor.components||{});for(var n,a=cf(t.prototype.constructor.dependencies||[]);!(n=a()).done;){var i=n.value; __set$(this,i,__get$(bf,i)) }this.chatEvents&&kf.register(this)}return e.prototype=Object.create(t.prototype),e}function xf(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function If(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}!function(t){ __call$(Object,"assign",[_f,t]) }({UploaderDemo:Sf((ef=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).chatEvents={onQuestionStart:function(t){},onMessage:function(t){},onTypingFinished:function(t){},onAnwserEnd:function(t){}},e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lf(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{}},n.attached=function(){},n.handleClick=function(){this.api.getUserInfo()},e}(a.Component),ef.template='\n        <button on-click="handleClick">上传按钮</button>\n    ',ef.dependencies=["api"],ef)),Drawer:wf,CapsulePC:ff,CapsuleWise:gf}),function(t){ __call$(Object,"assign",[bf,t]) }({api:new Tc});var Tf,Cf,Lf="aitab_feedback_form_time";function Df(t){return Pf.apply(this,Array.from(arguments))}function Pf(){var t;return t=function(t){var e,n,a,i,o,r;return If(this,(function(s){switch(s.label){case 0:n=null==(e=on.getState("agentInfo"))?void 0:e.agentId,a=on.getState("chatParams").sse_host+"/aichat/api/feedback?action="+t,n&&(a+="&agentId="+n),i={credentials:"include"},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Li(a,i,2e3)];case 2:return 0===(o=s.sent()).status&&o.data?[2,o.data]:[3,4];case 3:return r=s.sent(),console.error(r),[3,4];case 4:return[2,null]}}))},Pf=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){xf(o,a,i,r,s,"next",t)}function s(t){xf(o,a,i,r,s,"throw",t)}r(void 0)}))},Pf.apply(this,Array.from(arguments))}function Ef(t){var e,n=t.product,a=t.actionName,i=t.rank,o=t.baseData,r=t.recommendWordList,s=t.isPc,l=t.askModel,c=[],d="";(null==r?void 0:r.length)&&r.forEach((function(t){var e,n;t.usedModel?d={text:t.text}:c.push({agentId:"agentRec"===t.type?null==(e=t.agentInfo)?void 0:e.agentId:"",text:"agentRec"===t.type?null==(n=t.agentInfo)?void 0:n.label:t.text})}));var u=o.query,p={ext_show188:n.intentionType,ext_show193:a,ext_show194:(null==(e=on.getState("agentInfo"))?void 0:e.agentId)||0,ext_show196:i,ext_show197:o.sa||"",desc20:(null==u?void 0:u.length)>1e3?u.substring(0,1e3):u,desc27:on.getState("oriLid"),desc28:o.lid||"0",desc29:JSON.stringify(c[0]),desc30:JSON.stringify(c[1]),desc218:JSON.stringify(c[2]),desc219:n.triggerType};return s&& __call$(Object,"assign",[p,{ext_hide7:l,ext_hide8:n.answerModel,desc220:JSON.stringify(d)}]) ,{scoreKey:11,multiKey:9,timeKey:190,data:{cuid:o.cuid,bw:o.baiduid,uid:n.uid,appid:n.appId,feedback_type:n.feedbackType,extend_url: __get$(__get$Loc(location),"href") ,extrastring:p}}}function Af(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function Of(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Rf(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Af(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Af(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Nf(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Mf(){var t;return t=function(t,e){var n,a,i;return Nf(this,(function(o){switch(o.label){case 0:return e.data.get("baseData.chatHitKunlun")===jl?[2]:(n=Ul("prerenderConfirmPromise"))?[4,n]:[3,2];case 1:o.sent(),o.label=2;case 2:return e.data.set("cardSection.data",t),(a=document.createElement("div")).innerHTML=t,e.currentPageRootDom=a,i=a.querySelector("#NATab"),1===e.data.get("currentRank")&&eo(kn(i,"src")||""),Sn(i),e.existCard()&&(e.data.set("chatGenerate",e.data.get("baseData.chatGenerate")),e.data.set("queryIsDanger",e.data.get("baseData.queryIsDanger"))),e.data.get("baseData.chatGenerate")||e.data.set("cardSection.show",!0),[2]}}))},Mf=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Of(o,a,i,r,s,"next",t)}function s(t){Of(o,a,i,r,s,"throw",t)}r(void 0)}))},Mf.apply(this,Array.from(arguments))}!function(t){t.INIT="init",t.TITLE_GENERATING="title-generating",t.TITLE_COMPLETED="title-completed",t.COMPLETED="completed",t.NO_MIND_MAP="no-mind-map"}(Tf||(Tf={})),function(t){t.SSE_STOP="sse-stop",t.SET_DATA="set-data"}(Cf||(Cf={}));var qf=!1,jf=[];function Bf(){return on.getState("resourceLoaded")||document.querySelector('script[name="globalTJS"]')?Promise.resolve():new Promise(qf?function(t,e){jf.push({resolve:t,reject:e})}:function(t,e){qf=!0,fetch("https://m.baidu.com/searchframe?sa=chat_ala&data_type=json&source_type=list&req_source=chat_search_card",{mode:"cors",credentials:"include"}).then((function(e){e.json().then((function(e){var n,a;(n=e.styles||[],a=e.scripts||[],Promise.all([$f(n,"style"),$f(a,"script")])).then((function(){for(t(),on.dispatch("update",{resourceLoaded:!0});jf.length;){var e,n=null==(e=jf.shift())?void 0:e.resolve;n&&n()}})).catch((function(){return t()}))}))})).catch((function(){return e()}))})}function Hf(t,e){for(var n,a=Rf(Object.keys(e||{}));!(n=a()).done;){var i=n.value,o= __get$(e,i) ;t.setAttribute(i,o)}}function $f(t,e){var n=Promise.resolve();return t.forEach((function(t){n=n.then((function(){return function(t,e,n){return  new Promise(function(a,i){if("style"===e){var o=document.createElement(t.tag||"external"===t.type?"link":e);Hf(o,t.attr),t.name&&o.setAttribute("name",t.name),o.innerHTML=t.code||"";var r=Uf(),s=document.querySelectorAll('[name="cosmicStyle"]');s.length>0&&o.hasAttribute("data-vue-ssr-id")?__get$(s,s.length-1).insertAdjacentElement("afterend",o):r?document.head.insertBefore(o,r):document.head.prepend(o),a();}else{var l=document.createElement("script");Hf(l,t.attr),t.name&&l.setAttribute("name",t.name),l.innerHTML=t.code||"","external"!==t.type&&a(),l.async=!0,l.onload=function(){return a();},l.onerror=function(){return i(new Error("Failed to load script: "+t.name));},n.appendChild(l);}}) }(t,e,"head"===t.position||"style"===e?document.head:document.body)}))})),n}var Ff=null;function Uf(){return Ff||(Ff=document.head.firstElementChild)}function Gf(){return Gf=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Gf.apply(this,Array.from(arguments))}var Wf=a.defineComponent({components:{"ai-markdown":e.Markdown,"cosd-site-vcard":e.SiteVcard},initData:function(){return{agentRecommendList:[],blocks:[],generateAnswer:[],recommendText:"",allContent:"",typing:{speed:30,cursor:!0,mode:"all"},typingFinished:!1,cacheContentList:[]}},attached:function(){var t,e=this;this.dispatch("component-show",{name:"agentRecommend"}),this.handleChatClick=Xi(this.handleChatClick,1e3,{leading:!0,trailing:!1}),null==(t=this.data.get("generateAnswer")[0])||t.data.forEach((function(t){var n,a;if(t.content&&(null==t||null==(n=t.content)?void 0:n.generator)){var i,o,r=null==(a=t.content.generator)?void 0:a.component;if("agentRecommend"===r||"ai-agent-recommend"===r)e.data.push("cacheContentList",null==(o=t.content.generator)||null==(i=o.data)?void 0:i.value)}}))},computed:{allContent:function(){return this.data.get("isHistory")?this.data.get("historyContent")||"":this.data.get("cacheContentList").join("")}},handleChatClick:function(t,e){var n,a,i,o,r,s,l=this.data.get(),c=l.question,d=l.isHistory,u=(null==(i=c[0])||null==(a=i.data)||null==(n=a.question)?void 0:n.question)||"";null==(s=c[0])||null==(r=s.data)||null==(o=r.agentInfo)||o.agentName;var p=d?u:on.getState("query");t.agentInfo&&(Cs(t.agentInfo,"contact_agent"),Ds(t.agentInfo,p||"你好"))},typingFinishedHandle:function(){this.ref("recommend-markdown")&&this.ref("recommend-markdown").stop(),this.data.set("typingFinished",!0)},logParams:function(t,e,n){var a=t.agentInfo,i={value:"agent_recommand"},o={agent_id:a.agentId,agent_name:a.agentName,agent_pos:e+1},r=Gf({},i,{valueInfo:{component_name:"agentRecommand"},agent_content:[Gf({},o)]}),s=Gf({},i,{order:-1,cyc:1,clk_info:{type:"na",action:"invokecsaitab"},extra:Gf({},o,{component_content:{component_name:"agentRecommand"},ori_lid:on.getState("oriLid")})});return JSON.stringify("click"===n?s:r)}}),zf={};zf= __call$(Object,"assign",[zf,{answerRecommendCard:"answer-recommend-card_8tdaz_1","answer-recommend-card":"answer-recommend-card_8tdaz_1",divider:"divider_8tdaz_30"}]) ,Wf.template='\n\n    <div\n        s-if="{{typingEnd || isHistory && agentRecommendList && agentRecommendList.length}}"\n        class="cos-dqa {{$style[\'answer-recommend-card\']}}"\n        data-no-na-dialog\n    >\n        \x3c!--推荐文案--\x3e\n        <div s-if="{{!isHistory}}">\n            <ai-markdown\n                s-ref="recommend-markdown"\n                typing="{{typing}}"\n                content="{{allContent}}"\n                on-typing-finished="typingFinishedHandle"\n            />\n        </div>\n        <div s-else>\n            <ai-markdown\n                s-ref="recommend-markdown"\n                content="{{allContent}}"\n            />\n        </div>\n        \x3c!--挂载卡list--\x3e\n        <div\n            s-if="{{(!isHistory && agentRecommendList && typingFinished) || isHistory}}"\n            s-for="agent,index in agentRecommendList"\n        >\n            <div\n                data-module="agent_recommand"\n                on-click="handleChatClick(agent,index)"\n            >\n                <cosd-site-vcard\n                    title="{{agent.title}}"\n                    caption="{{agent.caption}}"\n                    action-text="{{agent.actionText}}"\n                    logo="{{agent.logo}}"\n                    visits="{{agent.visits}}"\n                    appearance="card"\n                    attr-data-show-area\n                    attr-data-show-ext="{{logParams(agent, index, \'show\')}}"\n                    attr-need-click-log\n                    attr-data-click-log="{{logParams(agent, index, \'click\')}}"\n                />\n            </div>\n            \x3c!-- 分隔线 --\x3e\n            <div s-if="{{index !== agentRecommendList.length - 1}}" class="cos-divider {{$style[\'divider\']}}"></div>\n        </div>\n    </div>\n';var Qf,Jf,Vf="function"==typeof Wf?Wf.prototype.initData||Kf:Wf.initData||Kf;function Kf(){return{$style:zf}}function Xf(){return  __call$(Object,"assign",[{},Vf.call(this),{$style:zf}]) }"function"==typeof Wf?Wf.prototype.initData=Xf:Wf.initData=Xf;var Yf=0xb0184ac3b751,Zf="aitab_complete_answer_count",tg="1"===(null==(Jf=on.getState("sample"))||null==(Qf=Jf.variables)?void 0:Qf.WIDGET_COLOR_STYLE),eg=tg?{ios:"https://activity.baidu.com/mbox/preview/4a89a99c64/home",android:"https://activity.baidu.com/mbox/preview/4a86a09e63/home"}:{ios:"https://activity.baidu.com/mbox/4a86a89a62/home",android:"https://activity.baidu.com/mbox/4a86a89a63/home"},ng=tg?{dark:"https://psstatic.cdn.bcebos.com/basics/aichat/桌面小窗视频-dark_1743074019000.mp4",light:"https://psstatic.cdn.bcebos.com/basics/aichat/桌面小窗视频-light_1743074063000.mp4"}:{dark:"https://psstatic.cdn.bcebos.com/basics/aichat/桌面小窗视频-Dark_1737638346000.mp4",light:"https://psstatic.cdn.bcebos.com/basics/aichat/桌面小窗视频-日间_1737638324000.mp4"},ag=tg?{dark:"https://psstatic.cdn.bcebos.com/basics/aichat/半层面板视频-dark_1743074087000.mp4",light:"https://psstatic.cdn.bcebos.com/basics/aichat/半层面板视频-light_1743074105000.mp4"}:{dark:"https://psstatic.cdn.bcebos.com/basics/aichat/半层面板视频-Dark_1737638300000.mp4",light:"https://psstatic.cdn.bcebos.com/basics/aichat/半层面板视频-日间_1737638231000.mp4"};function ig(t){Qn().emit({text:t,timer:1e3})}function og(t){o.canIUse("aiSearch.open")&&o.aiSearch.open({animation:"fadeEnter",degradedCmd:"baiduboxapp://v1/browser/open?&url="+encodeURIComponent(t),url:t})}function rg(){return new Promise((function(t){o.canIUse("search.hasOpenWidget")?o.search.hasOpenWidget({openWidgetId:Yf,ignoreConfig:!0,success:function(e){var n=function(){var n,a=e.status,i=e.data;n=i,0!==Object.keys(n).length&&t(!(0===a&&!i.unsupported&&!i.installed))};Ri?setTimeout(n,200):n()},fail:function(){return t(!1)}}):t(!1)}))}function sg(){return new Promise((function(t,e){var n="ai_chat",a=Mi(),i=Oi?eg.android:eg.ios,r=Ri&&di(ci(),"13.26")>0;o.canIUse("search.addOpenWidget")?o.search.addOpenWidget({openWidgetId:Yf,from:n,success:function(){ig("添加成功"),t(!0)},fail:function(e){!function(t,e){if(t){var n=t.status;n&&[1006,1005].includes(n)?ig("添加失败，请重试"):1003!==n&&og(e)}}(e,i),t(!1)}}):o.canIUse("search.invokeWidgetGuide")&&r?o.search.invokeWidgetGuide({from:n,source:"openwidget_aichat",pipVideoUrl:a?ng.dark:ng.light,guideList:[{title:"视频教程",detailInfo:"点击“去安装”可以一边观看一边安装",isVideo:1,videoUrl:a?ag.dark:ag.light}],success:function(){t(!1)},fail:function(){og(i),t(!1)}}):(og(i),e(new Error("Widget addition not supported.")))}))}function lg(){return new Promise((function(t){return lt()||pt()||!ht()||!ds()||di(ci(),"13.74")<0?t(!1):function(){if(localStorage.getItem(Zf)){var t=parseInt(localStorage.getItem(Zf),10);if(2==++t)return localStorage.setItem(Zf,t.toString()),!0}else localStorage.setItem(Zf,"1");return!1}()?void rg().then((function(e){t(!e)})):t(!1)}))}function cg(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function dg(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var ug=!1,pg=a.defineComponent({computed:{ubcShowLog:function(){var t=this.data.get("type");if("modelGuide"===t){var e=on.getState("usedModel");return JSON.stringify({value:"model_intro",setype:"csaitab",current_model:e.modelName})}return JSON.stringify({value:"ai_chat_"+t+"_guide",ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),setype:"csaitab"})},questionCloselyData:function(){var t=this.data.get("recommendWord");return t?{askComponentData:{component:"questionClosely",data:{recommendWord:t,type:"primary",emptyDisabled:!0,isSingleCol:"1",jumpTypes:["multiSearch"],hideAskItem:!0,context:{app:"bdbox",scene:"chat-search"},toChatSearch:!0,componentArea:"model_guide"},logExt:{current_model:on.getState("usedModel").modelName},sa:this.data.get("sa")}}:null}},messages:{"ai-question-closely:click":function(t){this.handleQuestionCloselyClick(t)}},components:{"ai-ask-entrance":jp},initData:function(){return{type:"",rank:void 0,latestRank:void 0,showStatus:0,leftTitle:"",leftText:"",leftBtn:"",rightImg:"",rightImgDark:"",showCallBack:"",isNewConversationLaunched:!1,tplInfo:{tplname:"nonala_cpt",srcid:"60259",lid:"",order:-1}}},listenHide:null,listenCardTypingComplete:null,attached:function(){var t=this,e=this.data.get("type");this.listenHide=function(){"modelGuide"!==e?t.data.set("showStatus",2):t.data.set("isNewConversationLaunched",!0)},Jn().on(this.listenHide),Xn().on(this.listenHide),Yn().on(this.listenHide),ea().on(this.listenHide),"modelGuide"!==e&&(this.listenCardTypingComplete=function(e){t.listener()},Fn().on(this.listenCardTypingComplete,{when:function(e){void 0===e&&(e={});var n=t.data.get("latestRank"),a=t.data.get("rank");return e.rank===a&&a===n}}))},listener:function(){var t=this,e=!1;if(ka().on((function(n){e=!0;var a=n.tipsData,i=n.disabled,o=t.data.get("showStatus");i||2===o?t.data.set("showStatus",2):t.handleData(a)}),{when:function(e){void 0===e&&(e={});var n=t.data.get("latestRank"),a=t.data.get("rank");return e.rank===a&&a===n}}),!e){this.handleData({type:"widget",leftTitle:"将我添加至桌面",leftText:"可以更快速找到我为你解决问题",leftBtn:"放到桌面",rightImg:"https://gips0.baidu.com/it/u=1108611378,3575234106&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f471_345",rightImgDark:"https://gips0.baidu.com/it/u=2836489570,2659260543&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f471_345"})}},disposed:function(){this.listenHide&&(Jn().off(this.listenHide),Xn().off(this.listenHide),Yn().off(this.listenHide),ea().off(this.listenHide),this.listenHide=null),this.listenCardTypingComplete&&(Fn().off(this.listenCardTypingComplete),this.listenCardTypingComplete=null)},handleData:function(t){return(e=function(){var e,n,a;return dg(this,(function(i){switch(i.label){case 0:return e=this,ug?[2]:( __call$(this.data,"assign",[t]) ,"widget"!==(n=this.data.get("type"))?[3,2]:[4,lg()]);case 1:return i.sent()?(document.addEventListener("visibilitychange",(function(){document.hidden||e.setWidgetGuideStatus()})),[3,3]):[2];case 2:"message"==n&&(a=this.data.get("showCallBack"))&&fetch(a,{method:"get",mode:"cors",credentials:"include"}),i.label=3;case 3:return this.data.set("showStatus",1),ug=!0,[2]}}))},function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){cg(o,a,i,r,s,"next",t)}function s(t){cg(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var e},handleBtnClick:function(){var t=this;this.handleClickLog();var e=this.data.get("type");if("widget"===e)rg().then((function(e){e||sg().then((function(e){e&&t.data.set("leftBtn","已添加")}))}));else if("modelGuide"===e){Ua({type:"click",value:"model_intro",ext:{current_model:on.getState("usedModel").modelName}});var n=this.data.get("btnLink");n&&window.open(n,"_blank")}},setWidgetGuideStatus:function(){var t=this;rg().then((function(e){t.data.set("leftBtn",e?"已添加":"放到桌面")})).catch((function(){}))},handleClickLog:function(){Ua({page:"resultpage",type:"click",value:"ai_chat_widget_guide",ext:{ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),setype:"csaitab"}})},handleQuestionCloselyClick:function(){on.getState("usedModel")}}),hg={};hg= __call$(Object,"assign",[hg,{guideWrapper:"guide-wrapper_1278t_1","guide-wrapper":"guide-wrapper_1278t_1",guideLeft:"guide-left_1278t_10","guide-left":"guide-left_1278t_10",guideTitle:"guide-title_1278t_20","guide-title":"guide-title_1278t_20",guideText:"guide-text_1278t_33","guide-text":"guide-text_1278t_33",guideBtn:"guide-btn_1278t_46","guide-btn":"guide-btn_1278t_46",guideRight:"guide-right_1278t_59","guide-right":"guide-right_1278t_59",guideRightImg:"guide-right-img_1278t_64","guide-right-img":"guide-right-img_1278t_64",guideRightLight:"guide-right-light_1278t_67","guide-right-light":"guide-right-light_1278t_67",guideRightDark:"guide-right-dark_1278t_70","guide-right-dark":"guide-right-dark_1278t_70",guideAskEntrance:"guide-ask-entrance_1278t_73","guide-ask-entrance":"guide-ask-entrance_1278t_73",guideWrapperModelGuide:"guide-wrapper-model-guide_1278t_93","guide-wrapper-model-guide":"guide-wrapper-model-guide_1278t_93"}]) ,pg.template='\n    <div class="answer-tips-wrapper">\n        <div\n            s-if="showStatus === 1"\n            class="{{$style[\'guide-wrapper\']}} {{type === \'modelGuide\' ? $style[\'guide-wrapper-model-guide\'] : \'\'}}"\n            data-show-ext="{{ubcShowLog}}"\n            data-show-area\n        >\n            <div class="{{$style[\'guide-left\']}}">\n                <div class="{{$style[\'guide-title\']}}">{{leftTitle}}</div>\n                <div class="{{$style[\'guide-text\']}}">{{leftText}}</div>\n                <div\n                    s-if="leftBtn"\n                    class="{{$style[\'guide-btn\']}}"\n                    on-click="handleBtnClick"\n                >{{leftBtn}}</div>\n            </div>\n            <div class="{{$style[\'guide-right\']}} {{$style[\'guide-right-light\']}}">\n                <img class="{{$style[\'guide-right-img\']}}" src="{{rightImg}}" />\n            </div>\n            <div class="{{$style[\'guide-right\']}} {{$style[\'guide-right-dark\']}}">\n                <img class="{{$style[\'guide-right-img\']}}" src="{{rightImgDark || rightImg}}" />\n            </div>\n        </div>\n        <div\n            s-if="!isNewConversationLaunched && questionCloselyData"\n            class="{{$style[\'guide-ask-entrance\']}}"\n        >\n            <ai-ask-entrance\n                s-ref="askComponent"\n                s-bind="{{questionCloselyData}}"\n                tpl-info="{{tplInfo}}"\n                sa="{{sa}}"\n            />\n        </div>\n    </div>\n';var fg="function"==typeof pg?pg.prototype.initData||gg:pg.initData||gg;function gg(){return{$style:hg}}function mg(){return  __call$(Object,"assign",[{},fg.call(this),{$style:hg}]) }"function"==typeof pg?pg.prototype.initData=mg:pg.initData=mg;var vg=function(){function t(){this.callBacks=[]}var e=t.prototype;return e.listen=function(t){if("function"!=typeof t)throw new Error(t+" must be a function");this.callBacks.push(t)},e.remove=function(t){this.callBacks=this.callBacks.filter((function(e){return e!==t}))},e.emit=function(t){this.callBacks.forEach((function(e){e(t)}))},t}(),yg=function(){function t(){this.list=[]}var e=t.prototype;return e.push=function(t){this.list.push(t)},e.resolveAll=function(t){this.list.forEach((function(e){e(t)})),this.list=[]},t}(),wg=new vg,bg=new yg;var _g,kg,Sg=a.defineComponent({trimWhitespace:"all",template:'\n    <div class="cs-noresult">\n        <span>😩对不起，我还没有学会这个问题，可以换个话题再问问我，我将尽力为你回答~</span>\n    </div>\n    ',initData:function(){return{}}});function xg(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=""),t&&o.canIUse("album.image.preview")){var a="string"==typeof t?[t]:t;o.album.image.preview({current: __get$(a,e) ,urls:a,img_items:a.map((function(t){return{url:t}})),href: __get$(__get$(window,"location"),"href") ,id:"",title:"",index:e.toString(),type:"0",position:{},from:n,ext:n,only_suppert_wifi:!1,isShowPageIndex:1,rootIn:"ai_image"===n?"search-component":n,source:n,slog:n,swipeCallback:"",closeCallback:"",hasMore:0})}}!function(t){t.IDLE="IDLE",t.WAITING="WAITING",t.GENERATING="GENERATING",t.COMPLETE="COMPLETE",t.ABORT="ABORT"}(_g||(_g={})),function(t){t.AUDIO="ml-audio",t.VIDEO="ml-video",t.CITATION_TEXT="ml-citation-text"}(kg||(kg={}));var Ig=a.defineComponent({components:{"cos-image":e.Image,"cos-icon":e.Icon},computed:{imgSrc:function(){return this.data.get("src")||this.data.get("originUrl")},iconName:function(){var t=(this.data.get("centerProps")||{}).icon;return"video_play3"===t?"play":t}},initData:function(){return{src:"",originUrl:"",useImagePreview:!0,jumpUrl:"",centerProps:null,rbProps:null,imgTitle:""}},attached:function(){},onFinish:function(){this.fire("render-finished")},handleImgClick:function(){var t=this.data.get(),e=t.useImagePreview,n=t.jumpUrl,a=t.originUrl,i=t.src;e||!n?xg(a||i,0,"cos-image"):n.startsWith("baiduboxapp:")?Pp(n):window.open(n,"_blank")}}),Tg={};Tg= __call$(Object,"assign",[Tg,{coverImageTitle:"cover-image-title_o5kac_1","cover-image-title":"cover-image-title_o5kac_1",coverImageCenter:"cover-image-center_o5kac_8","cover-image-center":"cover-image-center_o5kac_8",coverImageCenterIcon:"cover-image-center-icon_o5kac_14","cover-image-center-icon":"cover-image-center-icon_o5kac_14",coverImageRb:"cover-image-rb_o5kac_18","cover-image-rb":"cover-image-rb_o5kac_18",coverImageRbText:"cover-image-rb-text_o5kac_23","cover-image-rb-text":"cover-image-rb-text_o5kac_23"}]) ,Ig.template='\n    <div class="{{$style[\'cover-image-wrapper\']}}">\n        <div s-if="imgTitle" class="{{$style[\'cover-image-title\']}}">{{imgTitle}}</div>\n        <cos-image\n            src="{{imgSrc}}"\n            on-click="native:handleImgClick"\n            on-load="onFinish"\n            on-error="onFinish"\n        >\n            <div s-if="centerProps" class="{{$style[\'cover-image-center\']}}">\n                <cos-icon\n                    s-if="centerProps.icon"\n                    class="{{$style[\'cover-image-center-icon\']}}"\n                    name="{{iconName}}"\n                />\n            </div>\n            <div s-if="rbProps" class="{{$style[\'cover-image-rb\']}}">\n                <span s-if="rbProps.text" class="{{$style[\'cover-image-rb-text\']}}">{{rbProps.text}}</span>\n            </div>\n        </cos-image>\n    </div>\n';var Cg="function"==typeof Ig?Ig.prototype.initData||Lg:Ig.initData||Lg;function Lg(){return{$style:Tg}}function Dg(){return  __call$(Object,"assign",[{},Cg.call(this),{$style:Tg}]) }"function"==typeof Ig?Ig.prototype.initData=Dg:Ig.initData=Dg;var Pg=a.defineComponent({components:{"ai-image-group":e.ImageGroup},initData:function(){return{bindData:{},realShowExt:'{"value":"pic_cpt","component_content":{"component_name":"imageGroup"}}'}},attached:function(){var t=this;this.nextTick((function(){t.fire("render-finished")}))},handleScroll:function(){this.fire("ubc-log-event",{type:"click",value:"pic_cpt_scroll",extra:{valueInfo:[{component_name:"imageGroup"}]}})},handleImgClick:function(t){var e=t.index;this.fire("ubc-log-event",{type:"click",value:"pic_cpt_clk",extra:{valueInfo:[{component_name:"imageGroup"}]}}),xg(this.data.get("list").map((function(t){return t.src})),e,"image_group")}}),Eg={};Eg= __call$(Object,"assign",[Eg,{imageGroupWrapper:"image-group-wrapper_1pmzp_1","image-group-wrapper":"image-group-wrapper_1pmzp_1"}]) ,Pg.template='\n    <div\n        data-show-ext="{{realShowExt}}"\n        data-show-area\n        class="{{$style[\'image-group-wrapper\']}}"\n    >\n        <ai-image-group\n            s-bind="{{bindData}}"\n            on-render-finished="handleRenderFinished"\n            on-click="handleImgClick"\n            on-scroll="handleScroll"\n        >\n        </ai-image-group>\n    </div>\n';var Ag="function"==typeof Pg?Pg.prototype.initData||Og:Pg.initData||Og;function Og(){return{$style:Eg}}function Rg(){return  __call$(Object,"assign",[{},Ag.call(this),{$style:Eg}]) }function Ng(){return Ng=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Ng.apply(this,Array.from(arguments))}"function"==typeof Pg?Pg.prototype.initData=Rg:Pg.initData=Rg;var Mg=a.defineComponent({components:{"ai-image-scroll":e.ImageScroll},initData:function(){return{bindData:{},appearance:"thumbnail",indicator:"",snapAlign:"none",snapStop:"normal",spaceBetween:8,imageScrollData:[],baseData:{ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank"))}}},attached:function(){var t=this;this.handleImageData(),this.nextTick((function(){t.fire("render-finished")}))},computed:{realShowExt:function(){return JSON.stringify({value:"pic_cpt",valueInfo:{component_name:"imageScroll"}})}},handleImageData:function(){var t=this.data.get("bindData").items,e=[];t.forEach((function(t,n){e.push({src:t.originUrl,span:n%3==0?8:4})})),this.data.set("imageScrollData",e)},handleImgClick:function(t){Ua({type:"click",value:"pic_cpt_clk",ext:Ng({},this.data.get("baseData"),{valueInfo:[{component_name:"imageScroll"}]})}),xg(this.data.get("imageScrollData").map((function(t){return t.src})),t.index,"image_group")},handleChange:function(){Ua({type:"click",value:"pic_cpt_scroll",ext:Ng({},this.data.get("baseData"),{valueInfo:[{component_name:"imageScroll"}]})})}}),qg={};qg= __call$(Object,"assign",[qg,{imageGroupWrapper:"image-group-wrapper_1hhx2_1","image-group-wrapper":"image-group-wrapper_1hhx2_1"}]) ,Mg.template='\n    <div\n        data-show-area\n        data-show-ext="{{realShowExt}}"\n        class="{{$style[\'image-group-wrapper\']}}"\n    >\n        <ai-image-scroll\n            items="{{imageScrollData}}"\n            appearance="{{appearance}}"\n            indicator="{{indicator}}"\n            snap-align="{{snapAlign}}"\n            snap-stop="{{snapStop}}"\n            space-between="{{spaceBetween}}"\n            on-click="handleImgClick"\n            on-change="handleChange"\n        />\n    </div>\n';var jg="function"==typeof Mg?Mg.prototype.initData||Bg:Mg.initData||Bg;function Bg(){return{$style:qg}}function Hg(){return  __call$(Object,"assign",[{},jg.call(this),{$style:qg}]) }"function"==typeof Mg?Mg.prototype.initData=Hg:Mg.initData=Hg;var $g=a.defineComponent({components:{"cos-video-scroll":e.VideoScroll},computed:{videoData:function(){var t,e=this.data.get("bindData")||{},n=e.videoData,a=(void 0===n?{}:n).video,i=e.url;return a&&{poster:a.poster,src:a.src,duration:a.duration,autoplay:a.playType,vid:null==(t=a.options)?void 0:t.vid,fullscreenLinkInfo:{href:i}}},realShowExt:function(){return JSON.stringify({value:"nonala_cpt",valueInfo:{component_name:"videoScroll"}})}},initData:function(){return{bindData:{items:[]},playerDurationRecords:[],playRatio:0,addNewPlayingDuration:!0,touchStartTime:0,autoplay:!0}},created:function(){Bf()},attached:function(){var t=(this.data.get("bindData.items")||[]).map((function(t){return t.linkInfo&&(t.fullscreenLinkInfo=t.linkInfo),t}));this.data.merge("bindData",{items:ji(t)}),this.fire("render-finished")},handleClick:function(){this.dispatch("send-log",{cyc:"1",clk_info:{srcid:"52567",tplname:"nonala_cpt",pd:"csaitab",action:"generalVideo_jump",type:"na"},extra:{component_content:{component_name:"videoScroll"}}})},handlePlayerInstanceCreate:function(t){var e,n=this;this.data.set("vid",null==(e=this.data.get("videoData"))?void 0:e.vid),this.data.set("instance",t),t&&(this.externalControlVideoPlay(t),t.on("playing",(function(){n.handlePlayerPlaying(!0)})),t.on("pause",(function(){n.handlePlayerPlaying(!1)})),t.on("destroy",(function(){n.handlePlayerPlaying(!1)})),t.on("voiceBtnClicked",(function(t){var e={clk_info:{srcid:"52567",tplname:"nonala_cpt",pd:"csaitab",action:"generalVideo_clk",type:"b",xpath:t.muted?"%silence%":"%sound%"},extra:{component_content:{component_name:"videoScroll"}}};n.dispatch("send-log",e)})))},externalControlVideoPlay:function(t){var e=this;ja().on((function(n){n?(t.currentTime=0,e.data.set("autoplay",!1),t.pause()):(t.play(),e.data.set("autoplay",!0))}))},handlePlayerPlaying:function(t){t?(this.data.set("playingTime",Date.now()),this.data.set("addNewPlayingDuration",!0)):this.data.set("pauseTime",Date.now())}}),Fg={};Fg= __call$(Object,"assign",[Fg,{videoScrollWrapper:"video-scroll-wrapper_1czxz_1","video-scroll-wrapper":"video-scroll-wrapper_1czxz_1"}]) ,$g.template='\n    <div>\n        <cos-video-scroll\n            s-ref="player"\n            span="{{bindData.span}}"\n            items="{{bindData.items}}"\n            attr-data-show-area\n            attr-data-show-ext="{{realShowExt}}"\n            on-click="native:handleClick"\n            on-created="handlePlayerInstanceCreate"\n            class="{{$style[\'video-scroll-wrapper\']}}"\n            autoplay="{{autoplay}}"\n        />\n    </div>\n';var Ug="function"==typeof $g?$g.prototype.initData||Gg:$g.initData||Gg;function Gg(){return{$style:Fg}}function Wg(){return  __call$(Object,"assign",[{},Ug.call(this),{$style:Fg}]) }"function"==typeof $g?$g.prototype.initData=Wg:$g.initData=Wg;var zg={citationOld:/\^(\d+)\^/g,citationAllOld:/\^(\^|\d|\s)+\^/g,shortAnswer:/==\*\*(.*?)\*\*==\{(?:.*?)(?:\.cos-text-headline)(?:([^}]*))\}/g,coreAnswer:/==\*\*(.*?)\*\*==\{(.*?)\.dqa-(.([^}]*))\}/g,contentShortCut:/\n(.*?){(?:.*?).cos-line-clmap-(\d+)(?:([^}]*))}\n/g,searchLink:/\[([^\]]*?)\]\(\)(\{["|']+sa["|']+:(?:([^}]*))})?/g,bdPrefix:/:bd-(tts|copy)\{([^}]*)\}/g,audio:/<audio\s+(?:[^>]*?\s+)?(?:src=["']([^"']*?)["']|title=["']([^"']*?)["'])\s*(?:[^>]*?\s+)?(?:src=["']([^"']*?)["']|title=["']([^"']*?)["'])\s*.*?><\/audio>/gi,video:/<video\s+(?:[^>]*?\s+)?src=["']([^"']*?)["'].*?>(.*?)<\/video>/gi,yiyanCoreAnswer:/(?=^|[^=])(\*\*(.*?\*\*))(?=[^=]|$)/g,yiyanCitation:/\^\[(\d+)(\]\[(\d+))*\]\^/g,yiyanImage:/<img\s+src="([^"]+)"\s*(?:\/>|><\/img>)/gi};function Qg(t){return  __call$(t.value,"replace",[zg.citationAllOld,function(t){var e,n=(null==(e=t.match(zg.citationOld))?void 0:e.filter(function(t,e){return e<2;}))||[];return'‌:ml-citation{ref="'+n.map(function(t){return t.slice(1,t.length-1);}).join(",")+'" data="citationList"}';}]) }function Jg(t){return  __call$(t.value,"replace",[zg.searchLink,function(t,e){return"‌:ml-search["+e+"]";}]) }function Vg(t){return  __call$(t.value,"replace",[zg.yiyanCitation,function(t){var e,n=(null==(e=t.match(/\d+/g))?void 0:e.filter(function(t,e){return e<2;}))||[];return':ml-citation{ref="'+n.join(",")+'" data="citationList"}';}]) }function Kg(t){var e="";return e= __call$(e=__call$(t.value,"replace",[zg.audio,function(t,e,n,a,i){return'\n::ml-audio{title="'+(n||i)+'" src="'+(e||a)+'"}\n';}]),"replace",[zg.video,function(t,e){return'\n::ml-video{src="'+e+'"}\n';}]) ,e}function Xg(t){return  __call$(__call$(t.value,"replace",[/\\\[([\s\S]+?)\\\]/g,function(t,e){return/^\s*\n/.test(e)?"$$"+e+"$$":"$"+e+"$";}]),"replace",[/\\\(([\s\S]+?)\\\)/g,function(t,e){return"$"+e+"$";}]) }function Yg(t,e){var n=t;return n=Jg({value:n}),e||(n= __call$({value:n}.value,"replace",[zg.yiyanCoreAnswer,function(t,e){return"=="+e+"==";}]) ),n=function(t){return  __call$(t.value,"replace",[zg.yiyanImage,function(t,e){return"![]("+e+")";}]) }({value:n}),n=Xg({value:n=Kg({value:n=Qg({value:n=Vg({value:n})})})})}function Zg(t){var e=t;return e=Qg({value:e=Vg({value:e=Jg({value:e})})}),e=function(t){return  __call$(t.value,"replace",[zg.contentShortCut,function(t,e,n){return"\n:::ml-paragraph{line-clamp="+n+"}\n            "+e+"\n        :::\n";}]) }({value:e=function(t){return  __call$(t.value,"replace",[zg.shortAnswer,function(t,e){return"## =="+e+"==";}]) }({value:e= __call$({value:e}.value,"replace",[zg.coreAnswer,function(t,e,n,a,i){return/\.cos-text=headline/.test(n)||/\.cos-text-headline/.test(i)?"==**"+e+"**=={"+n+".dqa-"+a+i+"}":"==**"+e+"**==";}]) })}),e=function(t){return  __call$(t.value,"replace",[zg.bdPrefix,function(t,e,n){return":ml-"+e+"{"+n+"}";}]) }({value:e}),e=Xg({value:e=Kg({value:e})})}var tm=a.defineComponent({components:{"ai-markdown":e.Markdown},initData:function(){return{content:"",typing:null,isTypingEnd:!1,normalizeContent:Zg}},stopTyping:function(){var t;this.data.get("isTypingEnd")&&(null==(t=this.ref("markdown-content"))||t.stop())},appendContent:function(t){this.ref("markdown-content").appendContent(t)},typingFinished:function(){this.data.set("isTypingEnd",!0),this.fire("typing-finished")}}),em={};em= __call$(Object,"assign",[em,{dsContent:"ds-content_fv7dn_1","ds-content":"ds-content_fv7dn_1"}]) ,tm.template='\n    <div class="{{$style[\'ds-content\']}}" disable-audio>\n        <ai-markdown\n            s-ref="markdown-content"\n            typing="{{typing}}"\n            content="{{content}}"\n            normalizeContent="{{normalizeContent}}"\n            on-typing-finished="typingFinished"\n        />\n    </div>\n';var nm="function"==typeof tm?tm.prototype.initData||am:tm.initData||am;function am(){return{$style:em}}function im(){return  __call$(Object,"assign",[{},nm.call(this),{$style:em}]) }"function"==typeof tm?tm.prototype.initData=im:tm.initData=im;var om=a.defineComponent({components:{"cos-icon":e.Icon},initData:function(){return{hasContent:!0,thinkingText:"深度思考中",finishedText:"深度思考完成",stopText:"思考已停止",isExpanded:!0,imgSrc:"https://gips2.baidu.com/it/u=1024110589,3770674247&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f48_37",isThinkingDoneSrc:"https://gips2.baidu.com/it/u=48799040,3038285185&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f48_48",isThinkingDone:!1,isStopThinking:!1,path:"https://psstatic.cdn.bcebos.com/basics/aichat/data_1739260489000.json",options:{loop:!0,autoplay:!0,renderer:"svg"},lottieInstance:null,modelName:"",thinkingStatusText:"思考完成"}},attached:function(){var e=this;new Promise((function(e,n){t(["lottie-web"],(function(t){e(d(t))}),n)})).then((function(t){var n=t.default,a=e.data.get(),i=a.path,o=a.options;if(i){var r=e.ref("lottieWrapper"),s=n.loadAnimation({path:i,loop:(null==o?void 0:o.loop)||!1,autoplay:(null==o?void 0:o.autoplay)||!1,renderer:(null==o?void 0:o.renderer)||"svg",container:r});e.data.set("lottieInstance",s),e.fire("ready",s)}}))},toggle:function(){var t=this;this.data.get().isThinkingDone&&(this.sendLog("click"),this.fire("ds-click"),this.nextTick((function(){t.sendLog("show")})))},sendLog:function(t){var e=this.data.get("isExpanded");this.dispatch("send-ubclog",{type:t,value:"ds_think",extra:{is_open:e?"1":"0",enter_type:on.getState("pcEnterType")||"ai_tab_url"}})},detached:function(){this.data.get("lottieInstance")&&this.data.get("lottieInstance").destroy()}}),rm={};rm= __call$(Object,"assign",[rm,{dsHeader:"ds-header_acruy_1","ds-header":"ds-header_acruy_1",dsHeaderBottom:"ds-header-bottom_acruy_35","ds-header-bottom":"ds-header-bottom_acruy_35",dsFoldBottom:"ds-fold-bottom_acruy_38","ds-fold-bottom":"ds-fold-bottom_acruy_38",dsThinkingText:"ds-thinking-text_acruy_44","ds-thinking-text":"ds-thinking-text_acruy_44",dsLoading:"ds-loading_acruy_51","ds-loading":"ds-loading_acruy_51",dsImg:"ds-img_acruy_56","ds-img":"ds-img_acruy_56",isThinkingImg:"is-thinking-img_acruy_68","is-thinking-img":"is-thinking-img_acruy_68",rotate:"rotate_acruy_1",dsTitle:"ds-title_acruy_71","ds-title":"ds-title_acruy_71",dsToggleIcon:"ds-toggle-icon_acruy_76","ds-toggle-icon":"ds-toggle-icon_acruy_76"}]) ,om.template='\n    <div\n        class="\n            {{$style[\'ds-header\']}}\n            {{hasContent ? (isExpanded ? $style[\'ds-header-bottom\'] : $style[\'ds-fold-bottom\']) : \'\'}}\n        "\n        data-no-share-select\n        disable-tts\n        on-click="toggle"\n    >\n        <img\n            class="{{$style[\'ds-img\']}} {{isThinkingDone || !hasContent ? \'\' : $style[\'is-thinking-img\']}}"\n            src="{{isThinkingDoneSrc}}"\n        />\n        <span class="{{$style[\'ds-title\']}}">{{ modelName }}</span>\n        <span class="{{$style[\'ds-thinking-text\']}}">\n            {{ isStopThinking ? stopText : (isThinkingDone ? finishedText : thinkingText) }}\n        </span>\n        <fragment s-if="isPc">\n            <div\n                s-ref="lottieWrapper"\n                s-show="!isThinkingDone"\n                class="{{$style[\'ds-loading\']}}"\n            ></div>\n        </fragment>\n        <cos-icon\n            s-if="hasContent"\n            s-show="{{isThinkingDone || !isPc}}"\n            class="{{$style[\'ds-toggle-icon\']}}"\n            name="{{isExpanded ? \'up\' : \'down\'}}"\n        />\n    </div>\n';var sm="function"==typeof om?om.prototype.initData||lm:om.initData||lm;function lm(){return{$style:rm}}function cm(){return  __call$(Object,"assign",[{},sm.call(this),{$style:rm}]) }"function"==typeof om?om.prototype.initData=cm:om.initData=cm;var dm={initData:function(){return{isThinkingDone:!1,path:"https://psstatic.cdn.bcebos.com/basics/chat/loading_point_1740135136000.json",options:{loop:!0,autoplay:!0,renderer:"svg"},lottieInstance:null}},attached:function(){var t=this.data.get(),e=t.path,n=t.options;if(e){var a=this.ref("lottieWrapper"),i=s.loadAnimation({path:e,loop:(null==n?void 0:n.loop)||!1,autoplay:(null==n?void 0:n.autoplay)||!1,renderer:(null==n?void 0:n.renderer)||"svg",container:a});this.data.set("lottieInstance",i),this.fire("ready",i)}},detached:function(){this.data.get("lottieInstance")&&this.data.get("lottieInstance").destroy()}},um={};um= __call$(Object,"assign",[um,{dsLoading:"ds-loading_48k4o_1","ds-loading":"ds-loading_48k4o_1"}]) ,dm.template='\n    <div\n        class="{{$style[\'ds-tail\']}}"\n        disable-tts\n    >\n        <div\n            s-show="!isThinkingDone"\n            class="{{$style[\'ds-loading\']}}"\n            s-ref="lottieWrapper"\n        ></div>\n    </div>\n';var pm="function"==typeof dm?dm.prototype.initData||hm:dm.initData||hm;function hm(){return{$style:um}}function fm(){return  __call$(Object,"assign",[{},pm.call(this),{$style:um}]) }"function"==typeof dm?dm.prototype.initData=fm:dm.initData=fm;var gm=a.defineComponent({components:{"ds-context":tm,"ds-header":om,"ds-thiking-tail":dm},initData:function(){return{isExpanded:!0,isThinkingDone:!1,dsContent:"",typing:null,isStopThinking:!1,modelName:"",isPc:"pc"===rt(),hasContent:!0,thinkingText:"深度思考中",finishedText:"深度思考完成",stopText:"思考已停止"}},listenStopDsMarkdown:null,attached:function(){var t,e=this,n=this.data.get(),a=n.value,i=n.typing,o=null==(t=on.getState("dsUsedModel"))?void 0:t.modelName;if(this.data.set("modelName",o),this.observerEmptyPlace(),null===i){var r,s=null==(r=this.data.get("usedModel"))?void 0:r.modelName;this.data.set("modelName",s),this.data.set("dsContent",a),this.data.set("isThinkingDone",!0)}this.listenStopDsMarkdown=function(t){var n;t&&(e.data.set("isThinkingDone",null==t?void 0:t.isThinkingDone),null==(n=e.ref("ds-context"))||n.stopTyping())},Ra().on(this.listenStopDsMarkdown)},disposed:function(){this.listenStopDsMarkdown&&(Ra().off(this.listenStopDsMarkdown),this.listenStopDsMarkdown=null)},observerEmptyPlace:function(){var t,e=this,n=null==(t=this.ref("ds-header"))?void 0:t.el;if(n){var a=new IntersectionObserver((function(t){var n;t[0].isIntersecting&&(null==(n=e.ref("ds-header"))||n.sendLog("show"))}),{root:null,rootMargin:"0px",threshold:.6});a.observe(n)}},toggleContent:function(){this.data.set("isExpanded",!this.data.get("isExpanded"))},appendContent:function(t){var e;null==(e=this.ref("ds-context"))||e.appendContent(t)},stop:function(){var t;this.data.set("isThinkingDone",!0),this.data.set("isStopThinking",!0),null==(t=this.ref("ds-context"))||t.stopTyping()},typingFinished:function(){this.fire("typing-finished")}}),mm={};mm= __call$(Object,"assign",[mm,{dsContainer:"ds-container_husv5_1","ds-container":"ds-container_husv5_1"}]) ,gm.template='\n    <div\n        class="{{$style[\'ds-container\']}}"\n        disable-copy\n    >\n        \x3c!--ds思考态--\x3e\n        <ds-header\n            s-ref="ds-header"\n            is-pc="{{isPc}}"\n            is-expanded="{{isExpanded}}"\n            is-thinking-done="{{isThinkingDone}}"\n            is-stop-thinking="{{isStopThinking}}"\n            has-content="{{hasContent}}"\n            thinking-text="{{thinkingText}}"\n            finished-text="{{finishedText}}"\n            stop-text="{{stopText}}"\n            on-ds-click="toggleContent"\n        ></ds-header>\n        \x3c!--思考内容--\x3e\n        <ds-context\n            s-if="hasContent"\n            s-show="isExpanded"\n            s-ref="ds-context"\n            content="{{dsContent}}"\n            typing="{{typing}}"\n            on-typing-finished="typingFinished"\n        />\n        <ds-thiking-tail\n            s-if="!isPc"\n            is-thinking-done="{{isThinkingDone}}"\n        ></ds-thiking-tail>\n    </div>\n';var vm="function"==typeof gm?gm.prototype.initData||ym:gm.initData||ym;function ym(){return{$style:mm}}function wm(){return  __call$(Object,"assign",[{},vm.call(this),{$style:mm}]) }function bm(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function _m(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){bm(o,a,i,r,s,"next",t)}function s(t){bm(o,a,i,r,s,"throw",t)}r(void 0)}))}}function km(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof gm?gm.prototype.initData=wm:gm.initData=wm;var Sm=a.defineComponent({Lottie:null,initData:function(){return{picProcess:0,picLoadingDesc:"AI作图中",showPicLoading:!1,picLoadingExtend:!1,interval:null,picLoadingHeight:"auto",isPc:"pc"===rt()}},computed:{loadingDomStyle:function(){return{"padding-top":this.data.get("picLoadingHeight"),width:this.data.get("picLoadingHeight")}}},customNextTick:function(){return _m((function(){var t;return km(this,(function(e){return t=this,[2,new Promise((function(e){t.nextTick((function(){e()}))}))]}))})).apply(this)},attached:function(){var e=this;new Promise((function(e,n){t(["lottie-web"],(function(t){e(d(t))}),n)})).then((function(t){e.Lottie=t.default;var n={container:e.ref("brushDom"),renderer:"svg",loop:!0,autoplay:!0,path:"https://psstatic.cdn.bcebos.com/basics/chat/brush_1741693509000.json"};e.Lottie.loadAnimation(n)})),this.updateData({content:this.data.get("bindData")})},updateData:function(t){var e=this.el;if(t.clearLoading)this.clearPicLoading();else{var n=t.content;if(n){n.description&&this.data.set("picLoadingDesc",n.description);var a=n.ratio||"1-1";this.renderLottie(a);var i=this;setTimeout(_m((function(){var t,o,r;return km(this,(function(s){switch(s.label){case 0:return i.data.set("showPicLoading",!0),[4,i.customNextTick()];case 1:return s.sent(),o=a.split("-"),r=i.data.get("isPc")?"456px":(+o[1]||1)/(+o[0]||1)*(null==(t=i.el)?void 0:t.clientWidth)+"px",i.data.set("picLoadingHeight",r),i.nextTick((function(){i.data.set("picLoadingExtend",!0),setTimeout((function(){i.incrementNumber(33)}),1e3),i.dispatch("pic-loading:set-height",null==e?void 0:e.clientHeight)})),+n.progress>i.data.get("picProcess")&&i.incrementNumber(+n.progress),i.fire("typing-finished","pic-loading"),[2]}}))})),this.data.get("showPicLoading")?0:500)}}},incrementNumber:function(t){var e=this;if(!(t<=this.data.get("picProcess"))){clearTimeout(this.data.get("interval"));var n=function(){e.data.set("picProcess",e.data.get("picProcess")+1),e.data.get("picProcess")<t&&e.data.set("interval",setTimeout(n,10))};this.data.set("interval",setTimeout(n,10))}},clearPicLoading:function(){this.data.set("showPicLoading",!1),this.data.set("picProcess",0),clearTimeout(this.data.get("interval"))},renderLottie:function(e){var n=this;if(!this.data.get("showPicLoading")){var a={container:this.ref("loadingDom"),renderer:"svg",loop:!0,autoplay:!0,path:ke.get(e)};this.Lottie?this.Lottie.loadAnimation(a):new Promise((function(e,n){t(["lottie-web"],(function(t){e(d(t))}),n)})).then((function(t){n.Lottie=t.default,n.Lottie.loadAnimation(a)}))}},detached:function(){this.clearPicLoading()}}),xm={};xm= __call$(Object,"assign",[xm,{picLoading:"pic-loading_12rbp_1","pic-loading":"pic-loading_12rbp_1",picLoadingBrush:"pic-loading-brush_12rbp_9","pic-loading-brush":"pic-loading-brush_12rbp_9",picLoadingDesc:"pic-loading-desc_12rbp_17","pic-loading-desc":"pic-loading-desc_12rbp_17",answerBoxBorder:"answer-box-border_12rbp_27","answer-box-border":"answer-box-border_12rbp_27",picLoadingExtend:"pic-loading-extend_12rbp_33","pic-loading-extend":"pic-loading-extend_12rbp_33"}]) ,Sm.template='\n    <div\n        style="{{\'height:\' + picLoadingHeight + \';\'}}"\n        class="{{showPicLoading ? $style[\'answer-box-border\'] : \'\'}}"\n    >\n        <div\n            s-show="showPicLoading"\n            s-ref="loadingDom"\n            style="{{loadingDomStyle}}"\n            class="{{$style[\'pic-loading\']}} {{picLoadingExtend ? $style[\'pic-loading-extend\'] : \'\'}}"\n        >\n        </div>\n        <span s-if="showPicLoading" class="{{$style[\'pic-loading-desc\']}}">{{picProcess}}%</span>\n        <div\n            s-show="showPicLoading"\n            s-ref="brushDom"\n            class="{{$style[\'pic-loading-brush\']}}"\n        ></div>\n    </div>\n';var Im="function"==typeof Sm?Sm.prototype.initData||Tm:Sm.initData||Tm;function Tm(){return{$style:xm}}function Cm(){return  __call$(Object,"assign",[{},Im.call(this),{$style:xm}]) }"function"==typeof Sm?Sm.prototype.initData=Cm:Sm.initData=Cm;var Lm={components:{"ai-markdown":e.Markdown},initData:function(){return{content:"",typing:null,isTypingEnd:!1,isTypingFinished:!1,normalizeContent:Zg,foldStatus:"fold",askUsedModel:{},usedModel:{}}},computed:{contentShowUbcLog:function(){var t,e;return JSON.stringify({valueInfo:[{component_name:"thinkingSteps"}],value:"answer_think",type:"show",enter_type:on.getState("pcEnterType")||"ai_tab_url",ask_model:(null==(t=this.data.get("askUsedModel"))?void 0:t.modelName)||"hisUnknow",satisfy_model:(null==(e=this.data.get("usedModel"))?void 0:e.modelName)||""})}},stopTyping:function(){var t;this.data.get("isTypingEnd")&&(null==(t=this.ref("markdown"))||t.stop()),this.data.set("isTypingFinished",!0)},appendContent:function(t){this.ref("markdown").appendContent(t)},typingFinished:function(){this.data.set("isTypingEnd",!0),this.fire("typing-finished")}},Dm={};Dm= __call$(Object,"assign",[Dm,{markdownContent:"markdown-content_1b31q_1","markdown-content":"markdown-content_1b31q_1",typingFinished:"typing-finished_1b31q_8","typing-finished":"typing-finished_1b31q_8",expand:"expand_1b31q_11"}]) ,Lm.template='\n    <div\n        class="\n            {{$style[\'markdown-content\']}}\n            {{foldStatus === \'fold\' ? \'\' : $style[\'expand\']}}\n            {{isTypingFinished ? $style[\'typing-finished\'] : \'\'}}\n        "\n        data-show-area\n        data-show-ext="{{contentShowUbcLog}}"\n    >\n        <ai-markdown\n            s-ref="markdown"\n            typing="{{typing}}"\n            content="{{content}}"\n            normalizeContent="{{normalizeContent}}"\n            on-typing-finished="typingFinished"\n        />\n    </div>\n';var Pm="function"==typeof Lm?Lm.prototype.initData||Em:Lm.initData||Em;function Em(){return{$style:Dm}}function Am(){return  __call$(Object,"assign",[{},Pm.call(this),{$style:Dm}]) }"function"==typeof Lm?Lm.prototype.initData=Am:Lm.initData=Am;var Om=a.defineComponent({components:{"cs-avatar":e.Avatar},initData:function(){return{data:{},foldStatus:"fold"}},computed:{fileIcon:function(){var t=this.data.get("data");return _r.includes(t.type)?t.icon: __get$(me,hi(t.type,t.file_name)) }},handleReferenceClick:function(){this.fire("reference-click")}}),Rm={};Rm= __call$(Object,"assign",[Rm,{referenceItem:"reference-item_19dyr_1","reference-item":"reference-item_19dyr_1",expand:"expand_19dyr_9",text:"text_19dyr_17",title:"title_19dyr_20"}]) ,Om.template="\n    <div class=\"{{$style['reference-item']}} {{foldStatus === 'fold' ? '' : $style['expand']}}\">\n        <cs-avatar src=\"{{fileIcon}}\" size=\"xs\" />\n        <div class=\"{{$style['title']}}\" on-click=\"handleReferenceClick\">\n            <div class=\"{{$style['text']}}\">{{ data.file_name }}</div>\n        </div>\n    </div>\n";var Nm="function"==typeof Om?Om.prototype.initData||Mm:Om.initData||Mm;function Mm(){return{$style:Rm}}function qm(){return  __call$(Object,"assign",[{},Nm.call(this),{$style:Rm}]) }"function"==typeof Om?Om.prototype.initData=qm:Om.initData=qm;var jm=a.defineComponent({components:{"cs-avatar":e.Avatar},initData:function(){return{data:{},foldStatus:"fold"}},handleReferenceClick:function(){this.fire("reference-click")}}),Bm={};Bm= __call$(Object,"assign",[Bm,{referenceItem:"reference-item_rar5r_1","reference-item":"reference-item_rar5r_1",expand:"expand_rar5r_10",text:"text_rar5r_18",title:"title_rar5r_21",delimiter:"delimiter_rar5r_29",source:"source_rar5r_32"}]) ,jm.template='\n    <div class="{{$style[\'reference-item\']}} {{foldStatus === \'fold\' ? \'\' : $style[\'expand\']}}">\n        <cs-avatar src="{{data.icon}}" size="xs" />\n        <div on-click="handleReferenceClick" class="{{$style[\'title\']}}">\n            <div class="{{$style[\'text\']}}">{{ data.text }}</div>\n            <template s-if="{{data.source}}">\n                <div class="{{$style[\'delimiter\']}}">-</div>\n                <div class="{{$style[\'source\']}}">{{ data.source }}</div>\n            </template>\n        </div>\n    </div>\n';var Hm="function"==typeof jm?jm.prototype.initData||$m:jm.initData||$m;function $m(){return{$style:Bm}}function Fm(){return  __call$(Object,"assign",[{},Hm.call(this),{$style:Bm}]) }"function"==typeof jm?jm.prototype.initData=Fm:jm.initData=Fm;var Um=a.defineComponent({initData:function(){return{idx:0,data:{}}},handleReferenceClick:function(){this.fire("reference-click")}}),Gm={};Gm= __call$(Object,"assign",[Gm,{referenceItem:"reference-item_1gu0g_1","reference-item":"reference-item_1gu0g_1",title:"title_1gu0g_9",text:"text_1gu0g_14"}]) ,Um.template="\n    <div class=\"{{$style['reference-item']}}\">\n        <div on-click=\"handleReferenceClick\">{{ idx + 1 + '.' }}</div>\n        <div on-click=\"handleReferenceClick\" class=\"{{$style['title']}}\">\n            <div class=\"{{$style['text']}}\">{{ data.text + '-' + data.source }}</div>\n        </div>\n    </div>\n";var Wm="function"==typeof Um?Um.prototype.initData||zm:Um.initData||zm;function zm(){return{$style:Gm}}function Qm(){return  __call$(Object,"assign",[{},Wm.call(this),{$style:Gm}]) }"function"==typeof Um?Um.prototype.initData=Qm:Um.initData=Qm;var Jm=a.defineComponent({components:{"pc-knowledge":Om,"pc-online":jm,"wise-online":Um},initData:function(){return{data:{},idx:0,foldStatus:"fold",isPc:!1}},computed:{curComponent:function(){return this.data.get("isPc")?this.data.get("data.kb_reference")?"pc-knowledge":"pc-online":"wise-online"}},handleReferenceClick:function(){var t,e,n=this.data.get("data");if(n.kb_reference)this.fire("knowledge-item-click");else{var a=n.url,i=n.text;this.dispatch("send-ubclog",{type:"click",page:"resultpage",value:"answer_origin",extra:{pos:this.data.get("idx")+1,content:i,url:a,enter_type:on.getState("pcEnterType")||"ai_tab_url",valueInfo:[{component_name:"thinkingSteps"}],ask_model:(null==(t=this.data.get("askUsedModel"))?void 0:t.modelName)||"hisUnknow",satisfy_model:(null==(e=this.data.get("usedModel"))?void 0:e.modelName)||""}}),o.canIUse("search.open")?o.search.open({url:a,notShowLandingTopBar:0,isContainer:"1",statusBarStyle:2,config:'{"immersed":1,"background":"#09090A"}'}):window.open(a,"_blank")}}});Jm.template='\n    <div\n        s-is="{{curComponent}}"\n        data="{{data.kb_reference || data}}"\n        idx="{{idx}}"\n        fold-status="{{foldStatus}}"\n        on-reference-click="handleReferenceClick"\n    ></div>\n';var Vm=a.defineComponent({components:{"reference-item":Jm},initData:function(){return{referenceList:[],askUsedModel:{},usedModel:{},foldStatus:"fold",isPc:!1}},computed:{referenceListShowLogData:function(){var t,e,n,a=this.data.get("referenceList")||[];if(!!(null==(t=a[0])?void 0:t.kb_reference)){var i,o=ti.getState("knowledgeMsg."+ti.getState("knowledgeId"))||{};return JSON.stringify({value:"zsk_answer_origin",zsk_name:o.title,zsk_id:o.id,origin_num:a.length,file_num:(null==(i=o.fileList)?void 0:i.length)||0})}return JSON.stringify({type:"show",total_num:a.length,page:"resultpage",value:"answer_origin",enter_type:on.getState("pcEnterType")||"ai_tab_url",valueInfo:[{component_name:"thinkingSteps"}],ask_model:(null==(e=this.data.get("askUsedModel"))?void 0:e.modelName)||"hisUnknow",satisfy_model:(null==(n=this.data.get("usedModel"))?void 0:n.modelName)||""})}},handleKnowledgeItemClick:function(){var t,e=ti.getState("knowledgeMsg."+ti.getState("knowledgeId"))||{},n=this.data.get("referenceList")||[];Ua({type:"click",value:"zsk_answer_origin",ext:{zsk_name:e.title,zsk_id:e.id,origin_num:n.length,file_num:(null==(t=e.fileList)?void 0:t.length)||0,a_lid:on.getState("apagelid"),lid:on.getState("lid"),ori_lid:on.getState("oriLid"),re_rank:String(on.getState("rank"))}})}});Vm.template='\n    <div data-show-area data-show-ext="{{referenceListShowLogData}}">\n        <reference-item\n            s-for="refItem, idx in referenceList"\n            data="{{refItem}}"\n            idx="{{idx}}"\n            fold-status="{{foldStatus}}"\n            is-pc="{{isPc}}"\n            on-knowledge-item-click="handleKnowledgeItemClick"\n        />\n    </div>\n';var Km=a.defineComponent({initData:function(){return{status:"fold",hasSummary:!1}}}),Xm={};Xm= __call$(Object,"assign",[Xm,{thinkingStepsFold:"thinking-steps-fold_4vi36_1","thinking-steps-fold":"thinking-steps-fold_4vi36_1",thinkingStepsFoldContainer:"thinking-steps-fold-container_4vi36_7","thinking-steps-fold-container":"thinking-steps-fold-container_4vi36_7",thinkingStepsFoldFold:"thinking-steps-fold-fold_4vi36_11","thinking-steps-fold-fold":"thinking-steps-fold-fold_4vi36_11",showMask:"show-mask_4vi36_19","show-mask":"show-mask_4vi36_19"}]) ,Km.template="\n    <div\n        class=\"{{$style['thinking-steps-fold']}}\n            {{status === 'fold' ? $style['thinking-steps-fold-fold'] : ''}}\n            {{status === 'fold' ? $style['show-mask'] : ''}}\n        \"\n    >\n        <div class=\"{{$style['thinking-steps-fold-container']}}\">\n            <slot />\n        </div>\n    </div>\n";var Ym="function"==typeof Km?Km.prototype.initData||Zm:Km.initData||Zm;function Zm(){return{$style:Xm}}function tv(){return  __call$(Object,"assign",[{},Ym.call(this),{$style:Xm}]) }function ev(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function nv(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){ev(o,a,i,r,s,"next",t)}function s(t){ev(o,a,i,r,s,"throw",t)}r(void 0)}))}}function av(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Km?Km.prototype.initData=tv:Km.initData=tv;var iv=["web_search","searchingOnline","knowledge"],ov=["reasoning","reasoningContent"];var rv=a.defineComponent({components:{"cs-fold":Km,"reasoning-context":Lm,"reference-list":Vm,"ds-thiking-tail":dm,"ds-header":om,"cos-icon":e.Icon},initData:function(){return{showThinking:!1,title:"",titleIcon:"",couldExpand:!1,steps:[],referenceList:[],summary:"",curStep:"",isPc:"pc"===rt(),foldStatus:"pc"===rt()?"fold":"unfold",typing:null,inThinking:!1,isStopThinking:!1,historyContent:"",historyContentArr:[],isPcHistory:!1,reasoningContent:"",isTypingEnd:!1,askUsedModel:{},usedModel:{},isShowRerfenceArr:[],referenceListArr:[],curReasonRefIndex:-1,curStepLength:0,finished:!1,finishedText:"",thinkingText:""}},computed:{hasSummary:function(){return this.data.get("couldExpand")&&"fold"===this.data.get("foldStatus")&&(this.data.get("summary")||this.data.get("curStep"))},headerShowExt:function(){var t,e;return JSON.stringify({value:"answer_title",enter_type:on.getState("pcEnterType")||"ai_tab_url",valueInfo:[{component_name:"thinkingSteps"}],ask_model:(null==(t=this.data.get("askUsedModel"))?void 0:t.modelName)||"hisUnknow",satisfy_model:(null==(e=this.data.get("usedModel"))?void 0:e.modelName)||""})}},getReasonRef:function(t,e){return this.data.get("isPc")?"reasoningContent"===t?"markdown-content":"reference-list":"reasoningContent"===t?"markdown-content-"+e:"reference-list-"+e},isShowReasoningContext:function(t){return ov.includes(t.component)},toggleFold:function(){var t,e;if(this.data.get("couldExpand")){var n=this.data.get("foldStatus");this.data.set("foldStatus","fold"===n?"unfold":"fold");var a=this.data.get("isShowRerfenceArr").fill(!1);this.data.set("isShowRerfenceArr",a);var i,o,r=this.data.get("title")||"";if(this.dispatch("send-ubclog",{type:"click",value:"fold"===n?"answer_title_open":"answer_title_close",extra:{enter_type:on.getState("pcEnterType")||"ai_tab_url",valueInfo:[{component_name:"thinkingSteps"}],title:r,ask_model:(null==(t=this.data.get("askUsedModel"))?void 0:t.modelName)||"hisUnknow",satisfy_model:(null==(e=this.data.get("usedModel"))?void 0:e.modelName)||""}}),"fold"===n)this.dispatch("send-ubclog",{type:"show",value:"answer_content",extra:{enter_type:on.getState("pcEnterType")||"ai_tab_url",valueInfo:[{component_name:"thinkingSteps"}],ask_model:(null==(i=this.data.get("askUsedModel"))?void 0:i.modelName)||"hisUnknow",satisfy_model:(null==(o=this.data.get("usedModel"))?void 0:o.modelName)||""}})}},handleReferenceListTitleClick:function(t){var e=!this.data.get("isShowRerfenceArr["+t+"]");this.data.set("isShowRerfenceArr["+t+"]",e);var n=this.ref("reference-list-"+t).el;if(n)if(e){var a=n.scrollHeight+"px";n.style.height=a;var i=function(){n.style.height="auto",n.removeEventListener("transitionend",i)};n.addEventListener("transitionend",i)}else{var o=n.scrollHeight+"px";n.style.height=o,requestAnimationFrame((function(){n.style.height="0px"}))}},typingFinished:function(){this.fire("typing-finished")},customNextTick:function(){return nv((function(){var t;return av(this,(function(e){return t=this,[2,new Promise((function(e){t.nextTick(e)}))]}))})).apply(this)},updateData:function(t,e){return void 0===e&&(e=!1),nv((function(){var n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b,_,k,S,x,I,T,C,L,D,P,E,A,O,R,N,M,q,j,B,H,$,F,U;return av(this,(function(G){switch(G.label){case 0:return n=this.data.get("isPc"),a=t.title,i=void 0===a?"":a,o=t.titleIcon,r=void 0===o?"":o,s=t.couldExpand,l=void 0!==s&&s,c=t.steps,d=void 0===c?[]:c,u=t.referenceList,p=void 0===u?[]:u,h=t.reasoningContent,f=void 0===h?"":h,g=t.reasoningContentArr,m=void 0===g?[]:g,v=t.referenceListArr,y=void 0===v?[]:v,w=t.summary,b=void 0===w?"":w,_=t.status,k=Array.isArray(m)&&m[0]||f||"",S=Array.isArray(y)&&y.flat(1)||p.length>0&&p||[],e&&(this.data.set("historyContent",k),x=[],I=[],T=[].concat(y),C=[].concat(m),L=!1,D=i,d.forEach((function(t,e){"queryAnalysis"===t.step_name&&(L=!0),iv.includes(t.step_name)? __set$(I,e,T.shift()) :"reasoningContent"===t.component&&( __set$(x,e,C.shift()) ,"reasoningFinished"===t.step_name&&(D=t.title))})),this.data.set("finishedText",D),this.data.set("isPcHistory",L),this.data.set("historyContentArr",x),this.data.set("referenceListArr",I),this.finish()),this.data.set("showThinking",!0),i&&this.data.set("title",i),r&&this.data.set("titleIcon",r),l&&this.data.set("couldExpand",l),S.length&&this.data.set("referenceList",S),d.length?(this.data.set("steps",d),P= __get$(d,d.length-1) .title,"referenceList"=== __get$(d,d.length-1) .component&&(E=this.data.get("referenceList"),A= __get$(E,E.length-1) ||{},O=A.icon,R=A.text,N=A.kb_reference,P="<div style='flex-shrink: 0'>"+P+"</div><img style='border-radius: 50%' src=\""+function(t,e){return e?_r.includes(e.type)?e.icon: __get$(me,hi(e.type,e.file_name)) :t}(O,N)+"\" /><div style='white-space: nowrap; text-overflow: ellipsis; overflow: hidden'>"+((null==N?void 0:N.file_name)||R)+"</div>"),this.data.set("curStep",P),[4,this.customNextTick()]):[3,2];case 1:G.sent(),G.label=2;case 2:if(M=d.length,q=this.data.get("curStepLength"),n||e){if(n&&!e&&Array.isArray(y)&&y.length>0){for(F=this.data.get("referenceListArr"),U=d.length-1;U>=0;U--)if(iv.includes( __get$(d,U) .step_name)){ __set$(F,U,y[0]) ;break}this.data.set("referenceListArr",F)}}else M!==q&&(this.data.set("curStepLength",M),null==(B=this.ref("markdown-content-"+this.data.get("curReasonRefIndex")))||null==(j=B.stopTyping)||j.call(B),H=this.data.get("curReasonRefIndex")+1,this.data.set("curReasonRefIndex",H),this.data.set("isShowRerfenceArr["+H+"]",!1),this.data.set("referenceListArr["+H+"]",S),"reasoningFinished"===($= __get$(d,M-1) ).step_name?(this.data.set("finishedText",$.title),this.finish()):"reasoning"===$.step_name&&this.data.set("thinkingText",$.title));return k&&(!e&&this.appendReasonContent(k),this.data.get("inThinking")||this.data.set("inThinking",!0)),S.length&&this.fire("update-reference",this.data.get("referenceListArr").filter((function(t){return t})).flat(1)),b&&(this.data.set("inThinking",!1),this.data.set("isTypingEnd",!0),this.data.set("summary",b),this.stop()),k&&!b||this.fire("typing-finished"),"finished"!==_&&"closed"!==_||this.finish(),[2]}}))})).apply(this)},appendReasonContent:function(t){var e=this.data.get("isPc")?this.ref("markdown-content"):this.ref("markdown-content-"+this.data.get("curReasonRefIndex"));e&&(null==e.appendContent||e.appendContent.call(e,t))},stopReasonContent:function(){var t=this.data.get("isPc")?this.ref("markdown-content"):this.ref("markdown-content-"+this.data.get("curReasonRefIndex"));t&&(null==t.stopTyping||t.stopTyping.call(t))},appendReference:function(t){this.appendReasonContent(t)},finish:function(){this.data.set("finished",!0)},stop:function(){this.stopReasonContent()},forceStop:function(t){var e="hint"===t?"回答已完成":"回答已暂停";this.data.set("title",e),this.stop(),this.data.set("isStopThinking",!0),this.finish()},attached:function(){var t=this.data.get();this.updateData(t,!t.typing)}}),sv={};sv= __call$(Object,"assign",[sv,{thinkingSteps:"thinking-steps_pb6wx_1","thinking-steps":"thinking-steps_pb6wx_1",large:"large_pb6wx_14",expand:"expand_pb6wx_17",titleContainer:"title-container_pb6wx_26","title-container":"title-container_pb6wx_26",title:"title_pb6wx_26",summary:"summary_pb6wx_41",foldIcon:"fold-icon_pb6wx_54","fold-icon":"fold-icon_pb6wx_54",finished:"finished_pb6wx_68",rotate:"rotate_pb6wx_1",main:"main_pb6wx_71",step:"step_pb6wx_75",component:"component_pb6wx_95",stepsHeader:"steps-header_pb6wx_98","steps-header":"steps-header_pb6wx_98",finishComponent:"finish-component_pb6wx_141","finish-component":"finish-component_pb6wx_141",stepToolBlock:"step-tool-block_pb6wx_144","step-tool-block":"step-tool-block_pb6wx_144",referenceListTitleZone:"reference-list-title-zone_pb6wx_155","reference-list-title-zone":"reference-list-title-zone_pb6wx_155",referenceTitleIcon:"reference-title-icon_pb6wx_155","reference-title-icon":"reference-title-icon_pb6wx_155",iconDown:"icon-down_pb6wx_162","icon-down":"icon-down_pb6wx_162",referenceComponent:"reference-component_pb6wx_165","reference-component":"reference-component_pb6wx_165",referenceHide:"reference-hide_pb6wx_170","reference-hide":"reference-hide_pb6wx_170",referenceShow:"reference-show_pb6wx_174","reference-show":"reference-show_pb6wx_174",stepsTail:"steps-tail_pb6wx_177","steps-tail":"steps-tail_pb6wx_177",withExpand:"with-expand_pb6wx_198","with-expand":"with-expand_pb6wx_198",summaryTitle:"summary-title_pb6wx_201","summary-title":"summary-title_pb6wx_201"}]) ,rv.template='\n    <div\n        s-if="showThinking"\n        class="\n            {{$style[\'thinking-steps\']}}\n            {{couldExpand ? $style[\'large\'] : $style[\'tiny\']}}\n            {{foldStatus === \'fold\' ? \'\' : $style[\'expand\']}}\n            {{finished ? $style[\'finished\'] : \'\'}}\n        "\n        disable-copy\n    >\n        <header\n            s-if="isPc"\n            data-show-area\n            data-show-ext="{{headerShowExt}}"\n            on-click="toggleFold()"\n        >\n            <div class="{{$style[\'title-container\']}}">\n                <img src="{{titleIcon}}" />\n                <div class="{{$style[\'title\']}}">{{ title }}</div>\n            </div>\n            <div s-if="{{hasSummary && !inThinking}}" class="{{$style[\'summary\']}}">\n                \x3c!-- bca-disable-next-line --\x3e\n                {{(summary || curStep) | raw}}\n            </div>\n            <div\n                s-if="couldExpand"\n                class="{{$style[\'fold-icon\']}}"\n            >\n                <cos-icon name="{{foldStatus === \'fold\' ? \'down\' : \'up\'}}"/>\n            </div>\n        </header>\n        <ds-header\n            s-else\n            is-expanded="{{foldStatus === \'unfold\'}}"\n            thinkingText="{{thinkingText}}"\n            finishedText="{{finishedText}}"\n            is-thinking-done="{{finished}}"\n            is-stop-thinking="{{isStopThinking}}"\n            class="{{$style[\'steps-header\']}}"\n            on-ds-click="toggleFold"\n        ></ds-header>\n        <cs-fold\n            s-if="{{couldExpand && steps.length}}"\n            s-show="{{foldStatus === \'unfold\' || inThinking}}"\n            status="{{foldStatus}}"\n            has-summary="{{hasSummary}}"\n            class="{{$style[\'main\']}}"\n        >\n            <fragment s-for="step, sindex in steps">\n                <div\n                    s-if="{{isPc || step.step_name !== \'reasoningFinished\' || isPcHistory}}"\n                    class="\n                        {{$style[\'step\']}}\n                        {{step.step_name === \'reasoning\' ? $style[\'step-text-block\'] : $style[\'step-tool-block\']}}\n                    "\n                >\n                    <div s-if="{{isPc && foldStatus === \'unfold\'}}" class="{{$style[\'title\']}}">\n                        {{ step.title }}\n                    </div>\n                    <template s-if="{{step.component || step.title}}">\n                        <fragment s-if="{{step.component === \'referenceList\'}}">\n                            <div\n                                s-if="{{!isPc}}"\n                                class="{{$style[\'reference-list-title-zone\']}}"\n                                on-click="handleReferenceListTitleClick(sindex)"\n                            >\n                                {{ step.title }}\n                                <cos-icon\n                                    name="up"\n                                    class="\n                                        {{$style[\'reference-title-icon\']}}\n                                        {{isShowRerfenceArr[sindex] ? \'\' : $style[\'icon-down\']}}"\n                                />\n                            </div>\n                            <reference-list\n                                s-if="{{foldStatus === \'unfold\'}}"\n                                s-ref="{{getReasonRef(step.component, sindex)}}"\n                                class="\n                                    {{$style[\'component\']}}\n                                    {{$style[\'reference-component\']}}\n                                    {{isShowRerfenceArr[sindex] ? $style[\'reference-show\'] : $style[\'reference-hide\']}}\n                                "\n                                isPc="{{isPc}}"\n                                reference-list="{{referenceListArr[sindex]}}"\n                                fold-status="{{foldStatus}}"\n                                ask-used-model="{{askUsedModel}}"\n                                used-model="{{usedModel}}"\n                            />\n                        </fragment>\n                        <fragment s-else>\n                            <div\n                                s-if="{{!isPc && step.step_name !== \'reasoning\'}}"\n                                class="{{$style[\'reasoning-title\']}}"\n                            >\n                                <div>{{ step.title }}</div>\n                            </div>\n                            <reasoning-context\n                                s-if="{{isShowReasoningContext(step)}}"\n                                s-ref="{{getReasonRef(step.component, sindex)}}"\n                                class="\n                                    {{$style[\'component\']}}\n                                    {{step.step_name === \'reasoningFinished\' ? $style[\'finish-component\'] : \'\'}}\n                                "\n                                typing="{{typing}}"\n                                content="{{historyContentArr[sindex]}}"\n                                fold-status="{{foldStatus}}"\n                                on-typing-finished="typingFinished"\n                                is-typing-end="{{isTypingEnd}}"\n                                ask-used-model="{{askUsedModel}}"\n                                used-model="{{usedModel}}"\n                            />\n                        </fragment>\n                    </template>\n                </div>\n            </fragment>\n        </cs-fold>\n        <ds-thiking-tail\n            s-if="{{!isPc && !finished}}"\n            is-thinking-done="{{!inThinking}}"\n            class="{{$style[\'steps-tail\']}}"\n        ></ds-thiking-tail>\n    </div>\n';var lv,cv="function"==typeof rv?rv.prototype.initData||dv:rv.initData||dv;function dv(){return{$style:sv}}function uv(){return  __call$(Object,"assign",[{},cv.call(this),{$style:sv}]) }"function"==typeof rv?rv.prototype.initData=uv:rv.initData=uv,function(t){t.LINK="link",t.DOWNLOAD="download",t.DOWNLOAD_CENTER="donwloadCenter"}(lv||(lv={}));var pv=a.defineComponent({components:{"cosd-site-vcard":e.SiteVcard},initData:function(){return{list:[],isMcp:!1}},attached:function(){this.fire("render-finished"),this.handleButtonClick=Xi(this.handleButtonClick,1e3,{leading:!0,trailing:!1})},logParams:function(t){var e={value:"mcp",button_text:t.actionText};return JSON.stringify(e)},handleButtonClick:function(t,e){var n=t.url,a=t.title,i=t.actionText;switch(this.dispatch("send-ubclog",{type:"click",value:this.data.get("isMcp")?"mcp":"",extra:{button_text:i}}),t.type){case"link":Pp(n);break;case"download":var r=this.data.get("list["+e+"].actionText");Hn().conversation.clickDownload.emit({downloadUrl:n,fileName:a}),"下载"===r&&(o.canIUse("uCenter.downloadCenter")||o.canIUse("userCenter.downloadCenter")?(this.data.set("list["+e+"].actionText","去查看"),this.data.set("list["+e+"].type","donwloadCenter")):this.data.set("list["+e+"].actionText","重新下载"));break;case"donwloadCenter":o.canIUse("uCenter.downloadCenter")?o.uCenter.downloadCenter({params:{ubcSrc:"from_other"}}):o.canIUse("userCenter.downloadCenter")&&o.userCenter.downloadCenter({params:{ubcSrc:"from_other"}})}}}),hv={};hv= __call$(Object,"assign",[hv,{siteCard:"site-card_a16lw_1","site-card":"site-card_a16lw_1"}]) ,pv.template='\n\n    <div\n        s-if="{{list && list.length}}"\n        class="{{$style[\'site-card\']}}"\n    >\n        \x3c!--挂载卡list--\x3e\n        <div\n            s-for="site,index in list"\n            on-click="handleButtonClick(site, index)"\n        >\n            <cosd-site-vcard\n                title="{{site.title}}"\n                logo="{{site.logo}}"\n                caption="{{site.caption}}"\n                action-text="{{site.actionText}}"\n                appearance="filled"\n                attr-data-show-area\n                attr-data-show-ext="{{logParams(site)}}"\n            />\n        </div>\n    </div>\n';var fv="function"==typeof pv?pv.prototype.initData||gv:pv.initData||gv;function gv(){return{$style:hv}}function mv(){return  __call$(Object,"assign",[{},fv.call(this),{$style:hv}]) }function vv(){return vv=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},vv.apply(this,Array.from(arguments))}"function"==typeof pv?pv.prototype.initData=mv:pv.initData=mv;var yv=a.defineComponent({components:{"cos-video-player":e.RichVideoPlayer},computed:{videoData:function(){var t,e=this.data.get("bindData")||{},n=e.videoData,a=(void 0===n?{}:n).video,i=e.url;return a&&{poster:a.poster,src:a.src,duration:a.duration,autoplay:a.playType,vid:null==(t=a.options)?void 0:t.vid,fullscreenLinkInfo:{href:i}}},realShowExt:function(){return JSON.stringify({value:"nonala_cpt",component_content:{component_name:"generalVideo"}})}},initData:function(){return{bindData:{},playerDurationRecords:[],playRatio:0,addNewPlayingDuration:!0,touchStartTime:0}},created:function(){Bf()},attached:function(){this.fire("render-finished")},handleTouchstart:function(){this.data.set("touchStartTime",Date.now())},handleTouchend:function(t){var e=this.data.get("touchStartTime");Date.now()-e>500&&(t.preventDefault(),t.stopPropagation())},handleActionLogEvent:function(t){var e,n;t.component?this.fire("action-log-event",t):"only-csr"===(null==(n=this.data.get("bindData"))||null==(e=n.context)?void 0:e.renderMode)&&this.fire("action-log-event",{component:"generalVideo",actionType:"na"})},handlePlayerInstanceCreate:function(t){var e,n=this;this.data.set("vid",null==(e=this.data.get("videoData"))?void 0:e.vid),this.data.set("instance",t),t&&(t.on("timeupdate",(function(){n.handlePlayerTimeUpdate()})),t.on("playing",(function(){n.handlePlayerPlaying(!0)})),t.on("pause",(function(){n.handlePlayerPlaying(!1)})),t.on("destroy",(function(){n.handlePlayerPlaying(!1)})),t.on("voiceBtnClicked",(function(t){var e=t.muted?"Off":"Open";n.handleActionLogEvent({component:"generalVideo",actionType:"b",ext:{action:"voice_"+e}})})))},handlePlayerTimeUpdate:function(){var t=this.data.get("instance"),e=this.data.get("vid"),n=(null==t?void 0:t.duration)||1/0,a=(null==t?void 0:t.currentTime)||0;if(this.data.get("addNewPlayingDuration"))this.data.push("playerDurationRecords",[a,a]),this.data.set("addNewPlayingDuration",!1);else{var i=this.data.get("playerDurationRecords")||[[0,0]];this.data.set("playerDurationRecords."+(i.length-1)+".1",a)}var o=this.calcPlayerDuaration(),r="",s=Math.floor(o/n*100),l=this.data.get("playRatio")||0;l<30&&30===s?(this.data.set("playRatio",30),r="generalVideo30"):l<50&&50===s?(this.data.set("playRatio",50),r="generalVideo50"):l<80&&80===s&&(this.data.set("playRatio",80),r="generalVideo80"),r&&this.fire("ubc-log-event",{type:"show",value:r,page:"resultpage",extra:{valueInfo:[{component_name:"generalVideo"}],nid:e}})},calcPlayerDuaration:function(){var t=(this.data.get("playerDurationRecords")||[[0,0]]).slice();t.sort((function(t,e){return t[0]-e[0]}));for(var e=0,n=t[0],a=1;a<t.length;a++){var i= __get$(t,a) ;n[1]>=i[0]?n[1]=Math.max(n[1],i[1]):(e+=n[1]-n[0],n=i)}return e+=n[1]-n[0]},handlePlayerDraggingEnd:function(t){var e,n,a=(null==(e=this.data.get("videoData"))?void 0:e.duration)*t/100||0;this.data.push("playerDurationRecords",[a,a]),Np({component:"generalVideo",actionType:"scroll",ext:{action:"generalVideo_slide",nid:this.data.get("vid")}},vv({},this.data.get("tplInfo"),{tplname:"nonala_cpt"}),{},null==(n=this.ref("player"))?void 0:n.el)},handlePlayerPlaying:function(t){var e=this.data.get("instance");if(null==e||e.currentTime,t)this.data.set("playingTime",Date.now()),this.data.set("addNewPlayingDuration",!0);else{this.data.set("pauseTime",Date.now());var n=this.data.get("playingTime"),a=this.data.get("pauseTime");this.fire("ubc-log-event",{ubcId:"17630",value:"generalVideo_play",page:"resultpage",extra:{nid:this.data.get("vid"),starttime:n,endtime:a,duration:a-n}})}}});yv.template='\n    <div\n        s-if="bindData"\n        s-is="{{bindData.url ? \'a\' : \'div\'}}"\n        href="{{bindData.url}}"\n        class="cos-block"\n    >\n        <cos-video-player\n            s-ref="player"\n            attr-data-show-area\n            attr-data-show-ext="{{realShowExt}}"\n            s-bind="{{videoData}}"\n            on-created="handlePlayerInstanceCreate"\n            on-seeked="handlePlayerDraggingEnd"\n            on-click="native:handleActionLogEvent"\n            on-touchstart ="native:handleTouchstart"\n            on-touchend ="native:handleTouchend"\n        ></cos-video-player>\n    </div>\n';var wv,bv,_v,kv,Sv,xv,Iv,Tv,Cv,Lv,Dv,Pv=function(){return Pv=Object.assign||function(t){for(var e,n=1,a=Array.from(arguments).length;n<a;n++)for(var i in e= __get$(Array.from(arguments),n) )Object.prototype.hasOwnProperty.call(e,i)&&( __set$(t,i,__get$(e,i)) );return t},Pv.apply(this,Array.from(arguments))};function Ev(t){return{lower:t.toLowerCase().split("").map((function(t){return t.charCodeAt(0)})),upper:t.toUpperCase().split("").map((function(t){return t.charCodeAt(0)})),length:t.length}}"function"==typeof SuppressedError&&SuppressedError,function(t){t.Text="Text",t.Tag="Tag"}(wv||(wv={}));var Av=Ev("!doctype"),Ov=Ev("style"),Rv=Ev("script");function Nv(){return 32===Tv||10===Tv||9===Tv||9===Tv||13===Tv||12===Tv}function Mv(t){bv=0,_v=t,kv=t.length,Sv=0,xv=0,Iv=[],Cv=!1,Lv=!1,Dv=0}function qv(t,e,n){void 0===e&&(e=bv),void 0===n&&(n=xv);var a=_v.substring(Sv,n);1!==t&&3!==t||(a=a.toLowerCase()),1===t&&("script"===a?Cv=!0:"style"===a&&(Lv=!0)),3===t&&(Cv=Lv=!1),(0!==t&&4!==t||n!==Sv)&&Iv.push({type:t,start:Sv,end:n,value:a}),2===t||3===t?(Sv=n+1,bv=0):(Sv=n,bv=e)}function jv(){60===Tv&&qv(0,1)}function Bv(){Cv||Lv?47===Tv?(bv=14,Sv=xv+1):bv=0:Tv>=97&&Tv<=122||Tv>=65&&Tv<=90?(bv=2,Sv=xv):47===Tv?(bv=14,Sv=xv+1):60===Tv?qv(0):33===Tv?(bv=8,Sv=xv):63===Tv?(Sv=xv,qv(1,12)):bv=0}function Hv(){Nv()?qv(1,3):62===Tv?(qv(1),qv(2)):47===Tv&&qv(1,7)}function $v(){62===Tv?(qv(4),qv(2)):47===Tv?qv(4,7):61===Tv?(qv(4),qv(5,void 0,xv+1)):39===Tv?qv(4,5):34===Tv?qv(4,6):Nv()||qv(4,4)}function Fv(){62===Tv?(qv(6),qv(2)):47===Tv?qv(6,7):61===Tv?(qv(6),qv(5,3,xv+1)):Nv()&&qv(6,3)}function Uv(){39===Tv&&qv(7,3,xv+1)}function Gv(){34===Tv&&qv(8,3,xv+1)}function Wv(){62===Tv?qv(2):(qv(6,3),$v())}function zv(){switch(Tv){case 45:bv=10;break;case 100:case 68:bv=9;break;default:qv(1,12)}}function Qv(){(Dv=xv-Sv)===Av.length?Nv()?qv(1,3):Zv():62===Tv?(qv(1,void 0,Sv+1),qv(0),qv(2)): __get$(Av.lower,Dv) !==Tv&& __get$(Av.upper,Dv) !==Tv&&qv(1,12,Sv+1)}function Jv(){45===Tv?qv(1,11,xv+1):qv(1,12,Sv+1)}function Vv(){45===Tv&&qv(0,13)}function Kv(){62===Tv&&(qv(0),qv(2))}function Xv(){2===(Dv=xv-Sv)?62===Tv?qv(2):45===Tv?qv(0,void 0,Sv+1):bv=11:45!==Tv&&(bv=11)}function Yv(){Dv=xv-Sv,Lv?60===Tv?(Sv-=2,qv(0,1)):Dv<Ov.length? __get$(Ov.lower,Dv) !==Tv&& __get$(Ov.upper,Dv) !==Tv&&(Sv-=2,bv=0):62===Tv?qv(3):Nv()||(Sv-=2,bv=0):Cv?60===Tv?(Sv-=2,qv(0,1)):Dv<Rv.length? __get$(Rv.lower,Dv) !==Tv&& __get$(Rv.upper,Dv) !==Tv&&(Sv-=2,bv=0):62===Tv?qv(3):Nv()||(Sv-=2,bv=0):62===Tv&&qv(3)}function Zv(){throw new SyntaxError('Unexpected token "'+_v.charAt(xv)+'" at '+xv+" when parse "+bv)}function ty(t,e){return t.split(",").reduce((function(t,n){return  __set$(t,n,e) ,t}),Object.create(null))}var ey,ny,ay,iy,oy,ry,sy,ly,cy,dy,uy=ty("area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr,!doctype,,!,!--",!0),py=ty("li,option,select,textarea",!0);function hy(t,e,n,a){if(a.enter&&a.enter(t,e,n),t.type===wv.Tag&&Array.isArray(t.body))for(var i=0;i<t.body.length;i++)hy( __get$(t.body,i) ,t,i,a);a.leave&&a.leave(t,e,n)}function fy(t,e){void 0===t?(ny=0,ay.length=0,ly=""):(ay=function(t){for(Mv(t);xv<kv;){switch(Tv=_v.charCodeAt(xv),bv){case 0:jv();break;case 1:Bv();break;case 2:Hv();break;case 3:$v();break;case 4:Fv();break;case 5:Uv();break;case 6:Gv();break;case 7:Wv();break;case 8:zv();break;case 9:Qv();break;case 10:Jv();break;case 11:Vv();break;case 12:Kv();break;case 13:Xv();break;case 14:Yv();break;default:Zv()}xv++}switch(bv){case 0:case 1:case 4:case 5:case 6:case 7:case 11:case 12:case 13:qv(0);break;case 2:qv(1);break;case 3:break;case 8:qv(1,12);break;case 9:xv-Sv===Av.length?qv(1):(qv(1,void 0,Sv+1),qv(0));break;case 10:xv-Sv==2?qv(1):(qv(1,void 0,Sv+1),qv(0));break;case 14:qv(3)}var e=Iv;return Mv(""),e}(t),ny=ay.length,ly=t),ey=0,iy=void 0,oy=[],ry=void 0,sy=void 0,cy=void 0,dy=e}function gy(t){iy?t.type===wv.Tag&&t.name===iy.tag.name&& __get$(py,t.name) ?(iy=iy.parent,gy(t)):iy.tag.body&&(iy.tag.end=t.end,iy.tag.body.push(t)):oy.push(t)}function my(t){iy={parent:iy,tag:t},sy=void 0}function vy(t,e,n){return void 0===t&&(t=ry.start),void 0===e&&(e=ry.end),void 0===n&&(n=ry.value),{start:t,end:e,value:n,type:wv.Text}}function yy(){return{start:ry.start,end:ry.end,name:vy(),value:void 0}}function wy(t){void 0===t&&(t=sy),t.value+=ry.value,t.end=ry.end}function by(){void 0===cy&&(cy=ly.split("\n").reduce((function(t,e){return t.push(e.length+1+ __get$(t,t.length-1) ),t}),[0]));var t=function(t,e){var n="function"==typeof Symbol&& __get$(t,Symbol.iterator) ;if(!n)return t;var a,i,o=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(a=o.next()).done;)r.push(a.value)}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return r}(function(t,e){for(var n=NaN,a=NaN,i=1;i<t.length;i++)if( __get$(t,i) >e){n=i,a=e- __get$(t,i-1) +1;break}return[n,a]}(cy,ry.start),2),e=t[0],n=t[1];throw new Error('Unexpected token "'+ry.value+"("+ry.type+')" at ['+e+","+n+"]"+(iy?" when parsing tag: "+JSON.stringify(iy.tag.name)+".":""))}function _y(t){var e,n;t.attributeMap={};try{for(var a=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&& __get$(t,e) ,a=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&& __get$(t,a++) ,done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t.attributes),i=a.next();!i.done;i=a.next()){var o=i.value; __set$(t.attributeMap,o.name.value,o) }}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}function ky(){var t=0,e=void 0,n={start:ry.start-1,end:ry.end,type:wv.Tag,open:vy(ry.start-1),name:ry.value,rawName:ly.substring(ry.start,ry.end),attributes:[],attributeMap:void 0,body:null,close:null};if(gy(n),""===n.name||"!"===n.name||"!--"===n.name){if(n.open.value="<"+n.open.value,ey===ny)return;if(2!==(ry= __get$(ay,++ey) ).type)for(sy=vy(),n.body=[sy];++ey<ny;){if(2===(ry= __get$(ay,ey) ).type){sy=void 0;break}wy()}return n.close=vy(ry.start,ry.end+1,ry.value+">"),void(n.end=n.close.end)}for(;++ey<ny;){if(2===(ry= __get$(ay,ey) ).type){n.end=n.open.end=ry.end+1,n.open.value=ly.substring(n.open.start,n.open.end),""!==ry.value|| __get$(uy,n.name) ?n.body=void 0:(n.body=[],my(n));break}0===t?4!==ry.type&&(e=yy(),t=1,n.attributes.push(e)):1===t?4===ry.type?t=2:5===ry.type?t=3:wy(e.name):2===t?4!==ry.type&&(5===ry.type?t=3:(e=yy(),t=1,n.attributes.push(e))):3===t?4!==ry.type&&(e.value={start:ry.start,end:ry.end,value:6===ry.type?ry.value:ry.value.substr(1,ry.value.length-2),quote:6===ry.type?void 0:7===ry.type?"'":'"'},6===ry.type?t=4:(e.end=e.value.end,t=0)):4===ry.type?(e.end=e.value.end,t=0):wy(e.value)}}function Sy(){for(var t=iy;t&&ry.value.trim()!==t.tag.name;)t=t.parent;t&&(t.tag.close=vy(ry.start-2,ry.end+1,ly.substring(ry.start-2,ry.end+1)),t.tag.end=t.tag.close.end,t=t.parent,iy=t)}function xy(t,e){for(fy(t,Pv({setAttributeMap:!1},e));ey<ny;){switch((ry= __get$(ay,ey) ).type){case 0:sy?wy(sy):gy(sy=vy());break;case 1:sy=void 0,ky();break;case 3:sy=void 0,Sy();break;default:by()}ey++}var n=oy;return(null==dy?void 0:dy.setAttributeMap)&&function(t,e){for(var n=0;n<t.length;n++)hy( __get$(t,n) ,void 0,n,e)}(n,{enter:function(t){t.type===wv.Tag&&_y(t)}}),fy(),n}var Iy={allowedTags:["a","abbr","address","area","article","aside","b","bdi","bdo","big","blockquote","br","button","caption","cite","code","col","colgroup","data","dd","del","dfn","div","dl","dt","em","figcaption","figure","footer","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","img","ins","kbd","label","li","main","map","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","small","span","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","time","tr","u","ul","var","wbr"],allowedAttrs:["style"],tagAllowedAttrs:{a:["href","target"],img:["src"],td:["rowspan","colspan"],th:["rowspan","colspan"],time:["datetime"],colgroup:["span"],col:["span"]},allowedUrl:/^(?:mailto|tel|https?|ftp|[^:]*[^a-z0-9.+-][^:]*):|^[^:]*$/i};function Ty(t,e){void 0===e&&(e={});var n=Pv(Pv(Pv({},Iy),e),{tagAllowedAttrs:Pv(Pv({},Iy.tagAllowedAttrs),e.tagAllowedAttrs)});return Cy(xy(t),n,t)}function Cy(t,e,n){return t.map((function(t){if(t.type===wv.Text)return t.value;if(-1===e.allowedTags.indexOf(t.name))return"";if( __get$(uy,t.name) ){if(void 0!==t.body)throw new Error('self closed tag "'+t.name+'" should not have body')}else if(!t.body||!t.close)throw new Error('tag "'+t.name+'" should have body and close');var a=t.attributes.filter((function(n){var a;return(e.allowedAttrs.indexOf(n.name.value)>-1||(null===(a= __get$(e.tagAllowedAttrs,t.name) )||void 0===a?void 0:a.indexOf(n.name.value))>-1)&&(!n.value||("src"!==n.name.value&&"href"!==n.name.value||!!e.allowedUrl.test(n.value.value)))})).map((function(t){return n.substring(t.start,t.end)})).join(" "),i="<"+t.rawName+(a?" "+a:"")+">";return t.body?i+Cy(t.body,e,n)+"</"+t.rawName+">":i})).join("")}var Ly={allowedTags:["a","abbr","address","area","article","aside","b","bdi","bdo","big","blockquote","br","button","caption","cite","code","col","colgroup","data","dd","del","dfn","div","dl","dt","em","figcaption","figure","footer","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","img","ins","kbd","label","li","main","map","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","small","span","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","time","tr","u","ul","var","wbr"],allowedAttrs:["class","style"],tagAllowedAttrs:{a:["target"],img:["src"],td:["rowspan","colspan"],th:["rowspan","colspan"],time:["datetime"],colgroup:["span"],col:["span"]},allowedUrl:/^(?:mailto|tel|https?|ftp|[^:]*[^a-z0-9.+-][^:]*):|^[^:]*$/i};function Dy(t,e){return Ty(t,e? __call$(Object,"assign",[{},Ly,e]) :Ly)}function Py(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Ey(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Ay=a.defineComponent({trimWhitespace:"all",initData:function(){return{content:[]}},attached:function(){var t=this,e=this.data.get("content");e&&e.forEach((function(e){var n,a,i=e.value;if(i&&Dy)try{e.value=Dy(i)}catch(o){n=o,(null!=(a=Error)&&"undefined"!=typeof Symbol&& __get$(a,Symbol.hasInstance) ? __call$(a,Symbol.hasInstance,[n]) :n instanceof a)&&(e.value=t.handleSafeHtmlError(o,i))}})),this.handleMathJax(),this.fire("render-finished")},handleSafeHtmlError:function(t,e){if(t.message.indexOf("should have body and close")>-1)return  __call$(e,"replace",[/<\/?[^>]+>/g,""]) },loadJs:function(t){return new Promise((function(e,n){if(document.getElementById("math-jax-script"))e();else{var a=document.getElementsByTagName("script")[0],i=document.createElement("script");i.src=t,i.async=!0,i.id="math-jax-script",a.parentNode.insertBefore(i,a),i.onload=function(){e(i=null)},i.onerror=function(t){i=null,n(t)}}}))},handleMathJax:function(){return(t=function(){var t,e;return Ey(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.loadJs("//yy-s.zuoyebang.cc/static/mathjax_274_for-test/MathJax.js?config=update190725-1")];case 1:return n.sent(),e=this.el,null==(t=window.MathJax)||t.Hub.Queue(["Typeset",window.MathJax.Hub,e]),[3,3];case 2:return n.sent(),[3,3];case 3:return[2]}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Py(o,a,i,r,s,"next",t)}function s(t){Py(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var t}}),Oy={};Oy= __call$(Object,"assign",[Oy,{examQa:"exam-qa_1ip7j_1","exam-qa":"exam-qa_1ip7j_1",examQaItem:"exam-qa-item_1ip7j_15","exam-qa-item":"exam-qa-item_1ip7j_15",examQaItemTitle:"exam-qa-item-title_1ip7j_22","exam-qa-item-title":"exam-qa-item-title_1ip7j_22"}]) ,Ay.template='\n    <div class="{{$style[\'exam-qa\']}}">\n        <div\n            s-for="item in content"\n            class="{{$style[\'exam-qa-item\']}}"\n        >\n            <div class="{{$style[\'exam-qa-item-title\']}}">{{item.title}}</div>\n            \x3c!--bca-disable-next-line--\x3e\n            <div class="{{$style[\'exam-qa-item-value\']}}">{{item.value | raw}}</div>\n        </div>\n    </div>\n';var Ry="function"==typeof Ay?Ay.prototype.initData||Ny:Ay.initData||Ny;function Ny(){return{$style:Oy}}function My(){return  __call$(Object,"assign",[{},Ry.call(this),{$style:Oy}]) }function qy(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function jy(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){qy(o,a,i,r,s,"next",t)}function s(t){qy(o,a,i,r,s,"throw",t)}r(void 0)}))}}function By(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Ay?Ay.prototype.initData=My:Ay.initData=My;var Hy=function(){return!pt()&&di(ci(),"13.76")>=0},$y=jy((function(t){var e,n,a,i,o,r,s,l,c,d,u,p;return By(this,(function(h){switch(h.label){case 0:return e=t.content,n=t.title,a=t.lid,i={method:"POST",cors:!0,withCredentials:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({lid:a+"",data:JSON.stringify({content:e,title:n||" "}),scene:"baidu_edu"})},[4,fetch("https://easylearn.baidu.com/edu-web-go/aichat/cache",i)];case 1:return[4,h.sent().json()];case 2:if(o=h.sent(),s=(r=o||{}).errno,l=r.errmsg,c=r.data,d=(void 0===c?{}:c).cacheKey,u=void 0===d?"":d,0!==s||!u)throw new Error(l||"缓存作文数据失败");return p="https://easylearn.baidu.com/edu-page/composition/editor?cacheKey="+u+"&logid="+a,Hn().conversation.openCompositionEditor.emit({url:p}),[2]}}))})),Fy=function(t){return null==t?void 0: __call$(__call$(t,"replace",[/!\[.*?\]\(.*?\)/g,""]),"replace",[/<img\s+[^>]*>/g,""]) },Uy=a.defineComponent({editor:null,editorTool:{},controlKeys:["Backspace","Delete","Tab","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],components:{"ai-markdown":e.Markdown,"cos-icon":e.Icon},initData:function(){return{title:"",content:"",isEnd:!1,typing:{speed:30},typingFinished:!1,suffix:"",markdownTotalWord:0,totalWord:0,referenceList:[],titleMaxLength:12,type:"text",markdownValue:"",checked:!1}},computed:{titleLen:function(){var t,e;return(null==(e=this.data.get("title"))||null==(t=e.trim())?void 0:t.length)||0}},listenTextChange:null,attached:function(){var e=this,n=this.data.get("typing");!n&&this.data.set("typingFinished",!0),!n&&this.data.set("isEnd",!0),this.fire("typing-finished"),this.data.set("markdownValue",this.data.get("content")),this.data.set("titleValue",this.data.get("title")),new Promise((function(e,n){t(["./qeditor.pc.N-rbs8Tu"],e,n)})).then((function(t){return t.index_umd})).then((function(t){var n=t.Quill,a=t.toDelta,i=t.fromDelta;e.editor=new n(e.ref("edit-container"),{placeholder:"输入一些内容吧～"}),e.editorTool={toDelta:a,fromDelta:i},e.listenTextChange=function(t,n,a){var i,o=(null==(i=e.editor)?void 0:i.getLength())-1;e.data.set("totalWord",o+e.data.get("titleValue").length)},e.editor.on("text-change",e.listenTextChange)})),this.editorTouchHandle=this.touchStartHandler.bind(this),window.addEventListener("click",this.editorTouchHandle,!0),this.watch("titleValue",(function(t){var n;(void 0===t&&(t=""),"editor"===e.data.get("type"))&&e.data.set("totalWord",t.length+(null==(n=e.editor)?void 0:n.getLength())-1)})),this.nextTick((function(){e.updateTotalWord()}))},disposed:function(){window.removeEventListener("click",this.editorTouchHandle,!0),this.listenTextChange&&(this.editor.off("text-change",this.listenTextChange),this.listenTextChange=null)},typingFinishedHandle:function(){this.updateTotalWord(),this.data.set("typingFinished",!0),this.fire("typing-finished")},updateTotalWord:function(){var t,e=this.data.get("title")||"",n=this.ref("markdown").el,a=Mp((null==n||null==(t=n.querySelector(".cosd-markdown-content"))?void 0:t.textContent)||"",e);this.data.set("totalWord",a),this.data.set("markdownTotalWord",a)},appendContent:function(t,e){void 0===t&&(t="");var n=e.isEnd,a=void 0!==n&&n;this.data.set("isEnd",a);var i=this.ref("markdown");(null==i?void 0:i.appendContent)&&i.appendContent(t),this.data.set("typingFinished",!1);var o=this.data.get("markdownValue");this.data.set("markdownValue",o+t)},stop:function(){var t=this.ref("markdown");(null==t?void 0:t.stop)&&t.stop()},textToEditor:function(){var t,e,n=null==(t=this.editorTool)?void 0:t.toDelta(this.data.get("markdownValue"));null==(e=this.editor)||e.setContents(n),this.data.set("titleValue",this.data.get("title"))},handleTitleKeyDown:function(t){if(null==t?void 0:t.key){var n=this.data.get("titleMaxLength");!this.controlKeys.includes(t.key)&&this.data.get("titleValue").length>=n&&e.Toast.show({message:"标题最多输入"+n+"字哦～"})}},handleCancleEdit:function(t,e){var n;void 0===e&&(e=!1),e||this.fire("action-log-event",{component:"writing",actionType:"b",ext:{target:null==t?void 0:t.target}});var a=null==(n=localStorage)?void 0:n.getItem("writingEditQuitNoTips");if(e||"1"===a)return this.data.set("type","text"),this.data.set("totalWord",this.data.get("markdownTotalWord")),void this.dispatch("writing:cancel-edit");this.dispatch("writing:cancel-edit",{showDialog:!0})},handleCopy:function(t){var e;if(this.data.get("totalWord")){var n=this.data.get("titleValue"),a=(n?n+"\n":"")+(null==(e=this.editor)?void 0:e.getText());this.dispatch("writing:copy",{text:a}),this.fire("action-log-event",{component:"writing",actionType:"b",ext:{target:null==t?void 0:t.target}})}},touchStartHandler:function(t){var e,n=null==t||null==(e=t.target)?void 0:e.closest('[data-module^="edit"]'),a=null==n?void 0:n.getAttribute("data-cid"),i=this.data.get("type"),o=this.data.get("cid");if("editor"===i&&a&&a!==o)this.handleCancleEdit(t,!0);else{if("text"!==i||!a||!o||a!==o)return;var r,s;if(Hy())return void $y({title:this.data.get("title"),content:this.data.get("markdownValue"),lid:o});this.textToEditor(),this.data.set("type","editor");var l=(null==(r=this.editor)?void 0:r.getLength())||0;null==(s=this.editor)||s.setSelection(l,0),this.scrollToView(t)}},scrollToView:function(t){var e,n=this,a=null==t||null==(e=t.target)?void 0:e.closest(".cos-swiper-content");if(a){var i=a.style.overflow;a.style.overflow="visible",setTimeout((function(){var t=n.ref("editorBtn");null==t||t.scrollIntoView({behavior:"smooth",block:"start"}),a.style.overflow=i}),300)}},changeEditStatus:function(t){var e=t||{},n=e.cid,a=e.status;n===this.data.get("cid")&&"ok"===a&&(this.data.set("totalWord",this.data.get("markdownTotalWord")),this.data.set("type","text"))}}),Gy={};Gy= __call$(Object,"assign",[Gy,{writing:"writing_7ewg7_1",writingTitle:"writing-title_7ewg7_4","writing-title":"writing-title_7ewg7_4",writingContentEditorOcupy:"writing-content-editor-ocupy_7ewg7_8","writing-content-editor-ocupy":"writing-content-editor-ocupy_7ewg7_8",writingContentEditor:"writing-content-editor_7ewg7_8","writing-content-editor":"writing-content-editor_7ewg7_8",writingContentHide:"writing-content-hide_7ewg7_94","writing-content-hide":"writing-content-hide_7ewg7_94",writingTotalWord:"writing-total-word_7ewg7_98","writing-total-word":"writing-total-word_7ewg7_98",writingButtons:"writing-buttons_7ewg7_101","writing-buttons":"writing-buttons_7ewg7_101",buttonsHudong:"buttons-hudong_7ewg7_108","buttons-hudong":"buttons-hudong_7ewg7_108",buttonIconClose:"button-icon-close_7ewg7_117","button-icon-close":"button-icon-close_7ewg7_117",buttonIcon:"button-icon_7ewg7_117","button-icon":"button-icon_7ewg7_117",buttonDisabled:"button-disabled_7ewg7_124","button-disabled":"button-disabled_7ewg7_124"}]) ,Uy.template='\n    <div id="writing-markdown" class="{{$style[\'writing\']}}">\n        \x3c!-- 标题 --\x3e\n        <div\n            s-if="title && titleLen && type === \'text\'"\n            class="\n                {{$style[\'writing-title\']}}\n                cos-space-mb-md\n                cos-line-clamp-1\n                cos-color-text\n                cos-text-headline-sm\n            "\n        >{{title}}</div>\n        \x3c!-- 正文 --\x3e\n        <div s-ref="textDom">\n            <ai-markdown\n                s-show="{{type === \'text\'}}"\n                s-ref="markdown"\n                class="{{$style[\'writing-content\']}} cos-space-mb-md"\n                content="{{content}}"\n                type="yiyan"\n                normalizeContent="{{normalizeContent}}"\n                on-typing-finished="typingFinishedHandle"\n                typing="{{typing}}"\n            />\n        </div>\n        <div\n            class="{{type === \'text\' ? $style[\'writing-content-hide\'] : \'\'}}"\n        >\n            <input\n                s-ref="titleInput"\n                value="{=titleValue=}"\n                placeholder="标题（选填）"\n                maxlength="{{titleMaxLength}}"\n                on-keydown="handleTitleKeyDown"\n                class="\n                    {{$style[\'writing-title\']}}\n                    cos-space-mb-md\n                    cos-line-clamp-1\n                    cos-color-text\n                    cos-text-headline-sm\n                "\n            />\n            <div style="position: relative;">\n                <div class="{{$style[\'writing-content-editor-ocupy\']}}"></div>\n                <div\n                    class="{{$style[\'writing-content-editor\']}}"\n                    s-ref="edit-container"\n                >\n                </div>\n                \n            </div>\n        </div>\n        \x3c!-- 字数展示 --\x3e\n        <div\n            s-if="typingFinished && isEnd"\n            class="\n                {{$style[\'writing-total-word\']}}\n                cos-text-body-lg\n                cos-color-text-minor\n                cos-space-mt-xs\n            "\n            disable-copy\n            disable-audio\n        >共{{totalWord}}字</div>\n        <div\n            s-show="{{type === \'editor\'}}"\n            s-ref="editorBtn"\n            class="{{$style[\'writing-buttons\']}}"\n            disable-audio\n        >\n            <div class="{{$style[\'buttons-hudong\']}}" on-click="handleCancleEdit($event, false)" data-module="edit_cancel">\n                <cos-icon name="close" class="{{$style[\'button-icon-close\']}}"></cos-icon>\n                <span class="{{$style.text}} cos-font-medium cos-space-ml-3xs">取消编辑</span>\n            </div>\n            <div\n                class="{{$style[\'buttons-hudong\']}} {{!totalWord ? $style[\'button-disabled\'] : \'\'}}"\n                data-module="copy_edit"\n                on-click="handleCopy"\n            >\n                <cos-icon name="copy" class="{{$style[\'button-icon\']}}"/>\n                <span class="{{$style.text}} cos-font-medium cos-space-ml-xxs">复制</span>\n            </div>\n        </div>\n    </div>\n';var Wy="function"==typeof Uy?Uy.prototype.initData||zy:Uy.initData||zy;function zy(){return{$style:Gy}}function Qy(){return  __call$(Object,"assign",[{},Wy.call(this),{$style:Gy}]) }"function"==typeof Uy?Uy.prototype.initData=Qy:Uy.initData=Qy;var Jy=a.defineComponent({components:{"ai-markdown":e.Markdown},initData:function(){return{title:"",content:"",isEnd:!1,isPc:!1,typing:{speed:30,cursor:!0,mode:"all"},typingFinished:!1,markdownTotalWord:0,markdownValue:"",waitingValue:""}},attached:function(){this.fire("load-ready"),this.data.set("loadReady",!0),!this.data.get("typing")&&this.data.set("typingFinished",!0),this.fire("typing-finished"),this.data.set("markdownValue",this.data.get("content")),this.data.set("titleValue",this.data.get("title"))},typingFinishedHandle:function(){this.updateTotalWord(),this.data.set("typingFinished",!0),this.fire("typing-finished")},handleMarkdownClick:function(t){this.fire("click",t)},handleMarkdownToggle:function(t){this.fire("toggle",t)},updateTotalWord:function(){var t,e=this.data.get("title")||"",n=this.ref("markdown").el,a=(null==n||null==(t=n.querySelector(".markdownsdk-wrapper-box"))?void 0:t.textContent)||"",i= __call$(e,"replace",[/[\r\n\t]+/g,""]) .trim(),o= __call$(a,"replace",[/[\r\n\t]+/g,""]) .trim(),r=/[\u4e00-\u9fa5]/.test(o)? __call$(o,"replace",[/\s+/g,""]) .length+ __call$(i,"replace",[/\s+/g,""]) .length:o.split(/\s+/).length+i.split(/\s+/).length;this.data.set("totalWord",r),this.data.set("markdownTotalWord",r)},appendContent:function(t,e){void 0===t&&(t="");var n=e.isEnd,a=void 0!==n&&n;this.data.set("isEnd",a);var i=this.ref("markdown");if(this.data.get("loadReady")){var o=this.data.get("waitingValue"),r="";o?(r=o+t,this.data.set("waitingValue","")):r=t,(null==i?void 0:i.appendContent)&&i.appendContent(r),this.data.set("typingFinished",!1);var s=this.data.get("markdownValue");this.data.set("markdownValue",s+r)}else{var l=this.data.get("waitingValue");this.data.set("waitingValue",l+t)}},stop:function(){var t=this.ref("markdown");(null==t?void 0:t.stop)&&t.stop()},handleCopy:function(t){var e;if(this.data.get("totalWord")){var n=this.data.get("titleValue"),a=(n?n+"\n":"")+(null==(e=this.editor)?void 0:e.getText());this.dispatch("writing:copy",{text:a}),this.fire("action-log-event",{component:"writing",actionType:"b",ext:{target:null==t?void 0:t.target}})}}}),Vy={};Vy= __call$(Object,"assign",[Vy,{officeWritingTitle:"office-writing-title_16x6v_1","office-writing-title":"office-writing-title_16x6v_1",officeWritingContent:"office-writing-content_16x6v_6","office-writing-content":"office-writing-content_16x6v_6"}]) ,Jy.template='\n    <div class="{{$style[\'office-writing\']}}">\n        \x3c!-- 标题 --\x3e\n        <div\n            s-if="title"\n            class="\n                {{$style[\'office-writing-title\']}}\n                cos-space-mb-md\n                cos-line-clamp-1\n                cos-color-text\n                cos-text-headline-sm\n            "\n        >{{title}}</div>\n        \x3c!-- 正文 --\x3e\n        <div>\n            <ai-markdown\n                s-ref="markdown"\n                class="{{$style[\'office-writing-content\']}} cos-space-mb-md"\n                styles="{{$aiMarkdown}}"\n                content="{{content}}"\n                typing="{{typing}}"\n                on-typing-finished="typingFinishedHandle"\n                on-click="handleMarkdownClick"\n                on-toggle="handleMarkdownToggle($event)"\n                normalizeContent="{{normalizeContent}}"\n            />\n        </div>\n    </div>\n';var Ky="function"==typeof Jy?Jy.prototype.initData||Xy:Jy.initData||Xy;function Xy(){return{$style:Vy}}function Yy(){return  __call$(Object,"assign",[{},Ky.call(this),{$style:Vy}]) }function Zy(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function tw(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Zy(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zy(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ew(t,e,n){void 0===e&&(e=kg.AUDIO),void 0===n&&(n=!1),n||e!==kg.AUDIO||(null==c?void 0:c.currentVideoInstance)&&c.currentVideoInstance.pause();var a=[],i=t;n?(a=document.querySelectorAll("audio, video"),i=e===kg.AUDIO?t:null==t?void 0:t.querySelector("video")):a=document.querySelectorAll("audio");for(var o,r=tw(a);!(o=r()).done;){var s=o.value;s!==i&&(null==s||s.pause())}}function nw(){for(var t=Array.from(arguments).length,e=new Array(t),n=0;n<t;n++) __set$(e,n,__get$(Array.from(arguments),n)) }function aw(t){var e= __call$(t,"replace",["http://","https://"]) ,n=on.getState("urlInfo").picEditBaseUrl||"",a=new URL(n),i=new URL(decodeURIComponent(a.searchParams.get("url")));i.searchParams.set("objUrl",e),i.searchParams.set("thumbUrl",e),a.searchParams.set("url",i.toString()),Pp(a.toString())}function iw(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function ow(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){iw(o,a,i,r,s,"next",t)}function s(t){iw(o,a,i,r,s,"throw",t)}r(void 0)}))}}function rw(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function sw(){return sw=ow((function(t){var e,n,a;return rw(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,fetch(t,{method:"get",mode:"cors",credentials:"include",headers:{"Cache-Control":"no-cache"}})];case 1:return[4,i.sent().blob()];case 2:return e=i.sent(),a= new ClipboardItem((__set$(n={},e.type,e),n)) ,[4,navigator.clipboard.write([a])];case 3:return i.sent(),Qn().emit({text:"复制成功",type:"success"}),[3,5];case 4:return i.sent(),Qn().emit({text:"复制失败，请稍后重试",type:"info"}),[3,5];case 5:return[2]}}))})),sw.apply(this,Array.from(arguments))}function lw(){return lw=ow((function(t){var e,n,a;return rw(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,fetch(t,{method:"get",mode:"cors",credentials:"include",headers:{"Cache-Control":"no-cache"}})];case 1:return[4,i.sent().blob()];case 2:return e=i.sent(),n=URL.createObjectURL(e), __set$(a=document.createElement("a"),"href",n) ,a.download="downloaded-image.jpg",document.body.appendChild(a),a.click(),URL.revokeObjectURL(n),document.body.removeChild(a),[3,4];case 3:return i.sent(),Qn().emit({text:"下载失败，请稍后重试",type:"info"}),[3,4];case 4:return[2]}}))})),lw.apply(this,Array.from(arguments))}function cw(t,e,n){var a=null==t?void 0:t.querySelectorAll(".cosd-markdown .marklang .marklang-img"),i="";null==n||n.forEach((function(t){var e,n=null==t?void 0:t.data;"text"===((null==t?void 0:t.type)||"").toLowerCase()&&(i+=(null==n||null==(e=n.question)?void 0:e.question)||"")})),null==a||a.forEach((function(t){if(!t.parentNode.classList.contains("image-container")){var n=document.createElement("div");n.className="image-container",t.parentNode.insertBefore(n,t),n.appendChild(t),t.onload=function(){var a,o=document.createElement("button");o.className="copy";var r=JSON.stringify({value:"create_pic",button:"copy",query:i});o.setAttribute("data-show-ext",r),o.setAttribute("data-show-area",""),o.setAttribute("disable-copy",""),o.innerHTML='\n                <img src="https://gips1.baidu.com/it/u=2375320919,4209118494&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f42_42" alt="复制图标">\n                <span class="copy-text">复制</span>\n            ';var s=null==(a=t.src)?void 0: __call$(a,"replace",["http://","https://"]) ;o.onclick=function(){e("copy"),function(t){sw.apply(this,Array.from(arguments))}(s)},n.appendChild(o);var l=document.createElement("button");l.className="download";var c=JSON.stringify({value:"create_pic",button:"download",query:i});l.setAttribute("data-show-ext",c),l.setAttribute("data-show-area",""),l.innerHTML='\n                <img src="https://gips1.baidu.com/it/u=2542160073,1007292717&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f42_42" alt="下载图标">\n                ',l.onclick=function(){e("download"),function(t){lw.apply(this,Array.from(arguments))}(s)},n.appendChild(l)}}}))}function dw(t,e,n){var a=null==t?void 0:t.querySelectorAll(".cosd-markdown .marklang .marklang-img");null==a||a.forEach((function(t){if(a=t.parentNode,i="wise-generate-image",!wn(a).some((function(t){return t.classList.contains(i)}))){var a,i,o=document.createElement("div");o.className="wise-generate-image",t.parentNode.insertBefore(o,t),o.appendChild(t),ft()&&on.getState("urlInfo").picEditBaseUrl&&(t.onload=function(){var a,i=document.createElement("button");i.className="ai-edit-wrapper";var r=JSON.stringify({value:"answer_pic_retouch"});kn(i,"data-show-area",""),kn(i,"data-show-ext",r),kn(i,"disable-copy","");var s=window.matchMedia("(prefers-color-scheme: dark)").matches?"https://gips3.baidu.com/it/u=3439183576,425751119&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f54_55":"https://gips0.baidu.com/it/u=401145764,136222818&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f54_54";i.innerHTML='\n                <img\n                    class="ai-edit-icon"\n                    src="'+s+'"\n                    alt="修图图标"\n                />\n                <span class="ai-edit-text">\n                    修图\n                </span>\n            ';var l=null==(a=t.src)?void 0: __call$(a,"replace",["http://","https://"]) ;i.onclick=function(){Ua({type:"click",value:"answer_pic_retouch",ext:{ori_lid:on.getState("oriLid"),lid:n,re_rank:String(e)}}),aw(l)},o.appendChild(i)})}}))}"function"==typeof Jy?Jy.prototype.initData=Yy:Jy.initData=Yy;var uw=a.defineComponent({components:{"cos-icon":e.Icon},computed:{showValue:function(){var t=this.data.get("isReadOnly"),e=this.data.get("defaultValue"),n=this.data.get("placeholder"),a=this.data.get("selectedValue");return t?a||e:a||n}},attached:function(){var t=this;this.watch("hasData",(function(e){e||(t.data.get("placeholder"),t.data.set("selectedValue",""))}))},initData:function(){return{key:"",selectedValue:"",label:"",placeholder:"",hasData:!0,isLast:!1,isReadOnly:!1,defaultValue:"未知"}},handleClick:function(){var t=this.data.get("isReadOnly"),e=this.data.get("key");t||(this.fire("send-click-log",{type:"click",value:"chatForm_cpt_"+e}),this.fire("click"))}}),pw={};pw= __call$(Object,"assign",[pw,{selectPanel:"select-panel_5by9a_1","select-panel":"select-panel_5by9a_1",labelText:"label-text_5by9a_18","label-text":"label-text_5by9a_18",selectArea:"select-area_5by9a_25","select-area":"select-area_5by9a_25",selectValue:"select-value_5by9a_31","select-value":"select-value_5by9a_31",readOnly:"read-only_5by9a_46","read-only":"read-only_5by9a_46",lastPanel:"last-panel_5by9a_64","last-panel":"last-panel_5by9a_64"}]) ,uw.template="\n    <div\n        class=\"\n            {{$style['select-panel']}}\n            {{isReadOnly ? $style['read-only'] : ''}}\n            {{isLast ? $style['last-panel'] : ''}}\n        \"\n        on-click=\"handleClick\"\n    >\n        <div class=\"{{$style['label-text']}}\">{{label}}</div>\n        <div class=\"{{$style['select-area']}}\">\n            <div class=\"{{$style['select-value']}}\">{{showValue}}</div>\n            <cos-icon s-if=\"{{!isReadOnly}}\" name=\"down\"/>\n        </div>\n    </div>\n";var hw="function"==typeof uw?uw.prototype.initData||fw:uw.initData||fw;function fw(){return{$style:pw}}function gw(){return  __call$(Object,"assign",[{},hw.call(this),{$style:pw}]) }"function"==typeof uw?uw.prototype.initData=gw:uw.initData=gw;var mw=a.defineComponent({components:{"cos-date-time-picker":e.index,"select-panel":uw},computed:{timeValue:function(){var t=this.data.get("value"),e=this.data.get("defaultValue");return t?new Date(t):new Date(e)}},initData:function(){return{key:"",value:"",label:"",format:"YYYY-MM-DD-HH-mm",placeholder:"请选择日期时间",formattedDate:"",hasData:!0,isReadOnly:!1,isLast:!1,logParams:{},popupContainer:function(){return document.body},defaultValue:"Mon Jan 01 1990 00:00:00 GMT+0800 (中国标准时间)"}},attached:function(){var t=this,e=this.data.get("value");this.formatTimeValue(e),this.watch("hasData",(function(e){e||t.data.set("formattedDate","")}))},handleChange:function(){var t=this.data.get("key");this.fire("send-log",{type:"click",value:"chatForm_cpt_scroll",ext:{layerName:t}})},handleConfirm:function(t){var e,n,a=this.data.get("key");this.fire("send-log",{type:"click",value:"chatForm_cpt_confirm",ext:{layerName:a,isLunar:"0"}}),this.formatTimeValue(null==t||null==(e=t.value)?void 0:e.toString()),this.fire("update-form",{key:a,value:null==t||null==(n=t.value)?void 0:n.toString()})},handleOpen:function(){e.Toast.show({message:"若出生时间不详可选择0时0分",duration:1e3})},handleClose:function(){e.Toast.hide()},formatTimeValue:function(t){if("string"==typeof t){var e=new Date(t);if(isNaN(e.getTime()))this.data.set("formattedDate","");else{var n=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),o=e.getHours(),r=e.getMinutes(),s=n+"年"+a+"月"+i+"日";t.includes(":")&&(s+=o+"时"),t.includes(":")&&t.split(":").length>1&&(s+=r+"分"),this.data.set("formattedDate",s)}}else this.data.set("formattedDate","")},handleSendClickLog:function(t){this.fire("send-log",t)}}),vw={};vw= __call$(Object,"assign",[vw,{timePanel:"time-panel_h1bm3_1","time-panel":"time-panel_h1bm3_1"}]) ,mw.template='\n    <div>\n        <cos-date-time-picker\n            s-if="{{!isReadOnly}}"\n            format="{{format}}"\n            value="{{timeValue}}"\n            title="{{label}}"\n            class="{{$style[\'form-time-picker\']}}"\n            getPopupContainer="{{popupContainer}}"\n            drawerClass="form-drawer"\n            on-change="handleChange"\n            on-confirm="handleConfirm"\n            on-open="handleOpen"\n            on-close="handleClose"\n        >\n            <select-panel\n                slot="entry"\n                label="{{label}}"\n                selected-value="{{formattedDate || placeholder}}"\n                has-data="{{hasData}}"\n                key="{{key}}"\n                placeholder="{{placeholder}}"\n                on-send-click-log="handleSendClickLog"\n            />\n        </cos-date-time-picker>\n        <select-panel\n            s-else\n            label="{{label}}"\n            selected-value="{{formattedDate}}"\n            has-data="{{hasData}}"\n            is-read-only="{{isReadOnly}}"\n            is-last="{{isLast}}"\n            placeholder="{{placeholder}}"\n        />\n    </div>\n';var yw="function"==typeof mw?mw.prototype.initData||ww:mw.initData||ww;function ww(){return{$style:vw}}function bw(){return  __call$(Object,"assign",[{},yw.call(this),{$style:vw}]) }function _w(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function kw(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){_w(o,a,i,r,s,"next",t)}function s(t){_w(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Sw(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof mw?mw.prototype.initData=bw:mw.initData=bw;var xw=a.defineComponent({components:{"cos-city-selector":e.CitySelector,"select-panel":uw},computed:{formattedLocation:function(){var t=this.data.get("selectedCities");if(t.length<=0)return"";var e=t[0],n=e.country,a=void 0===n?"":n,i=e.province,o=void 0===i?"":i,r=e.city,s=void 0===r?"":r,l=e.county,c=void 0===l?"":l;if(a){var d=[];return s&&d.push(s),o&&d.push(o),a&&d.push(a),d.join(" ")}var u=[];return o&&u.push(o),s&&u.push(s),c&&u.push(c),u.join(" ")}},initData:function(){return{key:"",open:!1,selectedCities:[],nativeCities:[],foreignCities:[],placeholder:"",label:"",location:{city:"广州",code:440100,level:"1"},hasData:!0,isReadOnly:!1,isLast:!1,citiesDataUrl:"",popupContainer:function(){return document.body}}},attached:function(){this.getCityList()},handleClick:function(){this.data.get("isReadOnly")||this.data.set("open",!0)},handleRelocate:function(){var t=this.data.get("key");this.fire("send-log",{type:"click",value:"chatForm_cpt_location",ext:{layerName:t}})},handleChange:function(t){var e=this.data.get("key"),n=this.processObject(t.city),a=this.data.get("formattedLocation");this.data.set("open",!1),this.fire("update-form",{key:e,value:n});var i={layerName:e};"birthPlace"===e&&(i.birthPlace=a),"livingPlace"===e&&(i.livingPlace=a),this.fire("send-log",{type:"click",value:"chatForm_cpt_confirm",ext:i})},handleClose:function(){this.data.set("open",!1)},fetchCityList:function(t){return fetch(t,{method:"get"}).then(kw((function(t){return Sw(this,(function(e){switch(e.label){case 0:return[4,t.json()];case 1:return[2,[e.sent(),null]]}}))}))).catch((function(t){return[null,t]}))},getCityList:function(){var t=this,e=this.data.get("citiesDataUrl");this.fetchCityList(e).then((function(e){var n=e[0];t.data.set("nativeCities",n.cityList.list||[]),t.data.set("foreignCities",n.foreignCityList.list||[])}))},processObject:function(t){var e={};return Object.keys(t).forEach((function(n){n.startsWith("_")||( __set$(e,n,__get$(t,n)) )})),[e]},handleSendClickLog:function(t){this.fire("send-log",t)}}),Iw={};Iw= __call$(Object,"assign",[Iw,{}]) ,xw.template='\n    <div>\n        <select-panel\n            placeholder="{{placeholder}}"\n            label="{{label}}"\n            selected-value="{{formattedLocation}}"\n            has-data="{{hasData}}"\n            key="{{key}}"\n            is-read-only="{{isReadOnly}}"\n            is-last="{{isLast}}"\n            on-click="handleClick"\n            on-send-click-log="handleSendClickLog"\n        />\n        <cos-city-selector\n            open="{=open=}"\n            nativeCities="{{nativeCities}}"\n            foreignCities="{{foreignCities}}"\n            selectedCities="{=selectedCities=}"\n            location="{{true}}"\n            title="{{label}}"\n            class="form-city-picker"\n            on-change="handleChange"\n            on-close="handleClose"\n            on-relocate="handleRelocate"\n            getPopupContainer="{{popupContainer}}"\n        />\n    </div>\n';var Tw="function"==typeof xw?xw.prototype.initData||Cw:xw.initData||Cw;function Cw(){return{$style:Iw}}function Lw(){return  __call$(Object,"assign",[{},Tw.call(this),{$style:Iw}]) }"function"==typeof xw?xw.prototype.initData=Lw:xw.initData=Lw;var Dw=a.defineComponent({components:{"cos-radio":e.Radio,"cos-radio-group":e.RadioGroup,"select-panel":uw},computed:{checkedValue:function(){var t;return null==(t=this.data.get("options").find((function(t){return t.checked})))?void 0:t.value}},initData:function(){return{key:"",label:"",options:[],checkedValue:"",hasData:!0,isReadOnly:!1,isLast:!1}},attached:function(){var t=this;this.watch("hasData",(function(e){if(!e){var n=t.data.get("options");t.data.set("checkedValue",""),n.forEach((function(t){t.checked=!1})),t.data.set("options",n)}}))},changeValue:function(t){var e=this.data.get("key");this.handleUbcLog(t),this.data.set("checkedValue",t.value),this.fire("update-form",{key:e,value:t.value})},handleUbcLog:function(t){var e="女生"===t.value?"female":"male";this.fire("send-log",{type:"click",value:"chatForm_cpt_gender_"+e})}}),Pw={};Pw= __call$(Object,"assign",[Pw,{radioGroup:"radio-group_zmn4r_1","radio-group":"radio-group_zmn4r_1",radioItem:"radio-item_zmn4r_21","radio-item":"radio-item_zmn4r_21",radioImg:"radio-img_zmn4r_25","radio-img":"radio-img_zmn4r_25"}]) ,Dw.template='\n    <div class="{{$style[\'radio-group\']}}">\n        <cos-radio-group\n            s-if="{{!isReadOnly}}"\n            on-change="changeValue" \n            value="{{checkedValue}}" \n            disabled="{=disabled=}"\n        >\n            <cos-radio \n                s-for="item, index in options"\n                value="{{item.value}}" \n                appearance="tag"\n                checked="{{item.value === checkedValue}}"\n            >\n                <div class="{{$style[\'radio-item\']}}">\n                    <img src="{{item.icon}}" class="{{$style[\'radio-img\']}}"></img>\n                    <div class="{{$style[\'radio-text\']}}">{{item.value}}</div>\n                </div>\n            </cos-radio>\n        </cos-radio-group>\n        <select-panel\n            s-else\n            label="{{label}}"\n            selected-value="{{checkedValue}}"\n            is-read-only="{{isReadOnly}}"\n            is-last="{{isLast}}"\n        >\n        </select-panel>\n    </div>\n';var Ew="function"==typeof Dw?Dw.prototype.initData||Aw:Dw.initData||Aw;function Aw(){return{$style:Pw}}function Ow(){return  __call$(Object,"assign",[{},Ew.call(this),{$style:Pw}]) }function Rw(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Nw(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Rw(o,a,i,r,s,"next",t)}function s(t){Rw(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Mw(){return Mw=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Mw.apply(this,Array.from(arguments))}function qw(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Dw?Dw.prototype.initData=Ow:Dw.initData=Ow;var jw=a.defineComponent({components:{"date-time-picker":mw,"city-picker":xw,"radio-group":Dw,"cos-button":e.Button,"cos-checkbox":e.Checkbox},initData:function(){return{formId:"",formConfig:{title:"",subtitle:"",theme:{},fields:[],actions:[],agreement:{text:""}},isReadOnly:!1,userData:{remeber:!1,gender:"",birthDate:"",birthPlace:[],livingPlace:[]},hasData:!1,isTransitioning:!1,fadeIn:!1,fadeOut:!1,logExt:{},updateApi:"",isHistory:!1,remembered:!1}},attached:function(){var t=this;this.data.get("isHistory")?this.data.set("isReadOnly",!0):(this.extractUserData(),this.renderFinished(),this.listenNewConversation=function(){t.handleNewConversation()},Jn().on(this.listenNewConversation),Xn().on(this.listenNewConversation),Yn().on(this.listenNewConversation),ea().on(this.listenNewConversation))},disposed:function(){this.listenNewConversation&&(Jn().off(this.listenNewConversation),Xn().off(this.listenNewConversation),Yn().off(this.listenNewConversation),ea().off(this.listenNewConversation),this.listenNewConversation=null)},computed:{bgImage:function(){var t,e,n,a,i=this.data.get("formConfig");return Mi()?null==i||null==(e=i.theme)||null==(t=e.background)?void 0:t.dark:null==i||null==(a=i.theme)||null==(n=a.background)?void 0:n.light},commonLogParams:function(){var t=this.data.get("logExt");return Mw({ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),setype:"csaitab"},t)},ubcShowLog:function(){var t=this.data.get("commonLogParams");return JSON.stringify(Mw({value:"chatForm_cpt"},t))},clearShowLog:function(){var t=this.data.get("commonLogParams");return JSON.stringify(Mw({value:"chatForm_cpt_clear"},t))}},handleNewConversation:function(){return Nw((function(){return qw(this,(function(t){switch(t.label){case 0:return[4,this.switchToReadOnly()];case 1:return t.sent(),[2]}}))})).apply(this)},handleAction:function(t){var e=t.key,n=t.query,a=t.extData,i=this.data.get("userData").remember;this.handleUbcLog({type:"click",value:"chatForm_cpt_"+e,ext:{infoRemind:i?"1":"0"}}),"clear"===e?this.clearForm():this.submitForm(n,a)},clearForm:function(){return Nw((function(){var t;return qw(this,(function(e){return this.data.get("hasData")?(t={remeber:this.data.get("userData").remember,gender:"",birthDate:"",birthPlace:[],livingPlace:[]},this.data.set("userData",t),this.data.set("hasData",!1),this.postUpdateForm(t),[2]):[2]}))})).apply(this)},submitForm:function(t,e){return Nw((function(){var n;return qw(this,(function(a){return n={},e&&(n.csextdata=e),Xl({query:t,extParams:n}),[2]}))}))()},handleRememberMe:function(){return Nw((function(){var t;return qw(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,gs()];case 1:return e.sent(),[3,3];case 2:return e.sent(),[2];case 3:return t=this.data.get("remembered"),this.data.set("remembered",!t),this.handleUbcLog({type:"click",value:"chatForm_cpt_remind"+(t?"":"_cancel"),ext:{}}),this.handleUpdateForm({key:"remember",value:!t}),[2]}}))})).apply(this)},handleUpdateForm:function(t){return Nw((function(){var e,n;return qw(this,(function(a){return e=t.key,n=t.value,this.updateUserData(e,n),[2]}))})).apply(this)},extractUserData:function(){return Nw((function(){var t,e,n,a;return qw(this,(function(i){return t=this,e=this.data.get("formConfig"),n=e.fields,a={},n.forEach((function(t){var e=t.key,n=t.value,i=t.selectedCities;if("gender"===e){var o=t.options.find((function(t){return t.checked}));a.gender=o?o.value:""}else"birthDate"===e?a.birthDate=n||"": __set$(a,e,"birthPlace"===e||"livingPlace"===e?i||[]:n||"") })),a.remember=e.agreement.checked,this.data.set("remembered",e.agreement.checked),e.actions.forEach((function(e){"clear"===e.key&&(e.disabled||t.data.set("hasData",!0))})),this.data.set("userData",a),a.remember||this.postUpdateForm(a),[2]}))})).apply(this)},updateUserData:function(t,e){"remember"!==t&&this.data.set("hasData",!0);var n=this.data.get("userData"); __set$(n,t,e) ,this.data.set("userData",n),this.postUpdateForm(n)},postUpdateForm:function(t){var e=this,n=this.data.get("updateApi"),a=this.data.get("formId")||"",i=n+"?product=numerology";return t.sessionId=on.getState("oriLid"),t.msgId=on.getState("lid"),t.id=a||"",new Promise((function(n,a){fetch(i,{method:"post",mode:"cors",credentials:"include",body:JSON.stringify(t)}).then((function(t){return t.json()})).then((function(t){0===t.status&&e.data.set("formId",t.data.id),n(t)})).catch((function(t){a(t)}))}))},switchToReadOnly:function(){return Nw((function(){return qw(this,(function(t){switch(t.label){case 0:return this.data.get("isTransitioning")?[2]:(this.data.set("isTransitioning",!0),this.data.set("fadeOut",!0),[4,new Promise((function(t){return setTimeout(t,80)}))]);case 1:return t.sent(),this.data.set("isReadOnly",!0),this.data.set("fadeIn",!0),[4,new Promise((function(t){return setTimeout(t,240)}))];case 2:return t.sent(),this.data.set("fadeOut",!1),this.data.set("fadeIn",!1),this.data.set("isTransitioning",!1),[2]}}))})).apply(this)},renderFinished:function(){this.fire("render-finished")},handleUbcLog:function(t){var e=this.data.get("commonLogParams"),n=t.type;Ua({type:void 0===n?"show":n,value:t.value,ext:Mw({},e,t.ext)})}}),Bw={};Bw= __call$(Object,"assign",[Bw,{profileForm:"profile-form_1oe68_1","profile-form":"profile-form_1oe68_1",historyForm:"history-form_1oe68_9","history-form":"history-form_1oe68_9",formTitle:"form-title_1oe68_12","form-title":"form-title_1oe68_12",mainTitle:"main-title_1oe68_19","main-title":"main-title_1oe68_19",subTitle:"sub-title_1oe68_27","sub-title":"sub-title_1oe68_27",formContent:"form-content_1oe68_36","form-content":"form-content_1oe68_36",formContentItem:"form-content-item_1oe68_40","form-content-item":"form-content-item_1oe68_40",formAction:"form-action_1oe68_43","form-action":"form-action_1oe68_43",formActionBtn:"form-action-btn_1oe68_53","form-action-btn":"form-action-btn_1oe68_53",clear:"clear_1oe68_64",submit:"submit_1oe68_68",formRemeber:"form-remeber_1oe68_71","form-remeber":"form-remeber_1oe68_71",checkboxIcon:"checkbox-icon_1oe68_80","checkbox-icon":"checkbox-icon_1oe68_80",checkboxIconInner:"checkbox-icon-inner_1oe68_92","checkbox-icon-inner":"checkbox-icon-inner_1oe68_92",checkboxLabel:"checkbox-label_1oe68_100","checkbox-label":"checkbox-label_1oe68_100",rememberChecked:"remember-checked_1oe68_110","remember-checked":"remember-checked_1oe68_110",readOnly:"read-only_1oe68_131","read-only":"read-only_1oe68_131",fadeOut:"fade-out_1oe68_147","fade-out":"fade-out_1oe68_147",fadeIn:"fadeIn_1oe68_1","fade-in":"fade-in_1oe68_150"}]) ,jw.template='\n    <div\n        data-show-ext="{{ubcShowLog}}"\n        data-show-area\n        class="\n            {{$style[\'profile-form\']}}\n            {{fadeIn ? $style[\'fade-in\'] : \'\'}}\n            {{fadeOut ? $style[\'fade-out\'] : \'\'}}\n            {{isReadOnly ? $style[\'read-only\'] : \'\'}}\n            {{isHistory ? $style[\'history-form\'] : \'\'}}\n        "\n        style="{{{\n            \'background-image\': \'url(\' + bgImage + \')\'\n        }}}"\n    >\n        \x3c!-- 标题区 --\x3e\n        <div class="{{$style[\'form-title\']}}">\n            <div class="{{$style[\'main-title\']}}">{{formConfig.title}}</div>\n            <div\n                s-if="{{!isReadOnly}}"\n                class="{{$style[\'sub-title\']}}"\n            >{{formConfig.subTitle}}</div>\n        </div>\n\n        \x3c!-- 内容区 --\x3e\n        <div class="{{$style[\'form-content\']}}">\n            <component\n                s-for="field, index in formConfig.fields"\n                s-is="{{field.component}}"\n                class="{{$style[\'form-content-item\']}}"\n                label="{{field.label}}"\n                key="{{field.key}}"\n                value="{{field.value}}"\n                selected-cities="{{field.selectedCities}}"\n                placeholder="{{field.placeholder}}"\n                options="{{field.options}}"\n                cities-data-url="{{field.citiesDataUrl}}"\n                has-data="{{hasData}}"\n                is-read-only="{{isReadOnly}}"\n                is-last="{{index === formConfig.fields.length - 1}}"\n                on-update-form="handleUpdateForm"\n                on-send-log="handleUbcLog"\n            />\n        </div>\n\n        \x3c!-- 操作按钮 --\x3e\n        <div\n            s-if="!isReadOnly"\n            data-show-ext="{{clearShowLog}}"\n            data-show-area\n            class="{{$style[\'form-action\']}}"\n        >\n            <cos-button\n                s-for="item, index in formConfig.actions"\n                disabled="{{item.key === \'clear\' && !hasData}}"\n                class="\n                    {{$style[\'form-action-btn\']}}\n                    {{item.key === \'clear\' ? $style[\'clear\'] : \'\'}}\n                    {{item.key === \'generate\' || item.key === \'regenerate\' ? $style[\'submit\'] : \'\'}}\n                    {{hasData ? $style[\'form-action-active\'] : \'\'}}\n                "\n                on-click="handleAction(item)"\n            >{{item.label}}</cos-button>\n        </div>\n\n        \x3c!-- 记住我 --\x3e\n        <div\n            s-if="{{formConfig.agreement.text && !isReadOnly}}"\n            class="\n                {{$style[\'form-remeber\']}}\n                {{remembered ? $style[\'remember-checked\'] : \'\'}}\n            "\n            on-click="handleRememberMe"\n        >\n            <span class="{{$style[\'checkbox-icon\']}}">\n                <span class="{{$style[\'checkbox-icon-inner\']}}"></span>\n            </span>\n            <span class="{{$style[\'checkbox-label\']}}">\n                {{formConfig.agreement.text}}\n            </span>\n        </div>\n    </div>\n';var Hw="function"==typeof jw?jw.prototype.initData||$w:jw.initData||$w;function $w(){return{$style:Bw}}function Fw(){return  __call$(Object,"assign",[{},Hw.call(this),{$style:Bw}]) }"function"==typeof jw?jw.prototype.initData=Fw:jw.initData=Fw;var Uw=a.defineComponent({trimWhitespace:"all",initData:function(){return{value:""}},attached:function(){this.fire("render-finished")}}),Gw={};Gw= __call$(Object,"assign",[Gw,{bottomTip:"bottom-tip_c99a0_1","bottom-tip":"bottom-tip_c99a0_1"}]) ,Uw.template="\n    <div class=\"{{$style['bottom-tip']}}\">\n        {{value}}\n    </div>\n";var Ww="function"==typeof Uw?Uw.prototype.initData||zw:Uw.initData||zw;function zw(){return{$style:Gw}}function Qw(){return  __call$(Object,"assign",[{},Ww.call(this),{$style:Gw}]) }function Jw(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Vw(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Jw(o,a,i,r,s,"next",t)}function s(t){Jw(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Kw(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Uw?Uw.prototype.initData=Qw:Uw.initData=Qw;var Xw="data-has-loop-loading",Yw=a.defineComponent({computed:{isShowLoopLoading:function(){var t=this.data.get("appearance"),e=this.data.get("showPicLoading"),n=this.data.get("generationPrompt");return"steps"===t&&!e&&!n}},initData:function(){return{sseStatus:3,generationPrompt:"",appearance:"skeleton",picProcess:0,picLoadingDesc:"AI作图中",showPicLoading:!1,picLoadingExtend:!1,isPc:"pc"===rt(),interval:null,slideWordsInterval:null,slideWords:"",overviewType:"",loadingWidth:0,loadingUpdated:!1,picLoadingHeight:"auto"}},listenSendLoadingData:null,Lottie:null,customNextTick:function(){return Vw((function(){var t;return Kw(this,(function(e){return t=this,[2,new Promise((function(e){t.nextTick((function(){e()}))}))]}))})).apply(this)},attached:function(){var e=this;new Promise((function(e,n){t(["lottie-web"],(function(t){e(d(t))}),n)})).then((function(t){e.Lottie=t.default;var n={container:e.ref("brushDom"),renderer:"svg",loop:!0,autoplay:!0,path:"https://psstatic.cdn.bcebos.com/basics/chat/brush_1741693509000.json"};!e.data.get("isPc")&&e.Lottie.loadAnimation(n)}));var n=this.el,a=this.data.get("overviewType");this.listenSendLoadingData=function(t){if(void 0===t&&(t={}),!e.data.get("isPc"))if(t.clearLoading)e.clearPicLoading();else{var i=t.content;if(i){e.dispatch("update-chat-status",_g.GENERATING),i.description&&e.data.set("picLoadingDesc",i.description);var o=i.ratio||"1-1";e.renderLottie(o);var r=e;setTimeout(Vw((function(){var t,e,s,l;return Kw(this,(function(c){switch(c.label){case 0:return r.data.set("showPicLoading",!0),[4,r.customNextTick()];case 1:return c.sent(),e=o.split("-"),r.data.set("picLoadingHeight",(+e[1]||1)/(+e[0]||1)*(null==(t=r.el)?void 0:t.clientWidth)+"px"),"2"!==a&&"3"!==a||!n||null==(l=xn(n,"."+Vt))||null==(s=l.classList)||s.remove(Vt),r.nextTick((function(){r.data.set("picLoadingExtend",!0),setTimeout((function(){r.incrementNumber(33)}),1e3),r.dispatch("pic-loading:set-height",null==n?void 0:n.clientHeight)})),+i.progress>r.data.get("picProcess")&&r.incrementNumber(+i.progress),[2]}}))})),e.data.get("showPicLoading")?0:500)}}},Ia().on(this.listenSendLoadingData),this.listenLoopLoadingShow()},answerBoxDom:null,setLoopLoadingData:function(){this.answerBoxDom&&kn(this.answerBoxDom,Xw,"true")},removeLoopLoadingData:function(){this.answerBoxDom&&kn(this.answerBoxDom,Xw,null)},listenLoopLoadingShow:function(){var t=this;this.answerBoxDom=xn(this.el,Xt,null),this.data.get("isShowLoopLoading")&&this.setLoopLoadingData(),this.watch("isShowLoopLoading",(function(e){e?t.setLoopLoadingData():t.removeLoopLoadingData()}))},disposed:function(){this.removeLoopLoadingData(),this.answerBoxDom=null,this.listenSendLoadingData&&(Ia().off(this.listenSendLoadingData),this.listenSendLoadingData=null)},incrementNumber:function(t){var e=this;if(!(t<=this.data.get("picProcess"))){clearTimeout(this.data.get("interval"));var n=function(){e.data.set("picProcess",e.data.get("picProcess")+1),e.data.get("picProcess")<t&&e.data.set("interval",setTimeout(n,10))};this.data.set("interval",setTimeout(n,10))}},clearPicLoading:function(){this.data.set("showPicLoading",!1),this.data.set("picProcess",0),clearTimeout(this.data.get("interval"))},updateLoading:function(t){var e,n=null==t||null==(e=t.steps)?void 0:e[1];n&&!this.data.get("loadingUpdated")&&this.data.get("overviewType")&&"搜索全网"===n.title&&(this.data.set("generationPrompt","搜索全网"),this.setSlideWords(n.words),this.data.set("loadingUpdated",!0))},setSlideWords:function(t){var e=this;if(t&&t.length&&Array.isArray(t)){var n=0;this.data.set("slideWordsInterval",setInterval((function(){e.data.set("slideWords", __get$(t,n) ),n=(n+1)%t.length,e.nextTick((function(){var t,n=null==(t=e.ref("slideWords"))?void 0:t.offsetWidth;n&&e.data.set("loadingWidth",n)}))}),400))}},renderLottie:function(e){var n=this;if(!this.data.get("showPicLoading")){var a={container:this.ref("loadingDom"),renderer:"svg",loop:!0,autoplay:!0,path:ke.get(e)};this.Lottie?!this.data.get("isPc")&&this.Lottie.loadAnimation(a):new Promise((function(e,n){t(["lottie-web"],(function(t){e(d(t))}),n)})).then((function(t){n.Lottie=t.default,!n.data.get("isPc")&&n.Lottie.loadAnimation(a)}))}},detached:function(){this.data.get("showPicLoading")&&this.dispatch("pic-loading:listen-pic-load",""),this.clearPicLoading(),clearInterval(this.data.get("slideWordsInterval"))}}),Zw={};Zw= __call$(Object,"assign",[Zw,{chatSearchAnswerStatusStep:"chat-search-answer-status-step_oc7hj_31","chat-search-answer-status-step":"chat-search-answer-status-step_oc7hj_31",icon:"icon_oc7hj_36",cosdSearchingStepsIconProcessBreath:"cosd-searching-steps-icon-process-breath_oc7hj_1","cosd-searching-steps-icon-process-breath":"cosd-searching-steps-icon-process-breath_oc7hj_1",label:"label_oc7hj_45",singleLineStatusStep:"single-line-status-step_oc7hj_52","single-line-status-step":"single-line-status-step_oc7hj_52",box:"box_oc7hj_56",box1Container:"box-1-container_oc7hj_73","box-1-container":"box-1-container_oc7hj_73",loadingBar:"loading-bar_oc7hj_76","loading-bar":"loading-bar_oc7hj_76",borealisBar:"borealisBar_oc7hj_1",box1:"box-1_oc7hj_73","box-1":"box-1_oc7hj_73",box2:"box-2_oc7hj_94","box-2":"box-2_oc7hj_94",picLoadingExtend:"pic-loading-extend_oc7hj_137","pic-loading-extend":"pic-loading-extend_oc7hj_137",picLoading:"pic-loading_oc7hj_137","pic-loading":"pic-loading_oc7hj_137",picLoadingBrush:"pic-loading-brush_oc7hj_156","pic-loading-brush":"pic-loading-brush_oc7hj_156",picLoadingDesc:"pic-loading-desc_oc7hj_164","pic-loading-desc":"pic-loading-desc_oc7hj_164",answerBoxBorder:"answer-box-border_oc7hj_174","answer-box-border":"answer-box-border_oc7hj_174",slideAnimation:"slide-animation_oc7hj_188","slide-animation":"slide-animation_oc7hj_188",dotsContainer:"dots-container_oc7hj_191","dots-container":"dots-container_oc7hj_191",dot:"dot_oc7hj_191",breathe:"breathe_oc7hj_1",loopLoading:"loop-loading_oc7hj_220","loop-loading":"loop-loading_oc7hj_220",loopLoadingItem:"loop-loading-item_oc7hj_236","loop-loading-item":"loop-loading-item_oc7hj_236",loopLoadingItem1:"loop-loading-item-1_oc7hj_244","loop-loading-item-1":"loop-loading-item-1_oc7hj_244",loopLoadingItem2:"loop-loading-item-2_oc7hj_247","loop-loading-item-2":"loop-loading-item-2_oc7hj_247",loopLoadingItem3:"loop-loading-item-3_oc7hj_250","loop-loading-item-3":"loop-loading-item-3_oc7hj_250"}]) ,Yw.template="\n    <div\n        style=\"{{'height:' + picLoadingHeight + ';'}}\"\n        class=\"chat-search-answer-status {{showPicLoading ? $style['answer-box-border'] : ''}}\"\n    >\n        \x3c!-- 等待响应或者生成响应时显示，等待响应时有动画效果 --\x3e\n        <span\n            s-if=\"appearance === 'skeleton' && !showPicLoading\"\n            class=\"chat-search-answer-status-generating\"\n        >\n            <span class=\"{{$style['box-1-container']}}\">\n                <span class=\"text\">{{ generationPrompt }}</span>\n                <span class=\"{{$style['box']}} {{$style['box-1']}}\">\n                    <span class=\"{{$style['loading-bar']}}\"></span>\n                </span>\n            </span>\n            <span class=\"{{$style['box']}} {{$style['box-2']}}\">\n                <span class=\"{{$style['loading-bar']}}\"></span>\n            </span>\n        </span>\n        <div\n            s-if=\"appearance === 'steps' && !showPicLoading\"\n            class=\"{{$style['chat-search-answer-status-step']}} {{overviewType === '2' ? $style['single-line-status-step'] : ''}} cos-dqa cos-line-clamp-1\"\n        >\n            \x3c!-- 三点循环loading动画，独立使用 --\x3e\n            <div s-if=\"!generationPrompt\" class=\"{{$style['loop-loading']}}\">\n                <fragment s-for=\"item in [1, 2, 3]\">\n                    <div class=\"{{$style['loop-loading-item']}} {{$style['loop-loading-item-' + item]}}\"></div>\n                </fragment>\n            </div>\n            \x3c!-- 单点循环loading动画，思考态使用 --\x3e\n            <span s-elif=\"overviewType !== '2'\" class=\"{{$style['icon']}}\"></span>\n            <span s-if=\"generationPrompt\" class=\"{{$style['label']}}\">{{ generationPrompt }}</span>\n            <span\n                s-if=\"overviewType && slideWords\"\n                s-ref=\"loading\"\n                class=\"\n                    {{$style['label']}}\n                    {{overviewType !== '1' ? $style['slide-animation'] : ''}}\n                    {{overviewType === '2' ? 'cos-space-pl-xxs' : ''}}\n                    cos-line-clamp-1\n                \"\n                style=\"{{overviewType !== '1' ? 'max-width:'+ loadingWidth +'px;' : ''}}\"\n            >\n                <span s-ref=\"slideWords\">{{ slideWords }}</span>\n            </span>\n            <div s-if=\"overviewType === '2'\" class=\"cos-space-ml-3xs {{$style['dots-container']}}\">\n                <div class=\"{{$style['dot']}}\"></div>\n                <div class=\"{{$style['dot']}}\"></div>\n                <div class=\"{{$style['dot']}}\"></div>\n            </div>\n        </div>\n        <div\n            s-show=\"showPicLoading\"\n            s-ref=\"loadingDom\"\n            style=\"{{'padding-top:' + picLoadingHeight + ';'}}\"\n            class=\"{{$style['pic-loading']}} {{picLoadingExtend ? $style['pic-loading-extend'] : ''}}\"\n        >\n        </div>\n        <span s-if=\"showPicLoading\" class=\"{{$style['pic-loading-desc']}}\">{{picProcess}}%</span>\n        <div\n            s-show=\"showPicLoading\"\n            s-ref=\"brushDom\"\n            class=\"{{$style['pic-loading-brush']}}\"\n        ></div>\n    </div>\n";var tb="function"==typeof Yw?Yw.prototype.initData||eb:Yw.initData||eb;function eb(){return{$style:Zw}}function nb(){return  __call$(Object,"assign",[{},tb.call(this),{$style:Zw}]) }function ab(t){var e=t.outlineLid,n=t.outlineQid,a=Mr();return Li(on.getState("chatParams").sse_host+"/aichat/api/ppt/themelist?tk="+sc()+"&outlineLid="+e+"&outlineQid="+n+"&knowledgeId="+a,{credentials:"include"},4e3).then((function(t){return 1003===t.status?Promise.reject(new Error("无数据返回")):0===t.status&&t.data?Promise.resolve(t.data):Promise.reject(new Error("无数据返回"))})).catch((function(t){}))}"function"==typeof Yw?Yw.prototype.initData=nb:Yw.initData=nb;var ib=100,ob=99,rb=30;function sb(){return sb=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},sb.apply(this,Array.from(arguments))}var lb=function(){function t(t,e,n){this.typewriterArr=[],this.activeItem=null,this.speed=rb,this.skipDesc=!1,this.isEnd=!1,this.twMap=new Map,this.timer=null,this.consumeCallback=t,this.completeCallback=e,this.itemCompleteCallback=n}var e=t.prototype;return e.setOptions=function(t){void 0!==t.speed&&(this.speed=t.speed),void 0!==t.skipDesc&&(this.skipDesc=t.skipDesc),void 0!==t.isEnd&&(this.isEnd=t.isEnd)},e.setSkipDesc=function(t){this.skipDesc=t},e.setIsEnd=function(t){this.isEnd=t,!t||this.typewriterArr.length||this.activeItem||this.completeCallback()},e.initTwMap=function(t){this.twMap.set(t.id,{text:t.text||"",desc:t.desc||""})},e.addQueue=function(t){var e=t.id,n=t.parentId,a=t.text,i=t.desc;this.twMap.get(e)||(a&&this.typewriterArr.push({id:e,parentId:n,type:"text",str:a}),i&&!this.skipDesc&&this.typewriterArr.push({id:e,parentId:n,type:"desc",str:i}),this.twMap.set(e,{text:a||"",desc:i||""}))},e.start=function(){this.timer||this.consume()},e.stop=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},e.clear=function(){this.stop(),this.typewriterArr=[],this.activeItem=null,this.twMap.clear()},e.consume=function(){var t=this;if(!this.activeItem){if(0===this.typewriterArr.length)return void(this.isEnd&&this.completeCallback());if(this.activeItem=this.typewriterArr.shift()||null,!this.activeItem)return}var e=this.activeItem.str.charAt(0);if(!e)return this.itemCompleteCallback(this.activeItem),this.activeItem=null,void(this.timer=window.setTimeout((function(){t.timer=null,t.consume()}),this.speed));var n=sb({},this.activeItem,{str:e});this.activeItem.str=this.activeItem.str.substring(1),this.consumeCallback(n),this.timer=window.setTimeout((function(){t.timer=null,t.consume()}),this.speed)},t}();function cb(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function db(){return db=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},db.apply(this,Array.from(arguments))}function ub(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return cb(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cb(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var pb=function(t){var e=new Map,n=function(t){t.forEach((function(t){e.set(t.data.id,t.data),t.children&&t.children.length&&n(t.children)}))};return n(t),e},hb=function(t,e){if(!t.length)return"";var n="";return t[0]&&(n+=t[0].data.text+"\n\n",t.slice(1).forEach((function(t,a){n+=""+("number"===e?a+1+". ":"")+t.data.text+"\n",t.data.desc&&(n+=t.data.desc+"\n"),t.children&&t.children.length&&t.children.forEach((function(t,i){n+="  "+("number"===e?a+1+"."+(i+1)+" ":"- ")+t.data.text+"\n",t.data.desc&&(n+="  "+t.data.desc+"\n")})),n+="\n"}))),n.trim()},fb=function(t,e,n){if(!t.length)return{newNode:null,nodes:t};var a=JSON.parse(JSON.stringify(t)),i="outline-"+Math.random().toString(36).substring(2,10),o=null;if(1===n){var r=a.findIndex((function(t){return t.data.id===e}));-1!==r&&(o={data:{id:i,text:"",desc:"",parentId:""},children:[]},a.splice(r+1,0,o))}else if(2===n)for(var s,l=ub(a);!(s=l()).done;){var c=s.value;if(c.data.id===e){o={data:{id:i,text:"",desc:"",parentId:c.data.id},children:[]},c.children.splice(0,0,o);break}var d=c.children.findIndex((function(t){return t.data.id===e}));if(-1!==d){o={data:{id:i,text:"",desc:"",parentId:c.data.id},children:[]},c.children.splice(d+1,0,o);break}}return{newNode:o,nodes:a}},gb=function(t){if(!(null==t?void 0:t.length))return{hasEmptyTitle:!1,toast:"",editId:""};var e=function(t,e){var n,a;return(null==t||null==(a=t.data)||null==(n=a.text)?void 0:n.trim())?null:{hasEmptyTitle:!0,toast:e+"不能为空",editId:t.data.id}},n=e(t[0],"主标题");if(n)return n;for(var a,i=1,o=ub(t.slice(1));!(a=o()).done;){var r=a.value,s=e(r,"第"+i+"章标题");if(s)return s;for(var l,c=1,d=ub(r.children);!(l=d()).done;){var u=e(l.value,i+"."+c+"子章节标题");if(u)return u;c++}i++}return{hasEmptyTitle:!1,toast:"",editId:""}},mb=a.defineComponent({trimWhitespace:"all",elementObserver:null,components:{"cos-icon":e.Icon},initData:function(){return{isTitleEmpty:!1,textareaHeight:0,descTextareaHeight:0,titleMaxLength:ib}},computed:{placeholder:function(){return this.data.get("canEdit")?{text:1==+this.data.get("level")?"请输入章节标题":"请输入子章节标题",desc:"可输入本节需要提及的内容"}:{text:"",desc:""}},addNodeText:function(){var t=this.data.get("level"),e=this.data.get("isHasChild");return 2===t||1===t&&!e?"子节":"章节"}},attached:function(){var t=this;if(this.autoResize(this.ref("textRef")),this.watch("data.text",(function(e,n){2!=+t.data.get("level")&&t.data.set("isTitleEmpty",!e),e!==n&&t.autoResize(t.ref("textRef"))})),this.watch("editId",(function(e){var n;e===t.data.get("data").id&&("desc"!==t.data.get("focusType")&&(null==(n=t.ref("textRef"))||n.focus()))})),window.ResizeObserver){this.elementObserver=new ResizeObserver(Xi((function(){requestAnimationFrame((function(){t.autoResize(t.ref("textRef"))}))}),100));var e=this.ref("textRef");e&&this.elementObserver.observe(e)}},detached:function(){this.elementObserver&&this.elementObserver.disconnect()},autoResize:function(t,e){if(void 0===e&&(e="text"),t){var n=t.type;if("focus"===n&&this.data.set("focusType",e),t&&t.style){var a=t;a.style.height="auto",a.style.height=a.scrollHeight+"px"}"focus"===n&&t.scrollIntoView&&setTimeout((function(){t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}),0)}},onAddNode:function(t){this.data.get("isComposing")||(t.preventDefault(),this.data.set("focusType","text"),this.data.get("isTitle")||this.fire("add-node",{id:this.data.get("data").id,level:this.data.get("level")}))},onMoveLevel:function(t){if(!this.data.get("isComposing")){t.preventDefault();var e=+this.data.get("level");t.shiftKey&&2===e&&this.moveUpLevel(),t.shiftKey||1!==e||1===this.data.get("index")||this.moveDownLevel()}},onDelete:function(t,e){e||this.data.get("isComposing")||(t.preventDefault(),this.fire("delete-node",{id:this.data.get("data").id,level:this.data.get("level")}))},editContent:function(t){this.fire("enter-edit",t)},textareaInputHandle:function(t,n){var a=ib,i=t.target.value;if(i.length>a){var o=t.target;o.value=i.substring(0,a),this.data.set("data."+n,o.value),e.Toast.info({message:"标题不能超过100字"})}this.autoResize(t.target,n),this.fire("real-edited",{type:"input",id:this.data.get("data").id,level:this.data.get("level")})},textareaBlurHandle:function(t,e){this.fire("textarea-blur",e)},onKeyDown:function(t){var e=t.key;"Enter"===e?this.onAddNode(t):"Tab"===e?this.onMoveLevel(t):"Delete"===e&&this.onDelete(t,this.data.get("isTitle"))},textareaCopyHandle:function(t){this.fire("textarea-copy",t)},textareaPasteHandle:function(t,n){var a,i=null==(a=t.clipboardData)?void 0:a.getData("text");if(i){var o=ib,r=this.data.get("data."+n)||"";if(r.length+i.length>o){t.preventDefault();var s=o-r.length;if(s>0){var l=i.substring(0,s);this.data.set("data."+n,r+l),this.autoResize(this.ref(n+"Ref"),n),this.fire("real-edited",{type:n,id:this.data.get("data").id,level:this.data.get("level")})}e.Toast.info({message:"标题不能超过100字"})}}},autoFocus:function(t){t.stopPropagation()},handleCompositionStart:function(){this.data.set("isComposing",!0)},handleCompositionEnd:function(){this.data.set("isComposing",!1)},moveUpLevel:function(){var t=this.data.get("data").id,e=+this.data.get("level");this.fire("move-up-level",{id:t,level:e})},moveDownLevel:function(){var t=this.data.get("data").id,e=+this.data.get("level");this.fire("move-down-level",{id:t,level:e})},addNode:function(){var t=this.data.get("data").id,e=this.data.get("addNodeText");this.fire("add-node",{id:t,level:"章节"===e?1:2})},deleteNode:function(){var t=this.data.get("data").id,e=+this.data.get("level");this.fire("delete-node",{id:t,level:e})}}),vb={};vb= __call$(Object,"assign",[vb,{contentBox:"content-box_1anyt_1","content-box":"content-box_1anyt_1",disabled:"disabled_1anyt_9",tagText:"tag-text_1anyt_12","tag-text":"tag-text_1anyt_12",contentActions:"content-actions_1anyt_23","content-actions":"content-actions_1anyt_23",level1:"level-1_1anyt_26","level-1":"level-1_1anyt_26",isHasChild:"is-has-child_1anyt_26","is-has-child":"is-has-child_1anyt_26",contentInput:"content-input_1anyt_35","content-input":"content-input_1anyt_35",level2:"level-2_1anyt_40","level-2":"level-2_1anyt_40",contentContainer:"content-container_1anyt_54","content-container":"content-container_1anyt_54",outlineContentEdit:"outline-content-edit_1anyt_58","outline-content-edit":"outline-content-edit_1anyt_58",outlineContentEmpty:"outline-content-empty_1anyt_62","outline-content-empty":"outline-content-empty_1anyt_62",title:"title_1anyt_65",contentMain:"content-main_1anyt_68","content-main":"content-main_1anyt_68",actionsPanel:"actions-panel_1anyt_104","actions-panel":"actions-panel_1anyt_104",btnAreaItem:"btn-area-item_1anyt_113","btn-area-item":"btn-area-item_1anyt_113"}]) ,mb.template='\n    <div\n        class="\n            {{$style[\'content-box\']}}\n            {{$style[\'level-\' + level]}}\n            {{isLast ? $style[\'is-last\'] : \'\'}}\n            {{isHasChild ? $style[\'is-has-child\'] : \'\'}}\n            {{isTitle ? $style[\'is-title\'] : \'\'}}"\n    >\n        \x3c!--左侧tag--\x3e\n        <div\n            s-ref="boxLeftRef"\n            class="{{$style[\'tag-text\']}}"\n        >\n            {{ tag }}\n        </div>\n\n        \x3c!--内容区--\x3e\n        <div\n            class="{{$style[\'content-container\']}}"\n            tabindex="0"\n            on-click="editContent(data.id)"\n            on-compositionstart="handleCompositionStart"\n            on-compositionend="handleCompositionEnd"\n        >\n            <div class="{{$style[\'content-main\']}}">\n                <textarea\n                    data-id="{{data.id}}"\n                    s-ref="textRef"\n                    value="{=data.text=}"\n                    wrap="soft"\n                    class="{{$style[\'content-input\']}}"\n                    placeholder="{{placeholder.text}}"\n                    rows="1"\n                    disabled="{{disable}}"\n                    on-keydown="onKeyDown($event)"\n                    on-blur="textareaBlurHandle($event, level)"\n                    on-input="textareaInputHandle($event, \'text\')"\n                    on-focus="autoResize($event, \'text\')"\n                    on-keyup-esc="fire(\'cancel-edit\')"\n                    on-click="autoFocus($event)"\n                    on-copy="textareaCopyHandle"\n                    on-paste="textareaPasteHandle($event, \'text\')"\n                ></textarea>\n            </div>\n            <div\n                s-if="!disable && index !== 0"\n                class="{{$style[\'content-actions\']}}"\n            >\n                \x3c!--操作区--\x3e\n                <div class="{{$style[\'actions-panel\']}}">\n                    <div\n                        s-if="level === 1 && index !== 1"\n                        class="{{$style[\'btn-area-item\']}}"\n                        on-click="moveDownLevel"\n                    >\n                        <cos-icon name="to-down" />\n                        <span class="{{$style.text}}">降为子节</span>\n                    </div>\n                    <div\n                        s-if="level === 2"\n                        class="{{$style[\'btn-area-item\']}}"\n                        on-click="moveUpLevel"\n                    >\n                        <cos-icon name="to-up" />\n                        <span class="{{$style.text}}">升为章节</span>\n                    </div>\n                    <div\n                        class="{{$style[\'btn-area-item\']}}"\n                        on-click="addNode"\n                    >\n                        <cos-icon name="plus-circle" />\n                        <span class="{{$style.text}}">新增{{ addNodeText }}</span>\n                    </div>\n                    <div\n                        class="{{$style[\'btn-area-item\']}}"\n                        on-click="deleteNode"\n                    >\n                        <cos-icon name="bin" />\n                        <span class="{{$style.text}}">删除</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n';var yb="function"==typeof mb?mb.prototype.initData||wb:mb.initData||wb;function wb(){return{$style:vb}}function bb(){return  __call$(Object,"assign",[{},yb.call(this),{$style:vb}]) }function _b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function kb(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Sb(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){kb(o,a,i,r,s,"next",t)}function s(t){kb(o,a,i,r,s,"throw",t)}r(void 0)}))}}function xb(){return xb=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},xb.apply(this,Array.from(arguments))}function Ib(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_b(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Tb(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof mb?mb.prototype.initData=bb:mb.initData=bb;var Cb=Tt.connect(on,{workspaceData:"workspaceData"})(a.defineComponent({trimWhitespace:"all",outlineTypewriter:null,setTimer:null,clearTimer:null,debounceEditOutline:null,components:{"content-box":mb,"cos-loading":e.Loading,"chat-loading":Yw},initData:function(){return{nodes:[],canEdit:!1,editNodeId:"",needInitNode:!0,finished:!1,editOutlineLoading:!1,editOutlineActionQueue:[],selectTemplateButtonLoading:!1,isStop:!1}},computed:{globalDisable:function(){var t=this.data.get("isEditable");return void 0!==t?!t:!this.data.get("canEdit")},isLoading:function(){return!(this.data.get("finished")&&this.data.get("canEdit"))},isOpenCurWorkspace:function(){var t=this.data.get("outlineQid"),e=this.data.get("workspaceData.wenku.outlineQid");return e&&t===e},copyText:function(){return hb(this.data.get("nodes"),"number")},hasEmptyTitle:function(){return gb(this.data.get("nodes")).hasEmptyTitle?"1":"0"}},inited:function(){var t=this,e=function(t){var e=null;return{setTimer:function(n){e&&clearTimeout(e),e=window.setTimeout(n,t)},clearTimer:function(){e&&(clearTimeout(e),e=null)}}}(3e3),n=e.setTimer,a=e.clearTimer;this.setTimer=n,this.clearTimer=a,this.outlineTypewriter=new lb(this.outlineTypewriterConsume.bind(this),this.outlineTypewriterComplete.bind(this),this.outlineTypewriterItemComplete.bind(this)),this.debounceEditOutline=Ki(this.editOutline.bind(this),300),tl().on((function(e){e.outlineQid===t.data.get("outlineQid")&&t.checkEmptyTitleAction()}))},attached:function(){var t=this,e=this.data.get("value"),n=!!this.data.get("value.status");this.appendContent(e,n),Fn().on((function(e){e.rank===t.data.get("rank")&&t.handleFinished()})),nl().on((function(e){e.rank===t.data.get("rank")&&t.data.set("isStop",!0)}))},appendContent:function(t,e){if(void 0===e&&(e=!1),t){var n=t.bdjson,a=t.status,i=t.edited;n&&this.handleOutlineChange(n),a&&(this.fire("render-finished"),e&&this.handleFinished()), __call$(this.data,"assign",[{edited:i,outlineLid:t.outlineLid,outlineQid:t.outlineQid}]) }},handleOutlineChange:function(t){var e=this;try{var n,a;if(null==(n=this.outlineTypewriter)||n.setSkipDesc(!0),!t)return;var i=function(t){if(!Object.keys(t).length)return[];var e=[],n=function(t,e,n){var a,i,o=e.map((function(t){return t.c})).flat();return{id:t,text:(null==(a=o.find((function(t){return"span"===t.t})))?void 0:a.c)||"",desc:(null==(i=o.find((function(t){return"desc"===t.t})))?void 0:i.c)||"",parentId:n}},a=function(t,e,i){null==t||t.forEach((function(t){var o={data:n(t.id,t.c.c,i),children:[]};e.push(o),t.ch&&a(t.ch,o.children,t.id)}))},i={data:n(t.id,t.c.c,""),children:[]};return e.push(i),a(t.ch,e,""),e}("string"==typeof t?JSON.parse(t):t);if(!i.length)return;var o=this.getNodeMap(i);if(!o)return;o.forEach((function(t){var n;null==(n=e.outlineTypewriter)||n.addQueue(t)})),null==(a=this.outlineTypewriter)||a.start()}catch(t){nw("Error parsing outline:",t)}},handleFinished:function(){var t,e;this.data.get("finished")||(this.data.set("finished",!0),null==(t=this.outlineTypewriter)||t.setIsEnd(!0),(null==(e=this.outlineTypewriter)?void 0:e.typewriterArr.length)||this.outlineTypewriterComplete())},getNodeMap:function(t){if(this.data.get("needInitNode")){this.data.set("needInitNode",!1);var e=pb(t);return this.initTypedMap(e),this.data.set("nodes",t),this.fire("render-finished"),null}return pb(t)},initTypedMap:function(t){var e=this;t.forEach((function(t){var n;null==(n=e.outlineTypewriter)||n.initTwMap(t)}))},outlineTypewriterConsume:function(t){var e=this.data.get("nodes");if(t.parentId){var n=e.findIndex((function(e){return e.data.id===t.parentId}));if(-1===n)return;var a= __get$(e,n) .children,i=a.findIndex((function(e){return e.data.id===t.id}));if(-1!==i){var o=a.map((function(e,n){return n===i?xb({},e,{data:xb({},e.data,{text:"text"===t.type?e.data.text+t.str:e.data.text,desc:"desc"===t.type?e.data.desc+t.str:e.data.desc})}):e})),r=[].concat(e); __set$(r,n,xb({},__get$(e,n),{children:o})) ,this.data.set("nodes",r)}else{var s=a.map((function(t){return xb({},t)}));s.push({children:[],data:{desc:"desc"===t.type?t.str:"",id:t.id,parentId:t.parentId,text:"text"===t.type?t.str:""}});var l=[].concat(e); __set$(l,n,xb({},__get$(e,n),{children:s})) ,this.data.set("nodes",l)}}else{var c=e.findIndex((function(e){return e.data.id===t.id}));if(-1!==c){var d= __get$(e,c) ,u=[].concat(e); __set$(u,c,xb({},d,{data:xb({},d.data,{text:"text"===t.type?d.data.text+t.str:d.data.text,desc:"desc"===t.type?d.data.desc+t.str:d.data.desc})})) ,this.data.set("nodes",u)}else this.data.push("nodes",{children:[],data:{desc:"desc"===t.type?t.str:"",id:t.id,parentId:"",text:"text"===t.type?t.str:""}})}},outlineTypewriterComplete:function(){this.data.set("canEdit",!0),this.fire("render-finished")},outlineTypewriterItemComplete:function(){this.fire("render-finished")},getTitle:function(){var t,e;return(null==(e=this.data.get("nodes")[0])||null==(t=e.data)?void 0:t.text)||""},getSub:function(t){return void 0===t&&(t=!0),function(t,e){if(!e.length)return[];var n=[];return e.slice(1).forEach((function(e){t&&!e.data.text||n.push(e.data.text)})),n}(t,this.data.get("nodes"))},getResult:function(t,e){switch(void 0===t&&(t="json"),void 0===e&&(e={prefix:"number"}),t){case"json":return JSON.stringify(function(t){if(!t.length)return{};var e={id:"",c:{t:"p",c:[]},dataType:"data",ch:[]},n=function(t,e){var n=[{t:"p",c:[{t:"span",c:t||""}]}];return e&&n[0].c.push({t:"desc",c:e}),n};if(t[0]){var a=t[0];e.id=a.data.id,e.c.c=n(a.data.text,a.data.desc),e.ch=t.slice(1).map((function(t){var e={id:t.data.id,c:{t:"p",c:n(t.data.text,t.data.desc)},dataType:"data"};return t.children&&t.children.length&&(e.ch=t.children.map((function(t){return{id:t.data.id,c:{t:"p",c:n(t.data.text,t.data.desc)},dataType:"data"}}))),e}))}return e}(this.data.get("nodes")));case"text":return hb(this.data.get("nodes"),e.prefix);default:return""}},manageFocus:function(t,e,n){var a=this;void 0===n&&(n=""),this.nextTick((function(){null==a.clearTimer||a.clearTimer.call(a),"delete"===e&&n?(a.data.set("editNodeId",n),a.focusNodeById(n)):"add"!==e&&"move"!==e&&"edit"!==e||(a.data.set("editNodeId",t),a.focusNodeById(t),null==a.setTimer||a.setTimer.call(a,a.autoLoseFocus.bind(a)))}))},enterEdit:function(t){this.outlineClickHandle()&&this.manageFocus(t,"edit")},contentClickOutsideHandle:function(){this.data.get("editNodeId")&&(this.data.set("editNodeId",""),this.fire("edited",!1)),null==this.clearTimer||this.clearTimer.call(this)},autoLoseFocus:function(){var t,e,n=document.activeElement;t=n,(null!=(e=HTMLElement)&&"undefined"!=typeof Symbol&& __get$(e,Symbol.hasInstance) ? __call$(e,Symbol.hasInstance,[t]) :t instanceof e)&&(null==n||n.blur()),this.contentClickOutsideHandle()},outlineClickHandle:function(){return!!this.data.get("canEdit")||(e.Toast.info({message:"等大纲生成完，再开始编辑吧"}),!1)},addNode:function(t){var n=t.id,a=t.level;if(pb(this.data.get("nodes")).size>ob)e.Toast.error({message:"章节数量已达到上限"});else{var i=fb(this.data.get("nodes"),n,a),o=i.newNode,r=i.nodes;this.data.set("nodes",r),this.realEditedHandle({type:"add",level:a}),o&&this.manageFocus(o.data.id,"add"),this.sendLog({value:"ppt_"+this.getLevelString(a)+"_new",type:"click"})}},deleteNode:function(t){var n=t.id,a=t.level,i=this.data.get("nodes");if(!((null==i?void 0:i.length)<=1)){if(i&&2===i.length)if(i.find((function(t){return t.data.id===n})))return void e.Toast.info({message:"至少需要一个一级标题"});var o="",r=n||this.data.get("editNodeId"),s=i.findIndex((function(t){return t.data.id===r}));if(-1!==s)s+1<i.length?o= __get$(i,s+1) .data.id:s>0&&(o= __get$(i,s-1) .data.id);else for(var l,c=Ib(i);!(l=c()).done;){var d=l.value,u=d.children.findIndex((function(t){return t.data.id===r}));if(-1!==u){o=u+1<d.children.length? __get$(d.children,u+1) .data.id:u>0? __get$(d.children,u-1) .data.id:d.data.id;break}}var p=function(t,e){if(!t.length||!e)return t;var n=JSON.parse(JSON.stringify(t)),a=n.findIndex((function(t){return t.data.id===e}));if(-1!==a&&0!==a)return n.splice(a,1),n;for(var i,o=ub(n);!(i=o()).done;){var r=i.value,s=r.children.findIndex((function(t){return t.data.id===e}));if(-1!==s)return r.children.splice(s,1),n}return n}(i,r);this.realEditedHandle({type:"delete",level:a}),this.data.set("nodes",p),o&&this.manageFocus(o,"delete",o),this.sendLog({value:"ppt_"+this.getLevelString(a)+"_delete",type:"click"})}},moveUpLevel:function(t){var e=t.id,n=this.data.get("nodes"),a=e||this.data.get("editNodeId"),i=function(t,e){var n=function(t){var n= __get$(i,t) .children.findIndex((function(t){return t.data.id===e}));if(-1!==n){var a= __get$(__get$(i,t).children,n) ,o={data:db({},a.data,{parentId:""}),children:[]};if(n+1< __get$(i,t) .children.length){var r= __get$(i,t) .children.slice(n+1);r.forEach((function(t){t.data.parentId=a.data.id})),o.children=r, __get$(i,t) .children.splice(n+1)}return  __get$(i,t) .children.splice(n,1),i.splice(t+1,0,o),{v:i}}};if(!t.length||!e)return t;for(var a,i=JSON.parse(JSON.stringify(t)),o=0;o<i.length;o++){var r=n(o);if("object"==((a=r)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a))return r.v}return i}(n,a);this.realEditedHandle({type:"move",level:2}),this.data.set("nodes",i),this.manageFocus(a,"move"),this.sendLog({value:"ppt_2nd_upper",type:"click"})},moveDownLevel:function(t){var e=t.id,n=this.data.get("nodes"),a=e||this.data.get("editNodeId"),i=function(t,e){if(!t.length||!e)return t;var n=JSON.parse(JSON.stringify(t)),a=n.findIndex((function(t){return t.data.id===e}));if(-1!==a&&a>1){var i= __get$(n,a) ,o= __get$(n,a-1) ,r={data:db({},i.data,{parentId:o.data.id}),children:[]};n.splice(a,1),o.children.push(r),i.children&&i.children.length>0&&i.children.forEach((function(t){t.data.parentId=o.data.id,o.children.push(t)}))}return n}(n,a);this.realEditedHandle({type:"move",level:1}),this.data.set("nodes",i),this.manageFocus(a,"move"),this.sendLog({value:"ppt_1st_lower",type:"click"})},focusNodeById:function(t){if(t&&this.el){var e=this.el.querySelector('[data-id="'+t+'"]');if(e){e.focus();var n=e.value.length;e.setSelectionRange(n,n)}}},realEditedHandle:function(t){var e=t.type,n=t.level;this.data.set("edited",!0),null==this.debounceEditOutline||this.debounceEditOutline.call(this,{type:e,level:n})},clear:function(){var t;this.data.set("nodes",[]),null==(t=this.outlineTypewriter)||t.clear()},stop:function(){var t,e;this.data.set("isStop",!0),null==(t=this.outlineTypewriter)||t.stop(),null==(e=this.outlineTypewriter)||e.clear()},disposed:function(){var t;null==(t=this.outlineTypewriter)||t.clear(),null==this.clearTimer||this.clearTimer.call(this),this.data.get("outlineQid")===on.getState("workspaceData.wenku.outlineQid")&&on.dispatch("update",{showWorkspaceType:""})},checkEmptyTitleAction:function(){var t=this.data.get("nodes"),n=gb(t),a=n.hasEmptyTitle,i=n.toast,o=n.editId;return a&&(e.Toast.info({message:i}),this.manageFocus(o,"edit")),a},handleSelectTemplateButtonClick:function(){return Sb((function(){var t,e;return Tb(this,(function(n){switch(n.label){case 0:return t=this,this.data.get("selectTemplateButtonLoading")?[2]:(this.sendLog({value:"choose_ppt",type:"click"}),this.checkEmptyTitleAction()?[2]:(this.data.set("selectTemplateButtonLoading",!0),[4,this.getThemesList().finally((function(){t.data.set("selectTemplateButtonLoading",!1)}))]));case 1:return(e=n.sent())?(this.scrollToQueue(),on.dispatch("update",{showWorkspaceType:"wenku",workspaceData:{wenku:{outlineLid:this.data.get("outlineLid"),outlineQid:this.data.get("outlineQid")}}}),Ys().emit({type:"template",data:{outlineLid:this.data.get("outlineLid"),outlineQid:this.data.get("outlineQid"),themeId:e.themeId,templateList:e.list}}),[2]):[2]}}))})).apply(this)},scrollToQueue:function(){var t=In(this.el,"cs-rank-container");if(t){var e=t.querySelector(".cs-rank");e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},getThemesList:function(){return Sb((function(){var t,e,n;return Tb(this,(function(a){switch(a.label){case 0:return t=this,this.data.get("tplInfo.query"),e=this.data.get("outlineLid"),n=this.data.get("outlineQid"),[4,new Promise((function(e){t.data.get("editOutlineLoading")?t.data.push("editOutlineActionQueue",e):e({})}))];case 1:return a.sent(),[4,ab({outlineLid:e,outlineQid:n})];case 2:return[2,a.sent()]}}))})).apply(this)},editOutline:function(t){var e=t.type,n=t.level;return Sb((function(){var t,a,i,o,r,s;return Tb(this,(function(l){return t=this,["paste","input"].includes(e)&&this.sendLog({value:"ppt_"+this.getLevelString(n)+"_edit",type:"click"}),a=this.data.get("outlineLid"),i=this.data.get("outlineQid"),o=this.getResult("json"),r=Mr(),s=on.getState("chatParams").sse_host+"/aichat/api/ppt/outlineupdate?tk="+sc()+"&outlineLid="+a+"&outlineQid="+i+"&knowledgeId="+r,this.data.set("editOutlineLoading",!0),[2,fetch(s,{method:"post",credentials:"include",body:JSON.stringify({bdjson:o,title:this.getTitle()})}).then((function(t){return t.json()})).then((function(t){return 0===t.status?Promise.resolve(t.data):Promise.reject()})).finally((function(){t.data.set("editOutlineLoading",!1),t.handleEditOutlineQueue()}))]}))})).apply(this)},handleEditOutlineQueue:function(){var t=this.data.get("editOutlineActionQueue");this.data.set("editOutlineActionQueue",[]);for(var e,n=Ib(t);!(e=n()).done;){var a=e.value;null==a||a()}},getLevelString:function(t){return 1===t?"1st":"2nd"},sendLog:function(t){var e=t.value;Ua({page:"resultpage",type:t.type,value:e,ext:{enter_type:on.getState("pcEnterType"),re_rank:this.data.get("rank"),setype:"csaitab",a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),lid:on.getState("lid")}})}})),Lb={};Lb= __call$(Object,"assign",[Lb,{outlineContainer:"outline-container_pfi3d_1","outline-container":"outline-container_pfi3d_1",outlineDisable:"outline-disable_pfi3d_4","outline-disable":"outline-disable_pfi3d_4",finishedText:"finished-text_pfi3d_7","finished-text":"finished-text_pfi3d_7",chapterWrapper:"chapter-wrapper_pfi3d_12","chapter-wrapper":"chapter-wrapper_pfi3d_12",outlineDisableMask:"outline-disable-mask_pfi3d_38","outline-disable-mask":"outline-disable-mask_pfi3d_38",contentBoxWrap:"content-box-wrap_pfi3d_47","content-box-wrap":"content-box-wrap_pfi3d_47",outlineBottomButtonContainer:"outline-bottom-button-container_pfi3d_51","outline-bottom-button-container":"outline-bottom-button-container_pfi3d_51",outlineBtnWrapper:"outline-btn-wrapper_pfi3d_54","outline-btn-wrapper":"outline-btn-wrapper_pfi3d_54",editText:"edit-text_pfi3d_60","edit-text":"edit-text_pfi3d_60",outlineActionButton:"outline-action-button_pfi3d_65","outline-action-button":"outline-action-button_pfi3d_65",outlineActionButtonLogo:"outline-action-button-logo_pfi3d_83","outline-action-button-logo":"outline-action-button-logo_pfi3d_83"}]) ,Cb.template='\n    <div\n        id="outline-editor{{outlineQid}}"\n        s-ref="wrapper"\n        class="{{$style[\'outline-container\']}}"\n        disabled-copy\n        data-copy="{{copyText}}"\n        has-empty-title="{{hasEmptyTitle}}"\n    >\n        <div\n            s-if="canEdit"\n            class="{{$style[\'finished-text\']}}"\n        >\n            已为您生成可自由编辑的大纲。确认无误后，点击下方「选择模板」按钮，即可进入PPT模板选择页面。\n        </div>\n        <div\n            s-else\n            class="{{$style[\'outline-disable-mask\']}}"\n            on-click="outlineClickHandle"\n        ></div>\n        <div\n            s-ref="wrapperInner"\n            class="{{$style[\'content-box-wrap\']}}"\n        >\n            <div\n                s-for="item, i in nodes"\n                class="{{$style[\'chapter-wrapper\']}}"\n            >\n                <content-box\n                    data="{=item.data=}"\n                    level="{{1}}"\n                    tag="{{i === 0 ? \'主标题：\' : \'第\' + i + \'章：\'}}"\n                    edit-id="{{editNodeId}}"\n                    is-title="{{i === 0}}"\n                    index="{{i}}"\n                    disable="{{globalDisable}}"\n                    type="{{outlineType}}"\n                    can-edit="{{canEdit}}"\n                    is-last="{{i === nodes.length - 1 && !item.children.length}}"\n                    is-has-child="{{!!item.children.length}}"\n                    on-add-node="addNode"\n                    on-delete-node="deleteNode"\n                    on-move-down-level="moveDownLevel"\n                    on-enter-edit="enterEdit"\n                    on-real-edited="realEditedHandle"\n                    on-textarea-blur="textareaBlurHandle"\n                />\n\n                <template s-for="child, j in item.children">\n                    <content-box\n                        data="{=child.data=}"\n                        level="{{2}}"\n                        tag="{{i + \'.\' + (j + 1)}}"\n                        edit-id="{{editNodeId}}"\n                        disable="{{globalDisable}}"\n                        type="{{outlineType}}"\n                        can-edit="{{canEdit}}"\n                        is-last="{{i === nodes.length - 1 && j === item.children.length - 1}}"\n                        on-add-node="addNode"\n                        on-delete-node="deleteNode"\n                        on-move-up-level="moveUpLevel"\n                        on-move-down-level="moveDownLevel"\n                        on-enter-edit="enterEdit"\n                        on-real-edited="realEditedHandle"\n                        on-textarea-blur="textareaBlurHandle"\n                    />\n                </template>\n            </div>\n        </div>\n\n        \x3c!-- 底部按钮 --\x3e\n        <div\n            s-if="!isStop"\n            class="{{$style[\'outline-bottom-button-container\']}}"\n        >\n            <div\n                s-if="isLoading"\n                class="{{$style[\'outline-loading\']}}"\n            >\n                <chat-loading\n                    sse-status="1"\n                    appearance="steps"\n                />\n            </div>\n            <div\n                s-else\n                class="{{$style[\'outline-btn-wrapper\']}}"\n            >\n                <div\n                    s-if="edited"\n                    class="{{$style[\'edit-text\']}}"\n                >\n                    已编辑\n                </div>\n                <div\n                    s-if="!isOpenCurWorkspace"\n                    s-ref="selectTemplateButton"\n                    class="{{$style[\'outline-action-button\']}}"\n                    on-click="handleSelectTemplateButtonClick"\n                    on-touchstart="handleSelectTemplateButtonClick"\n                >\n                    <cos-loading\n                        s-if="selectTemplateButtonLoading"\n                        position="right"\n                        appearance="reverse"\n                        text=" "\n                    />\n                    <img\n                        s-else\n                        class="{{$style[\'outline-action-button-logo\']}}"\n                        alt="ppt-logo"\n                        src="https://psstatic.cdn.bcebos.com/basics/chat/btn-ppt-logo_1742195947000.svg"\n                    />\n                    选择模板\n                </div>\n            </div>\n        </div>\n    </div>\n';var Db="function"==typeof Cb?Cb.prototype.initData||Pb:Cb.initData||Pb;function Pb(){return{$style:Lb}}function Eb(){return  __call$(Object,"assign",[{},Db.call(this),{$style:Lb}]) }function Ab(){return Ab=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Ab.apply(this,Array.from(arguments))}"function"==typeof Cb?Cb.prototype.initData=Eb:Cb.initData=Eb;var Ob=function(){function t(t){this.options={maxRetries:void 0!==t.maxRetries?t.maxRetries:3,retryDelay:void 0!==t.retryDelay?t.retryDelay:1e3,timeout:void 0!==t.timeout?t.timeout:1e4,onSuccess:"function"==typeof t.onSuccess?t.onSuccess:null,onError:"function"==typeof t.onError?t.onError:null},this.loadedResources={js:{},css:{}}}var e=t.prototype;return e.loadMicroApp=function(t,e){var n=this;void 0===e&&(e={});var a=Ab({},this.options,e),i=t.js,o=void 0===i?[]:i,r=t.css,s=void 0===r?[]:r,l=o.every((function(t){return  __get$(n.loadedResources.js,t) })),c=s.every((function(t){return  __get$(n.loadedResources.css,t) }));if(l&&c)return"function"==typeof a.onSuccess&&a.onSuccess(),Promise.resolve({success:!0,alreadyLoaded:!0});var d=o.filter((function(t){return! __get$(n.loadedResources.js,t) })),u=s.filter((function(t){return! __get$(n.loadedResources.css,t) }));return new Promise((function(t,e){n._loadCssResources(u,a).then((function(){return n._loadJsResources(d,a)})).then((function(){"function"==typeof a.onSuccess&&a.onSuccess(),t({success:!0})})).catch((function(t){"function"==typeof a.onError&&a.onError(t),e(t)}))}))},e.unloadMicroApp=function(t){var e=this,n=t.js,a=void 0===n?[]:n,i=t.css;return(void 0===i?[]:i).forEach((function(t){if( __get$(e.loadedResources.css,t) ){var n=document.querySelectorAll('link[href="'+t+'"]');Array.from(n).forEach((function(t){t.parentNode&&t.parentNode.removeChild(t)})),delete e.loadedResources.css[t]}})),a.forEach((function(t){if( __get$(e.loadedResources.js,t) ){var n=document.querySelectorAll('script[src="'+t+'"]');Array.from(n).forEach((function(t){t.parentNode&&t.parentNode.removeChild(t)})),delete e.loadedResources.js[t]}})),{success:!0}},e._loadCssResources=function(t,e){var n=this;if(!t||0===t.length)return Promise.resolve();var a=t.map((function(t){return  __get$(n.loadedResources.css,t) ?Promise.resolve():n._loadResourceWithRetry((function(){return n._loadCss(t,e)}),e.maxRetries,e.retryDelay).then((function(){ __set$(n.loadedResources.css,t,!0) }))}));return Promise.all(a)},e._loadJsResources=function(t,e){var n=this;return t&&0!==t.length?t.reduce((function(t,a){return t.then((function(){return  __get$(n.loadedResources.js,a) ?Promise.resolve():n._loadResourceWithRetry((function(){return n._loadJs(a,e)}),e.maxRetries,e.retryDelay).then((function(){ __set$(n.loadedResources.js,a,!0) }))}))}),Promise.resolve()):Promise.resolve()},e._loadResourceWithRetry=function(t,e,n){var a=this;return new Promise((function(i,o){t().then(i).catch((function(r){if(e<=0)return o(r);console.warn("资源加载失败，"+n+"ms 后重试，剩余重试次数: "+e,r),setTimeout((function(){a._loadResourceWithRetry(t,e-1,n).then(i).catch(o)}),n)}))}))},e._loadCss=function(t,e){var n=this;return  new Promise(function(a,i){if(document.querySelectorAll('link[href="'+t+'"]').length>0)return __set$(n.loadedResources.css,t,!0),a();var o=document.createElement("link"),r=!1,s=null;e.timeout&&(s=setTimeout(function(){r=!0,i(new Error("加载 CSS 超时: "+t));},e.timeout)),o.rel="stylesheet",o.type="text/css",__set$(o,"href",t),o.onload=function(){r||(clearTimeout(s),a());},o.onerror=function(){r||(clearTimeout(s),i(new Error("加载 CSS 失败: "+t)));},document.head.appendChild(o);}) },e._loadJs=function(t,e){var n=this;return  new Promise(function(a,i){if(document.querySelectorAll('script[src="'+t+'"]').length>0)return __set$(n.loadedResources.js,t,!0),a();var o=document.createElement("script"),r=!1,s=null;e.timeout&&(s=setTimeout(function(){r=!0,i(new Error("加载 JS 超时: "+t));},e.timeout)),o.type="text/javascript",o.src=t,o.async=!1,o.onload=function(){r||(clearTimeout(s),a());},o.onerror=function(){r||(clearTimeout(s),i(new Error("加载 JS 失败: "+t)));},document.head.appendChild(o);}) },e.isLoaded=function(t){var e=this,n=t.js,a=void 0===n?[]:n,i=t.css,o=void 0===i?[]:i,r=a.every((function(t){return  __get$(e.loadedResources.js,t) })),s=o.every((function(t){return  __get$(e.loadedResources.css,t) }));return r&&s},e.getLoadedResources=function(){return{js:Object.keys(this.loadedResources.js),css:Object.keys(this.loadedResources.css)}},e.clearAllResources=function(){return Object.keys(this.loadedResources.css).forEach((function(t){var e=document.querySelectorAll('link[href="'+t+'"]');Array.from(e).forEach((function(t){t.parentNode&&t.parentNode.removeChild(t)}))})),this.loadedResources.css={},Object.keys(this.loadedResources.js).forEach((function(t){var e=document.querySelectorAll('script[src="'+t+'"]');Array.from(e).forEach((function(t){t.parentNode&&t.parentNode.removeChild(t)}))})),this.loadedResources.js={},{success:!0}},t}();function Rb(t){return"https://wenku.baidu.com/view/"+t+".html?fr=AI_search_AIPPT"}function Nb(t,e){return"ppt-preview-root__"+t+"__"+e}function Mb(t,e){return t+"_"+e}function qb(t){var e="#"+t+" #mobile-thumbnails";return document.querySelector(e)}var jb,Bb=(jb=null,function(){return jb||(jb=new Ob({maxRetries:3,retryDelay:1500,timeout:15e3,onSuccess:function(){},onError:function(t){return console.error("模块加载失败:",t)}})),jb});function Hb(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function $b(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Hb(o,a,i,r,s,"next",t)}function s(t){Hb(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Fb(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Ub=a.defineComponent({components:{"cos-icon":e.Icon},computed:{},initData:function(){return{docQid:"",docLid:"",docId:"",title:"",pptViewerId:"",isDownload:!1}},attached:function(){var t=this;Zs().on((function(e){e.pptUniqId===t.data.get("pptViewerId")&&t.handleDownload()}))},handleDownload:function(){return $b((function(){var t;return Fb(this,(function(n){var a,i,o,r,s,l;return t=this,e.Toast.show({message:"正在下载中...",duration:3e3}),(a={docQid:this.data.get("docQid"),docLid:this.data.get("docLid"),docId:this.data.get("docId"),title:this.data.get("title")},i=a.docQid,o=a.docLid,r=a.docId,s=a.title,l=Mr(),Li(on.getState("chatParams").sse_host+"/aichat/api/ppt/download?docQid="+i+"&tk="+sc()+"&docLid="+o+"&docId="+r+"&title="+s+"&knowledgeId="+l,{credentials:"include"},5e3).then((function(t){return 1003===t.status?Promise.reject(new Error("无数据返回")):0===t.status&&t.data?Promise.resolve(t.data):Promise.reject(new Error("无数据返回"))})).catch((function(t){}))).then((function(e){e.isDeleted?t.fire("ppt-file-deleted"):e.isLimit&&!t.data.get("isDownload")?window.open("https://wenku.baidu.com/ndbusiness/browse/wenkuvipcashier?third_fr=search_ppt&cashier_code=P*search_ppt-L*ppt_download"):(window.open(e.url),Ys().emit({type:"updateUserInfo",data:{}}),t.data.set("isDownload",!0))})),[2]}))})).apply(this)},handlePreview:function(){this.fire("handle-preview")},handleEdit:function(){return $b((function(){return Fb(this,(function(t){switch(t.label){case 0:return[4,(e={docQid:this.data.get("docQid"),docLid:this.data.get("docLid"),docId:this.data.get("docId")},n=e.docQid,a=e.docLid,i=e.docId,o=Mr(),Li(on.getState("chatParams").sse_host+"/aichat/api/ppt/status?tk="+sc()+"&docQid="+n+"&docLid="+a+"&docId="+i+"&knowledgeId="+o,{credentials:"include"},3e3).then((function(t){return 1003===t.status?Promise.reject(new Error("无数据返回")):0===t.status&&t.data?Promise.resolve(t.data):Promise.reject(new Error("无数据返回"))})).catch((function(t){})))];case 1:return t.sent().isDeleted?this.fire("ppt-file-deleted"):window.open(Rb(this.data.get("docId"))),[2]}var e,n,a,i,o}))})).apply(this)},getLogInfo:function(t){return JSON.stringify({type:"click",value:t,page:"resultpage",ubcExt:{enter_type:"home_tab",setype:"csaitab"}})}}),Gb={};Gb= __call$(Object,"assign",[Gb,{pptViewerPptMenuWrapper:"ppt-viewer-ppt-menu-wrapper_ahj5n_1","ppt-viewer-ppt-menu-wrapper":"ppt-viewer-ppt-menu-wrapper_ahj5n_1",pptViewerPptMenu:"ppt-viewer-ppt-menu_ahj5n_1","ppt-viewer-ppt-menu":"ppt-viewer-ppt-menu_ahj5n_1",pptViewerPptMenuItem:"ppt-viewer-ppt-menu-item_ahj5n_18","ppt-viewer-ppt-menu-item":"ppt-viewer-ppt-menu-item_ahj5n_18",pptViewerPptMenuItemIcon:"ppt-viewer-ppt-menu-item-icon_ahj5n_25","ppt-viewer-ppt-menu-item-icon":"ppt-viewer-ppt-menu-item-icon_ahj5n_25",pptViewerPptMenuItemText:"ppt-viewer-ppt-menu-item-text_ahj5n_29","ppt-viewer-ppt-menu-item-text":"ppt-viewer-ppt-menu-item-text_ahj5n_29"}]) ,Ub.template='\n    <div class="{{$style[\'ppt-viewer-ppt-menu-wrapper\']}} ppt-viewer-ppt-menu-hover">\n        <div\n            class="{{$style[\'ppt-viewer-ppt-menu\']}}"\n            need-click-log\n        >\n            <div\n                class="{{$style[\'ppt-viewer-ppt-menu-item\']}}"\n                on-click="handleDownload"\n                on-touchstart="handleDownload"\n                data-click-log="{{getLogInfo(\'ppt_file_download\')}}"\n            >\n                <cos-icon\n                    name="download"\n                    class="{{$style[\'ppt-viewer-ppt-menu-item-icon\']}}"\n                />\n                <span class="{{$style[\'ppt-viewer-ppt-menu-item-text\']}}">下载</span>\n            </div>\n            <div\n                class="{{$style[\'ppt-viewer-ppt-menu-item\']}}"\n                on-click="handlePreview"\n                on-touchstart="handlePreview"\n                data-click-log="{{getLogInfo(\'ppt_file_preview\')}}"\n            >\n                <cos-icon\n                    name="eye"\n                    class="{{$style[\'ppt-viewer-ppt-menu-item-icon\']}}"\n                />\n                <span class="{{$style[\'ppt-viewer-ppt-menu-item-text\']}}">预览</span>\n            </div>\n            <div\n                class="{{$style[\'ppt-viewer-ppt-menu-item\']}}"\n                on-click="handleEdit"\n                on-touchstart="handleEdit"\n                data-click-log="{{getLogInfo(\'ppt_file_edit\')}}"\n            >\n                <cos-icon\n                    name="input"\n                    class="{{$style[\'ppt-viewer-ppt-menu-item-icon\']}}"\n                />\n                <span class="{{$style[\'ppt-viewer-ppt-menu-item-text\']}}">编辑</span>\n            </div>\n        </div>\n    </div>\n';var Wb="function"==typeof Ub?Ub.prototype.initData||zb:Ub.initData||zb;function zb(){return{$style:Gb}}function Qb(){return  __call$(Object,"assign",[{},Wb.call(this),{$style:Gb}]) }"function"==typeof Ub?Ub.prototype.initData=Qb:Ub.initData=Qb;var Jb="loading",Vb="success",Kb="fail",Xb="fail",Yb="delete";function Zb(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function t_(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Zb(o,a,i,r,s,"next",t)}function s(t){Zb(o,a,i,r,s,"throw",t)}r(void 0)}))}}function e_(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var n_=Tt.connect(on,{workspaceData:"workspaceData"})(a.defineComponent({components:{"cos-icon":e.Icon,"ppt-menu":Ub,"cos-loading":e.Loading},computed:{pptSuccessWidth:function(){return this.data.get("hasPPTImg")?"width: 270px;":"width: 220px;"},ubcPPTClickLog:function(){return JSON.stringify({type:"click",value:"ppt_cover",page:"resultpage",ubcExt:{enter_type:"home_tab",setype:"csaitab"}})},pptHeaderText:function(){var t=this.data.get("pptStatus"),e=this.data.get("errType");return t===Kb&&e===Xb?"":"基于上述大纲和模版即将为你生成PPT:"}},initData:function(){return{hasPPTImg:!0,pptStatus:Jb,errType:"",coverImg:"",pptTitle:"",bdjson:[],docId:"",docLid:"",docQid:"",qid:"",sessionId:"",value:{},rrToken:"",outlineLid:"",outlineQid:"",pptViewerId:"",wenkuQid:"",sseStop:!1,isDownload:!1,isHistory:!1}},attached:function(){var t=this;this.data.set("pptViewerId",Math.random().toString(36).substring(2,10));var e=this.data.get("value");e.status?this.appendContent(e,!0):(Fn().on((function(e){e.rank===t.data.get("rank")&&t.data.set("pptStatus",Vb)})),this.appendContent(e),on.dispatch("update",{workspaceData:{wenku:{pptId:this.data.get("pptViewerId")}}})),el().on((function(e){t.data.get("sseStop")&&t.data.get("wenkuQid")===e.value.wenkuQid&&t.appendContent(e.value)})),nl().on((function(e){e.rank===t.data.get("rank")&&t.stop("hint")}))},appendContent:function(t,e){if(void 0===e&&(e=!1),this.data.set("value",t),t.status) __call$(this.data,"assign",[{docId:t.docid,docLid:t.docLid,docQid:t.docQid,pptTitle:t.title,coverImg:t.coverImg,hasPPTImg:e&&t.coverImg,qid:t.qid,outlineLid:t.outlineLid,outlineQid:t.outlineQid,styleId:t.styleId,tplId:t.tplId,themeId:t.themeId,wenkuQid:t.wenkuQid,isHistory:e}]) ,e? __call$(this.data,"assign",[{isDownload:t.isDownload,pptStatus:t.isDeleted?Kb:Vb,errType:t.isDeleted?Yb:""}]) :(t.rrToken&&this.data.set("rrToken",t.rrToken),Ys().emit({type:"ppt",pptUniqId:this.data.get("pptViewerId"),data:{bdjson:this.data.get("bdjson"),renderType:"sse",docId:t.docid,endTurn:!0}}));else{var n,a=t.bdjson;this.data.push("bdjson",a?null==(n=JSON.parse(a))?void 0:n[0]:{}), __call$(this.data,"assign",[{outlineLid:t.outlineLid,outlineQid:t.outlineQid,wenkuQid:t.wenkuQid}]) ,this.data.get("workspaceData.wenku.pptId")===this.data.get("pptViewerId")&&Ys().emit({type:"ppt",pptUniqId:this.data.get("pptViewerId"),data:{bdjson:this.data.get("bdjson"),renderType:"sse"}})}this.fire("render-finished")},stop:function(t){var e=this;this.data.set("sseStop",!0),"hint"===t&&(this.data.set("pptStatus",Kb),this.data.set("errType",Xb),this.nextTick((function(){e.handleErrClick()})))},handlePPTFileDeleted:function(){this.data.set("pptStatus",Kb),this.data.set("errType",Yb),e.Toast.show({message:"该文件已在百度文库删除，选择模板可重新生成",duration:2e3})},handleLoadingClick:function(){on.dispatch("update",{showWorkspaceType:"wenku",workspaceData:{wenku:{pptId:this.data.get("pptViewerId")}}}),Ys().emit({type:"ppt-active"})},handleErrClick:function(){this.handleTemplateData()},handleSuccessClick:function(){return t_((function(){var t,e;return e_(this,(function(n){switch(n.label){case 0:return on.dispatch("update",{showWorkspaceType:"wenku",workspaceData:{wenku:{pptId:this.data.get("pptViewerId")}}}),Ys().emit({type:"ppt-active"}),(t=this.data.get("isHistory"))||this.handleDataPreview(),[4,(a={docQid:this.data.get("docQid"),docLid:this.data.get("docLid"),docId:this.data.get("docId")},i=a.docId,o=a.docQid,r=a.docLid,s=Mr(),Li(on.getState("chatParams").sse_host+"/aichat/api/ppt/preview?tk="+sc()+"&docId="+i+"&docQid="+o+"&docLid="+r+"&knowledgeId="+s,{credentials:"include"},5e3).then((function(t){return 1003===t.status?Promise.reject(new Error("无数据返回")):0===t.status&&t.data?Promise.resolve(t.data):Promise.reject(new Error("无数据返回"))})).catch((function(t){})))];case 1:return(e=n.sent())?(e.isDeleted?(on.dispatch("update",{showWorkspaceType:""}),this.handlePPTFileDeleted(),this.handleTemplateData()):(this.data.set("bdjson",e.slide),t&&this.handleDataPreview()),[2]):[2]}var a,i,o,r,s}))})).apply(this)},handleDataPreview:function(){Ys().emit({type:"ppt",pptUniqId:this.data.get("pptViewerId"),data:{bdjson:this.data.get("bdjson"),renderType:"static",docId:this.data.get("docId"),isDownload:this.data.get("isDownload")}})},handleTemplateData:function(){return t_((function(){var t,e,n;return e_(this,(function(a){switch(a.label){case 0:return this.data.get("tplInfo.query"),t=this.data.get("outlineQid"),[4,ab({outlineLid:e=this.data.get("outlineLid"),outlineQid:t})];case 1:return(n=a.sent())?(on.dispatch("update",{showWorkspaceType:"wenku"}),Ys().emit({type:"template",data:{outlineLid:e,outlineQid:t,themeId:n.themeId,templateList:n.list}}),[2]):[2]}}))})).apply(this)},disposed:function(){this.data.get("pptViewerId")===on.getState("workspaceData.wenku.pptId")&&on.dispatch("update",{showWorkspaceType:""})}})),a_={};a_= __call$(Object,"assign",[a_,{pptViewerWrapper:"ppt-viewer-wrapper_1w1uz_1","ppt-viewer-wrapper":"ppt-viewer-wrapper_1w1uz_1",pptViewerGuideTitle:"ppt-viewer-guide-title_1w1uz_5","ppt-viewer-guide-title":"ppt-viewer-guide-title_1w1uz_5",pptViewerLoading:"ppt-viewer-loading_1w1uz_11","ppt-viewer-loading":"ppt-viewer-loading_1w1uz_11",pptViewerLoadingImgContainer:"ppt-viewer-loading-img-container_1w1uz_22","ppt-viewer-loading-img-container":"ppt-viewer-loading-img-container_1w1uz_22",pptViewerLoadingImg:"ppt-viewer-loading-img_1w1uz_22","ppt-viewer-loading-img":"ppt-viewer-loading-img_1w1uz_22",csLoading:"cs-loading_1w1uz_34","cs-loading":"cs-loading_1w1uz_34",pptViewerLoadingContent:"ppt-viewer-loading-content_1w1uz_43","ppt-viewer-loading-content":"ppt-viewer-loading-content_1w1uz_43",pptViewerLoadingContentDesc:"ppt-viewer-loading-content-desc_1w1uz_49","ppt-viewer-loading-content-desc":"ppt-viewer-loading-content-desc_1w1uz_49",pptViewerSuccessContent:"ppt-viewer-success-content_1w1uz_54","ppt-viewer-success-content":"ppt-viewer-success-content_1w1uz_54",pptViewerNoImg:"ppt-viewer-no-img_1w1uz_61","ppt-viewer-no-img":"ppt-viewer-no-img_1w1uz_61",pptViewerPptImg:"ppt-viewer-ppt-img_1w1uz_76","ppt-viewer-ppt-img":"ppt-viewer-ppt-img_1w1uz_76",pptViewerPptContent:"ppt-viewer-ppt-content_1w1uz_80","ppt-viewer-ppt-content":"ppt-viewer-ppt-content_1w1uz_80",pptViewerPptTitle:"ppt-viewer-ppt-title_1w1uz_83","ppt-viewer-ppt-title":"ppt-viewer-ppt-title_1w1uz_83",pptViewerPptDesc:"ppt-viewer-ppt-desc_1w1uz_93","ppt-viewer-ppt-desc":"ppt-viewer-ppt-desc_1w1uz_93",pptViewerHasImg:"ppt-viewer-has-img_1w1uz_99","ppt-viewer-has-img":"ppt-viewer-has-img_1w1uz_99",pptViewerHasImgContent:"ppt-viewer-has-img-content_1w1uz_108","ppt-viewer-has-img-content":"ppt-viewer-has-img-content_1w1uz_108",pptViewerHasImgContentTitle:"ppt-viewer-has-img-content-title_1w1uz_117","ppt-viewer-has-img-content-title":"ppt-viewer-has-img-content-title_1w1uz_117",pptViewerHasImgContentImg:"ppt-viewer-has-img-content-img_1w1uz_123","ppt-viewer-has-img-content-img":"ppt-viewer-has-img-content-img_1w1uz_123",pptViewerPptImgContainer:"ppt-viewer-ppt-img-container_1w1uz_127","ppt-viewer-ppt-img-container":"ppt-viewer-ppt-img-container_1w1uz_127",pptViewerErrWrapper:"ppt-viewer-err-wrapper_1w1uz_147","ppt-viewer-err-wrapper":"ppt-viewer-err-wrapper_1w1uz_147",pptViewerErrContent:"ppt-viewer-err-content_1w1uz_156","ppt-viewer-err-content":"ppt-viewer-err-content_1w1uz_156",pptViewerErrContentTitle:"ppt-viewer-err-content-title_1w1uz_163","ppt-viewer-err-content-title":"ppt-viewer-err-content-title_1w1uz_163",pptViewerErrContentIcon:"ppt-viewer-err-content-icon_1w1uz_168","ppt-viewer-err-content-icon":"ppt-viewer-err-content-icon_1w1uz_168",pptViewerErrImg:"ppt-viewer-err-img_1w1uz_173","ppt-viewer-err-img":"ppt-viewer-err-img_1w1uz_173",errImg:"err-img_1w1uz_183","err-img":"err-img_1w1uz_183"}]) ,n_.template='\n    <div class="{{$style[\'ppt-viewer-wrapper\']}}" style="{{isHistory ? \'\' : \'margin-bottom: 30px;\'}}">\n        <div class="{{$style[\'ppt-viewer-guide-title\']}}"> {{ pptHeaderText }} </div>\n        <div\n            s-if="{{pptStatus === \'loading\'}}"\n            class="{{$style[\'ppt-viewer-loading\']}}"\n            on-click="handleLoadingClick"\n            on-touchstart="handleLoadingClick"\n        >\n            <div class="{{$style[\'ppt-viewer-loading-img-container\']}}">\n                <cos-loading\n                    text=""\n                    class="{{$style[\'cs-loading\']}}"\n                />\n                <img\n                    class="{{$style[\'ppt-viewer-loading-img\']}}"\n                    src="https://psstatic.cdn.bcebos.com/basics/aichat/empty-file_1741832059000.png"\n                    alt=""\n                />\n            </div>\n            <div class="{{$style[\'ppt-viewer-loading-content\']}}">\n                <div class="{{$style[\'ppt-viewer-loading-content-desc\']}}">正在生成中...</div>\n            </div>\n        </div>\n        <div\n            s-else-if="{{pptStatus === \'success\'}}"\n            class="{{$style[\'ppt-viewer-success-content\']}}"\n            style="{{pptSuccessWidth}}"\n        >\n            <div\n                s-if="{{hasPPTImg}}"\n                class="{{$style[\'ppt-viewer-has-img\']}}"\n                on-click="handleSuccessClick"\n                on-touchstart="handleSuccessClick"\n                data-click-log="{{ubcPPTClickLog}}"\n                need-click-log\n            >\n                <div class="{{$style[\'ppt-viewer-has-img-content\']}}">\n                    <img\n                        class="{{$style[\'ppt-viewer-has-img-content-img\']}}"\n                        src="https://psstatic.cdn.bcebos.com/basics/aichat/image_1741847966000.png"\n                        alt=""\n                    />\n                    <span class="{{$style[\'ppt-viewer-has-img-content-title\']}}">{{ pptTitle }}</span>\n                </div>\n                <div class="{{$style[\'ppt-viewer-ppt-img-container\']}}">\n                    <img\n                        class="{{$style[\'ppt-viewer-ppt-img\']}}"\n                        src="{{coverImg}}"\n                        alt=""\n                    />\n                </div>\n            </div>\n            <div\n                s-else\n                class="{{$style[\'ppt-viewer-no-img\']}}"\n                on-click="handleSuccessClick"\n                on-touchstart="handleSuccessClick"\n                data-click-log="{{ubcPPTClickLog}}"\n                need-click-log\n            >\n                <img\n                    class="{{$style[\'ppt-viewer-ppt-img\']}}"\n                    src="https://psstatic.cdn.bcebos.com/basics/aichat/ppt-file_1741832038000.png"\n                    alt=""\n                />\n                <div class="{{$style[\'ppt-viewer-ppt-content\']}}">\n                    <div class="{{$style[\'ppt-viewer-ppt-title\']}}">\n                        {{ pptTitle }}\n                    </div>\n                    <div class="{{$style[\'ppt-viewer-ppt-desc\']}}"> PPT已完成 </div>\n                </div>\n            </div>\n            <ppt-menu\n                on-handle-preview="handleSuccessClick"\n                on-ppt-file-deleted="handlePPTFileDeleted"\n                doc-id="{{docId}}"\n                doc-Qid="{{docQid}}"\n                doc-Lid="{{docLid}}"\n                title="{{pptTitle}}"\n                ppt-viewer-id="{{pptViewerId}}"\n                is-download="{=isDownload=}"\n            />\n        </div>\n        <div\n            s-else-if="{{pptStatus === \'fail\'}}"\n            class="{{$style[\'ppt-viewer-err-wrapper\']}}"\n            on-click="handleErrClick"\n            on-touchstart="handleErrClick"\n        >\n            <div class="{{$style[\'ppt-viewer-err-content\']}}">\n                <cos-icon\n                    name="info-circle-fill"\n                    class="{{$style[\'ppt-viewer-err-content-icon\']}}"\n                />\n                <span\n                    class="{{$style[\'ppt-viewer-err-content-title\']}}"\n                    s-if="{{errType === \'delete\'}}"\n                >\n                    PPT已删除，点击重新生成\n                </span>\n                <span\n                    class="{{$style[\'ppt-viewer-err-content-title\']}}"\n                    s-else\n                >\n                    PPT生成失败，点击重新生成\n                </span>\n            </div>\n            <div class="{{$style[\'ppt-viewer-err-img\']}}">\n                <img\n                    class="{{$style[\'err-img\']}}"\n                    src="https://psstatic.cdn.bcebos.com/basics/aichat/empty_img_1741865189000.png"\n                    alt=""\n                />\n            </div>\n        </div>\n    </div>\n';var i_="function"==typeof n_?n_.prototype.initData||o_:n_.initData||o_;function o_(){return{$style:a_}}function r_(){return  __call$(Object,"assign",[{},i_.call(this),{$style:a_}]) }"function"==typeof n_?n_.prototype.initData=r_:n_.initData=r_;var s_=function(){function t(t,e){this.resources=t,this.options=e}var e=t.prototype;return e.load=function(){var t=this;return Promise.resolve().then((function(){return t.loadCss()})).then((function(){return t.loadHtml()})).then((function(){return t.loadJs()}))},e.loadCss=function(){var t=this.resources.css;if(t){var e=document.createElement("style");e.textContent=t,this.options.container.appendChild(e)}},e.loadHtml=function(){var t=this.resources.html;if(t){var e=document.createElement("div");e.innerHTML=t,this.options.container.appendChild(e)}},e.loadJs=function(){var t=this.resources.js;if(t)try{var e=document.createElement("script");e.textContent=t,this.options.container.appendChild(e)}catch(t){console.error("Failed to execute JS:",t)}},t}();function l_(t,e){return l_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l_(t,e)}var c_=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l_(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{ad_place_list:[]}},n.attached=function(){var t=this;new s_({html:this.data.get("html"),css:this.data.get("css"),js:this.data.get("js")},{container:this.el}).load().finally((function(){t.fire("render-finished")}))},e}(a.Component);c_.trimWhitespace="all",c_.computed={html:function(){return this.data.get("ad_place_list[0].ad_place_data")},css:function(){return this.data.get("global_css_list[0]")},js:function(){return this.data.get("global_js_list[1]")}};var d_={};d_= __call$(Object,"assign",[d_,{}]) ,c_.template="\n    <div></div>\n";var u_="function"==typeof c_?c_.prototype.initData||p_:c_.initData||p_;function p_(){return{$style:d_}}function h_(){return  __call$(Object,"assign",[{},u_.call(this),{$style:d_}]) }function f_(t){var e=t.qid,n=t.lid,a=t.fileMeta,i=sc(),o=Mr(),r=on.getState("chatParams").sse_host+"/aichat/api/canvas/update?tk="+i+"&qid="+e+"&knowledgeId="+o+"&lid="+n;return new Promise((function(t,e){fetch(r,{method:"post",credentials:"include",body:JSON.stringify({fileMeta:a})}).then((function(e){t(e.json())})).catch((function(t){e(t)}))}))}function g_(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function m_(){return m_=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},m_.apply(this,Array.from(arguments))}function v_(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof c_?c_.prototype.initData=h_:c_.initData=h_;var y_=a.defineComponent({trimWhitespace:"all",components:{"chat-loading":Yw},initData:function(){return{state:"loading",isFinished:!1,value:{logId:"",type:"",description:{},time:"",files:[]}}},attached:function(){var t=this,e=this.data.get("value");this.appendContent(e,{isHistory:!!e.isFinished,openChatEditor:!e.isFinished}),Fn().on((function(e){e.rank===t.data.get("rank")&&t.handleFinished()})),ll().on((function(e){if(e.id===t.data.get("value.id")){var n=t.data.get("value.files");t.data.set("value.files",n.map((function(t){return m_({},t,{isUpdated:t.fileId===e.fileId})})))}}))},computed:{leftImgSrc:function(){return __get$({code:"https://psstatic.cdn.bcebos.com/basics/aichat/code-canvas_1744719181000.png",text:"https://psstatic.cdn.bcebos.com/basics/aichat/text-canvas_1744719187000.png"},this.data.get("value.type")) },editorValue:function(){return m_({},this.data.get("value"),{state:this.data.get("state"),cid:this.data.get("cid")})},allFilesFinished:function(){return this.data.get("value.files").every((function(t){return t.isFinished}))}},appendContent:function(t,e){if(this.fire("render-finished"),t){var n=t.files,a=t.updateFile,i=e||{},o=i.openChatEditor,r=void 0!==o&&o,s=i.isHistory,l=void 0!==s&&s,c=this.getFileWithContent(n,a);this.data.set("value",m_({},t,{files:c})),l?this.data.set("state","success"):(r&&c.length>0&&this.openChatEditor(c[0]),this.updateEditor())}},getFileWithContent:function(t,e){var n=this.data.get("value.files");return e?t.map((function(t){var a=t.fileId,i=a===(null==e?void 0:e.fileId),o=n.find((function(t){return t.fileId===a}));return m_({},t,{content:""+((null==o?void 0:o.content)||"")+(i?null==e?void 0:e.content:"")})})):n},onClick:function(t){var e="success"===this.data.get("state"),n=m_({},t,{openType:"hand"});e?this.fetchHistoryAndOpenChatEditor(n):this.openChatEditor(n)},fetchHistoryAndOpenChatEditor:function(t){return(e=function(){var e,n,a,i,o,r,s,l;return v_(this,(function(c){switch(c.label){case 0:return e=this,[4,(d={fileId:t.fileId,lid:on.getState("oriLid"),qid:this.data.get("value.logId")},u=d.fileId,p=d.lid,h=d.qid,f=sc(),g=Mr(),Li(on.getState("chatParams").sse_host+"/aichat/api/canvas/search?tk="+f+"&lid="+p+"&qid="+h+"&knowledgeId="+g+"&fileId="+u,{credentials:"include"},2e3).then((function(t){return 1003===t.status?Promise.reject(new Error("")):0===t.status&&t.data?Promise.resolve(t.data):Promise.reject(new Error(""))})).catch((function(t){})))];case 1:return(n=c.sent())?(a=n.time,i=n.fileMeta,o=n.isUpdated,r=this.data.get("value"),s=r.files,this.data.set("value",m_({},r,{files:s.map((function(t){return m_({},t,i.fileId===t.fileId?m_({content:i.content},o?{updateTime:a}:{}):{})}))})),l=s.find((function(t){return t.fileId===i.fileId})),l&&this.nextTick((function(){return e.openChatEditor(m_({},l,{openType:"hand"}))})),[2]):[2]}var d,u,p,h,f,g}))},function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){g_(o,a,i,r,s,"next",t)}function s(t){g_(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var e},openChatEditor:function(t){var e=this,n="editor"===on.getState("showWorkspaceType");n||on.dispatch("update",{showWorkspaceType:"editor"}),this.nextTick((function(){var a=e.data.get("editorValue");il().emit({value:a,currentFile:m_({},t,{query:on.getState("query")}),hasDelay:!n})}))},updateEditor:function(){var t=this.data.get("editorValue");al().emit(t)},handleFinished:function(){this.data.set("state","success"),this.updateEditor()},stop:function(){this.data.set("state","stop"),this.updateEditor()},getStateText:function(t,e){var n=t.isFinished,a=t.isUpdated,i=this.data.get("value.description");return a?i.update:n?i.success:"stop"===e?i.stop:"loading"===e?i.loading:""},getClickLog:function(t){var e=t.isFinished,n=this.data.get("value.type");return JSON.stringify({value:"produce_card",ubcExt:{query:on.getState("query"),status:e?"finish":"loading",card_name:"code"===n?"code":"creative"}})},getShowLog:function(t){var e=t.isFinished,n=this.data.get("value.type");return JSON.stringify({value:"produce_card",query:on.getState("query"),status:e?"finish":"loading",card_name:"code"===n?"code":"creative"})},disposed:function(){ol().emit({id:this.data.get("value.id")})}}),w_={};w_= __call$(Object,"assign",[w_,{workspace:"workspace_1mkt3_1",content:"content_1mkt3_5",leftImg:"leftImg_1mkt3_16",rightContent:"rightContent_1mkt3_20",rightContentTitle:"rightContentTitle_1mkt3_26",rightContentContent:"rightContentContent_1mkt3_36"}]) ,y_.template='\n    <div\n        class="{{$style.workspace}}"\n    >\n        <div class="{{$style.contentWrapper}}">\n            <template s-for="file in value.files">\n                <div\n                    data-show-area\n                    need-click-log\n                    data-show-ext="{{getShowLog(file)}}"\n                    data-click-log="{{getClickLog(file)}}"\n                    class="{{$style.content}}"\n                    on-click="onClick(file)"\n                >\n                    <img\n                        class="{{$style.leftImg}}"\n                        src="{{leftImgSrc}}"\n                    />\n                    <div class="{{$style.rightContent}}">\n                        <div class="{{$style.rightContentTitle}}">\n                            {{ file.name }}\n                        </div>\n                        <div class="{{$style.rightContentContent}}">\n                            {{ getStateText(file, state) }}\n                        </div>\n                    </div>\n                </div>\n            </template>\n        </div>\n        <div\n            s-if="state === \'loading\' && !allFilesFinished"\n            class="{{$style.loading}}"\n        >\n            <chat-loading\n                sse-status="1"\n                appearance="steps"\n            />\n        </div>\n    </div>\n';var b_="function"==typeof y_?y_.prototype.initData||__:y_.initData||__;function __(){return{$style:w_}}function k_(){return  __call$(Object,"assign",[{},b_.call(this),{$style:w_}]) }function S_(t){if(t){var e=t.closest("[data-click-log]");if(e){var n={};try{var a;n=(null==(a=JSON.parse(e.getAttribute("data-click-log")))?void 0:a.extra)||{}}catch(t){console.error(t)}return n}}}function x_(t,e){return t}function I_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function T_(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function C_(){return C_=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},C_.apply(this,Array.from(arguments))}function L_(t,e){return L_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},L_(t,e)}function D_(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return I_(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I_(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P_(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof y_?y_.prototype.initData=k_:y_.initData=k_;var E_,A_=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).listenOpenHalfScreenByUiJson=null,e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L_(t,e)}(e,t);var n=e.prototype;return n.updateData=function(t){var e=this;try{var n=this.data.get("uiInstance");if(!n)return;if(t&&t.isEmptyPack||!Object.keys(t).length)return void this.fire("render-finished");n.updateData(function(t){return x_(t)}(t),(function(){e.renderFinished()})),this.data.set("show",!0)}catch(t){console.error(t),pn(t,{group:"uijson-error"}),this.fire("render-finished")}},n.lastUiJsonDone=function(){this.data.get("uiInstance").setStatus("finished")},n.initData=function(){return{show:!1,index:-1,history:!1,uijsonHidden:!1}},n.handleUiMeta=function(){var t,e=this;return(t=function(){var t,n,a,i,o,s,l;return P_(this,(function(c){return n={type:"chat-view",platform:"pc"===rt()?"pc":"wise"},a={apis:Io(),env:n},xo(a),r.sdk.init({env:n,showProgress:!0,apis:Io()}),i=e.data.get("historyUiData"),o=!!i,i&&e.data.set("history",o),(s=x_(e.data.get("")))&&s.component?(l=r.sdk.renderMessage(e.ref("content"),{uiMeta:s,onRenderCompleted:e.renderFinished.bind(e),onAttach:e.handleHistoryData.bind(e),history:o,markdownOptions:{typingMode:"all"},disposeAfterSubmitClueForm:!0,useRichVideoPlayer:!0,renderContext:{renderContextId:e.data.get("rank"),query:null==(t=e.data.get("tplInfo"))?void 0:t.query},events:{"agent-ui-prompt":function(t){var n,a=(null==(n=t.arg)?void 0:n.data)||{},i=a.msg,o=a.extData;o&&e.dispatch("update-agent-info",o),i&&Xl({query:i})},"agent-ui-open-drawer":function(t){var n,a,i=null==t||null==(n=t.arg)?void 0:n.data,o=i.percent,r=i.title,s=i.url;e.dispatch("open-half-screen",{halfScreenPercent:o,title:r,url:s,board_from:null==t||null==(a=t.arg)?void 0:a.type})},"agent-ui-preview-image":function(t){var n,a=null==t?void 0:t.arg,i=a.data,o=a.type,r=null==i||null==(n=i.$event)?void 0:n.src;if(r){var s=function(t){if(t){var e=t.closest(".chat-search-answer-generate")||t.closest(".history-answer-box"),n=e&&e.querySelectorAll("img.agent-ui-image-item");return n&&Array.from(n).filter((function(t){return t.closest(".agent-ui-image")})).map((function(t){return t.src}))}return null}(e.el),l=Array.isArray(s)&&0!==s.length&&s||[i.$event.src];xg(l,l.indexOf(r),o||"ai_image")}},"agent-ui-log":function(t){var n=t.arg.data.$event||{},a=t.arg.type,i=t.arg.show,o=n.ext||{},r=n.cs_value||n.value,s=o.cs_action_type||o.action_type,l=o.cs_component_name||o.component_name;if("goods-card"!==a&&"site-vcard"!==a&&"more-link"!==a&&"base-clue-form"!==a&&"shop-card"!==a||"display"!==i&&"recall"!==n.type){var c;if("site-vcard"===a&&"click"===n.type)return void e.dispatch("send-log",{cyc:1,extra:C_({},o,{action_type:s,component_name:l}),target:null==(c=t.arg.data.$data)?void 0:c.target,type:"l"});if("exposure"!==i)e.dispatch("send-ubclog",{type:n.type,value:r,extra:C_({},o,{action_type:s,component_name:l})});else{var d=e.data.get("baseLogData");d||(d=S_(e.el),e.data.set("baseLogData",d));var u=[o.component_content||{}],p=o.agent_id||(null==d?void 0:d.agent_id),h=o.agent_name||(null==d?void 0:d.agent_name);Ua({type:n.type,value:r,ext:C_({},o,{action_type:s},d,{valueInfo:u,agentId:p,agentName:h,value:r,component_name:l})})}}}}}),e.data.set("uiInstance",l),[2]):(e.data.set("uijsonHidden",!0),e.fire("render-finished"),[2])}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){T_(o,a,i,r,s,"next",t)}function s(t){T_(o,a,i,r,s,"throw",t)}r(void 0)}))})()},n.handleHistoryData=function(){var t=this.data.get("historyUiData");if(Array.isArray(t))for(var e,n=D_(t);!(e=n()).done;){var a=e.value;this.updateData(a)}},n.renderFinished=function(){this.fire("render-finished")},n.attached=function(){var t=this;try{this.handleUiMeta(),this.listenOpenHalfScreenByUiJson=function(e){var n=e.rank,a=e.halfScreenData;if(n===t.data.get("rank")){var i=a.percent,o=a.title,r=a.url,s=a.type;t.dispatch("open-half-screen",{halfScreenPercent:i,title:o,url:r,board_from:s})}},xa().on(this.listenOpenHalfScreenByUiJson)}catch(t){console.error(t),pn(t,{group:"uijson-error"}),this.fire("render-finished")}},n.disposed=function(){this.listenOpenHalfScreenByUiJson&&(xa().off(this.listenOpenHalfScreenByUiJson),this.listenOpenHalfScreenByUiJson=null)},e}(a.Component);function O_(){return O_=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},O_.apply(this,Array.from(arguments))}A_.template='\n        <div\n            enableHotspot\n            on-click="handleClick"\n            data-module="ai_uijson"\n            data-show="component"\n            data-show-ext="{{realShowExt}}"\n            data-show-area\n            class="{{index === 0 && !show ? \'first-cmpt-none\' : \'\'}} {{uijsonHidden ? \'uijson-hidden\' : \'\'}}"\n        >\n            <div class="eb-plugin-ui" s-ref="content"></div>\n        </div>\n    ',A_.computed={realShowExt:function(){return JSON.stringify({component_content:{component_name:"uijson"}})}},function(t){ __set$(t,t.IDLE=0,"IDLE") , __set$(t,t.WAITING=1,"WAITING") , __set$(t,t.GENERATING=2,"GENERATING") , __set$(t,t.COMPLETE=3,"COMPLETE") , __set$(t,t.ABORT=4,"ABORT") }(E_||(E_={}));var R_={"ai-markdown":function(t,e){return O_({},e,{data:O_({},e.data,{content:t.data.content+e.data.content})})},"ai-reasoning-content":function(t,e){return O_({},e,{data:O_({},e.data,{value:t.data.value+e.data.value})})},"ai-thinking-steps":function(t,e){var n=[t.data.reasoningContentArr,e.data.reasoningContentArr],a=n[1],i=[].concat(n[0])[0]+[].concat(a)[0];return O_({},e,{data:O_({},t.data,e.data,i?{reasoningContentArr:[i]}:{})})}},N_=Object.keys(R_);function M_(t){if(t.length<=1)return t;for(var e=[t[0]],n=1;n<=t.length-1;n++){var a= __get$(t,n) ,i= __get$(e,e.length-1) ;if(N_.includes(a.component)&&i.component===a.component){var o=Array.isArray(a.data.steps)?a.data.steps:[],r=Array.isArray(i.data.steps)?i.data.steps:[];if("ai-thinking-steps"===a.component&&o.length!==r.length)e.push(a);else{var s= __get$(R_,a.component) ; __set$(e,e.length-1,s(i,a)) }}else e.push(a)}return e}function q_(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function j_(){return j_=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},j_.apply(this,Array.from(arguments))}function B_(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var H_,$_=["ai-writing"],F_=["ai-markdown","ai-markdown-editor"],U_=["ai-office-writing"],G_=["ai-copyable-text"],W_=["searchingSteps","reference","imageGroup","generalVideo","uijson","officeWriting","shortcuts","capsule","writing","ala-card","questionGuide"];!function(t){t.WORD="word",t.ALL="all"}(H_||(H_={}));var z_={"ai-markdown":e.Markdown,"ai-image":Ig,"ai-image-group":Pg,"ai-image-scroll":Mg,"ai-video-scroll":$g,"ai-general-video":yv,"ai-echart":n.AIEchart,"ai-image-with-thumbnail":n.AIImageWithThumbnail,"ai-markdown-editor":n.AIMarkdownEditor,"ai-comparison":e.Comparison,"ai-uijson":A_,"ai-exam-qa":Ay,"ai-writing":Uy,"ai-office-writing":Jy,"ai-copyable-text":e.CopyableText,"ai-reasoning-content":gm,"ai-thinking-steps":rv,"ai-chat-form":jw,"ai-bottom-tip":Uw,"ai-outline-editor":Cb,"ai-ppt-viewer":n_,"ai-progress":Sm,"ai-site-v-card":pv,"ai-biz-block":c_,"ai-editor-workspace-viewer":y_},Q_=/\^(\d+)\^/g,J_=/\^(\^|\d|\s)+\^/g,V_={play:"video_cpt_play",pause:"video_cpt_pause",muted:"video_cpt_mute",volume:"video_cpt_sound",seeked:"video_cpt_slide"},K_={play:"music_cpt_play",pause:"music_cpt_pause"},X_=null,Y_=a.defineComponent({trimWhitespace:"all",components:z_,initData:function(){return{agentInfo:null,context:void 0,id:"",renderMode:"ssr-csr",blocks:[],audios:{},hasFold:!1,maxHeight:1680,typingSpeed:30,generatingSuffix:"",completeSuffix:"",referenceBlock:void 0,referenceElement:void 0,thinkingReference:[],blocksForCsrStatic:[],status:E_.IDLE,StatusSet:E_,accBlocks:[],curBlock:void 0,askUsedModel:{},usedModel:{},queqeIndex:-1,queue:[],prevBlockRenderFinished:!0,lastBlockRender:!1,isYiyan:!1,abortType:void 0,abortMsg:"",abortMsgShow:"",abortMsgHasTopSpace:!0,isRenderFinishedDispatched:!1,hasMarkdownRenderReady:!1,answerIndex:0,cid:"",isPc:"pc"===rt(),normalizeContent:Zg,isHistory:!1}},inited:function(){var t=this.data.get("renderMode"),e=this.data.get("context");e?e.renderMode=t:e={renderMode:t},this.data.set("context",e);var n=this.data.get("blocks");n.forEach(this.formatBlock.bind(this)),this.data.set("blocks",n)},dynamicStyle:function(t,e,n){return 0===e&&0===n&&"ai-markdown"!==t.component?"clear:both;":""},dynamicClass:function(t,e,n){var a=t.component;return 0===e?["ai-markdown","ai-exam-qa","ai-image","ai-general-video","ai-image-group","ai-office-writing","ai-reasoning-content"].includes(a)||0!==n?"":"ai-uijson"===a?"cos-space-pt-sm":"cos-space-pt-md":["ai-input","ai-markdown-editor"].includes(a)?"cos-space-mt-md":"cos-space-mt-lg"},realShowExt:function(t){var e;if(!G_.includes(t.component))return"";var n=(null==(e=t.data)?void 0:e.logExtData)||{};return JSON.stringify(j_({component_content:{component_name:this.kebabToCamel(t.component)},value:"nonala_cpt"},n))},bindDataHandler:function(t){return["ai-markdown-editor","ai-image-with-thumbnail","ai-writing","ai-office-writing","ai-copyable-text"].includes(t.component)?{"data-no-na-dialog":!0}:{}},attached:function(){var t=this;if("only-csr-static"===this.data.get("renderMode")){var e,n,a=this.data.get("blocks"),i=a.find((function(t){return"ai-thinking-steps"===t.component})),o=((null==i?void 0:i.data)||{}).referenceListArr,r=void 0===o?[]:o;r.length&&(i.data.referenceList=r.flat(1));var s=(null==i||null==(n=i.data)||null==(e=n.referenceList)?void 0:e.length)?i:a.find((function(t){return"ai-reference"===t.component}));this.data.set("referenceBlock",s),this.data.set("blocksForCsrStatic",a),s&&(null==a||a.forEach((function(e){"ai-markdown"===e.component&&(e.data.referenceList=e.data.referenceList||s.data.referenceList,setTimeout(t.insertReferenceToMarkdown.bind(t,a,e.data.referenceList),1e3))}))),this.nextTick(this.deferAddImageTools.bind(this))}this.startVisibilityChangeListener()},deferAddImageTools:function(){this.data.get("isPc")?this.addImageTools():this.addWiseImageTools()},handleReady:function(t){-1===$_.indexOf(t.component)&&-1===F_.indexOf(t.component)||this.data.get("hasMarkdownRenderReady")||(this.data.set("hasMarkdownRenderReady",!0),this.fire("markdown-render-ready"))},clear:function(){this.data.set("status",E_.WAITING),this.data.set("accBlocks",[]),this.data.set("curBlock",void 0),this.data.set("queue",[]),this.data.set("prevBlockRenderFinished",!0),this.data.set("lastBlockRender",!1),this.data.set("isYiyan",!1),this.data.set("abortType",void 0),this.data.set("abortMsg",""),this.data.set("abortMsgShow",""),this.data.set("abortMsgHasTopSpace",!0),this.data.set("isRenderFinishedDispatched",!1)},stop:function(t,e){var n=this;this.data.set("status",E_.ABORT),this.data.set("abortType",t),this.data.set("abortMsg",e);var a,i,o,r,s=this.data.get("curBlock"),l=this.data.get("accBlocks"),c=l.length-1;("ai-markdown"!==(null==s?void 0:s.component)&&"ai-copyable-text"!==(null==s?void 0:s.component)&&"ai-reasoning-content"!==(null==s?void 0:s.component)&&"separate-bub"!==t||this.stopTyping(c),"ai-outline-editor"===(null==s?void 0:s.component)||"ai-editor-workspace-viewer"===(null==s?void 0:s.component))&&(null==(a=this.ref(s.component+c))||a.stop());"ai-ppt-viewer"===(null==s?void 0:s.component)&&(null==(i=this.ref(s.component+c))||i.stop(t));"ai-markdown-editor"===(null==s?void 0:s.component)&&(null==(o=this.ref(s.component+c))||o.cancelTyping());($_.includes(null==s?void 0:s.component)||U_.includes(null==s?void 0:s.component))&&(null==(r=this.ref(s.component+c))||r.stop());var d,u=l.findIndex((function(t){return"ai-thinking-steps"===t.component}));-1!==u&&(null==(d=this.ref("ai-thinking-steps"+u))||d.forceStop(t));this.nextTick((function(){n.isEmpty()?(n.data.set("abortMsgShow",n.data.get("abortMsg")),n.data.set("abortMsgHasTopSpace",!1)):"user-abort"===n.data.get("abortType")?n.data.set("abortMsgShow",""):n.data.set("abortMsgShow",n.data.get("abortMsg")),n.dispatchRenderFinished(t)})),this.lastUiJsonStop()},startWaiting:function(){this.data.set("status",E_.WAITING)},startGenerating:function(){this.data.set("status",E_.GENERATING)},pushBlock:function(t){this.data.get("status")!==E_.ABORT&&t&&(t.data||(t.data={}),t&&t.component&&!t.component.includes("markdown")&&!W_.includes(t.component)&&(!function(t){var e;un.sendExcept({group:"chat_compontent_display",info:{msg:t,query:_t(on.getState("query")),platform:rt(),agentName:(null==(e=on.getState("agentInfo"))?void 0:e.agentName)||""}})}(t.component),W_.push(t.component)),"reference"!==t.component&&"dqaReference"!==t.component||this.data.set("referenceBlock",t),this.formatBlock(t),t._index=this.data.get("queqeIndex")+1,this.data.set("queqeIndex",t._index),this.data.push("queue",t),nw("进新包：","序号("+(null==t?void 0:t._index)+")",t.component,t.data),nw("当前正在处理的包的完成情况：",this.data.get("prevBlockRenderFinished")),this.data.get("prevBlockRenderFinished")&&(this.data.set("prevBlockRenderFinished",!1),this.findNextBlockAndRender()))},getCitationList:function(t,e){return t.map((function(t,n){if(t.kb_reference){var a=t.kb_reference;return e.add(n+1),{abstract:a.para_list.join(""),title:a.file_name,linkInfo:{href:"javascript:void(0);"}}}return j_({},t,{source:{logo:t.icon,name:t.source},title:t.text,thumbnail:t.poster,linkInfo:{href:t.url}})}))},insertReferenceToMarkdown:function(t,e){var n=t||this.data.get("accBlocks");if(e&&n)for(var a=0;a<n.length;a++){var i= __get$(n,a) ,o=i.component,r=void 0===o?"":o;if("ai-markdown"===r||"ai-reasoning-content"===r||"ai-thinking-steps"===r||U_.includes(r)){var s="";if(null==e?void 0:e.length){var c,d,u,p=new Set,h=this.getCitationList(e,p);s+=l.dataToSource("citationList",h);var f=this.ref(""+r+a);U_.includes(r)||"ai-reasoning-content"===r?(null==f?void 0:f.appendContent)&&f.appendContent(s,i.data):"ai-thinking-steps"===r?(null==f?void 0:f.appendReference)&&f.appendReference(s):null==f||f.appendContent(s),this.updateKbReference(f,p),nw("已经增加溯源扩展数据到markdown","序号"+(null==(c= __get$(n,a) )?void 0:c._index),null==(d= __get$(n,a) )?void 0:d.component,null==(u= __get$(n,a) )?void 0:u.data,h)}}else"ai-writing"===i.component&&(i.data.referenceList||this.data.set("accBlocks["+a+"].data.referenceList",e))}this.handleBlockRenderFinished("referer包主动调用")},handleBlockRenderFinished:function(t){var e=this;this.nextTick((function(){var n=e.data.get("curBlock");if(!e.data.get("isHistory")&&n&&(e.fire("fragment-render-finished",e.data.get("curBlock")),e.data.set("prevBlockRenderFinished",!0),nw("当前正在处理的包 已完成","序号"+(null==n?void 0:n._index),n.component,n.data,"处理完成的原因：",t,"还剩余未消费包数量：",e.data.get("queue").length),e.data.get("status")!==E_.ABORT))if(e.data.get("queue").length)e.findNextBlockAndRender();else if(e.data.get("lastBlockRender")){nw("准备结束ai-entry（因为队列为空且有结束包）","序号"+(null==n?void 0:n._index),n.component,n.data);var a=e.getLastBlockIndex("ai-markdown"),i=e.getLastBlockIndex("ai-office-writing"),o=e.getLastBlockIndex("ai-reasoning-content");(a>=0||i>=0||o>=0)&&(setTimeout((function(){e.stopTyping(a),e.stopTyping(i)}),300),Ra().emit({isThinkingDone:!0}));var r=e.getLastBlockIndex("ai-function-buttons");r>-1&&e.data.set("accBlocks["+r+"].data.hasUnderline",!1);var s=e.getLastBlockIndex("ai-markdown-editor");if(s>-1&&e.data.set("accBlocks["+s+"].data.hasUnderline",!1),e.data.set("status",E_.COMPLETE),e.dispatchRenderFinished(),e.isInvalidBlock(n))e.data.get("accBlocks").forEach((function(t,n){var a;null==(a=e.ref("ai-markdown"+n))||a.setTextDisable()}));e.stopTouchPropagationForScroll()}}))},stopTyping:function(t){var e,n,a,i,o;t<0||(null==(e=this.ref("ai-markdown"+t))||e.stop(),null==(n=this.ref("ai-office-writing"+t))||n.stop(),null==(a=this.ref("ai-copyable-text"+t))||a.stop(),null==(i=this.ref("ai-reasoning-content"+t))||i.stop(),null==(o=this.ref("ai-thinking-steps"+t))||o.stop(),this.lastUiJsonStop())},lastUiJsonStop:function(){null==X_||X_.lastUiJsonDone(),X_=null},findNextBlockAndRender:function(){return(t=function(){var t,e,n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b,_,k,S;return B_(this,(function(x){switch(x.label){case 0:if(t=this,e=this.data.get("curBlock"),n=this.data.get("queue"),this.data.get("isPc")||(a=M_(n),this.data.set("queue",a)),i=this.data.shift("queue"),this.data.set("curBlock",i),nw("开始消费队列的包","序号"+(null==i?void 0:i._index),i.component,i.data),this.isLastBlock(i)&&(nw("出现了finish的包","序号"+(null==i?void 0:i._index),i.component,i.data),this.data.set("lastBlockRender",!0),this.stopTouchPropagationForScroll(),this.lastUiJsonStop()),!go(i.usedModel)&&go(this.data.get("usedModel"))&&this.data.set("usedModel",i.usedModel),this.data.set("prevBlockRenderFinished",!1),this.isBlockNotForRender(i))return"ai-reference"===i.component?this.insertReferenceToMarkdown(this.data.get("accBlocks"),null==(o=i.data)?void 0:o.referenceList):this.handleBlockRenderFinished("非渲染包"),[2];if("ai-uijson"!==i.component)return[3,4];x.label=1;case 1:return x.trys.push([1,3,,4]),[4,No(this.data.get("agentInfo"))];case 2:return x.sent(),[3,4];case 3:return x.sent(),this.handleBlockRenderFinished("非渲染包"),[2];case 4:return r=function(t,e){return!!t&&t.component===e.component&&("ai-editor-workspace-viewer"!==e.component||t.data.value.id===e.data.value.id)},r(e,i)?(d=this.data.get("accBlocks"),u=d.length-1,p=this.ref(""+(null==(s= __get$(d,u) )?void 0:s.component)+u),e.data.isComponentFinished?(this.data.push("accBlocks",i),[2]):(h=this.data.get("accBlocks["+u+"]").data.functionButtons,"ai-uijson"!==i.component&&X_&&this.lastUiJsonStop(),"ai-markdown-editor"===i.component&&h||(null==(l=e.data)?void 0:l.referenceToggleIcon)||(null==(c=i.data)?void 0:c.referenceToggleIcon)?(this.data.push("accBlocks",i),this.stopTyping(u),[3,13]):[3,5])):[3,14];case 5:return i.data.functionButtons?(this.data.set("accBlocks["+u+"].data.functionButtons",i.data.functionButtons),[3,13]):[3,6];case 6:return"ai-uijson"!==i.component?[3,7]:("uiMeta"!==i.dataType?(null==p||p.updateData(i.data),X_=p):this.data.push("accBlocks",i),[3,13]);case 7:return"ai-markdown"!==i.component?[3,8]:(i.data.content?((null==p?void 0:p.appendContent)&&(null==(f=i.data)?void 0:f.content)&&(null==p||p.appendContent(i.data.content)), __get$(d,u) .data.content+=i.data.content):this.handleBlockRenderFinished("空markdown包"),[3,13]);case 8:return-1!==$_.indexOf(i.component)||U_.includes(i.component)?(g=i.data.content,(null==p?void 0:p.appendContent)&&p.appendContent(g,i.data),g||this.handleBlockRenderFinished("空markdown包"),[3,13]):[3,9];case 9:return"ai-thinking-steps"!==i.component?[3,12]:(null==p?void 0:p.updateData)?[4,p.updateData(i.data)]:[3,11];case 10:x.sent(),x.label=11;case 11:return[3,13];case 12:"ai-progress"===i.component?(null==p?void 0:p.updateData)&&p.updateData({content:i.data}):(null==p?void 0:p.appendContent)&&p.appendContent(i.data.rawValue||i.data.value),x.label=13;case 13:return[3,15];case 14:m=this.getLastBlockIndex("ai-markdown"),v=this.getLastBlockIndex("ai-office-writing"),y=this.getLastBlockIndex("ai-reasoning-content"),(m>=0||v>=0||y>=0)&&(this.stopTyping(m),this.stopTyping(v),Ra().emit({isThinkingDone:!0})),"ai-markdown"!==i.component||i.data.content?"ai-progress"===i.component?(this.data.push("accBlocks",i),this.handleBlockRenderFinished("图片加载包")):"ai-thinking-steps"===i.component?(w=this.data.get("accBlocks"),b=w.findIndex((function(t){return"ai-thinking-steps"===t.component})),w.filter((function(t){return"ai-progress"===t.component})).length>0&&this.data.set("accBlocks",w.filter((function(t){return"ai-progress"!==t.component}))),b<0?this.data.push("accBlocks",i):this.insertReferenceToMarkdown(w,this.data.get("thinkingReference")),_=b<0?w.length-1:b,this.nextTick((function(){var e,n=t.ref(""+(null==(e= __get$(w,_) )?void 0:e.component)+_);(null==n?void 0:n.updateData)&&n.updateData(i.data),t.handleBlockRenderFinished("当前包渲染结束")}))):(this.data.push("accBlocks",i),"ai-reasoning-content"===i.component&&(k=this.data.get("accBlocks"),S=k.length-1,this.nextTick((function(){var e,n=t.ref(""+(null==(e= __get$(k,S) )?void 0:e.component)+S);"ai-reasoning-content"===i.component&&(null==n?void 0:n.appendContent)&&n.appendContent(i.data.value),t.handleBlockRenderFinished("当前包渲染结束")})))):(this.data.push("accBlocks",i),this.handleBlockRenderFinished("空markdown包")),x.label=15;case 15:return[2]}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){q_(o,a,i,r,s,"next",t)}function s(t){q_(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var t},handleAudioPlay:function(t){var e=t.markdownId,n=t.audioList,a=t.playIndex,i=this.data.get("audios"); __set$(i,e,n) ,Object.keys(i).forEach((function(t){ __get$(i,t) .forEach((function(n,i){+e==+t&&+a==+i||!n.data.get("playStatus")||n.handlePlayPause()}))})),this.dispatch("ai-entry:audio",{entryId:this.data.get("id"),markdownId:e,playIndex:a,audios:i})},handleToggleReference:function(t){var e=this,n=t.id,a=t.referenceIcon;this.dispatch("ai-entry:toggle-reference",{entryId:this.data.get("id"),markdownId:n,referenceIcon:a});var i=this.data.get("renderMode"),o=this.data.get("blocks"),r=this.data.get("accBlocks"),s=o,l="blocks";"only-csr"===i&&(s=r,l="accBlocks"),null==s||s.forEach((function(t,i){e.data.splice(l,[i,1,j_({},t,{data:j_({},t.data,{referenceToggleIcon:"hidden"===t.data.referenceToggleIcon?"hidden":i===n?a:"down"})})])}))},handleCopyClick:function(t){this.fire("copy",{event:t.event,text:t.content})},handleUpdateReference:function(t){this.data.set("thinkingReference",t)},formatBlock:function(t){var e=this;("markdown-yiyan"===t.component&&(this.data.set("isYiyan",!0),t.isYiyan=!0,this.data.set("normalizeContent",(function(t){return Yg(t,e.data.get("isPc"))}))),["markdown-yiyan","markdown-hamburg"].includes(t.component)?(t.data.type="markdown-yiyan"===t.component?"yiyan":"sfm",t.component="markdown"):"markdown-with-askback"===t.component&&(t.component="markdown"),"uijson"===t.component)&&("only-csr"===this.data.get("renderMode")&&(t.data.generatingSuffix=this.data.get("generatingSuffix")));if("markdownEditor"===t.component&&t.data){var n=this.data.get("renderMode");"only-csr"===n?(t.data.typingSwitch=!0,t.data.typingSpeed=this.data.get("typingSpeed"),t.data.rawValue=t.data.value,t.data.value="",t.data.suffix=this.data.get("generatingSuffix")):"only-csr-static"===n&&(t.data.typingSwitch=!1,t.data.rawValue=t.data.value,t.data.value="")}if("reasoningContent"===t.component){var a=this.data.get("renderMode");"only-csr"===a?t.data.typing={speed:this.data.get("isPc")?10:300,cursor:!0,mode:"all"}:"only-csr-static"===a&&(t.data.typing=null)}if("thinkingSteps"===t.component){var i=this.data.get("renderMode");"only-csr"===i?t.data.typing={speed:this.data.get("isPc")?10:30,cursor:this.data.get("isPc"),mode:"all"}:"only-csr-static"===i&&(t.data.typing=null)}if("copyableText"===t.component){var o=this.data.get("renderMode");"only-csr"===o?(t.data.typing={speed:this.data.get("typingSpeed")},t.data.suffix=this.data.get("generatingSuffix")):"only-csr-static"===o&&(t.data.typing=null)}if("writing"===t.component){var r=this.data.get("renderMode");"only-csr"===r?"all"===t.data.typingMode?t.data.typing=null:(t.data.typing={speed:this.data.get("typingSpeed"),mode:"all"},t.data.suffix=this.data.get("generatingSuffix")):"only-csr-static"===r&&(t.data.typing=null)}"officeWriting"===t.component&&("only-csr-static"===this.data.get("renderMode")&&(t.data.typing={cursor:!1,mode:t.data.typingMode||"all"}));var s=t.component&&this.camel2kebab(t.component);if(t.component=s&&this.formatComponentName(s),"ai-markdown"===t.component){var l=t.data.value;t.data=j_({},t.data,{content:l}),"only-csr"===this.data.get("renderMode")&&(t.data.typing={speed:this.data.get("isPc")?10:"all"===t.data.typingHideMask?300:30,cursor:!0,hideMask:t.data.typingHideMask||!1,mode:t.data.typingMode||"all"}),this.handleImages(l)}else t.data=j_({context:this.data.get("context")},t.data);"ai-markdown"===t.component&&this.markdownPreProcess(t)},handleImages:function(){var t=this.data.get("isPc")?this.addImageTools.bind(this):this.addWiseImageTools.bind(this),e=new MutationObserver(t);this.el&&(null==e||e.observe(this.el,{childList:!0,subtree:!0})),this.data.set("imageDomObserver",e)},addImageTools:function(){var t,e;(t=this.el)&&(t.querySelector('.cosd-markdown .marklang a[type="agent"]')||(null==(e=t.closest(".cs-answer-container"))?void 0:e.querySelector("#agent-icon")))||cw(this.el,this.imageToolClickCallBack.bind(this),this.data.get("question"))},addWiseImageTools:function(){var t,e,n,a=this.data.get(this.data.get("isHistory")?"blocks":"accBlocks"),i=null!=(n=null==a||null==(t=a[0])?void 0:t.isMcp)&&n,o=this.data.get("rank"),r=null==(e=this.data.get("tplInfo"))?void 0:e.lid;i||dw(this.el,o,r)},imageToolClickCallBack:function(t){this.dispatch("send-ubclog",{type:"click",value:"create_pic",extra:{button:t}})},markdownPreProcess:function(t){t.data&&t.data.content&&(t.data.content= __call$(t.data.content,"replace",[J_,function(t){var e,n=(null==(e=t.match(Q_))?void 0:e.filter(function(t,e){return e<2;}))||[];return n.join("");}]) )},camel2kebab:function(t){return  __call$(t,"replace",[/([A-Z])/g,function(t){return"-"+t.toLowerCase();}]) },kebabToCamel:function(t){return t.split("-").map((function(t,e){return 0===e?"":1===e?t.toLowerCase():t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()})).join("")},formatComponentName:function(t){return t.startsWith("ai-")?t:"ai-"+t},getCurrentBlock:function(){var t=this.data.get("blocksForCsrStatic"),e=this.data.get("accBlocks"),n=this.data.get("blocks"),a=this.data.get("renderMode"),i=n;return"only-csr"===a?i=e:"only-csr-static"===a&&(i=t),i},handleComponent:function(t,e){for(var n=this,a=Array.from(arguments).length,i=new Array(a>2?a-2:0),o=2;o<a;o++) __set$(i,o-2,__get$(Array.from(arguments),o)) ;var r=this.getCurrentBlock();r&&r.forEach((function(a,o){var r;a.component===n.formatComponentName(t)&&(n.ref(a.component+o)&& __get$(r=n.ref(a.component+o),e) .apply(r,[].concat(i)))}))},handleComponentAll:function(t){for(var e=this,n=Array.from(arguments).length,a=new Array(n>1?n-1:0),i=1;i<n;i++) __set$(a,i-1,__get$(Array.from(arguments),i)) ;var o=this.getCurrentBlock(),r=[];return o&&o.forEach((function(n,i){var o,s=e.ref(n.component+i);s&& __get$(s,t) &&r.push( __get$(o=s,t) .apply(o,[].concat(a)))})),Promise.all(r)},isBlockNotForRender:function(t){var e;return!t.component||"ai-reference"===t.component||!Object.keys(z_).includes("ai-"===t.component.slice(0,3)?t.component:"ai-"+t.component)||U_.includes(null==t?void 0:t.component)&&!(null==(e=t.data)?void 0:e.content)},isMarkdownCmpt:function(t){return["markdown-yiyan","markdown-hamburg","markdown"].includes(t.component)},isLastBlock:function(t){return t.isFinished},isInvalidBlock:function(t){var e,n;return"hint"===(null==(e=t.notice)?void 0:e.noticeIcon)&&"dict3S"===(null==(n=t.notice)?void 0:n.noticeStyleType)},getLastBlockIndex:function(t){for(var e=this.data.get("accBlocks"),n=e.length-1;n>=0;n--)if( __get$(e,n) .component===t)return n;return-1},stopTouchPropagationForScroll:function(){var t=this;this.nextTick((function(){var e=t.el;if(e){var n=e.querySelectorAll("code"),a=e.querySelectorAll("table");n.forEach(t.stopTouchPropagation),a.forEach(t.stopTouchPropagation)}}))},stopTouchPropagation:function(t){t.scrollWidth>=t.clientWidth&&(t.addEventListener("touchstart",(function(t){t.stopPropagation()})),t.addEventListener("touchmove",(function(t){t.stopPropagation()})),t.addEventListener("touchend",(function(t){t.stopPropagation()})))},isEmpty:function(){var t=this.ref("generatedContent");return!t||0===t.clientHeight},dispatchRenderFinished:function(t){void 0===t&&(t=""),this.data.get("isRenderFinishedDispatched")||(this.fire("render-finished"),this.dispatch("ai-entry:render-finished",{type:t}),this.data.set("isRenderFinishedDispatched",!0),this.stopVisibilityChangeListener())},handleActionLogEvent:function(t){this.fire("action-log-event",t)},handleShowLogEvent:function(t){this.fire("show-log-event",t)},handleMarkdownClick:function(t,e){var n=t.directive,a=t.event,i=t.from,o=t.data,r=t.action,s=t.target,l=this.data.get("isHistory")?"1":"0";n!==kg.AUDIO&&n!==kg.VIDEO||!s||"play"!==r||ew(n===kg.AUDIO?null==s?void 0:s.audio:null==s?void 0:s.el,n,this.data.get("isPc"));if("ai-markdown"===e||U_.includes(e))if(this.data.get("isPc")&&"ml-citation"===n)this.dispatch("send-ubclog",{type:"click",value:"subscriptJump",extra:{valueInfo:[{component_name:"markdown",component_type:"reference"}],info_rank:o.citationId,is_his:l}});else{if("ml-citation"===n)"citationId"===i?this.fire("action-log-event",{actionType:"o",component:"markdown",componentType:"reference",ext:{action:"sup",entry_type:"1",refer_type:"text",is_his:l}}):"tooltip"===i&&this.fire("action-log-event",{actionType:"na",component:"markdown",componentType:"reference",ext:{panel_type:"1",refer_type:"",is_his:l}});else if(n===kg.AUDIO&&r&&Object.keys(K_).includes(r))this.fire("ubc-log-event",{type:"click",value: __get$(K_,r) ,extra:{music_name:null==s?void 0:s.data.get("title")}});else if(n===kg.VIDEO&&r&&Object.keys(V_).includes(r))this.fire("ubc-log-event",{type:"click",value: __get$(V_,r) ,extra:{video_name:null==s?void 0:s.data.get("src")}});else if("ml-site-vcard"===n){var c,d;this.fire("ubc-log-event",{type:"click",value:"siteVcard",extra:{valueInfo:[{component_name:"siteVcard",component_content:a.target.innerText}],agent_id:null==(c=this.data.get("agentInfo"))?void 0:c.agentId,agent_name:null==(d=this.data.get("agentInfo"))?void 0:d.agentName}})}if(a){var u,p=(null==(u=a.target)?void 0:u.closest("a.cosd-site-vcard"))||a.target,h=p.tagName.toLowerCase(),f=p.getAttribute("href")||"";if(("a"===h||"link"===i)&&fo(f))return a.preventDefault(),a.stopPropagation(),void _o({url:f},{env:{platform:"pc"===rt()?"pc":ht()?"na":"wise"}})}}},handleMarkdownToggle:function(t,e){var n=t.directive;t.event;var a=t.open,i=t.data;if(this.data.get("isPc")&&"ml-citation"===n&&a){var o=this.data.get("isHistory")?"1":"0";if(U_.includes(e))return void this.dispatch("send-ubclog",{type:"click",value:"subscript",extra:{valueInfo:[{component_name:"markdown",component_type:"reference"}],info_rank:i.citationId,value:"subscript",is_his:o}});"ai-markdown"===e&&lp({type:"click",value:"subscript",ubcExt:{valueInfo:[{component_name:"markdown",component_type:"reference"}],info_rank:i.citationId,value:"subscript",is_his:o}},this.data.get("tplInfo"),this.el)}},updateKbReference:function(t,e){if(this.data.get("isPc")&&t&&t.el){var n=t.el;(n.classList.contains("cosd-markdown")?[n]:Array.from(n.querySelectorAll(".cosd-markdown"))).forEach((function(t){Array.from(t.querySelectorAll(".cosd-citation")).forEach((function(t){var n,a=(null==(n=t.querySelector("span"))?void 0:n.innerHTML)||"";e.has(+a)&&t.parentNode.addEventListener("mouseenter",(function(){setTimeout((function(){Array.from(document.querySelectorAll(".cos-tooltip-trigger:not(.cos-tooltip-trigger-hidden)")).forEach((function(t){var e=t.querySelector("a");e&&"javascript:void(0);"===e.getAttribute("href")&&(e.outerHTML= __call$(__call$(e.outerHTML,"replace",["<a",'<div style="font-weight: 500"']),"replace",["</a>","</div>"]) )}))}),500)}),{once:!0})}))}))}},handleMarkdownShow:function(t,e){var n,a,i=t.directive,o=t.target;if(!("ai-markdown"!==e||this.data.get("isPc")||i!==kg.VIDEO&&i!==kg.AUDIO&&"ml-site-vcard"!==i)){var r={};i===kg.VIDEO?r=JSON.stringify({value:"video_cpt",video_name:null==o?void 0:o.data.get("src")}):i===kg.AUDIO?r=JSON.stringify({value:"music_cpt",music_name:null==o?void 0:o.data.get("title")}):"ml-site-vcard"===i&&(r=JSON.stringify({value:"sitevcard",valueInfo:{component_name:"siteVcard",component_content:null==o?void 0:o.data.get("title")}})),null==o||null==(n=o.el)||n.setAttribute("data-show-area",""),null==o||null==(a=o.el)||a.setAttribute("data-show-ext",r),this.fire("markdown-inner-show-event")}},handleUBCLogEvent:function(t){this.fire("ubc-log-event",t)},startVisibilityChangeListener:function(){var t=this;this.visibilityChangeHandler=function(){if("visible"===document.visibilityState){var e=t.data.get("queue");if(e.length<=1)return;var n=M_(e);t.data.set("queue",n)}},document.addEventListener("visibilitychange",this.visibilityChangeHandler)},stopVisibilityChangeListener:function(){this.visibilityChangeHandler&&(document.removeEventListener("visibilitychange",this.visibilityChangeHandler),this.visibilityChangeHandler=null)},destroy:function(){this.stopVisibilityChangeListener()}});function Z_(){return Z_=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Z_.apply(this,Array.from(arguments))}Y_.template='\n\n    <div class="ai-entry">\n        <div s-if="renderMode === \'only-csr\'">\n            <slot s-if="status === StatusSet.IDLE" name="idle">\n            </slot>\n            <slot s-elif="status === StatusSet.WAITING" name="waiting">\n                正在思考...\n            </slot>\n            <slot s-elif="status >= StatusSet.GENERATING" name="generating">\n                <div s-ref="generatedContent">\n                    \x3c!--分享也展现这部分--\x3e\n                    <div\n                        s-for="block, index in accBlocks"\n                        data-show-ext="{{realShowExt(block)}}"\n                        s-bind="bindDataHandler(block)"\n                    >\n                        \x3c!--class特殊处理：首个渲染包是markdown文字，文字需要在AI标前缀后紧接着显示；若不是，则需要换行，因为AI标的实现是float，所以需要增加间距和clear--\x3e\n                        \x3c!--used-model字段协议设计不合理，待优化--\x3e\n                        <div\n                            s-is="block.component"\n                            s-if="!isBlockNotForRender(block)"\n                            s-ref="{{block.component + index}}"\n                            s-bind="block.data"\n                            id="{{index}}"\n                            is-mcp="{{block.isMcp}}"\n                            cid="{{cid}}"\n                            rank="{{rank}}"\n                            index="{{index}}"\n                            bind-data="{{block.data}}"\n                            ask-used-model="{{askUsedModel}}"\n                            used-model="{{usedModel}}"\n                            tplInfo="{{tplInfo}}"\n                            reference-element="{{referenceElement}}"\n                            class="{{dynamicClass(block, index, answerIndex)}}"\n                            style="{{dynamicStyle(block, index, answerIndex)}}"\n                            on-render-finished="handleBlockRenderFinished(block.component + \'-render-finished\')"\n                            on-action-log-event="handleActionLogEvent"\n                            on-ubc-log-event="handleUBCLogEvent"\n                            on-show-log-event="handleShowLogEvent"\n                            on-render-ready="handleReady(block)"\n                            on-toggle-reference="handleToggleReference"\n                            on-load-ready="handleReady(block)"\n                            on-typing-finished="handleBlockRenderFinished(\'typing-finished\')"\n                            on-click="handleMarkdownClick($event, block.component)"\n                            on-show="handleMarkdownShow($event, block.component)"\n                            on-toggle="handleMarkdownToggle($event, block.component)"\n                            on-copy-click="handleCopyClick($event, block.component)"\n                            on-update-reference="handleUpdateReference($event, block)"\n                            normalizeContent="{{normalizeContent}}"\n                        >\n                        </div>\n                    </div>\n                    <div\n                        s-if="abortMsgShow"\n                        class="ai-entry-msg-show cos-color-text{{\n                            abortMsgHasTopSpace ? \' cos-space-mt-lg\' : \'\'}}"\n                    >\n                        <div class="ai-entry-abort-msg">\n                            {{ abortMsgShow }}\n                        </div>\n                    </div>\n                </div>\n            </slot>\n        </div>\n        <template s-elif="renderMode === \'only-csr-static\'">\n            <div\n                s-for="block, index in blocksForCsrStatic"\n                data-show-ext="{{realShowExt(block)}}"\n                s-bind="bindDataHandler(block)"\n            >\n                <div\n                    s-is="block.component"\n                    s-if="!isBlockNotForRender(block)"\n                    s-ref="{{block.component + index}}"\n                    s-bind="block.data"\n                    is-mcp="{{block.isMcp}}"\n                    bind-data="{{block.data}}"\n                    used-model="{{usedModel}}"\n                    tplInfo="{{tplInfo}}"\n                    rank="{{rank}}"\n                    cid="{{cid}}"\n                    reference-element="{{referenceElement}}"\n                    class="{{index === 0 ? \'\'\n                        : block.component === \'ai-input\' ? \'cos-space-mt-md\' : \'cos-space-mt-lg\'}}"\n                    on-action-log-event="handleActionLogEvent"\n                    on-ubc-log-event="handleUBCLogEvent"\n                    on-show-log-event="handleShowLogEvent"\n                    on-click="handleMarkdownClick($event, block.component)"\n                    on-show="handleMarkdownShow($event, block.component)"\n                    on-toggle="handleMarkdownToggle($event, block.component)"\n                    normalizeContent="{{normalizeContent}}"\n                    on-copy-click="handleCopyClick($event, block.component)"\n                >\n                </div>\n            </div>\n        </template>\n        <template s-else>\n            <template s-for="block, index in blocks">\n                <div\n                    s-is="block.component"\n                    s-if="!isBlockNotForRender(block)"\n                    id="{{index}}"\n                    s-ref="{{block.component + index}}"\n                    s-bind="block.data"\n                    bind-data="{{block.data}}"\n                    is-mcp="{{block.isMcp}}"\n                    rank="{{rank}}"\n                    reference-element="{{referenceElement}}"\n                    class="{{index === 0 ? \'\'\n                        : block.component === \'ai-input\' ? \'cos-space-mt-md\' : \'cos-space-mt-lg\'}}"\n                    on-toggle-reference="handleToggleReference"\n                    on-audio-play="handleAudioPlay"\n                    tplInfo="{{tplInfo}}"\n                    on-action-log-event="handleActionLogEvent"\n                    on-ubc-log-event="handleUBCLogEvent"\n                    on-show-log-event="handleShowLogEvent"\n                >\n                </div>\n            </template>\n        </template>\n    </div>\n';var tk=a.defineComponent({components:{"dqa-reference":e.CitationList,icon:e.Icon},computed:{items:function(){return this.data.get("isPc"),this.data.get("referList").map((function(t,e){var n,a=Z_({},t,{linkInfo:{href:t.url,target:"_blank"},isVideo:(null==(n=t.type)?void 0:n.indexOf("video"))>-1,thumbnail:t.poster,title:t.text,source:{logo:t.icon,name:t.source}});return t.suffix&&(a.tags=[{text:t.suffix,appearance:"filled",bgColor:"rgba(57, 179, 98, 0.10)",color:"var(--cos-color-text-success, #39B362)",icon:"medical"}]),a}))},btnClickLog:function(){var t=this.data.get("logExtParams")||{},e=this.data.get("showReference"),n=this.data.get("extra");return JSON.stringify({type:"click",value:e?"site_fold":"site_open",ubcExt:Z_({valueInfo:[{component_name:"reference"}]},n,t)})}},initData:function(){return{text:"",status:"fold",height:"100%",foldIndex:0,lastNum:0,referArray:[],maxRow:1,realShowExt:'{"value":"site_show","component_content":{"component_name":"reference"}}',showReference:!0,isPc:"pc"===rt(),logExtParams:{},isDownloadReference:!1,isHistory:!1,extra:{}}},created:function(){this.data.set("extra",{is_his:this.data.get("isHistory")?"1":"0"})},attached:function(){var t=this,e=this.data.get("extra"),n=S_(this.el);if(this.data.set("realShowExt",JSON.stringify(Z_({value:"site_show",component_content:{component_name:"reference"}},e,n))),this.setReferArray(),this.watch("referList",(function(){t.setReferArray()})),this.data.get("isPc")){var a=this.data.get("showReference");this.dispatch("send-ubclog",{type:"show",value:a?"site_fold":"site_open",extra:e})}this.dispatch("send-ubclog",{type:"show",value:"site",extra:e})},setReferArray:function(){var t=this.data.get("referList");if(t&&t.length)for(var e=0;e<t.length;e++){var n= __get$(t,e) ;this.data.splice("referArray",[e,1,Z_({},n,{index:e+1})])}},handleShowReference:function(){var t=this.data.get("showReference"),e=this.data.get("extra");this.data.set("showReference",!t),!t&&this.data.get("isPc")&&this.dispatch("send-ubclog",{type:"show",value:"site",extra:e})},handleReferenceClick:function(t){var e=this.data.get("tplInfo"),n=this.data.get("extra");if(this.data.get("isPc")){var a=this.data.get("logExtParams")||{};lp({type:"click",value:"site",ubcExt:Z_({info_rank:null==t?void 0:t.index,valueInfo:[{component_name:"reference"}]},n,a)},e,this.el)}else{var i,o=this.data.get("logExtParams")||{};Np({component:"reference",tplname:"nonala_cpt",actionType:"na",ext:Z_({panel_type:"0",panel_order:null==t||null==(i=t.index)?void 0:i.toString(),component_content:{component_name:"reference"}},n,o)},e,{launchMultiSearch:!0},this.el)}},handleReferenceScrollEnd:function(t){Np({component:"reference",actionType:"scroll",ext:Z_({action:"slideslip",component_content:{component_name:"reference"}},this.data.get("extra"))},this.data.get("tplInfo"),{launchMultiSearch:!0},this.el)},handleReferenceChange:function(t){var e=this.data.get("extra");this.data.get("isPc")&&this.dispatch("send-ubclog",{type:"click",value:"site_slide",extra:Z_({info_rank:t.prevIndex},e)})}}),ek={};ek= __call$(Object,"assign",[ek,{reference:"reference_if14w_1",referencePanel:"reference-panel_if14w_7","reference-panel":"reference-panel_if14w_7",referenceFold:"reference-fold_if14w_10","reference-fold":"reference-fold_if14w_10",referenceSummary:"reference-summary_if14w_13","reference-summary":"reference-summary_if14w_13",referenceList:"reference-list_if14w_26","reference-list":"reference-list_if14w_26",downloadReference:"download-reference_if14w_59","download-reference":"download-reference_if14w_59"}]) ,tk.template='\n    <div\n        disable-copy\n        s-ref="reference"\n        class="{{$style.reference}}"\n        style="height:{{height}}"\n        data-module="site"\n        data-show-ext="{{realShowExt}}"\n        data-show-area\n    >\n        <div\n            s-if="isPc"\n            class="{{$style.referencePanel}}"\n            need-click-log\n        >\n            <div\n                data-click-log="{{btnClickLog}}"\n                class="{{$style.referenceSummary}} {{!showReference && isDownloadReference ? $style.referenceFold : \'\'}}"\n                on-click="handleShowReference">\n                <span>查看{{items.length}}篇参考资料</span>\n                <icon name="{{showReference ? \'up\' : \'down\'}}"/>\n            </div>\n        </div>\n        <div\n            s-if="!isPc || showReference"\n            class="{{isDownloadReference ? $style.downloadReference : \'\'}}"\n        >\n            <dqa-reference\n                class="{{$style.referenceList}}"\n                appearance="stripe"\n                on-click="handleReferenceClick"\n                on-change="handleReferenceChange"\n                on-scrollend="handleReferenceScrollEnd"\n                items="{{items}}"\n            />\n        </div>\n    </div>\n';var nk="function"==typeof tk?tk.prototype.initData||ak:tk.initData||ak;function ak(){return{$style:ek}}function ik(){return  __call$(Object,"assign",[{},nk.call(this),{$style:ek}]) }"function"==typeof tk?tk.prototype.initData=ik:tk.initData=ik;var ok=a.defineComponent({components:{"dqa-reference":tk},initData:function(){return{referenceList:[],scrollStartX:0,isLeftScroll:!1,isShowDownload:!1,logExtParams:{},tplInfo:{},isHistory:!1}},handleReferenceClick:function(t){var e=t.event,n=t.url;e.stopPropagation(),n&&window.open(n,"_blank")},touchstartHandle:function(t){var e;this.data.set("scrollStartX",(null==t||null==(e=t.touches[0])?void 0:e.clientX)||0)},touchmoveHandle:function(t){var e,n=((null==t||null==(e=t.touches[0])?void 0:e.clientX)||0)<this.data.get("scrollStartX");this.data.set("isLeftScroll",n);var a=this.ref("reference").el,i=a&&a.querySelector('[class*="list-scroll"]');i&&(n?i.scrollLeft+i.offsetWidth<i.scrollWidth:i.scrollLeft>0)&&t.stopPropagation()},touchendHandle:function(t){var e;this.data.set("scrollStartX",(null==t||null==(e=t.touches[0])?void 0:e.clientX)||0);var n=this.data.get("isLeftScroll"),a=this.ref("reference").el,i=a&&a.querySelector('[class*="list-scroll"]');i&&(n?i.scrollLeft+i.offsetWidth-5<i.scrollWidth:i.scrollLeft>5)&&t.stopPropagation()}}),rk={};rk= __call$(Object,"assign",[rk,{reference:"reference_1sdr1_1",download:"download_1sdr1_5",historyReference:"history-reference_1sdr1_15","history-reference":"history-reference_1sdr1_15"}]) ,ok.template='\n    \x3c!-- chat-reference-wrapper 用于分享图片时，隐藏溯源角标 --\x3e\n    <div\n        class="chat-reference-wrapper {{isShowDownload ? $style[\'download\'] : \'\'}}"\n        on-touchstart="touchstartHandle"\n        on-touchend="touchendHandle"\n        on-touchmove="touchmoveHandle"\n    >\n        <dqa-reference\n            s-ref="reference"\n            is-download-reference="{{isShowDownload}}"\n            refer-list="{{referList}}"\n            log-ext-params="{{logExtParams}}"\n            on-click="handleReferenceClick"\n            tplInfo="{{tplInfo}}"\n            class="\n                {{$style[\'reference\']}}\n                {{isHistory ? $style[\'history-reference\'] : \'\'}}\n            "\n            is-history="{{isHistory}}"\n        />\n    </div>\n';var sk="function"==typeof ok?ok.prototype.initData||lk:ok.initData||lk;function lk(){return{$style:rk}}function ck(){return  __call$(Object,"assign",[{},sk.call(this),{$style:rk}]) }function dk(){return dk=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},dk.apply(this,Array.from(arguments))}"function"==typeof ok?ok.prototype.initData=ck:ok.initData=ck;var uk="操作次数超过限制值",pk=a.defineComponent({template:"\n\n    ",components:{"cos-icon":e.Icon},initData:function(){return{status:null,url:null,feDislikeKey:null,feLikeType:null,reqParams:{},word:"",feedbackId:null,feedbackTitle:"请选择遇到的问题",feedbackContentList:[["内容错误","与搜索词无关"],["内容陈旧","包含违规信息"],["页面打不开","浏览体验差"]],feedbackTipsFixed:!1,feedbackShowInput:!1,feedbackCustomTheme:!1,useWiseStyle:!1,useCardSendLog:!1,praiseFrequencyLimitAlert:{content:[uk]},tplInfo:{},notShowPopup:!1,changeField:!1,praisedTimes:0,isPraising:!1,tipVisible:!1,color:"#6e4bfaff",isWendaIndex:!1,graphCreationLog:{},isPreventLog:!1,isDataFlyWheel:!1,uselessShow:!0,isBless:!1}},created:function(){this.handlePraise=Xi(this.handlePraise,100)},attached:function(){this.data.get("isPreventLog")||this.dispatch("send-ubclog",{type:"show",value:"like_unlike"})},handlePraise:function(t,e){var n=this;e.stopPropagation();var a=this.data.get(),i=a.isPraising,o=a.praisedTimes,r=a.status,s=a.feedbackId,l=a.feedbackTitle,c=a.feedbackContentList;if(!i)if(o>9)this.showFrequencyLimit();else if(this.data.set("praisedTimes",o+1),this.data.set("tipVisible",!1),"like"!==r&&"degrade"!==r||this.doPraise(r,!0,e),r!==t){var d=e.target;this.nextTick((function(){if(n.doPraise(t,!1,e),"degrade"===t&&!n.data.get("notShowPopup")){var a=n.getDownIconLocation(d),i=Hn().conversation.feedbackPop;null==i||i.emit(dk({id:s,title:l,content:c,url:n.data.get("url"),isGenPc:n.data.get("isGenPc"),feDislikeKey:n.data.get("feDislikeKey")},a))}n.data.set("status",t),n.dispatch("send-ubclog",{type:"click",value:"like_unlike",extra:dk({action:"like"===t?"like_set":"unlike_set"},n.data.get("graphCreationLog"))})}))}else this.data.set("status",null),this.dispatch("send-ubclog",{type:"click",value:"like_unlike",extra:dk({action:"like"===r?"like_unset":"unlike_unset"},this.data.get("graphCreationLog"))})},doPraise:function(t,e,n){var a=this,i=this.data.get(),o=i.feLikeType,r=i.feDislikeKey,s=i.changeField,l="ps_"+encodeURI(this.data.get("url"));"degrade"===t&&r&&(l=r);var c="https://ext.baidu.com/api/like/v1/"+t+"/receive?",d=e?"cancel":"add",u="callback_"+t+"_"+d,p=this.data.get("reqParams");if(c+=Mt(dk({sfrom:s?"search":"search_topone",source:s?"search_aisearch":"search_topone",appname:"baiduapp",type:o,callback:u,ext:'{"search_query": "'+this.data.get("word")+'"}',rtype:9,op_type:d,id:l},p)),this.data.set("isPraising",!0),fetch(c,{method:"get",mode:"no-cors",credentials:"include"}).then((function(t){a.data.set("isPraising",!1)})).catch((function(){a.data.set("isPraising",!1)})),this.data.get("useCardSendLog")){var h={type:"b",fm:"beha",action:t+"_"+d,extra:this.data.get("isBless")?{module_type:"hudong"}:{},target:null==n?void 0:n.target};this.data.get("isDataFlyWheel")&&(h.extra.interactKey=l),this.dispatch("send-log",h)}},showFrequencyLimit:function(){this.data.get("isPc")?this.dispatch("UI:showToast",{content:uk}):e.Toast.show({message:uk})},getDownIconLocation:function(t){var e={left:0,top:0,bottom:0};if(t){var n=t.getBoundingClientRect();e.left=Math.round(n.left),e.bottom=Math.round(n.bottom),e.top=Math.round(n.top)}return e}}),hk={};hk= __call$(Object,"assign",[hk,{praiseWrapper:"praise-wrapper_1d2g2_1","praise-wrapper":"praise-wrapper_1d2g2_1",btnWrapper:"btn-wrapper_1d2g2_10","btn-wrapper":"btn-wrapper_1d2g2_10",btnCsaitabWrapper:"btn-csaitab-wrapper_1d2g2_18","btn-csaitab-wrapper":"btn-csaitab-wrapper_1d2g2_18",btnGroup:"btn-group_1d2g2_21","btn-group":"btn-group_1d2g2_21",active:"active_1d2g2_31",expIcon:"exp-icon_1d2g2_34","exp-icon":"exp-icon_1d2g2_34",fillIcon:"fill-icon_1d2g2_34","fill-icon":"fill-icon_1d2g2_34",lineIcon:"line-icon_1d2g2_37","line-icon":"line-icon_1d2g2_37",useful:"useful_1d2g2_40",nouseful:"nouseful_1d2g2_43",expText:"exp-text_1d2g2_58","exp-text":"exp-text_1d2g2_58",num:"num_1d2g2_70",divider:"divider_1d2g2_77",praiseUnderline:"praise-underline_1d2g2_109","praise-underline":"praise-underline_1d2g2_109",text:"text_1d2g2_146",praiseCsaitabWrapper:"praise-csaitab-wrapper_1d2g2_155","praise-csaitab-wrapper":"praise-csaitab-wrapper_1d2g2_155",useWiseStyle:"use-wise-style_1d2g2_166","use-wise-style":"use-wise-style_1d2g2_166",useGenPcStyle:"use-gen-pc-style_1d2g2_166","use-gen-pc-style":"use-gen-pc-style_1d2g2_166"}]) ,pk.template="\n    <div style=\"--color: {{color || '#6e4bfaff'}}\">\n        <div\n            class=\"\n                {{$style['praise-wrapper']}}\n                {{$style['praise-csaitab-wrapper']}}\n                {{useWiseStyle ? $style['use-wise-style'] : ''}}\n                {{isHuabu && isPc ? $style['use-gen-pc-style'] : ''}}\n            \"\n            rl-type=\"stop\"\n        >\n            <div class=\"{{$style['btn-wrapper']}} {{$style['btn-csaitab-wrapper']}}\">\n                <div\n                    data-module=\"cai\"\n                    class=\"{{$style['btn-group']}} {{$style.nouseful}} {{status === 'degrade' ? $style['active'] : ''}}\"\n                    on-click=\"handlePraise('degrade', $event)\"\n                >\n                    <cos-icon\n                        name=\"thumbs-down-fill\"\n                        class=\"{{$style['exp-icon']}} {{$style['fill-icon']}}\"\n                    />\n                    <cos-icon\n                        name=\"thumbs-down\"\n                        class=\"{{$style['exp-icon']}} {{$style['line-icon']}}\"\n                    />\n                    <span s-if=\"{{caiText}}\" class=\"{{$style.text}} cos-font-medium\">踩</span>\n                    <span s-if=\"{{uselessShow}}\" class=\"{{$style['exp-text']}} cos-font-medium\">没用</span>\n                </div>\n            </div>\n        </div>\n    </div>\n";var fk="function"==typeof pk?pk.prototype.initData||gk:pk.initData||gk;function gk(){return{$style:hk}}function mk(){return  __call$(Object,"assign",[{},fk.call(this),{$style:hk}]) }function vk(){return vk=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},vk.apply(this,Array.from(arguments))}"function"==typeof pk?pk.prototype.initData=mk:pk.initData=mk;var yk=a.defineComponent({components:{"cos-icon":e.Icon},initData:function(){return{tplInfo:{},isPc:!1,graphCreationLog:{},isNaElder:!1}},attached:function(){this.dispatch("send-ubclog",{type:"show",value:"copy"}),this.dispatch("send-midlog",{cst:2,clk_extra:{t:1}}),this.data.get("isPc")||this.checkIsElder()},copyText:function(t){var n=this.data.get("getCopyTarget");if("function"==typeof n){var a=n();if(a){var i="*[disable-copy]",o="";if(a.querySelector&&a.querySelector(i)){var r=a.cloneNode(!0),s=r.querySelectorAll(i);Array.from(s).forEach((function(t){t.remove()})),r.style.background="transparent",document.body.appendChild(r),o=r.innerText.trim(),document.body.removeChild(r)}else o=a.innerText;this.fire("click-log","copy"),this.dispatch("send-log",{type:"b",fm:"beha",target:t.target,extra:vk({clk_region:"function"},this.data.get("graphCreationLog"))});var l=this.data.get("isPc"),c=this.data.get("isNaElder")&&!l?4e3:2e3;o?Ep(o).then((function(t){e.Toast.show({message:"复制成功",duration:c})})).catch((function(t){var n="复制失败";l?e.Toast.error({message:n,duration:c}):e.Toast.show({message:n,duration:c})})):e.Toast.show({message:"正文内容为空，暂不支持复制",duration:c})}}},checkIsElder:function(){var t=this;o&&o.canIUse("elder.getElderConfig")&&o.elder.getElderConfig({success:function(e){var n;0===e.status&&t.data.set("isNaElder",!!(null==e||null==(n=e.data)?void 0:n.isElderMode))}})}}),wk={};wk= __call$(Object,"assign",[wk,{copy:"copy_114mz_1",icon:"icon_114mz_4",copyText:"copy-text_114mz_18","copy-text":"copy-text_114mz_18",text:"text_114mz_29"}]) ,yk.template='\n    <div>\n        <div\n            data-module="copy"\n            class="cos-row copy-container {{$style.copy}} {{$style.copyDark}} {{!copyTxtDisable ? $style.copyText : \'\'}}"\n            on-click="copyText"\n        >\n            <cos-icon class="{{$style.icon}}" name="copy" />\n            <span s-if="{{!copyTxtDisable}}" class="{{$style.text}} cos-font-medium">复制</span>\n        </div>\n    </div>\n';var bk,_k="function"==typeof yk?yk.prototype.initData||kk:yk.initData||kk;function kk(){return{$style:wk}}function Sk(){return  __call$(Object,"assign",[{},_k.call(this),{$style:wk}]) }function xk(){return xk=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},xk.apply(this,Array.from(arguments))}"function"==typeof yk?yk.prototype.initData=Sk:yk.initData=Sk,function(t){t.REWRITE="重写",t.REDRAW="重画"}(bk||(bk={}));var Ik=a.defineComponent({components:{"cos-icon":e.Icon},computed:{ubcClickLog:function(){return JSON.stringify({type:"click",value:"change",ubcExt:xk({},this.data.get("logExtData"))})}},initData:function(){return{tplInfo:{},popupData:{content:[]},replaceText:"重新回答",replaceIcon:"exchange",isPreventLog:!1,forceShowReplaceText:!1,dispatchedClickEvents:["send-log"],isBless:!1,logExtData:{},isFixedWidth:!1,rank:0,isPc:!1}},attached:function(){this.onClickReplace=Xi(this.onClick.bind(this),300,{leading:!0,trailing:!1}),this.data.get("isPreventLog")||(this.dispatch("send-ubclog",{type:"show",value:"change"}),this.dispatch("send-midlog",{cst:2,clk_extra:{t:4}}))},onClick:function(t){var e=this;if(this.data.get("isPc"))return this.fire("click-log","change"),void Ws().emit({params:{location_id:"generate_"+this.data.get("rank"),function_type:"card_function_regenerate",location_type:"answer_card"}});var n={type:"b",fm:"beha",extra:{clk_region:"function"},target:t.target};this.data.get("isBless")&&(n.extra.module_type="hudong",n.action="rewrite");var a=this.data.get("dispatchedClickEvents")||[];(null==a?void 0:a.length)&&a.forEach((function(t){e.dispatch(t,n)})),this.fire("click",{e:t})}}),Tk={};Tk= __call$(Object,"assign",[Tk,{replace:"replace_7d8py_1",icon:"icon_7d8py_4",text:"text_7d8py_10",iconGray:"icon-gray_7d8py_14","icon-gray":"icon-gray_7d8py_14",fixedWidth:"fixed-width_7d8py_17","fixed-width":"fixed-width_7d8py_17"}]) ,Ik.template='\n    <div>\n        <div\n            data-module="change"\n            data-click-log="{{ubcClickLog}}"\n            class="cos-row {{$style.replace}} {{isGray ? $style[\'icon-gray\'] : \'\'}} {{isFixedWidth ? $style[\'fixed-width\'] : \'\'}}"\n            on-click="onClickReplace"\n        >\n            <cos-icon class="{{$style.icon}}" name="{{replaceIcon}}" />\n        </div>\n    </div>\n';var Ck="function"==typeof Ik?Ik.prototype.initData||Lk:Ik.initData||Lk;function Lk(){return{$style:Tk}}function Dk(){return  __call$(Object,"assign",[{},Ck.call(this),{$style:Tk}]) }function Pk(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function Ek(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){Pk(o,a,i,r,s,"next",t)}function s(t){Pk(o,a,i,r,s,"throw",t)}r(void 0)}))}}function Ak(){return Ak=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Ak.apply(this,Array.from(arguments))}function Ok(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Ik?Ik.prototype.initData=Dk:Ik.initData=Dk;var Rk="PRELOAD_AUDIO_EXPIRE",Nk=a.defineComponent({components:{"cos-icon":e.Icon},computed:{paused:function(){var t;return 1!==(null==(t=this.data.get("conf"))?void 0:t.status)},audioHandler:function(){return this.data.get("audioHandlerList")[0]||new Audio},idleAudioHandler:function(){return this.data.get("audioHandlerList")[1]||new Audio}},initData:function(){return{audioHandlerList:[],voiceApi:"",getVoiceListing:!1,conf:{status:0,speed:"speed"},tmpAudioList:[],storeAudioList:[],broadcastSignal:{tgNum:-1},tplInfo:{},text:"",graphCreationLog:{},ttsApiFrom:"h5",useCardSendLog:!1,newIcon:!1,setype:"",agentInfo:{},voicePanelStatus:0,preloadIndex:0,source:"",preloaded:!1,preloadAudioList:[]}},listenTtsPlay:null,created:function(){this.preloadAudio()},attached:function(){var t=this;this.globalPauseAudio=this.globalPauseAudio.bind(this),window.addEventListener("visibilitychange",this.globalPauseAudio),window.addEventListener("pagehide",this.globalPauseAudio),this.watch("conf.status",(function(e){t.fire("change",{paused:1!==e})})),this.dispatch("send-ubclog",{type:"show",value:"broadcast"}),this.eventListener(),this.listenTtsPlay=function(e){e!==t&&(t.pauseAudio(),t.data.set("tmpAudioList",[]),t.data.get("audioHandler")&&(t.data.get("audioHandler").src=""),t.data.get("idleAudioHandler")&&(t.data.get("idleAudioHandler").src=""),t.data.set("conf.status",0),t.data.set("hasPaused",!1))},aa().on(this.listenTtsPlay)},listenVoicePanelStatus:null,eventListener:function(){var t=this,e=Hn();this.listenVoicePanelStatus=function(e){var n,a;t.data.set("voicePanelStatus",null==(n=e.params)?void 0:n.show_status);var i=t.data.get("conf.status");1===(null==(a=e.params)?void 0:a.show_status)&&1===i&&t.pauseAudio()},e.container.voicePanelStatus.on(this.listenVoicePanelStatus)},disposed:function(){window.removeEventListener("visibilitychange",this.globalPauseAudio),window.removeEventListener("pagehide",this.globalPauseAudio),this.listenTtsPlay&&(aa().off(this.listenTtsPlay),this.listenTtsPlay=null),this.listenVoicePanelStatus&&(Hn().container.voicePanelStatus.off(this.listenVoicePanelStatus),this.listenVoicePanelStatus=null)},globalPauseAudio:function(){this.pauseAudio();var t=this.data.get("audioHandler");t&&(t.currentTime=0,this.data.set("conf.status",0),this.dispatch("send-broadcast-ubclog",{extra:{info:this.data.get("text"),agent_id:this.data.get("agentInfo.agentId")||"",agent_name:this.data.get("agentInfo.agentName")||"",end_reas:"leave"}}))},clickAudio:function(t){return Ek((function(){var n,a,i,o,r,s,l,c,d,u,p,h,f;return Ok(this,(function(g){switch(g.label){case 0:return t.preventDefault(),t.stopPropagation(),this.createAudio(),aa().emit(this),n=this.data.get(),a=n.conf,i=void 0===a?{}:a,o=n.audioHandler,r=void 0===o?null:o,s=n.voiceApi,l=void 0===s?"":s,c=n.text,l||c?this.data.get("getVoiceListing")?[2]:(this.data.set("getVoiceListing",!0),this.sendTtsLog(t),this.data.get("preloaded")?(u=this.data.get("preloadAudioList"),[3,3]):[3,1]):(e.Toast.show({message:"正文内容为空，暂不支持播放"}),[2]);case 1:return[4,c?this.getAudioListByText(c):this.getAudioListByApi(l)];case 2:u=g.sent(),g.label=3;case 3:return d=u||[],this.data.set("getVoiceListing",!1),r&&0!==d.length?(p=this.data.get("tmpAudioList"),2!==i.status?[3,5]:[4,this.resumeAudio()]):(e.Toast.show({message:"播报异常，请稍后再试"}),[2]);case 4:return g.sent(),[3,10];case 5:return 1!==i.status?[3,6]:(this.pauseAudio(),this.dispatch("send-broadcast-ubclog",{extra:{info:this.data.get("text"),agent_id:this.data.get("agentInfo.agentId")||"",agent_name:this.data.get("agentInfo.agentName")||"",end_reas:"stop"}}),[3,10]);case 6:return 0!==p.length||i.status?[3,8]:(this.data.set("tmpAudioList",d),[4,this.playNewAudio()]);case 7:return g.sent(),[3,10];case 8:return i.status?[3,10]:[4,this.playNewAudio()];case 9:g.sent(),g.label=10;case 10:return h=Date.now(),f=h+864e5,localStorage.setItem(Rk,f),[2]}}))})).apply(this)},fetchAudioListSSE:function(t){return Ek((function(){var n;return Ok(this,(function(a){return n=this,[2,new Promise((function(a){var i=n.data.get("storeAudioList");if(i.length>0)a(i);else{var o=new EventSource(t);o.onmessage=function(t){var e=JSON.parse(t.data).data,i=e.url,r=e.isEnd;n.data.set("storeAudioList",[].concat(n.data.get("storeAudioList"),[i])),n.data.set("tmpAudioList",[].concat(n.data.get("tmpAudioList"),[i])),a(n.data.get("storeAudioList")),0===n.data.get("conf.status")&&n.playNewAudio(),r&&o.close()},o.onerror=function(){n.data.set("storeAudioList",[]),n.data.set("tmpAudioList",[]),o.close(),e.Toast.show({message:"播报异常了，请稍后再试"})}}}))]}))})).apply(this)},getAudioListByApi:function(t){return Ek((function(){var e;return Ok(this,(function(n){return e=this,[2,new Promise((function(n){var a=e.data.get("storeAudioList");a.length>0?n(a):fetch(t,{method:"jsonp",timeout:1500,jsonpCallback:"callback",jsonpCallbackFunction:"callback"}).then((function(t){var a=t.errno,i=t.data;if(0===a){var o=(void 0===i?{}:i).contentList,r=void 0===o?[]:o,s=e.data.get("broadcastSignal").tgNum;if(r.length>0)return e.data.set("tmpAudioList",r.filter((function(t){return t.tgNum>=s}))),e.data.set("storeAudioList",r.concat([])),void n(r)}n([])})).catch((function(){n([])}))}))]}))})).apply(this)},preloadAudio:function(){var t=this;if("longPress"!==this.data.get("source")){var e=localStorage.getItem(Rk)||0;Date.now()>e?localStorage.removeItem(Rk):this.getAudioListByText(this.data.get("text")).then((function(e){e.length>0&&(t.data.set("preloadAudioList",e),t.data.set("preloaded",!0),t.createAudio())}))}},getAudioListByText:function(t){return Ek((function(){var e,n,a,i;return Ok(this,(function(o){return e=this,n=this.data.get("ttsApiFrom"),a={text:t,from:n,appId:this.data.get("agentInfo.agentId")||"",agentSearchId:this.data.get("agentInfo.agentSearchId")||"",per:4189,rate:this.data.get("agentInfo.ttsApi")?32:64,mid:this.data.get("agentInfo.mid")||""},this.data.get("agentInfo.speechId")&&(a.per=this.data.get("agentInfo.speechId")),i=(this.data.get("agentInfo.ttsApi")||"https://chat.baidu.com/aichat/api/tts")+"?",Object.keys(a).forEach((function(t){ __set$(a,t,encodeURIComponent(__get$(a,t))) ,i+=t+"="+ __get$(a,t) +"&"})),this.data.get("agentInfo.ttsApi")?[2,this.fetchAudioListSSE(i)]:[2,new Promise((function(t){var n=e.data.get("storeAudioList");n.length>0?t(n):fetch(i,{method:"get",mode:"cors",credentials:"include"}).then((function(t){if(t.ok)return t.json();throw new Error("tts api error")})).then((function(n){var a=n.status,i=n.data;if(0==+a){var o=(void 0===i?{}:i).contentList,r=void 0===o?[]:o;r.length&&(e.data.set("storeAudioList",r),t(r))}})).catch((function(){t([])}))}))]}))})).apply(this)},getAudioIns:function(){var t=this,e=new Audio;e.className="chat-search-own-audio",this.el.appendChild(e);var n=this;e.addEventListener("playing",Ek((function(){return Ok(this,(function(t){return n.data.get("hasPaused")?(n.data.set("hasPaused",!1),[2]):(n.data.shift("tmpAudioList"),n.data.get("tmpAudioList")[0]&&(n.data.get("idleAudioHandler").src=n.data.get("tmpAudioList")[0]),[2])}))})));var a=this;return e.addEventListener("ended",Ek((function(){var t,e,n;return Ok(this,(function(i){switch(i.label){case 0:return n=a.data.shift("audioHandlerList"),a.data.push("audioHandlerList",n),0===(null==(t=a.data.get("tmpAudioList"))?void 0:t.length)&&(a.data.set("conf.status",0),a.data.get("audioHandler").src="",a.data.get("idleAudioHandler").src=""),[4,a.playNewAudio()];case 1:return i.sent(),0===(null==(e=a.data.get("tmpAudioList"))?void 0:e.length)&&(ua().emit({isAction:!0,action:4,actionName:"播报",rank:on.getState("rank")}),a.dispatch("send-ubclog",{type:"show",value:"broadcast_over"}),a.dispatch("send-broadcast-ubclog",{extra:{info:a.data.get("text"),agent_id:a.data.get("agentInfo.agentId")||"",agent_name:a.data.get("agentInfo.agentName")||"",end_reas:"finish"}})),[2]}}))}))),e.addEventListener("pause",(function(){t.data.set("conf.status",2)})),e},createAudio:function(){var t;if(!this.data.get("audioHandlerList").length||!(null==(t=this.el)?void 0:t.querySelector(".chat-search-own-audio")))for(var e=0;e<2;e++){var n=this.getAudioIns();this.data.push("audioHandlerList",n)}},pauseAudio:function(){var t=this.data.get("audioHandler");t&&(this.data.set("hasPaused",!0),t.pause(),this.data.set("conf.status",2))},resumeAudio:function(){return Ek((function(){var t;return Ok(this,(function(e){switch(e.label){case 0:t=this.data.get("audioHandler"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.play()];case 2:return e.sent(),ew(t),this.data.set("conf.status",1),[3,4];case 3:return e.sent(),this.data.set("conf.status",0),[3,4];case 4:return[2]}}))})).apply(this)},playNewAudio:function(){return Ek((function(){var t,e,n,a,i;return Ok(this,(function(o){switch(o.label){case 0:if(t=this.data.get(),e=t.audioHandler,n=t.tmpAudioList,!(i=(a=void 0===n?[]:n)[0]))return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),a.includes(e.src)||(e.src=i.audio||i),[4,e.play()];case 2:return o.sent(),ew(e),1===this.data.get("voicePanelStatus")?(this.pauseAudio(),[2]):(this.data.set("conf.status",1),[3,4]);case 3:return o.sent(),this.data.set("conf.status",0),[3,4];case 4:return[2]}}))})).apply(this)},longPressPlay:function(t){return Ek((function(){var n,a,i,o,r,s,l;return Ok(this,(function(c){switch(c.label){case 0:return t&&(this.data.set("storeAudioList",[]),this.data.set("text",t)),this.createAudio(),aa().emit(this),n=this.data.get(),a=n.audioHandler,i=void 0===a?null:a,o=n.voiceApi,r=void 0===o?"":o,s=n.text,r||s?this.data.get("getVoiceListing")?[2]:(this.data.set("getVoiceListing",!0),[4,s?this.getAudioListByText(s):this.getAudioListByApi(r)]):[2];case 1:return l=c.sent()||[],this.data.set("getVoiceListing",!1),i&&0!==l.length?(this.data.set("tmpAudioList",l),[4,this.playNewAudio()]):(e.Toast.show({message:"播报异常，请稍后再试"}),[2]);case 2:return c.sent(),[2]}}))})).apply(this)},detached:function(){var t=document.querySelector(".chat-search-own-audio");t&&t.parentNode.removeChild(t),window.removeEventListener("visibilitychange",this.globalPauseAudio),window.removeEventListener("pagehide",this.globalPauseAudio)},sendTtsLog:function(t){var e=this.data.get("conf.status");this.data.get("useCardSendLog")&&this.dispatch("send-log",Ak({type:"b",fm:"beha",target:t.target,action:1===e?"pause":"play"},this.data.get("graphCreationLog")))}}),Mk={};Mk= __call$(Object,"assign",[Mk,{audioIconWrapper:"audio-icon-wrapper_1nedb_1","audio-icon-wrapper":"audio-icon-wrapper_1nedb_1",audioIcon:"audio-icon_1nedb_1","audio-icon":"audio-icon_1nedb_1",playIcon:"play-icon_1nedb_23","play-icon":"play-icon_1nedb_23",playIconSvg:"play-icon-svg_1nedb_23","play-icon-svg":"play-icon-svg_1nedb_23",playIconDark:"play-icon-dark_1nedb_30","play-icon-dark":"play-icon-dark_1nedb_30",playIconDarkAndroid:"play-icon-dark-android_1nedb_33","play-icon-dark-android":"play-icon-dark-android_1nedb_33",yinbo1:"yinbo1_1nedb_82",animationYinbo1:"animationYinbo1_1nedb_1",yinbo2:"yinbo2_1nedb_87",animationYinbo2:"animationYinbo2_1nedb_1",laba:"laba_1nedb_92",animationLaba:"animationLaba_1nedb_1",audioIconNew:"audio-icon-new_1nedb_96","audio-icon-new":"audio-icon-new_1nedb_96",playIconNew:"play-icon-new_1nedb_107","play-icon-new":"play-icon-new_1nedb_107",playIconImgNew:"play-icon-img-new_1nedb_113","play-icon-img-new":"play-icon-img-new_1nedb_113",playIconSvgNew:"play-icon-svg-new_1nedb_117","play-icon-svg-new":"play-icon-svg-new_1nedb_117",playAgentIcon:"play-agent-icon_1nedb_133","play-agent-icon":"play-agent-icon_1nedb_133",playIconHolder:"play-icon-holder_1nedb_143","play-icon-holder":"play-icon-holder_1nedb_143"}]) ,Nk.template='\n    <span\n        on-click="clickAudio"\n        class="{{$style[\'audio-icon-wrapper\']}}"\n        data-module="broadcast"\n    >\n        <span\n            rl-type="stop"\n            on-click="handleClick"\n            class="{{$style[\'audio-icon\']}} {{newIcon ? $style[\'audio-icon-new\'] : \'\'}}"\n        >\n            \x3c!-- 播报按钮旧样式 --\x3e\n            <fragment>\n                <cos-icon\n                    s-show="paused"\n                    name="volume"\n                    class="{{$style[\'play-icon\']}}"\n                />\n                <svg\n                    s-show="!paused"\n                    class="{{$style[\'play-icon\']}} {{$style[\'play-icon-svg\']}} {{$style[\'play-agent-svg\']}}"\n                    width="18"\n                    height="18"\n                    viewBox="0 0 18 18"\n                    fill="none"\n                    xmlns="http://www.w3.org/2000/svg"\n                >\n                    \x3c!-- eslint-disable max-len --\x3e\n                    <path\n                        class="{{$style.yinbo2}}"\n                        d="M14.5449 2.65743L15.0638 3.22126C16.4545 4.73221 17.3056 6.83707 17.3056 9.14877C17.3056 11.4591 16.4555 13.5629 15.0663 15.0736L14.5476 15.6377L13.4195 14.6003L13.9381 14.0363C15.0608 12.8154 15.7731 11.0845 15.7731 9.14877C15.7731 7.21187 15.06 5.48014 13.9362 4.25914L13.4172 3.69531L14.5449 2.65743Z"\n                        fill="#6e4bfa"\n                    />\n                    <path\n                        class="{{$style.yinbo1}}"\n                        d="M13.1319 5.85007L12.6875 5.2258L11.439 6.11454L11.8833 6.7388C12.3383 7.3779 12.6167 8.1969 12.6167 9.0988C12.6167 10.0049 12.3357 10.8273 11.877 11.4677L11.4308 12.0907L12.6767 12.9831L13.1229 12.3601C13.7695 11.4574 14.1493 10.3224 14.1493 9.0988C14.1493 7.8808 13.773 6.7507 13.1319 5.85007Z"\n                        fill="#6e4bfa"\n                    />\n                    <path\n                        class="{{$style.laba}}"\n                        d="M8.93333 3.25245L5.62553 6.21187C5.20593 6.58727 4.6627 6.7948 4.0997 6.7948H2.33333V11.4135H4.0506C4.61007 11.4135 5.15017 11.6185 5.5688 11.9896L8.93333 14.9728V3.25245ZM8.3846 1.95431C8.61683 1.74652 8.91267 1.65242 9.20017 1.6684C9.48767 1.68439 9.77123 1.81069 9.97903 2.04293C10.1643 2.24997 10.2667 2.51803 10.2667 2.79583V15.4267C10.2667 15.7383 10.1395 16.0215 9.93593 16.2251C9.73233 16.4287 9.44913 16.5559 9.1375 16.5559C8.86143 16.5559 8.59493 16.4547 8.38837 16.2716L4.6842 12.9873C4.5095 12.8324 4.2841 12.7468 4.0506 12.7468H2.12917C1.81754 12.7468 1.53433 12.6197 1.33073 12.4161C1.12712 12.2125 1 11.9293 1 11.6177V6.59064C1 6.27904 1.12712 5.9958 1.33073 5.7922C1.53433 5.5886 1.81754 5.46147 2.12917 5.46147H4.0997C4.33467 5.46147 4.56137 5.37487 4.7365 5.2182L8.3846 1.95431Z"\n                        fill="#6e4bfa"\n                    />\n                    \x3c!-- eslint-enable max-len --\x3e\n                </svg>\n            </fragment>\n        </span>\n        <span s-if="{{isShowText}}" class="cos-space-ml-xxs">播报</span>\n    </span>\n';var qk="function"==typeof Nk?Nk.prototype.initData||jk:Nk.initData||jk;function jk(){return{$style:Mk}}function Bk(){return  __call$(Object,"assign",[{},qk.call(this),{$style:Mk}]) }"function"==typeof Nk?Nk.prototype.initData=Bk:Nk.initData=Bk;var Hk=a.defineComponent({components:{"cos-icon":e.Icon},initData:function(){return{cid:"",isShowEditTxt:!1}},attached:function(){this.dispatch("send-ubclog",{type:"show",value:"edit"})},handleEdit:function(t){this.fire("edit-click"),this.dispatch("send-log",{type:"b",fm:"beha",target:t.target})}}),$k={};$k= __call$(Object,"assign",[$k,{edit:"edit_1s10o_1",icon:"icon_1s10o_1",text:"text_1s10o_7",editText:"edit-text_1s10o_17","edit-text":"edit-text_1s10o_17"}]) ,Hk.template='\n    <div\n        data-module="edit"\n        data-cid="{{cid}}"\n        class="{{$style[\'edit\']}} {{isShowEditTxt ? $style.editText : \'\'}}"\n        on-click="handleEdit"\n    >\n        <cos-icon class="{{$style[\'icon\']}}" name="input" />\n        <span s-if="{{isShowEditTxt}}" class="{{$style.text}} cos-font-medium">编辑</span>\n    </div>\n';var Fk="function"==typeof Hk?Hk.prototype.initData||Uk:Hk.initData||Uk;function Uk(){return{$style:$k}}function Gk(){return  __call$(Object,"assign",[{},Fk.call(this),{$style:$k}]) }function Wk(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function zk(){return zk=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},zk.apply(this,Array.from(arguments))}function Qk(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Hk?Hk.prototype.initData=Gk:Hk.initData=Gk;var Jk=a.defineComponent({cryptoJS:null,components:{"sc-icon":e.Icon},initData:function(){return{tplInfo:{},downloadUrl:"",isPc:!1,graphCreationLog:{},downloadParams:{sk:"etdh47hd78ehr4vd530ch378d83jtb3u",ak:"B3YhqQYhgQ67HgTssGsQy8KmsP"}}},attached:function(){var e=this;this.data.get("isPc")||new Promise((function(e,n){t(["./crypto.pc.DP5BwNok"],e,n)})).then((function(t){return t.index})).then((function(t){e.cryptoJS=t})),this.dispatch("send-ubclog",{type:"show",value:"download"}),this.dispatch("send-midlog",{cst:2,clk_extra:{t:1}})},downloadText:function(t){return(e=function(){var e,n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y;return Qk(this,(function(w){switch(w.label){case 0:return w.trys.push([0,2,,3]),[4,gs()];case 1:return w.sent(),[3,3];case 2:return w.sent(),[2,Qn().emit({text:"登录失败，请稍后再试"})];case 3:return navigator.onLine?(this.fire("click-log","download"),this.dispatch("send-log",{type:"b",fm:"beha",target:t.target,extra:zk({clk_region:"function"},this.data.get("graphCreationLog"))}),"function"!=typeof(a=this.data.get("getDownloadTarget"))?[2]:(i=a())?(o=i.innerText,r=this.data.get("isPc"),s=_t(on.getState("query"))||"文档",r?(l=new Blob([o],{type:"text/plain"}),c=URL.createObjectURL(l), __set$(d=document.createElement("a"),"href",c) ,d.download=s,d.click(),[2]):(u=String(Date.now()),p=this.data.get("downloadParams"),h=p.ak,f=p.sk,g=(null==(e=this.cryptoJS)?void 0:e.MD5(o+f+u))||"",m=g.toString(null==(n=this.cryptoJS)?void 0:n.enc.Hex),v=this.data.get("downloadUrl"),y=this.data.get("tplInfo").query,fetch(v,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"post",credentials:"include",body:Ht.params({fileType:"txt",content:o,signature:m,timestamp:u,ak:h})}).then((function(t){return t.json()})).then((function(t){if(0===t.errno){var e=t.data.fileUrl;Hn().conversation.clickDownload.emit({downloadUrl:e,fileName:"AI助手-"+y})}})),[2])):[2]):[2,Qn().emit({text:"网络异常，请稍后再试"})]}}))},function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){Wk(o,a,i,r,s,"next",t)}function s(t){Wk(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var e}}),Vk={};Vk= __call$(Object,"assign",[Vk,{download:"download_1hyxh_1",icon:"icon_1hyxh_4",downloadText:"download-text_1hyxh_19","download-text":"download-text_1hyxh_19",text:"text_1hyxh_24"}]) ,Jk.template='\n    <div>\n        <div\n            data-module="download"\n            class="cos-row download-container {{$style.download}} {{$style.downloadDark}} {{!downloadTxtDisable ? $style.downloadText : \'\'}}"\n            on-click="downloadText"\n        >\n            <sc-icon class="{{$style.icon}}" name="download" />\n            <span class="{{$style.text}} cos-font-medium">下载</span>\n        </div>\n    </div>\n';var Kk="function"==typeof Jk?Jk.prototype.initData||Xk:Jk.initData||Xk;function Xk(){return{$style:Vk}}function Yk(){return  __call$(Object,"assign",[{},Kk.call(this),{$style:Vk}]) }function Zk(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function tS(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Jk?Jk.prototype.initData=Yk:Jk.initData=Yk;var eS=a.defineComponent({components:{"cos-icon":e.Icon},computed:{},initData:function(){return{rank:1}},attached:function(){this.dispatch("send-ubclog",{type:"show",value:"share"})},onClick:function(t){return(e=function(){var e,n,a,i;return tS(this,(function(o){return this.dispatch("send-log",{type:"b",fm:"beha",target:t.target,extra:{clk_region:"function"}}),e=ci(),n=di(e,"15.9")>=0,a=this.data.get("isHistory")?"history":"generate",i=this.data.get("rank")-on.getState("qaPairIdDiff"),n?Hn().conversation.showShareMenu.emit({location_id:a+"_"+i,location_type:"answer_card"}):Ba().emit({params:{location_id:"generate_"+i,function_type:"card_function_share",location_type:"answer_card"}}),[2]}))},function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){Zk(o,a,i,r,s,"next",t)}function s(t){Zk(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var e}}),nS={};nS= __call$(Object,"assign",[nS,{share:"share_1juxc_1",icon:"icon_1juxc_4",text:"text_1juxc_10"}]) ,eS.template='\n    <div>\n        <div\n            class="cos-row {{$style.share}}"\n            data-module="share"\n            on-click="onClick"\n        >\n            <cos-icon class="{{$style.icon}}" name="share1" />\n            <span s-if="{{shareText}}" class="{{$style.text}} cos-font-medium">分享</span>\n        </div>\n    </div>\n';var aS="function"==typeof eS?eS.prototype.initData||iS:eS.initData||iS;function iS(){return{$style:nS}}function oS(){return  __call$(Object,"assign",[{},aS.call(this),{$style:nS}]) }"function"==typeof eS?eS.prototype.initData=oS:eS.initData=oS;var rS=a.defineComponent({components:{"wd-praise":pk,copy:yk,replace:Ik,"wd-tts-player":Nk,edit:Hk,download:Jk,share:eS,"cos-icon":e.Icon,"cos-tooltip":e.Tooltip},initData:function(){var t=this;return{praise:{},comment:{},tplInfo:{},logExtParams:{},ttsUrl:"",ttsPaused:!0,useWiseStyle:!1,useCardSendLog:!1,isWendaIndex:!1,hudongTtsUrl:"",graphCreationLog:{},realShowData:{},isDataFlyWheel:!1,showTts:!1,ttsApiFrom:"h5",isPreventLog:!1,forceShowReplaceText:!0,dispatchedReplaceClickEvents:["send-log"],agentInfo:{},isBless:!1,isShowEdit:!1,cid:"",isShowEditTxt:!1,itemPosition:"",logExtData:{},isShowDownload:!1,isPc:!1,rank:0,isDeepSeekPage:lt(),isShowTooltip:!1,leftCanShowBtn:{copy:!0,tts:!0,share:!0,praise:!0,feedback:!1},toolTipShow:!1,getAladdinContainer:function(){return t.el}}},attached:function(){var t=this;this.data.get("isShowtotalWord")&&setTimeout((function(){t.handleEditLength()}),300),this.watch("isShowReplace",(function(e){e||(t.data.set("isReplacing",!0),setTimeout((function(){t.data.set("isReplacing",!1),t.calcLeftBtnLen()}),160))})),setTimeout((function(){t.calcLeftBtnLen()}),300)},handleEditLength:function(){var t=this.el.closest(".answer-container");if(!t.querySelector("#writing-markdown")){var e=t.querySelectorAll(".cosd-markdown-content"),n="";e.forEach((function(t){t.closest("[disable-copy]")||(n+=t.textContent)})),this.data.set("editTotalWord",Mp(n,""))}},onReplace:function(t){this.fire("replace",t)},onEditClick:function(t){this.fire("edit-click",t)},ttsChange:function(t){this.data.set("ttsPaused",null==t?void 0:t.paused)},ttsClick:function(t){t.preventDefault(),t.stopPropagation();var e=this.ref("ttsPlayer");e&&e.clickAudio(t)},handleInteractClickLog:function(t){this.fire("click-log",t)},calcLeftBtnLen:function(){var t,e,n,a,i={copy:!0,tts:!0,share:!0,praise:!0,feedback:!1};this.data.set("leftCanShowBtn",i);var o,r,s=this.ref("left"),l=(null==s||null==(t=s.getBoundingClientRect())?void 0:t.right)||0,c=this.ref("tts"),d=null==(e=this.ref("share"))?void 0:e.el,u=null==(n=this.ref("praise"))?void 0:n.el;d&&(null==(a=d.getBoundingClientRect())?void 0:a.right)>l&&(i.share=!1,i.feedback=!0,i.praise=!1,u&&(null==(o=u.getBoundingClientRect())?void 0:o.right)>l?(i.tts=!1,c&&(null==(r=c.getBoundingClientRect())?void 0:r.right)>l?(i.copy=!1,this.data.set("leftCanShowBtn",i)):this.data.set("leftCanShowBtn",i)):this.data.set("leftCanShowBtn",i))},handleTooltipToggle:function(t){this.data.set("toolTipShow",t)}}),sS={};sS= __call$(Object,"assign",[sS,{interactTotalWord:"interact-total-word_9b6cv_80","interact-total-word":"interact-total-word_9b6cv_80",interactWrapper:"interact-wrapper_9b6cv_86","interact-wrapper":"interact-wrapper_9b6cv_86",opacityAnimation:"opacityAnimation_9b6cv_1",interactItem:"interact-item_9b6cv_99","interact-item":"interact-item_9b6cv_99",fadeOut:"fade-out_9b6cv_102","fade-out":"fade-out_9b6cv_102",fadeOutScale2:"fadeOutScale2_9b6cv_1",moveRight:"moveRight_9b6cv_1","move-right":"move-right_9b6cv_105",interactWrapperSpace:"interact-wrapper-space_9b6cv_108","interact-wrapper-space":"interact-wrapper-space_9b6cv_108",interactWrapperLeft:"interact-wrapper-left_9b6cv_111","interact-wrapper-left":"interact-wrapper-left_9b6cv_111",interactWrapperRight:"interact-wrapper-right_9b6cv_117","interact-wrapper-right":"interact-wrapper-right_9b6cv_117",ttsChatWrapper:"tts-chat-wrapper_9b6cv_122","tts-chat-wrapper":"tts-chat-wrapper_9b6cv_122",feedbackWrapper:"feedback-wrapper_9b6cv_132","feedback-wrapper":"feedback-wrapper_9b6cv_132",tooltipContent:"tooltip-content_9b6cv_148","tooltip-content":"tooltip-content_9b6cv_148",fadeOutScale:"fadeOutScale_9b6cv_1",fadeInScale:"fadeInScale_9b6cv_1",ttsPlayer:"tts-player_9b6cv_178","tts-player":"tts-player_9b6cv_178",ttsAgentPlayer:"tts-agent-player_9b6cv_183","tts-agent-player":"tts-agent-player_9b6cv_183",ttsWrapper:"tts-wrapper_9b6cv_193","tts-wrapper":"tts-wrapper_9b6cv_193",ttsText:"tts-text_9b6cv_208","tts-text":"tts-text_9b6cv_208",ttsTextColor:"tts-text-color_9b6cv_212","tts-text-color":"tts-text-color_9b6cv_212",ttsPlaying:"tts-playing_9b6cv_215","tts-playing":"tts-playing_9b6cv_215",ttsPlayingGen:"tts-playing-gen_9b6cv_218","tts-playing-gen":"tts-playing-gen_9b6cv_218",editCopy:"edit-copy_9b6cv_245","edit-copy":"edit-copy_9b6cv_245"}]) ,rS.template='\n    <div>\n        <div\n            s-if="{{editTotalWord}}"\n            class="{{$style[\'interact-total-word\']}}"\n        > \n            共{{editTotalWord}}字\n        </div>\n        <div\n            class="{{$style[\'interact-wrapper\']}}"\n            s-bind="{{realShowData}}"\n        >\n            <div s-ref="left" class="{{$style[\'interact-wrapper-left\']}}">\n                <copy\n                    s-if="{{isShowCopy && leftCanShowBtn.copy}}"\n                    s-ref="copy"\n                    get-copy-target="{{getCopyTarget}}"\n                    copy-txt-disable="{{copyTxtDisable || isShowEdit}}"\n                    tpl-info="{{tplInfo}}"\n                    graph-creation-log="{{graphCreationLog}}"\n                    on-click-log="handleInteractClickLog"\n                />\n                <div\n                    s-if="{{isShowTts && leftCanShowBtn.tts}}"\n                    s-ref="tts"\n                    class="{{$style[\'tts-chat-wrapper\']}}">\n                    <wd-tts-player\n                        s-ref="ttsPlayer"\n                        class="{{$style[\'tts-agent-player\']}}"\n                        text="{{ttsText}}"\n                        voice-api="{{ttsUrl || hudongTtsUrl}}"\n                        use-card-send-log="{{useCardSendLog}}"\n                        graph-creation-log="{{graphCreationLog}}"\n                        tts-api-from="{{ttsApiFrom}}"\n                        setype="{{setype}}"\n                        agent-info="{{agentInfo}}"\n                    />\n                </div>\n                <wd-praise\n                    s-if="{{leftCanShowBtn.praise}}"\n                    s-ref="praise"\n                    url="{{praise.url}}"\n                    fe-dislike-key="{{praise.feDislikeKey}}"\n                    fe-like-type="{{praise.feLikeType}}"\n                    word="{{praise.word}}"\n                    status="{{praise.status}}"\n                    feedback-id="{{praise.feedbackId}}"\n                    feedback-title="{{praise.feedbackTitle}}"\n                    feedback-content-list="{{praise.feedbackContentList}}"\n                    is-gen-pc="{{praise.isGenPc}}"\n                    graph-creation-log="{{graphCreationLog}}"\n                    setype="{{setype}}"\n                    is-bless="{{isBless}}"\n                    is-prevent-log="{{isPreventLog}}"\n                />\n                <share\n                    s-if="{{isShowShare && leftCanShowBtn.share}}"\n                    s-ref="share"\n                    rank="{{rank}}"\n                    is-history="{{isHistory}}"\n                />\n                <cos-tooltip\n                    s-if="{{leftCanShowBtn.feedback}}"\n                    s-ref="tool-tip"\n                    bubbleClass="{{toolTipShow ? \'interact-tooltip interact-tooltip-show\' : \'interact-tooltip interact-tooltip-hide\'}}"\n                    on-toggle="handleTooltipToggle"\n                >\n                    <div class="{{$style[\'feedback-wrapper\']}}">\n                        <cos-icon class="{{$style[\'feedback\']}} "name="feedback" />\n                    </div>\n                    <div\n                        slot="content"\n                        s-ref="tool-tip-content"\n                        class="{{$style[\'tooltip-content\']}}"\n                    >\n                        <share\n                            s-if="{{isShowShare && !leftCanShowBtn.share}}"\n                            share-text="{{true}}"\n                            rank="{{rank}}"\n                            is-history="{{isHistory}}"\n                        />\n                        <div s-if="{{!leftCanShowBtn.praise}}" class="cos-divider"></div>\n                        <wd-praise\n                            s-if="{{!leftCanShowBtn.praise}}"\n                            url="{{praise.url}}"\n                            fe-dislike-key="{{praise.feDislikeKey}}"\n                            fe-like-type="{{praise.feLikeType}}"\n                            word="{{praise.word}}"\n                            status="{{praise.status}}"\n                            feedback-id="{{praise.feedbackId}}"\n                            feedback-title="{{praise.feedbackTitle}}"\n                            feedback-content-list="{{praise.feedbackContentList}}"\n                            is-gen-pc="{{praise.isGenPc}}"\n                            graph-creation-log="{{graphCreationLog}}"\n                            setype="{{setype}}"\n                            is-bless="{{isBless}}"\n                            is-prevent-log="{{isPreventLog}}"\n                            cai-text="{{true}}"\n                        />\n                        <div s-if="{{isShowTts && !leftCanShowBtn.tts}}" class="cos-divider"></div>\n                        <div s-if="isShowTts && !leftCanShowBtn.tts" class="{{$style[\'tts-chat-wrapper\']}} {{$style[\'interact-item\']}}">\n                            <wd-tts-player\n                                s-ref="ttsPlayer"\n                                class="{{$style[\'tts-agent-player\']}}"\n                                text="{{ttsText}}"\n                                voice-api="{{ttsUrl || hudongTtsUrl}}"\n                                use-card-send-log="{{useCardSendLog}}"\n                                graph-creation-log="{{graphCreationLog}}"\n                                tts-api-from="{{ttsApiFrom}}"\n                                setype="{{setype}}"\n                                agent-info="{{agentInfo}}"\n                                is-show-text="{{true}}"\n                            />\n                        </div>\n                        <div s-if="isShowCopy && !leftCanShowBtn.copy" class="cos-divider"></div>\n                        <copy\n                            s-if="{{isShowCopy && !leftCanShowBtn.copy}}"\n                            get-copy-target="{{getCopyTarget}}"\n                            copy-txt-disable="{{false}}"\n                            tpl-info="{{tplInfo}}"\n                            graph-creation-log="{{graphCreationLog}}"\n                            on-click-log="handleInteractClickLog"\n                        />\n                    </div>\n                </cos-tooltip>\n            </div>\n            <div s-ref="middle" class="{{$style[\'interact-wrapper-space\']}}"></div>\n            <div s-ref="right" class="{{$style[\'interact-wrapper-right\']}}">\n                <edit\n                    s-if="{{isShowEdit}}"\n                    cid="{{cid}}"\n                    is-show-edit-txt="{{isShowEditTxt}}"\n                    class="{{$style[\'interact-item\']}} {{isReplacing ? $style[\'move-right\'] : \'\'}}"\n                    on-edit-click="onEditClick"\n                />\n                <replace\n                    s-if="{{isShowReplace || isReplacing}}"\n                    class="{{$style[\'interact-item\']}} {{isReplacing ? $style[\'fade-out\'] : \'\'}}"\n                    is-fixed-width\n                    is-gray="{{replaceGray}}"\n                    graph-creation-log="{{graphCreationLog}}"\n                    replace-text="{{replaceText}}"\n                    replace-icon="{{replaceIcon}}"\n                    setype="{{setype}}"\n                    is-prevent-log="{{isPreventLog}}"\n                    force-show-replace-text="{{forceShowReplaceText}}"\n                    dispatched-click-events="{{dispatchedReplaceClickEvents}}"\n                    is-bless="{{isBless}}"\n                    rank="{{rank}}"\n                    on-click="onReplace"\n                    on-click-log="handleInteractClickLog"\n                />\n            </div>\n        </div>\n    </div>\n';var lS="function"==typeof rS?rS.prototype.initData||cS:rS.initData||cS;function cS(){return{$style:sS}}function dS(){return  __call$(Object,"assign",[{},lS.call(this),{$style:sS}]) }"function"==typeof rS?rS.prototype.initData=dS:rS.initData=dS;var uS=a.defineComponent({components:{"dqa-interact":rS,"reference-wrapper":ok},computed:{realShowData:function(){var t,e=null==(t=this.data.get("interactData"))?void 0:t.replaceText,n="sge_spring"===this.data.get("setype");return n&&("重写"===e?e="rewrite":"重画"===e&&(e="redraw")),n&&e?{"data-show":"hudong","data-show-ext":JSON.stringify({hudong_name:["zan","cai",e]})}:{}},isPc:function(){return"pc"===rt()}},initData:function(){return{isShowReference:!1,interactData:{},referList:null,isShowInteract:!1,replaceGray:!1,isShowSug:!1,suglist:null,isShowButton:!1,theme:{},fallbackAskShow:!1,logExtParams:{},isNeedTtsAnimation:!1,agentInfo:{},isBless:!1,isPc:!1,tplInfo:{},cid:"",logExtData:{},rank:0}},attached:function(){this.showPauseInconButton()},showPauseInconButton:function(){var t=this.data.get("isShowButton");ga().emit({isShowButton:t})},onReplace:function(t){this.fire("replace",t)},onSugClick:function(t){this.fire("sug-click",t)},onInteractButtonLog:function(t){this.fire("button-click",{state:"",isInteractClick:!0,value:t})},onEditClick:function(){this.fire("edit-click")}}),pS={};pS= __call$(Object,"assign",[pS,{interact:"interact_ga96m_1",interactCsaitab:"interact-csaitab_ga96m_8","interact-csaitab":"interact-csaitab_ga96m_8",footerDownload:"footer-download_ga96m_12","footer-download":"footer-download_ga96m_12",interactRefer:"interact-refer_ga96m_16","interact-refer":"interact-refer_ga96m_16"}]) ,uS.template='\n    <div class="{{interactData.isShowDownload ? $style[\'footer-download\'] : \'\'}}">\n        \x3c!-- 溯源区 --\x3e\n        <reference-wrapper\n            s-if="{{isShowReference && referList}}"\n            is-show-download="{{interactData.isShowDownload}}"\n            refer-list="{{referList}}"\n            log-ext-params="{{logExtParams}}"\n            tplInfo="{{tplInfo}}"\n        />\n        \x3c!-- 互动区 --\x3e\n        <dqa-interact\n            s-ref="interact"\n            s-if="{{isShowInteract}}"\n            s-bind="{{interactData}}"\n            is-history="{{isHistory}}"\n            get-copy-target="{{getCopyTarget}}"\n            class="\n                {{$style[\'interact\']}}\n                {{$style[\'interact-csaitab\']}}\n                {{isShowReference && referList ? $style[\'interact-refer\'] : \'\'}}\n            "\n            on-replace="onReplace"\n            agent-info="{{agentInfo}}"\n            tts-text="{{ttsText}}"\n            replace-gray="{{replaceGray}}"\n            graph-creation-log="{{graphCreationLog}}"\n            setype="{{setype}}"\n            is-bless="{{isBless}}"\n            rank="{{rank}}"\n            is-pc="{{isPc}}"\n            real-show-data="{{realShowData}}"\n            cid="{{cid}}"\n            is-prevent-log="{{setype === \'sge_spring\'}}"\n            log-ext-data="{{logExtData}}"\n            log-ext-params="{{logExtParams}}"\n            on-edit-click="onEditClick"\n            on-click-log="onInteractButtonLog"\n            tplInfo="{{tplInfo}}"\n        />\n    </div>\n';var hS,fS="function"==typeof uS?uS.prototype.initData||gS:uS.initData||gS;function gS(){return{$style:pS}}function mS(){return  __call$(Object,"assign",[{},fS.call(this),{$style:pS}]) }function vS(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function yS(){return yS=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},yS.apply(this,Array.from(arguments))}function wS(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return vS(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vS(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}"function"==typeof uS?uS.prototype.initData=mS:uS.initData=mS;var bS={praise:{feLikeKey:"mockkey",feDislikeKey:"mockkey",feLikeType:"mock",feedbackContentList:[["答非所问","回答有误"],["信息过时","没有帮助"],["存在偏见","内容违法"]],feedbackTitle:"请选择遇到的问题",likeTxtDisable:!0,word:"",feedbackId:"ai_index_history_",feedbackCustom:!0,isGenPc:!1,showDivider:!0},isChatSearch:!0,isShowCopy:!0,isShowReplace:!1,isShowTts:!0,replaceText:"",replaceIcon:"exchange",commentDisable:!0,useCardSendLog:!0,useWiseStyle:!0,copyTxtDisable:!0,isShowEditTxt:!0,isShowEdit:!1,tplInfo:{},hudongTtsUrl:"",ttsApiFrom:"csaitab",isShowShare:ft()&&!lt(),setype:(null==(hS=on.getState("chatParams"))?void 0:hS.setype)||"",isShowtotalWord:!1},_S=a.defineComponent({components:{footer:uS},computed:{customBgImgStyle:function(){if(this.data.get("isWritingScene"))return{};var t=this.data.get("logExtData");if("text"===(null==t?void 0:t.scene)&&"text_work"===(null==t?void 0:t.scene_1st))return{};var e=this.data.get("bgProps"),n=e.backgroundImage,a=e.backgroundImageDark,i=e.bgLinearGradient,o="",r="";return n&&(o+="url("+n+")",r+="url("+(a||n)+")"),i&&(o=o?o+", ":"",r=r?r+", ":"",o+="linear-gradient(to bottom, "+i+")",r+="linear-gradient(to bottom, "+i+")"),o?{"--custom-bg":o,"--custom-bg-dark":r}:{}},isWritingScene:function(){var t=this.data.get("interactData");return null==t?void 0:t.isShowEdit},isAlaHat:function(){var t=this.data.get("currentAnswer");if(!t)return!1;if(!this.data.get("isHistory"))return this.data.get("commonData.isAlaHat");for(var e,n=wS(t);!(e=n()).done;){var a=e.value;if(null==a?void 0:a.is_ala_hat)return!0}return!!this.data.get("hasAlaCard")||void 0},referenceList:function(){var t=this.data.get("currentAnswer");if(!t)return[];if(!this.data.get("isHistory"))return t.referenceList;return function(t){if(!Array.isArray(t))return[];for(var e,n=null,a=!1,i=wS(t);!(e=i()).done;){var o=e.value;if(o&&o.component){if(o.component.includes("markdown")&&o.data&&Array.isArray(o.data.referenceList))return a=!0,n=o.data.referenceList;o.component.includes("reference")&&!a&&o.data&&Array.isArray(o.data.referenceList)&&(n=o.data.referenceList)}}return n||[]}(t)},isShowReference:function(){var t=this.data.get("referenceList"),e=this.data.get("isHistory"),n=this.data.get("currentAnswer"),a=this.data.get("isAlaHat");return e?t&&t.length&&!a:t&&t.length&&!a&&!(null==n?void 0:n.isLoading)},interactData:function(){var t=this.data.get("isHistory"),e=this.data.get("currentAnswer");if(e){var n;if(!t)return null==(n=e.interactData)?void 0:n.data;var a=yS({},bS),i=this.data.get("rank"),o=this.data.get("latestRank");a.isShowReplace=i===o,a.praise.feedbackId="ai_index_history_"+i;for(var r,s=wS(e);!(r=s()).done;){var l=r.value;"ai-writing"!==l.component&&"writing"!==l.component&&7!==l.queryIntent&&24!==l.queryIntent||lt()||l.isMcp||(Hy()&&(a.isShowEdit=!0),a.isShowtotalWord=!0)}return a}},isShowInteract:function(){if(this.data.get("isPc"))return!1;var t=this.data.get("isHistory"),e=this.data.get("currentAnswer"),n=this.data.get("isAlaHat"),a=this.data.get("interactData");return t?a&&!n&&!this.data.get("isSeparateBub"):a&&!(null==e?void 0:e.isLoading)&&!n&&!(null==e?void 0:e.hideInteract)}},initData:function(){var t=this;return{bgProps:{},isPc:"pc"===rt(),getCopyTarget:function(){var e;return null==(e=t.el)?void 0:e.querySelector(".marklang, .ai-entry")},qaPairIdDiff:on.getState("qaPairIdDiff"),graphCreationLog:{},commonData:{}}},attached:function(){var t=this;this.data.get("isPc")||setTimeout((function(){if(t.data.get("isHistory")){var e,n=null==(e=t.el)?void 0:e.querySelector(".ai-entry"),a=Op(n);t.data.set("ttsText",a)}}),300)},handleReplace:function(){var t=this.data.get("isHistory"),e=this.data.get("qaPairIdDiff"),n=t?"history":"generate",a=this.data.get("rank")-e;Ba().emit({params:{location_id:n+"_"+a,function_type:"card_function_regenerate",location_type:"answer_card"}})},onEditClick:function(){this.fire("edit-click")}}),kS={};kS= __call$(Object,"assign",[kS,{container:"container_17olx_1",borderLayer:"border-layer_17olx_17","border-layer":"border-layer_17olx_17",containerCustom:"container-custom_17olx_28","container-custom":"container-custom_17olx_28",bgHeader:"bg-header_17olx_41","bg-header":"bg-header_17olx_41",horizontalGradientBox:"horizontal-gradient-box_17olx_51","horizontal-gradient-box":"horizontal-gradient-box_17olx_51"}]) ,_S.template='\n    <div\n        style="{{customBgImgStyle}}"\n        class="answer-container\n            cs-enable-selection\n            {{$style[\'container\']}}\n            {{bgProps && (bgProps.backgroundImage || bgProps.bgLinearGradient)\n            && !isWritingScene ? $style[\'container-custom\'] : \'\'}}\n        "\n    >\n        <div s-if="bgProps && bgProps.image && !isWritingScene" class="{{$style[\'bg-header\']}}">\n            <div\n                data-no-na-dialog\n                class="{{$style[\'horizontal-gradient-box\']}}"\n            ></div>\n            <div class="{{$style[\'border-layer\']}}"></div>\n        </div>\n        <slot></slot>\n        <footer\n            s-ref="footer"\n            is-show-reference="{{isShowReference}}"\n            is-history="{{isHistory}}"\n            refer-list="{{referenceList}}"\n            is-show-interact="{{isShowInteract}}"\n            is-show-button="{{isShowButton}}"\n            interact-data="{{interactData}}"\n            get-copy-target="{{getCopyTarget}}"\n            tts-text="{{ttsText}}"\n            agent-info="{{agentInfo}}"\n            graph-creation-log="{{graphCreationLog}}"\n            setype="{{setype}}"\n            is-bless="{{isBless}}"\n            is-pc="{{isPc}}"\n            rank="{{rank}}"\n            cid="{{cid}}"\n            on-replace="handleReplace"\n            on-edit-click="onEditClick"\n            tplInfo="{{tplInfo}}"\n            log-ext-params="{{logExtParams}}"\n        ></footer>\n    </div>\n';var SS="function"==typeof _S?_S.prototype.initData||xS:_S.initData||xS;function xS(){return{$style:kS}}function IS(){return  __call$(Object,"assign",[{},SS.call(this),{$style:kS}]) }"function"==typeof _S?_S.prototype.initData=IS:_S.initData=IS;var TS="data-has-question-head",CS=Tt.connect(on,{imageQuery:"imageQuery"})(a.defineComponent({initData:function(){return{isShowTitle:!1,isShowPos:!1,titleClass:"",titleText:"",currentIndex:1,length:1,imageQuery:{},isPc:"pc"===rt()}},computed:{rectList:function(){var t=this.data.get("rank"),e=this.data.get("imageQuery");return e&& __get$(e,t) && __get$(e,t) .rectList&& __get$(e,t) .rectList.length? __get$(e,t) .rectList:[]},rectIndex:function(){var t=this.data.get("rank"),e=this.data.get("imageQuery");return e&& __get$(e,t) &&void 0!== __get$(e,t) .rectIndex? __get$(e,t) .rectIndex:-1},isShowQuestionHead:function(){var t=this.data.get("isHistory"),e=this.data.get("rectList");return!t&&e&&e.length>1}},onTitleClick:function(t){this.fire("title-click",t)},handleImageQueryClick:function(t){var e=this.data.get("rank");this.dispatch("image-query-tab:click",t),Kn().emit({index:t,rank:e})},attached:function(){var t=this.data.get("isHistory"),e=this.data.get("rectList");!t&&e&&e.length>1&&this.dispatch("image-query-tab:show-log",{ubcId:"17132",page:"resultpage",type:"show",value:"change_question_number",extra:{question_number:this.data.get("rectIndex")}}),this.listenQuestionHeadShow()},setQuestionHeadData:function(){this.answerBoxDom&&kn(this.answerBoxDom,TS,"true")},removeQuestionHeadData:function(){this.answerBoxDom&&kn(this.answerBoxDom,TS,null)},listenQuestionHeadShow:function(){var t=this;this.answerBoxDom=xn(this.el,Xt,null),this.data.get("isShowQuestionHead")&&this.setQuestionHeadData(),this.watch("isShowQuestionHead",(function(e){e?t.setQuestionHeadData():t.removeQuestionHeadData()}))},disposed:function(){this.removeQuestionHeadData(),this.answerBoxDom=null}})),LS={};LS= __call$(Object,"assign",[LS,{title:"title_z54ny_1",pos:"pos_z54ny_9",imageQueryHeadQuestion:"image-query-head-question_z54ny_38","image-query-head-question":"image-query-head-question_z54ny_38",imageQueryHeadContain:"image-query-head-contain_z54ny_48","image-query-head-contain":"image-query-head-contain_z54ny_48",imageQueryHeadImg:"image-query-head-img_z54ny_55","image-query-head-img":"image-query-head-img_z54ny_55",imageQueryHeadChoose:"image-query-head-choose_z54ny_77","image-query-head-choose":"image-query-head-choose_z54ny_77"}]) ,CS.template='\n    <div>\n        \x3c!-- 标题 --\x3e\n        <div s-if="isShowTitle" class="{{titleClass}}">\n            <div\n                data-module="char"\n                class="{{$style[\'title\']}}"\n                on-click="onTitleClick"\n            >\n                <span class="cu-line-clamp-default">{{titleText}}</span>\n            </div>\n        </div>\n        \x3c!-- 角标 --\x3e\n        <div\n            s-if="{{isShowPos && !isPc}}"\n            class="{{$style.pos}}"\n        >\n            {{currentIndex}}/{{length}}\n        </div>\n        <fragment s-if="!isHistory && rectList && rectList.length > 1">\n            <div class="{{$style[\'image-query-head-contain\']}} cos-space-mb-lg">\n                <div class="{{$style[\'image-query-head-question\']}}">\n                    <div\n                        s-for="item, index in rectList"\n                        on-click="handleImageQueryClick(index)"\n                        class="{{$style[\'image-query-head-img\']}} {{index === rectIndex ? $style[\'image-query-head-choose\'] : \'\'}}"\n                    >{{index + 1}}</div>\n                </div>\n            </div>\n        </fragment>\n    </div>\n';var DS="function"==typeof CS?CS.prototype.initData||PS:CS.initData||PS;function PS(){return{$style:LS}}function ES(){return  __call$(Object,"assign",[{},DS.call(this),{$style:LS}]) }function AS(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function OS(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function RS(){var e;return e=function(){return OS(this,(function(e){return[2,new Promise((function(e,n){new Promise((function(e,n){t(["./share-img-utils.pc.KeJdRRYE"],e,n)})).then((function(t){return t.html2canvas_min})).then((function(t){e(t)})).catch((function(t){n(t)}))}))]}))},RS=function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){AS(o,a,i,r,s,"next",t)}function s(t){AS(o,a,i,r,s,"throw",t)}r(void 0)}))},RS.apply(this,Array.from(arguments))}function NS(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function MS(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function qS(){return qS=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},qS.apply(this,Array.from(arguments))}function jS(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return NS(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?NS(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function BS(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof CS?CS.prototype.initData=ES:CS.initData=ES;var HS={copy:"复制","copy-link":"复制链接","view-picture":"查看图片","save-picture":"保存图片","share-picture":"分享图片","save-cloud":"保存云盘","ai-picture":"AI图","qr-code":"二维码",category:"图片垂类"};function $S(t,e,n){var a,i,o,r=t.data.get("rank"),s=r-on.getState("qaPairIdDiff"),l=_n('.cs-rank-container[rank="'+s+'"]'),c=null==(a=_n("[data-query]",l))?void 0:a.getAttribute("data-query"),d=on.getState("pageType"),u=n.bottom_safe_height;if(ht()&&di(ci(),"15.9")>=0&&"landing"===d){var p=on.getState("shareRankList");p.push(s),on.dispatch("update",{showSelectedBox:!0,shareRankList:[].concat(p)}),ja().emit(!0),function(){RS.apply(this,Array.from(arguments))}(),u&&(i=u,o=document.querySelector("body"),i?o.style.setProperty("--scroll-content-height",i+"px"):o.style.removeProperty("--scroll-content-height"))}else{var h=$c(s);da().emit({query:c,shareUrl:h,rank:r,type:e})}}function FS(){var t;return t=function(t){var e,n,a,i,o,r,s;return BS(this,(function(l){switch(l.label){case 0:if("pc"===rt())return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,gs()];case 2:return l.sent(),[3,4];case 3:return l.sent(),Qn().emit({text:"登录失败，请稍后再试"}),[2];case 4:if(e=t.data.get("rank"),n=on.getState("qaPairIdDiff"),(i=_n('.cs-rank-container[rank="'+(a=e-n)+'"]'))&&_n("[data-delete]",i)){o=_n("[data-delete]",i).getAttribute("data-delete"),r=null;try{r=JSON.parse(o)}catch(t){r={}}r.sessionId&&r.deleteQidList.length>0&&(s=qS({req_type:2,ori_lid_list:[{ori_lid:r.sessionId,qid_list:r.deleteQidList}]},Nr()?{knowledge_id:ti.getState("knowledgeId")}:{}),setTimeout((function(){pa().emit({content:"pc"===rt()?"":"是否删除该条消息",title:"pc"===rt()?"是否删除该条消息？":"",type:"warning",confirm:function(){!function(t,e){$l.deleteQAPair(t,e)}(a,s)}})}),200))}return[2]}}))},FS=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){MS(o,a,i,r,s,"next",t)}function s(t){MS(o,a,i,r,s,"throw",t)}r(void 0)}))},FS.apply(this,Array.from(arguments))}function US(t,e){void 0===e&&(e="generate");var n=Ki((function(n){var a="pc"===rt(),i=n.params||{},o=t.data.get("rank"),r=0;if(i.location_id){var s=i.location_id.split("_"),l=s[0],c=+s[1];if(!a)c+=on.getState("qaPairIdDiff");if(r=s[2],l!==e||c!==o)return}switch(i.function_type){case"card_function_tts":var d,u,p;if("history"===e){var h,f,g,m,v=t.data.get("aiContainerRef"),y=null==(g=t.ref(""+v))||null==(f=g.ref("footer"))||null==(h=f.ref("interact"))?void 0:h.ref("ttsPlayer");if(y)null==y||y.longPressPlay();else null==(m=t.ref("ttsPlayer"))||m.longPressPlay();break}var w=null==(d=t.ref("ai-container-"+t.data.get("currentIndex")+"-"+(r||t.data.get("currentAnswerIndex"))))?void 0:d.ref("cs-container"),b=null==w||null==(p=w.ref("footer"))||null==(u=p.ref("interact"))?void 0:u.ref("ttsPlayer");if(b)null==b||b.longPressPlay();else{b=t.ref("ttsPlayer");var _=t.data.get("ttsTextList["+t.data.get("currentIndex")+"]["+(r||t.data.get("currentAnswerIndex"))+"]");null==b||b.longPressPlay(_)}break;case"card_function_regenerate":var k=t.data.get("agentInfo"),S={sa:"re_dl_reans",agentInfo:{},is_rebuild:1};k&&(S.agentInfo=k);var x=function(t){var e=[],n=0;return null==t||t.forEach((function(t){var a,i;if("text"===t.type)e.push({type:"TEXT",data:{text:{query:(null==(i=t.data)||null==(a=i.question)?void 0:a.question)||"",text_type:""}}});else if("image"===t.type){var o,r;null==(r=t.data)||null==(o=r.question)||o.question.forEach((function(t){e.push({type:"IMAGE",data:{image:{image_url:t.image_url||t.imageUrl,image_id:t.image_id,image_b64:t.imageB64}}})})),n=2}else if("file"===t.type){var s,l;(null==(l=t.data)||null==(s=l.question)?void 0:s.question).forEach((function(t){e.push({type:"FILE",data:{file:{file_id:t.fileId,file_name:t.fileName,file_url:t.fileUrl,file_path:t.filePath,file_size:t.fileSize,status:1,file_type:t.fileType,file_uri:t.fileUri,file_count:t.fileCount}}})})),n=1}})),{sseQuery:e,interactionType:n}}(t.data.get("question")),I=x.sseQuery,T=x.interactionType;S.interactionType=T,Xl({query:I,extParams:S}).catch((function(t){console.error(t)}));break;case"card_function_report_feedback":var C=$c(o),L=function(t,e){if("generate"===e){var n,a,i=(null==t||null==(n=t.data)?void 0:n.get("agentInfo"))||"",o=(null==t||null==(a=t.data)?void 0:a.get("baseData"))||{},r=o.queryIndustry,s=void 0===r?"":r,l=o.queryIntent,c=void 0===l?"":l,d=o.lid;return{isAgent:i,queryIndustry:s,queryIntent:c,lid:void 0===d?"":d}}if("history"===e){var u,p=(null==t||null==(u=t.data)?void 0:u.get("question[0].data.agentInfo"))||"",h="",f="";try{for(var g,m,v=jS((null==t||null==(g=t.data)?void 0:g.get("blocksList")[0][0])||[]);!(m=v()).done;){var y=m.value;if((null==y?void 0:y.queryIndustry)&&(h=y.queryIndustry),(null==y?void 0:y.queryIntent)&&(f=y.queryIntent),h&&f)return{queryIndustry:h,queryIntent:f,isAgent:p}}}catch(t){}return{queryIndustry:h,queryIntent:f,isAgent:p}}}(t,e),D=L.isAgent,P=L.queryIndustry,E=L.queryIntent,A=L.lid,O=void 0===A?"":A,R=("pc"===rt()?"https://ufosdk.baidu.com/ufosdk/report/KoJVyE33%2BjJq0Y1tDecU9Q%3D%3D/294248":"https://ufosdk.baidu.com/ufosdk/report/iEm3bO8WwytHJrBiMWnFRg%3D%3D/294248")+"?question="+encodeURIComponent(t.data.get("question[0].data.question.question"))+"&answer_url="+encodeURIComponent(C)+"&extend_is_znt="+encodeURIComponent(D?1:2)+"&extend_industry="+encodeURIComponent(P)+"&extend_intention="+encodeURIComponent(E)+"&extend_lid="+encodeURIComponent(O);window.open(R,"_blank");break;case"card_function_share":$S(t,e,i);break;case"card_function_delete":!function(t){FS.apply(this,Array.from(arguments))}(t);break;case"card_function_local_selection":!function(t,e){var n=t;if(e&&(n=_n("#"+e)),n&&!xn(n,".cs-independen-guide, .ai-markdown-editor-content, .code-wrapper",null)&&Ri){var a=document.createRange();a.selectNodeContents(n);var i=window.getSelection();i.removeAllRanges(),i.addRange(a)}}(null,i.element_id);break;case"copy":case"copy-link":case"view-picture":case"save-picture":case"share-picture":case"save-cloud":case"ai-picture":case"qr-code":case"category":var N= __get$(HS,i.function_type) ||"";!function(t,e,n,a){var i;if("generate"===n&&(null==(i=t.data)?void 0:i.get("rank"))===on.getState("rank")&&Number.isFinite(e.location_x)&&Number.isFinite(e.location_y)){for(var o=window.document.elementsFromPoint(e.location_x,e.location_y),r="",s=0;s<o.length;s++){var l= __get$(o,s) ;l.closest(".cs-rank-container")&&(r=l.getAttribute("rank"))}if(Number(r)===on.getState("rank")){var c="copy"===e.function_type?1:5;ua().emit({isAction:!0,rank:on.getState("rank"),action:c,actionName:a})}}}(t,i,e,N)}}),300,{leading:!0,trailing:!1});return Ws().on(n),Ba().on(n),window.addEventListener("longPress",n),n}function GS(){return GS=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},GS.apply(this,Array.from(arguments))}var WS=a.defineComponent({components:{"cosc-feedback-form":e.FeedBackForm},computed:{},initData:function(){return{rank:1,feedbackInfo:[],currentFeedbackIndex:0,feedbackData:[]}},attached:function(){this.listener()},listenNewConversation:null,listener:function(){var t=this;this.listenNewConversation=function(){t.handleCloseFeedback(!0)},Jn().on(this.listenNewConversation),this.clickListener=function(e){e.target&&!t.el.contains(e.target)&&t.handleCloseFeedback()},document.addEventListener("click",this.clickListener,!0)},getExtData:function(){return{setype:"csaitab",is_plugin:"0",re_rank:String(this.data.get("rank")),a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),lid:on.getState("lid")}},handleSubmitFeedback:function(){var t=this.data.get("currentFeedbackIndex");this.data.set("feedbackInfo["+t+"].isFeedback",!0),Ua({type:"click",value:"submit_feedback",page:"resultpage",ext:GS({},this.getExtData(),{button:this.data.get("feedbackInfo["+t+"].type")})})},handleCloseFeedback:function(t){if(t)this.data.set("feedbackInfo[0].isShowFeedback",!1),this.data.set("feedbackInfo[1].isShowFeedback",!1);else{var e=this.data.get("currentFeedbackIndex");Ua({type:"click",value:"close_feedback",page:"resultpage",ext:GS({},this.getExtData(),{button:this.data.get("feedbackInfo["+e+"].type")})}),this.data.set("feedbackInfo["+e+"].isShowFeedback",!1)}},handleFeedbackInput:function(){var t=this.data.get("currentFeedbackIndex"),e=this.data.get("feedbackInfo["+t+"]");e.isInput||(this.data.set("feedbackInfo["+t+"].isInput",!0),Ua({type:"click",value:"zancai_edit",page:"resultpage",ext:GS({},this.getExtData(),{button:e.type})}))},disposed:function(){this.clickListener&&document.removeEventListener("click",this.clickListener,!0),this.listenNewConversation&&Jn().off(this.listenNewConversation)}}),zS={};zS= __call$(Object,"assign",[zS,{feedbackContainer:"feedback-container_lmv02_1","feedback-container":"feedback-container_lmv02_1"}]) ,WS.template='\n    \x3c!--赞踩反馈卡--\x3e\n    <div\n        class="{{$style[\'feedback-container\']}}"\n    >\n        <cosc-feedback-form\n            col="{{feedbackData[currentFeedbackIndex].col}}"\n            successMessage="{{feedbackData[currentFeedbackIndex].successMessage}}"\n            product="{{feedbackData[currentFeedbackIndex].product}}"\n            title="{{feedbackData[currentFeedbackIndex].title}}"\n            type="{{feedbackData[currentFeedbackIndex].type}}"\n            options="{{feedbackData[currentFeedbackIndex].options}}"\n            titleTag="{{feedbackData[currentFeedbackIndex].titleTag}}"\n            on-close="handleCloseFeedback(false)"\n            on-submit="handleSubmitFeedback"\n            on-input="handleFeedbackInput"\n        />\n    </div>\n';var QS="function"==typeof WS?WS.prototype.initData||JS:WS.initData||JS;function JS(){return{$style:zS}}function VS(){return  __call$(Object,"assign",[{},QS.call(this),{$style:zS}]) }function KS(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function XS(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function YS(){return YS=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},YS.apply(this,Array.from(arguments))}function ZS(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return KS(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?KS(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tx(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof WS?WS.prototype.initData=VS:WS.initData=VS;var ex=a.defineComponent({components:{"cos-icon":e.Icon,"cos-tooltip":e.Tooltip,"user-feedback-card":WS},computed:{exportMenuShowExt:function(){return JSON.stringify({value:"out_board"})},isShowReply:function(){var t=this.data.get("type"),e=this.data.get("rank"),n=this.data.get("latestRank"),a=this.data.get("interactiveArea");return!(!go(a)&&a.disableReply)&&("question"!==t&&e===n)},isShowCopyMenu:function(){var t=this.data.get("interactiveArea"),e=this.data.get("type");return!(!go(t)&&t.copyDisable||"question"!==e&&!this.data.get("copyContent"))},isShowMDCopy:function(){var t=this.data.get("isShowCopyMenu");return!!this.data.get("mdData").mdStr&&t},isShowZanCaiCard:function(){var t=this.data.get("type"),e=this.data.get("feedbackData"),n=this.data.get("isShowFeedback");return"generate"===t&&e&&e.length>0&&!n},isShowEditReply:function(){for(var t,e=this.data.get("type"),n=!0,a=ZS(this.data.get("questionList"));!(t=a()).done;){var i=t.value;if("file"===i.type){n=1===i.data.question.question.length;break}}return"question"===e&&n}},initData:function(){return{latestRank:1,rank:1,getCopyTarget:{},status:"GENERATING",type:"generate",hasMd:!1,isPc:"pc"===rt(),mdData:{mdStr:"",urlData:[]},questionList:[],menuId:Math.random().toString(36).substring(2,10),feedbackInfo:[{type:"zan",name:"赞",icon:["thumbs-up-fill","thumbs-up"],isFeedback:!1,isChoose:!1,isShowFeedback:!1,isInput:!1},{type:"cai",name:"踩",icon:["thumbs-down-fill","thumbs-down"],isFeedback:!1,isChoose:!1,isShowFeedback:!1,isInput:!1}],currentFeedbackIndex:0,interactiveArea:{},question:[],agentInfo:{},feedbackData:[],baseData:{},askUsedModel:"",copyContent:"",recommendWordList:[],isShowFeedback:!1,generateAnswer:[],blocksList:[]}},attached:function(){this.data.get("isPc")&&this.setScrollPagePadding(),this.listener(),this.handleExportFile=Ki(this.handleExportFile,500,{leading:!0,trailing:!1})},listener:function(){var t=this,e=this.data.get("type");"question"===e&&(this.handleCover=function(e){if(e.id===t.data.get("menuId")){var n={type:"show",value:"content_alert",page:"resultpage",ext:YS({},t.getExtData())};Ua(n),pa().emit({content:"输入框已有内容，是否覆盖？",title:"提示",appearance:"info",confirm:function(){n.type="click",n.ext.button_text="确定",Ua(n),t.inputCopy(!1)},cancel:function(){n.type="click",n.ext.button_text="取消",Ua(n)}})}},sl().on(this.handleCover)),"generate"===e&&this.watch("status",(function(e){if("COMPLETE"===e){var n=t.getCopyText();t.data.set("copyContent",n),t.setGenerateMarkdownDataForCopy()}})),"history"===e&&ta().on((function(){var e=t.getCopyText();t.data.set("copyContent",e),t.setHistoryMarkdownDataForCopy()}))},getShowLogInfo:function(t){return JSON.stringify({value:"answer_menu",button:t})},getLogInfo:function(t,e){var n={enter_type:"home_tab",setype:"csaitab",button:e};if("question"===this.data.get("type")){var a=this.data.get("questionList");n.content_type=1===a.length&&"text"===a[0].type?"1":"0"}return JSON.stringify({type:t,value:"question"!==this.data.get("type")?"answer_menu":"card_hover_menu",page:"resultpage",ubcExt:n})},exportMenuClickLog:function(t){return JSON.stringify({type:"click",value:"out_board",page:"resultpage",ubcExt:{setype:"csaitab",button:t}})},getFileIcon:function(t){return"word"===t?me.Word:"pdf"===t?me.PDF:""},setScrollPagePadding:function(){var t=document.querySelector('[class*="index_scroll-content"]');t&&(t.style.paddingBottom="15px")},updateMenu:function(t){this.data.set("showDelete",t.showDelete)},menuClick:function(t){var e=this.data.get("type");Ws().emit({params:{location_id:e+"_"+this.data.get("rank"),function_type:t,location_type:"generate"===e?"answer_card":"query_card"}})},setGenerateMarkdownDataForCopy:function(){var t=this.data.get("generateAnswer"),e={mdStr:"",urlData:[]};if(t.length&&t[0].data)for(var n,a=ZS(t[0].data);!(n=a()).done;){var i=n.value;if(i.content&&i.content.generator&&i.content.generator.component&&"ai-thinking-steps"===i.content.generator.component&&i.content.generator.data.referenceList)e.urlData=i.content.generator.data.referenceList;else if(i.content&&i.content.generator&&i.content.generator.component&&"ai-markdown"===i.content.generator.component){e.mdStr=i.content.generator.data.content;break}}this.data.set("mdData",e)},setHistoryMarkdownDataForCopy:function(){for(var t,e={mdStr:"",urlData:[],urlArr:[]},n=["markdown","markdown-yiyan","markdown-hamburg","ai-markdown"],a=["thinkingSteps","ai-thinking-steps"],i=ZS(this.data.get("blocksList").flat(1)[0]);!(t=i()).done;){var o=t.value;if(a.includes(o.component)&&o.data.referenceList)e.urlData=o.data.referenceList;else if(a.includes(o.component)&&o.data.referenceListArr)e.urlArr=o.data.referenceListArr;else if(n.includes(o.component)){e.mdStr=o.data.value;break}}this.data.set("mdData",e)},getMdData:function(){var t=this.data.get("mdData"),e= __call$(t.mdStr,"replace",[/\^(\[\d+\])+\^/g,""]) ;e= __call$(e,"replace",[/\^(\^|\d|\s)+\^/g,""]) ;var n=1,a=t.urlData.length?t.urlData.reduce((function(t,e){return t+"\n"+n+++".["+e.text+" - "+e.source+"]("+e.url+")"}),""):"";t.urlArr&&t.urlArr.length&&t.urlArr.flat(1).forEach((function(t){a+="\n"+n+++".["+t.text+" - "+t.source+"]("+t.url+")"}));return a?e+"\n\n引用链接："+a:e},getExtData:function(){return{setype:"csaitab",is_plugin:"0",re_rank:String(this.data.get("rank")),a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),lid:on.getState("lid")}},handleExportFile:function(t){return(n=function(){var n,a,i,o,r,s;return tx(this,(function(l){switch(l.label){case 0:n=null,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,gs()];case 2:return n=l.sent(),[3,4];case 3:return l.sent(),[2];case 4:if(!n)return[2];e.Toast.show({message:"正在导出...",duration:3e3}),a=this.getMdData(),i=this.data.get("question"),o="";try{o=i[0].data.question.question}catch(t){o="导出文件"}return r={export_type:"word"===t?"docx":"pdf",markdown:a,export_title:o,token:""},s=window.open("about:blank"),function(t){var e=on.getState("chatParams").sse_host+"/aichat/api/file/converkit";return t.token=sc(),Li(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}},7e3).then((function(t){return 1003===t.status?Promise.reject():0===t.status&&t.data?Promise.resolve(t.data):Promise.reject()})).catch((function(t){}))}(r).then((function(t){t&&t.url?( __set$(__get$(s,"location"),"href",t.url) ,setTimeout((function(){s.close()}),2e3)):(s.close(),e.Toast.error({message:"导出失败，请重试"}))})),[2]}}))},function(){var t=this,e=Array.from(arguments);return new Promise((function(a,i){var o=n.apply(t,e);function r(t){XS(o,a,i,r,s,"next",t)}function s(t){XS(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var n},mdCopy:function(){Ep(this.getMdData()).then((function(){e.Toast.success({message:"复制成功"})})).catch((function(){e.Toast.error({message:"复制失败"})}))},copy:function(){Ep(this.getCopyText()).then((function(){e.Toast.success({message:"复制成功"})})).catch((function(){e.Toast.error({message:"复制失败"})}))},getCopyText:function(){var t,e=this.data.get("getCopyTarget");if("function"!=typeof e)return"";var n=e(this.data.get("currentAnswerIndex"));if(!n)return"";var a="*[disable-copy]",i="",o=null==n||null==(t=n.querySelector("*[data-copy]"))?void 0:t.getAttribute("data-copy");if(n.querySelector&&n.querySelector(a)){var r=n.cloneNode(!0),s=r.querySelectorAll(a);Array.from(s).forEach((function(t){t.remove()})),r.style.background="transparent",document.body.appendChild(r),i=o||r.innerText.trim(),document.body.removeChild(r)}else i=o||n.innerText;return i},inputCopy:function(t){var e=this.data.get("questionList"),n={type:"query",word:"",file:null,image:null,isUserInput:!0,isInputCopy:!0,agentInfo:this.data.get("agentInfo"),showCover:{show:t,id:this.data.get("menuId")}};Aa().emit({sa:"copyinput"}),e.forEach((function(t){var e=t.data.question.question;"text"===t.type?n.word=e:"file"===t.type?n.file={fileName:e[0].fileName,fileSize:e[0].fileSize,fileId:e[0].fileId,fileUrl:e[0].fileUrl,filePath:e[0].filePath}:"image"===t.type&&(n.image={imageId:e[0].image_id,imageUrl:e[0].imageUrl})})),zn().emit(n)},handleFeedback:function(t){var e,n=this.data.get("feedbackInfo"),a=Math.abs(t-1);if( __get$(n,t) .isChoose)this.data.set("feedbackInfo["+t+"].isChoose",!1);else if(this.data.set("feedbackInfo["+t+"].isChoose",!0),this.data.set("feedbackInfo["+a+"].isChoose",!1),this.data.set("currentFeedbackIndex",t),! __get$(n,t) .isFeedback&&this.data.get("isShowZanCaiCard")&&! __get$(n,t) .isFeedback&&! __get$(n,a) .isFeedback){var i=Ef({product:this.data.get("feedbackData["+t+"]").product,rank:this.data.get("rank"),actionName:"赞踩反馈信息收集",baseData:this.data.get("baseData"),isPc:this.data.get("isPc"),askModel:(null==(e=this.data.get("askUsedModel"))?void 0:e.modelName)||"",recommendWordList:this.data.get("recommendWordList")});this.data.set("feedbackData["+t+"].product",i),this.data.set("feedbackInfo["+t+"].isShowFeedback",!0),this.data.set("feedbackInfo["+a+"].isShowFeedback",!1)}},disposed:function(){this.handleCover&&sl().off(this.handleCover)}}),nx={};nx= __call$(Object,"assign",[nx,{menu:"menu_1eac9_1",menuText:"menu-text_1eac9_6","menu-text":"menu-text_1eac9_6",menuItem:"menu-item_1eac9_32","menu-item":"menu-item_1eac9_32",icon:"icon_1eac9_40",generateMenu:"generate-menu_1eac9_68","generate-menu":"generate-menu_1eac9_68",csMenuTooltipCustom:"cs-menu-tooltip-custom_1eac9_112","cs-menu-tooltip-custom":"cs-menu-tooltip-custom_1eac9_112",tooltipMenuList:"tooltip-menu-list_1eac9_128","tooltip-menu-list":"tooltip-menu-list_1eac9_128",exportMenu:"export-menu_1eac9_151","export-menu":"export-menu_1eac9_151",exportSubmenu:"export-submenu_1eac9_154","export-submenu":"export-submenu_1eac9_154",exportItem:"export-item_1eac9_177","export-item":"export-item_1eac9_177",itemFileImg:"item-file-img_1eac9_186","item-file-img":"item-file-img_1eac9_186"}]) ,ex.template='\n    <div class="cs-answer-hover-menu" data-show-area>\n        <div\n            s-if="status === \'COMPLETE\'"\n            class="\n                {{type === \'question\' ? $style[\'menu\'] : $style[\'generate-menu\']}}\n                {{type === \'question\' ? \'cs-answer-hover-menu-container\' : \'\'}}"\n            need-click-log\n        >\n            \x3c!--复制--\x3e\n            <span\n                class="{{$style[\'menu-item\']}}"\n                data-click-log="{{getLogInfo(\'click\', \'copy\')}}"\n                s-if="isShowCopyMenu"\n                data-show-ext="{{type !== \'question\' ? getShowLogInfo(\'copy\') : \'\'}}"\n            >\n                <cos-icon\n                    name="copy"\n                    class="{{$style[\'icon\']}}"\n                    on-click="native:copy"\n                />\n                <span class="{{$style[\'menu-text\']}}">复制</span>\n            </span>\n            \x3c!--重答--\x3e\n            <span\n                s-if="{{isShowReply}}"\n                class="{{$style[\'menu-item\']}}"\n                data-click-log="{{getLogInfo(\'click\', \'reply\')}}"\n                data-show-ext="{{type !== \'question\' ? getShowLogInfo(\'reply\') : \'\'}}"\n            >\n                <cos-icon\n                    name="exchange"\n                    class="{{$style[\'icon\']}}"\n                    on-click="native:menuClick(\'card_function_regenerate\')"\n                />\n                <span class="{{$style[\'menu-text\']}}">重答</span>\n            </span>\n            \x3c!--删除--\x3e\n            <span\n                s-if="(type !== \'question\' || showDelete) && rank !== 1"\n                class="{{$style[\'menu-item\']}}"\n                data-click-log="{{getLogInfo(\'click\', \'delete\')}}"\n                data-show-ext="{{type !== \'question\' ? getShowLogInfo(\'delete\') : \'\'}}"\n            >\n                <cos-icon\n                    name="bin"\n                    class="{{$style[\'icon\']}}"\n                    on-click="native:menuClick(\'card_function_delete\')"\n                />\n                <span class="{{$style[\'menu-text\']}}">删除</span>\n            </span>\n            \x3c!--编辑后重答--\x3e\n            <span\n                s-if="{{isShowEditReply}}"\n                class="{{$style[\'menu-item\']}}"\n                data-click-log="{{getLogInfo(\'click\', \'copy_inputbox\')}}"\n            >\n                <cos-icon\n                    name="input"\n                    class="{{$style[\'icon\']}}"\n                    on-click="native:inputCopy(true)"\n                />\n                <span class="{{$style[\'menu-text\']}}">编辑后重答</span>\n            </span>\n            \x3c!--赞、踩--\x3e\n            <template s-if="{{type === \'generate\'}}">\n                <span\n                    s-for="item, index in feedbackInfo"\n                    class="{{$style[\'menu-item\']}}"\n                    data-show-ext="{{type !== \'question\' ? getShowLogInfo(item.type) : \'\'}}"\n                    need-click-log\n                    data-click-log="{{getLogInfo(\'click\', item.type)}}"\n                >\n                    <cos-icon\n                        name="{{item.isChoose ? item.icon[0] : item.icon[1]}}"\n                        class="{{$style[\'icon\']}}"\n                        on-click="native:handleFeedback(index)"\n                    />\n                    <span class="{{$style[\'menu-text\']}}" style="left: -8px;">{{item.name}}</span>\n                    <div s-if="{{item.isShowFeedback}}" class="{{$style[\'feedback-arrow\']}}">\n                    </div>\n                </span>\n            </template>\n            \x3c!--更多菜单--\x3e\n            <span\n                s-if="{{type !== \'question\' && isShowMDCopy}}"\n                class="{{$style[\'menu-item\']}} {{$style[\'other-menu\']}}"\n                data-show-ext="{{type !== \'question\' ? getShowLogInfo(\'more\') : \'\'}}"\n            >\n                <cos-tooltip\n                    trigger="hover"\n                    position="bottom-start"\n                    bubbleClass="{{$style[\'cs-menu-tooltip-custom\']}}"\n                >\n                    <cos-icon\n                        name="feedback"\n                        class="{{$style[\'icon\']}}"\n                    />\n                    <template slot="content">\n                        <div\n                            class="{{$style[\'tooltip-menu-list\']}}"\n                            need-click-log\n                            data-show-area\n                        >\n                            \x3c!--复制md--\x3e\n                            <div\n                                s-if="isShowMDCopy"\n                                class="{{$style[\'menu-item\']}}"\n                                on-click="native:mdCopy"\n                                data-click-log="{{getLogInfo(\'click\', \'copy_markdown\')}}"\n                                data-show-ext="{{type !== \'question\' ? getShowLogInfo(\'copy_markdown\') : \'\'}}"\n                            >\n                                <cos-icon\n                                    name="copy"\n                                    class="{{$style[\'icon\']}}"\n                                />\n                                复制为Markdown\n                            </div>\n                            \x3c!--导出菜单--\x3e\n                            <div\n                                s-if="isShowMDCopy"\n                                class="{{$style[\'menu-item\']}}\n                                {{$style[\'export-menu\']}}"\n                                data-show-ext="{{type !== \'question\' ? getShowLogInfo(\'out\') : \'\'}}"\n                                data-click-log="{{getLogInfo(\'click\', \'out\')}}"\n                            >\n                                <cos-icon\n                                    name="download"\n                                    class="{{$style[\'icon\']}}"\n                                />\n                                导出\n                                <div\n                                    data-show-area\n                                    data-show-ext="{{exportMenuShowExt}}"\n                                    class="{{$style[\'export-submenu\']}}"\n                                >\n                                    \x3c!--导出word--\x3e\n                                    <div\n                                        class="{{$style[\'export-item\']}}"\n                                        on-click="handleExportFile(\'word\')"\n                                        data-click-log="{{exportMenuClickLog(\'word\')}}"\n                                        need-click-log\n                                    >\n                                        <img\n                                            class="{{$style[\'item-file-img\']}}"\n                                            src="{{getFileIcon(\'word\')}}"\n                                            alt=""\n                                        >\n                                        Word文档\n                                    </div>\n                                    \x3c!--导出pdf--\x3e\n                                    <div\n                                        class="{{$style[\'export-item\']}}"\n                                        on-click="handleExportFile(\'pdf\')"\n                                        data-click-log="{{exportMenuClickLog(\'pdf\')}}"\n                                        need-click-log\n                                    >\n                                        <img\n                                            class="{{$style[\'item-file-img\']}}"\n                                            src="{{getFileIcon(\'pdf\')}}"\n                                            alt=""\n                                        >\n                                        PDF文档\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </template>\n                </cos-tooltip>\n            </span>\n        </div>\n        \x3c!--赞踩反馈卡--\x3e\n        <user-feedback-card\n            s-if="{{feedbackInfo[currentFeedbackIndex].isShowFeedback}}"\n            feedback-data="{=feedbackData=}"\n            feedback-info="{=feedbackInfo=}"\n            current-feedback-index="{=currentFeedbackIndex=}"\n            rank="{{rank}}"\n        />\n    </div>\n';var ax="function"==typeof ex?ex.prototype.initData||ix:ex.initData||ix;function ix(){return{$style:nx}}function ox(){return  __call$(Object,"assign",[{},ax.call(this),{$style:nx}]) }"function"==typeof ex?ex.prototype.initData=ox:ex.initData=ox;var rx=a.defineComponent({enableScrollClose:!0,components:{"cosc-title":e.Title,"cos-icon":e.Icon},attached:function(){this.listenerInit()},listenFeedbackPop:null,listenerInit:function(){var t=this,e=Hn().conversation.feedbackPop;this.listenFeedbackPop=function(e){void 0===e&&(e={}),e.id&&e.id!==t.data.get("id")||(t.data.set("url",e.url),t.data.set("title",e.title),t.data.set("contentList",e.content),t.data.set("showPop",!0),t.data.set("isGenPc",e.isGenPc),t.data.set("feDislikeKey",e.feDislikeKey),((null==e?void 0:e.left)&&(null==e?void 0:e.bottom)||(null==e?void 0:e.top))&&t.computeContentDisplay(e),window.addEventListener("scroll",t.scrollHandler),t.initContentListStatus(e.content))},null==e||e.on(this.listenFeedbackPop),this.scrollHandler=this.srcollListen.bind(this),window.addEventListener("scroll",this.scrollHandler)},disposed:function(){var t=Hn().conversation.feedbackPop;this.listenFeedbackPop&&t&&(t.off(this.listenFeedbackPop),window.removeEventListener("scroll",this.scrollHandler),this.listenFeedbackPop=null)},initData:function(){return{id:null,title:"",contentList:[],contentListStatus:[],tplInfo:{},showTopTriangle:!0,triangleLeft:120,contentTop:260,showPop:!1,popInitialize:!0,url:"",popupData:{content:["已收到您的问题反馈"]},tipVisible:!1,feedbackTipsFixed:!1,useCardSendLog:!1,feedbackShowInput:!1,feedBackText:"",feDislikeKey:"",inputWarn:!1,isDataFlyWheel:!1,color:"#6e4bfaff",feedbackCustomTheme:!1}},computeContentDisplay:function(t){var e=this;this.data.set("triangleLeft",t.left-7);var n=document.documentElement.clientHeight||document.body.clientHeight;this.nextTick((function(){var a,i=null==(a=e.ref("fdPopContent").getBoundingClientRect())?void 0:a.height;if(i){var o=n-t.bottom-8>i+(window.BdboxBottomBarHeight||0);e.data.set("showTopTriangle",o),e.data.set("contentTop",o?t.bottom+12:t.top-i-12),e.preventSilde(),e.data.set("popInitialize",!1)}else e.data.set("showPop",!1)}))},shadowClick:function(t){t.preventDefault(),t.stopPropagation();var e=t.target.getAttribute("textTag");if(this.data.get("useCardSendLog")&&e){var n={type:"b",fm:"beha",action:"feedback",subpos:e};if(this.data.get("isDataFlyWheel")){var a=Math.floor(+e/2),i=+e%2,o=this.data.get("contentList");n={type:"b",fm:"beha",action:"feedback",extra:{interactKey:this.data.get("feDislikeKey"),feedback_option: __get$(__get$(o,a),i) }}}this.dispatch("send-log",n),this.showTextToast()}else this.data.get("isPc")&&this.data.get("isHuabu")&&e?(this.dispatch("Event:logEvent",{type:"b",action:"feedback",subpos:e,fm:"beha",extra:{clk_region:"hudong"}}),this.showTextToast()):e&&this.showTextToast();this.closePop()},closePop:function(){this.data.set("showPop",!1),this.data.set("popInitialize",!0),this.data.set("feedBackText",""),this.recoverSlide(),window.removeEventListener("scroll",this.scrollHandler)},showTextToast:function(){this.data.get("isGenPc")||this.data.get("isPc")&&this.data.get("isHuabu")?this.dispatch("UI:showToast",{content:"已收到您的问题反馈"}):"pc"===this.data.get("tplInfo").env?this.ref("tip").show():e.Toast.show({message:"已收到您的问题反馈"})},preventSilde:function(){document.body.addEventListener("touchmove",this.preventDefault,{passive:!1}),this.data.get("isPc")&&this.data.get("isHuabu")||(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden")},recoverSlide:function(){document.body.removeEventListener("touchmove",this.preventDefault,{passive:!1}),this.data.get("isPc")&&this.data.get("isHuabu")||(document.body.style.overflow="",document.documentElement.style.overflow="")},preventDefault:function(t){t.preventDefault()},srcollListen:function(){this.enableScrollClose&&this.closePop()},initContentListStatus:function(t){for(var e=new Array(t.length).fill([]),n=0;n<t.length;n++) __set$(e,n,new Array(__get$(t,n).length).fill(!1)) ;this.data.set("contentListStatus",e)},handleItemClick:function(t,e,n){if(this.data.get("feedbackShowInput")){t.stopPropagation();var a=this.data.get("contentListStatus["+e+"]["+n+"]");this.data.set("contentListStatus["+e+"]["+n+"]",!a)}},stop:function(t){t.stopPropagation()},handleInput:function(t){this.data.set("inputWarn",t.target.value.length>=500)},submitFeedBack:function(t){t.stopPropagation();for(var n=this.data.get(),a=n.feedBackText,i=n.contentList,o=n.contentListStatus,r=[],s=0;s<o.length;s++)for(var l=0;l< __get$(o,s) .length;l++) __get$(__get$(o,s),l) &&r.push( __get$(__get$(i,s),l) );if(a||0!==r.length){if(this.data.get("useCardSendLog")){var c={type:"b",fm:"beha",action:"feedback",extra:{interactKey:this.data.get("feDislikeKey")}};a&&(c.extra.feedback_input=a),r.length>0&&(c.extra.feedback_option=r.join("_")),this.dispatch("send-log",c)}e.Toast.show({message:"已收到您的问题反馈"}),this.closePop()}else this.closePop()},handleFocus:function(){this.enableScrollClose=!1},handleBlur:function(){this.enableScrollClose=!0}}),sx={};sx= __call$(Object,"assign",[sx,{popWrap:"pop-wrap_1jcah_1","pop-wrap":"pop-wrap_1jcah_1",contentWrap:"content-wrap_1jcah_9","content-wrap":"content-wrap_1jcah_9",triangleIcon:"triangle-icon_1jcah_16","triangle-icon":"triangle-icon_1jcah_16",topTriangle:"top-triangle_1jcah_34","top-triangle":"top-triangle_1jcah_34",bottomTriangle:"bottom-triangle_1jcah_40","bottom-triangle":"bottom-triangle_1jcah_40",content:"content_1jcah_9",title:"title_1jcah_53",texts:"texts_1jcah_58",text:"text_1jcah_58",selectItem:"select-item_1jcah_75","select-item":"select-item_1jcah_75",popInitialize:"pop-initialize_1jcah_79","pop-initialize":"pop-initialize_1jcah_79",popReady:"pop-ready_1jcah_82","pop-ready":"pop-ready_1jcah_82",closeIcon:"close-icon_1jcah_85","close-icon":"close-icon_1jcah_85",feedbackTextarea:"feedback-textarea_1jcah_95","feedback-textarea":"feedback-textarea_1jcah_95",count:"count_1jcah_100",inputWarn:"input-warn_1jcah_108","input-warn":"input-warn_1jcah_108",textareaWrapper:"textarea-wrapper_1jcah_111","textarea-wrapper":"textarea-wrapper_1jcah_111",textInputTextarea:"text-input-textarea_1jcah_116","text-input-textarea":"text-input-textarea_1jcah_116",btnWrap:"btn-wrap_1jcah_137","btn-wrap":"btn-wrap_1jcah_137",btn:"btn_1jcah_137",submit:"submit_1jcah_154"}]) ,rx.template='\n    <div\n        style="--color: {{color || \'#6e4bfaff\'}}"\n        class="{{feedbackCustomTheme ? [\'theme-customize\', \'cos-dqa\'] : \'\'}}"\n        data-stop-bubble\n        on-click="shadowClick($event)"\n    >\n        <div\n            s-if="showPop"\n            class="\n                {{$style[\'pop-wrap\']}}\n                {{popInitialize ? $style[\'pop-initialize\'] : $style[\'pop-ready\']}}\n                {{isGenPc || (isPc && isHuabu) ? $style[\'pop-genpc\'] :\'\'}}\n                cs-feedback-pop\n            "\n            rl-type="stop"\n        >\n            <div\n                class="{{$style[\'content-wrap\']}}"\n                s-ref="fdPopContent"\n                style="top: {{contentTop}}px;"\n            >\n                <cos-icon\n                    name="close_line"\n                    class="{{$style[\'close-icon\']}}"\n                    on-click="native:hide"\n                    s-if="tplInfo && tplInfo.env === \'pc\'"\n                />\n                <div\n                    s-if="showTopTriangle"\n                    class="{{$style[\'triangle-icon\']}} {{$style[\'top-triangle\']}}"\n                    style="left: {{triangleLeft}}px"\n                />\n                <div class="{{$style[\'content\']}}">\n                    <cosc-title\n                        s-if="title"\n                        class="cos-space-pb-md cos-line-clamp-1 {{$style[\'title\']}}"\n                    >\n                        <span class="cos-line-clamp-1">{{title}}</span>\n                    </cosc-title>\n                    <div\n                        s-for="texts,lineIndex in contentList"\n                        class="{{$style[\'texts\']}}"\n                    >\n                        <div\n                            s-for="text,index in texts"\n                            enableHotspot="true"\n                            class="\n                                cos-link-button\n                                cos-block\n                                cos-line-clamp-1\n                                {{$style[\'text\']}}\n                                {{contentListStatus[lineIndex][index] ? $style[\'select-item\'] : \'\'}}\n                            "\n                            on-click="native:handleItemClick($event, lineIndex, index)"\n                        >\n                            <p textTag="{{lineIndex * 2 + index}}" class="cos-line-clamp-1">\n                                {{text}}\n                            </p>\n                        </div>\n                    </div>\n\n                    \x3c!-- 用于评估使用的输入框 --\x3e\n                    \x3c!-- 请注意：以下输入框仅用于配置零流量线下评估使用，不可以用于线上用户使用，存在部分暂无法解决的体验问题，长线考虑NA面板 --\x3e\n                    <div\n                        s-if="feedbackShowInput"\n                        class="{{$style[\'feedback-textarea\']}}"\n                        on-click="stop"\n                    >\n                        <div\n                            class="{{$style[\'textarea-wrapper\']}}"\n                            on-touchmove="stop"\n                        >\n                            <textarea\n                                class="cos-text-body {{$style[\'text-input-textarea\']}}"\n                                placeholder="请输入你的反馈意见"\n                                value="{=feedBackText=}"\n                                on-input="handleInput"\n                                on-focus="handleFocus"\n                                on-blur="handleBlur"\n                                maxlength="500"\n                            >\n                            </textarea>\n                            <div\n                                class="{{$style[\'count\']}} {{inputWarn ? $style[\'input-warn\'] : \'\'}}"\n                            >{{feedBackText.length}}/500</div>\n                        </div>\n                    </div>\n                    <div s-if="feedbackShowInput" class="{{$style[\'btn-wrap\']}}">\n                        <div class="{{$style[\'btn\']}}">取消</div>\n                        <div class="{{$style[\'btn\']}} {{$style[\'submit\']}}" on-click="submitFeedBack">反馈给我</div>\n                    </div>\n                </div>\n                <div\n                    s-if="!showTopTriangle"\n                    class="{{$style[\'triangle-icon\']}} {{$style[\'bottom-triangle\']}}"\n                    style="left: {{triangleLeft}}px"\n                />\n            </div>\n        </div>\n    </div>\n';var lx="function"==typeof rx?rx.prototype.initData||cx:rx.initData||cx;function cx(){return{$style:sx}}function dx(){return  __call$(Object,"assign",[{},lx.call(this),{$style:sx}]) }function ux(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function px(){return px=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},px.apply(this,Array.from(arguments))}function hx(t,e){return hx=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},hx(t,e)}function fx(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ux(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ux(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}"function"==typeof rx?rx.prototype.initData=dx:rx.initData=dx;var gx=function(t){function n(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hx(t,e)}(n,t);var a=n.prototype;return a.initData=function(){var t=this,e=Date.now();return{bgProps:{},indicatorColor:"#6e4bfaff",blocksList:[],hints:{},currentIndex:0,independenBlocks:[],entryRef:"entry-"+e,aiContainerRef:"ai-container-"+e,shareParams:"",rank:0,latestRank:0,deleteParams:"",initShowHistory:!1,isPc:!1,isExtension:vt(),aiEntryStyle:"",isSeparateBub:!1,referenceList:[],logExtParams:{},tplInfo:{},getCopyTarget:function(){var e,n=null==(e=t.ref(t.data.get("aiContainerRef")))?void 0:e.el;return(null==n?void 0:n.querySelector(".marklang, .ai-entry"))||n},interactiveArea:{}}},a.created=function(){var t=this;this.handleBlocksList();var e=[],n=[],a=this.data.get("blocksList"),i=this.data.get("isSeparateBub"),o=this.data.get("independenBlocks");a.forEach((function(a,r){i&&!o.length?(a.forEach((function(t){!function(t,e){return 0===e.length||!t.sectionId||! __get$(e,e.length-1) .sectionId||t.sectionId=== __get$(e,e.length-1) .sectionId}(t,n)?(e.push(n),n=[t]):n.push(t)})),n.length&&e.push(n),t.data.set("blocksList["+r+"]",e),e=[],n=[]):t.data.set("blocksList["+r+"]",[a])}))},a.attached=function(){var t=this;setTimeout((function(){var e,n=t.data.get("initShowHistory"),a=t.data.get("isAiCall");ta().emit({initShowHistory:n,isAiCall:a});var i=t.data.get("entryRef"),o=Op(null==(e=t.ref(i))?void 0:e.el);t.data.set("ttsText",o),t.listenLongPressHandler=US(t,"history"),t.referShowLog(),t.data.set("feedbackId","ai_index_history_"+t.data.get("rank"))}),100),this.data.set("isPc","pc"===rt())},a.handleSwiperChange=function(t){var e=(t||{}).index,n=void 0===e?0:e;this.data.set("currentIndex",n)},a.handleCopy=function(t){this.copyText(t.text)},a.sendUbcLog=function(t){if(t&&t.value&&["site","sitescroll","site_open","site_fold","subscript","site_slide","subscriptJump","answer_title_open","answer_title_close","answer_content","answer_origin"].includes(t.value)){var e=t.type,n=void 0===e?"show":e,a=t.value,i=void 0===a?"":a,o=t.extra,r=void 0===o?{}:o,s=this.data.get("rank"),l=this.data.get("tplInfo");Ua({ubcId:t.ubcId,page:t.page,type:n,value:i,source:"active",ext:px({lid:"",ori_lid:"",re_rank:s.toString(),setype:"csaitab"},r)},l)}},a.copyText=function(t){Ep(t).then((function(){e.Toast.show({message:"复制成功"})})).catch((function(){e.Toast.show({message:"复制失败"})}))},a.handleBlocksList=function(){var t=this,e=this.data.get("blocksList"),n=[];e.forEach((function(e){var a=[];e.forEach((function(e){!e.component&&e.interactiveArea?t.data.set("interactiveArea",e.interactiveArea):e.component&&a.push(e)})),n.push(a)})),this.data.set("blocksList",n)},a.showToast=function(){this.data.get("isPc")?Qn().emit({text:"历史记录不支持该功能",type:"info"}):e.Toast.show({message:"历史记录不支持该功能"})},a.formatUbcParams=function(t,e){var n=(e[0]||{}).agentInfo||{},a=n.agentSearchId,i=n.agentName;return t.ext= __call$(Object,"assign",[{},t.extra,{ori_lid:"",lid:"",re_rank:String(this.data.get("rank")),agent_id:a,agent_name:i}]) ,t},a.handleUbcLogEvent=function(t,e){e&&e.length&&!this.data.get("isPc")&&Ua(this.formatUbcParams(t,e))},a.goToAgent=function(t){var n,a;if("pc"===rt()&&"agent"===(null==(a=t.target.attributes)||null==(n=a.type)?void 0:n.value))if(t.preventDefault(),this.data.get("isExtension"))t.stopPropagation(),e.Toast.info({message:"请到网页版使用",duration:2e3});else{var i,o,r=(null==(i=this.data.get("question")[0].data)?void 0:i.agentInfo)||{},s=null==(o=t.target)?void 0: __get$(o,"href") ;if(s){var l=As(s);if(l){var c=px({},r,{realUrl:l});ma().emit(c)}}}},a.isBless=function(t){for(var e,n=fx(t);!(e=n()).done;){var a=e.value;if("ai-markdown-editor"===a.component||"markdownEditor"===a.component)return!0}return!1},a.referShowLog=function(){var t,e=this,n=this.data.get("entryRef"),a=null==(t=this.ref(n))?void 0:t.el;if(a){var i=bn(".cosd-citation",a);i.forEach((function(t,n){var a,o,r;(null==(a=t.parentElement)?void 0:a.nextElementSibling)!==(null==(o= __get$(i,n+1) )?void 0:o.parentElement)&&e.sendUbcLog({type:"show",value:"subscript",extra:{is_his:"1",info_rank:null==(r=t.getElementsByClassName("cosd-citation-citationId")[0])?void 0:r.innerText}})}))}},a.handleActionLogEvent=function(t){var e,n;if("reference"===t.componentType){var a=this.data.get("logExtParams")||{},i=this.data.get("rank"),o=this.data.get("tplInfo")||{},r=this.data.get("entryRef");t.ext= __call$(Object,"assign",[{},t.ext,px({re_rank:String(i),ori_lid:"",lid:""},a)]) ,Np(t,o,{launchMultiSearch:!0},(null==(e=t.ext)?void 0:e.target)||(null==(n=this.ref(r))?void 0:n.el))}},a.disposed=function(){this.listenLongPressHandler&&Ws().off(this.listenLongPressHandler),this.listenLongPressHandler&&Ba().off(this.listenLongPressHandler),this.listenLongPressHandler=null},a.onEditClick=function(t){for(var n,a=fx(t);!(n=a()).done;){if("ai-writing"===n.value.component)return}var i=t.findIndex((function(t){return"ai-markdown"===t.component}));t.findIndex((function(t){return"ai-office-writing"===t.component}));var o,r="";i>-1&&(r=null==(o= __get$(t,i) .data)?void 0:o.content);if(r=Fy(r)){if(Hy()){var s,l,c=null==(l=event)||null==(s=l.target)?void 0:s.closest('[data-module^="edit"]'),d=null==c?void 0:c.getAttribute("data-cid");d&&$y({title:"",content:r,lid:d})}}else e.Toast.show({message:"正文内容为空，暂不支持编辑"})},n}(a.Component);gx.components={"cs-container":_S,"sc-ai-entry":Y_,"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem,header:CS,"wd-tts-player":Nk,"answer-recommend":Wf,"reference-wrapper":ok,"pc-menu-bar":ex,"wd-feedback-pop":rx},gx.messages={"ai-markdown-editor:btn-click":function(t){var e=this,n=t.value,a=n.actionType,i=n.text,o=n.id;"recipient"===a||"from"===a||"edit"===a||"image"===a?(this.showToast(),"image"===a&&setTimeout((function(){var t;null==(t=e.ref("independenCard"))||t.handleComponent("ai-markdown-editor","changeEditStatus",{isDanger:0,id:o})}),0)):"copy"===a&&this.copyText(i)},"ai-image-with-thumbnail:jump-diy-page":function(){this.showToast()},"ai-image-with-thumbnail:update":function(){this.showToast()},"open-half-screen":function(){this.showToast()},"send-ubclog":function(t){this.sendUbcLog(t.value)}},gx.computed={hintText:function(){return"notSupport"===this.data.get("hints.parts[0].type")?this.data.get("hints.parts[0].text"):""}};var mx={},vx={},yx={};yx= __call$(Object,"assign",[yx,{hideItem:"hide-item_19hgd_1","hide-item":"hide-item_19hgd_1",independenStyle:"independen-style_19hgd_5","independen-style":"independen-style_19hgd_5",independenStylePadding:"independen-style-padding_19hgd_9","independen-style-padding":"independen-style-padding_19hgd_9",indicatorMargin:"indicator-margin_19hgd_14","indicator-margin":"indicator-margin_19hgd_14",showAnimation:"show-animation_19hgd_25","show-animation":"show-animation_19hgd_25",chatSearchHistoryShow:"chatSearchHistoryShow_19hgd_1",answerHistory:"answer-history_19hgd_28","answer-history":"answer-history_19hgd_28",chatSearchHistoryAnswer:"chat-search-history-answer_19hgd_56","chat-search-history-answer":"chat-search-history-answer_19hgd_56",historyAnswerSwiper:"history-answer-swiper_19hgd_60","history-answer-swiper":"history-answer-swiper_19hgd_60"}]) ,gx.template='\n    <div\n        data-share="{{shareParams}}"\n        data-delete="{{deleteParams}}"\n        class="\n            {{initShowHistory ? $style[\'show-animation\'] : \'\'}}\n            {{$style[\'chat-search-history-answer\']}}\n        "\n        on-click="capture:goToAgent"\n    >\n        <cs-container s-if="hintText">{{hintText}}</cs-container>\n        <cos-swiper\n            s-else\n            styles="{{$swiper}}"\n            style="\n                --indicator-color: {{indicatorColor}};\n                {{!agentRecommendList.length ? \'\' : \'pointer-events: none\'}}\n            "\n            class="{{$style[\'history-answer-swiper\']}}"\n            s-ref="swiper"\n            type="page"\n            snap-align="start"\n            snap-stop="always"\n            on-change="handleSwiperChange"\n            indicator="{{blocksList.length > 1 && !agentRecommendList.length ? \'center\': \'\'}}"\n            prevent-default="{{false}}"\n        >\n            <cos-swiper-item\n                styles="{{$swiperItem}}"\n                s-for="blocks, index in blocksList"\n                width="100%"\n                class="{{index !== currentIndex ? $style[\'hide-item\'] : \'\'}} cs-history-answer"\n            >\n                <fragment s-for="currentAnswer, currentAnswerIndex in blocks">\n                    <cs-container\n                        class="{{$style[\'answer-history\']}}\n                            {{blocksList.length > 1\n                            && (!independenBlocks[index] || !independenBlocks[index].length)\n                            && !agentRecommendList.length\n                            ? $style[\'indicator-margin\'] : \'\'}}"\n                        bg-props="{{bgProps}}"\n                        current-answer="{{currentAnswer}}"\n                        s-ref="{{aiContainerRef}}"\n                        is-history="{{true}}"\n                        is-separate-bub="{{isSeparateBub || (independenBlocks[index] && independenBlocks[index].length > 0)}}"\n                        rank="{{rank}}"\n                        cid="{{qid}}"\n                        latest-rank="{{latestRank}}"\n                        agent-info="{{currentAnswer[0] && currentAnswer[0].agentInfo}}"\n                        tplInfo="{{tplInfo}}"\n                        has-ala-Card="{{hasAlaCard}}"\n                        on-edit-click="onEditClick(currentAnswer)"\n                    >\n                        <header\n                            is-show-pos="{{blocksList.length > 1 && !agentRecommendList.length}}"\n                            current-index="{{index + 1}}"\n                            length="{{blocksList.length}}"\n                        ></header>\n                        <sc-ai-entry\n                            s-ref="{{entryRef}}"\n                            render-mode="only-csr-static"\n                            context="{{ {\n                                scene: \'chat-search\',\n                                app: \'bdbox\'\n                            } }}"\n                            style="{{aiEntryStyle}}"\n                            blocks="{{currentAnswer}}"\n                            rank="{{rank}}"\n                            question="{{question}}"\n                            on-ubc-log-event="handleUbcLogEvent($event, currentAnswer)"\n                            on-action-log-event="handleActionLogEvent"\n                            is-history="true" \n                            cid="{{qid}}"\n                        />\n                    </cs-container>\n                    <pc-menu-bar\n                        s-if="isPc"\n                        s-ref="{{\'menu-\' + currentAnswerIndex}}"\n                        rank="{{rank}}"\n                        type="history"\n                        current-answer-index="{{currentAnswerIndex}}"\n                        get-copy-target="{{getCopyTarget}}"\n                        status="COMPLETE"\n                        latest-rank="{{latestRank}}"\n                        question="{{question}}"\n                        interactive-area="{{interactiveArea}}"\n                        blocks-list="{{blocksList}}"\n                    >\n                    </pc-menu-bar>\n                </fragment>\n                \x3c!-- 拆卡 --\x3e\n                <cs-container\n                    s-if="independenBlocks[index] && independenBlocks[index].length > 0"\n                    class="\n                        {{independenBlocks[index].length > 0\n                            && blocks && blocks.length > 0\n                            && blocks[0].length > 0\n                            && blocks[0][0].data\n                            && !blocks[0][0].data.hideAlaStyle\n                            ? $style[\'independen-style-padding\']\n                            : $style[\'independen-style\']}}\n                        {{$style[\'answer-history\']}}\n                        {{blocksList.length > 1 ? $style[\'indicator-margin\'] : \'\'}}\n                    "\n                    bg-props="{{independenBlocks[index].length > 0 && independenBlocks[index][0].bgProps}}"\n                    current-answer="{{independenBlocks[index]}}"\n                    is-history="{{true}}"\n                    is-separate-bub="{{isBless(independenBlocks[index])}}"\n                    cid="{{qid}}"\n                    rank="{{rank}}"\n                    tplInfo="{{tplInfo}}"\n                    latest-rank="{{latestRank}}"\n                    on-edit-click="onEditClick(independenBlocks[index])"\n                >\n                    <sc-ai-entry\n                        s-ref="independenCard"\n                        render-mode="only-csr-static"\n                        context="{{ {\n                            scene: \'chat-search\',\n                            app: \'bdbox\'\n                        } }}"\n                        blocks="{{independenBlocks[index]}}"\n                        question="{{question}}"\n                        on-ubc-log-event="handleUbcLogEvent($event, blocks[0])"\n                        on-copy="handleCopy"\n                        isHistory="true"\n                        cid="{{qid}}"\n                        on-action-log-event="handleActionLogEvent"\n                    />\n                </cs-container>\n                \x3c!--历史人脉卡在拆泡场景下的特殊处理--\x3e\n                <template s-for="block in blocks">\n                    <template s-for="item in block">\n                        <answer-recommend\n                            s-if="item.data.agentRecommendList.length && item.component === \'ai-agent-recommend\'"\n                            is-history="true"\n                            s-ref="answer-recommend"\n                            question="{{question}}"\n                            history-content="{{item.data.content}}"\n                            agent-recommend-list="{{item.data.agentRecommendList}}"\n                        />\n\n                    </template>\n                </template>\n            </cos-swiper-item>\n            \x3c!-- 长按菜单语音播报功能，仅播报不展现 --\x3e\n            <wd-tts-player\n                s-show="false"\n                source="longPress"\n                text="{{ttsText}}"\n                s-ref="ttsPlayer"\n                tts-api-from="csaitab"\n            />\n        </cos-swiper>\n        <wd-feedback-pop\n            id="{{feedbackId}}"\n            color="{{commonData.defaultInteractData.praise.color}}"\n            feedback-show-input="{{false}}"\n            feedback-custom-theme="{{false}}"\n            is-data-fly-wheel="{{false}}"\n            use-card-send-log="{{true}}"\n        />\n    </div>\n';var wx="function"==typeof gx?gx.prototype.initData||bx:gx.initData||bx;function bx(){return{$style:yx,$swiper:mx,$swiperItem:vx}}function _x(){return  __call$(Object,"assign",[{},wx.call(this),{$style:yx,$swiper:mx,$swiperItem:vx}]) }function kx(){return kx=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},kx.apply(this,Array.from(arguments))}"function"==typeof gx?gx.prototype.initData=_x:gx.initData=_x;var Sx=a.defineComponent({components:{"ask-entrance":jp,"chat-guide":$h,"cosd-question-guide":e.QuestionGuide},initData:function(){return{isChatSearch:!0,isNewConversationLaunched:!1,sseQuery:"",sseApi:"",chatAsyncRequest:0,tplInfo:{tplname:"nonala_cpt",srcid:"60259",lid:"",order:-1},chatParams:{},askData:{guideWord:"",category:[],endWord:""},context:{app:"bdbox",scene:"chat-search"},isBaiduBox:!0,hasComponentData:!1,canLaunchMultiSearch:!1,askComponentData:[],asyncAskComponentData:[],chatSearchAiTabInfo:{isChatSearchAiTabExperiment:!0,isAiTab:!0},baseData:{},isPc:"pc"===rt(),questionGuide:{},guideWord:on.getState("guideWord"),agentList:on.getState("agentList"),hideTopAgentList:on.getState("hideTopAgentList"),askComponentShow:!0,curAgentInfo:null}},messages:{"ai-ask-back:change":function(t){if(this.data.get("isChatSearch")){var e=t.value;Hn().conversation.updataTag.emit(kx({cardId:this.data.get("tplInfo.lid"),categoryName:e.categoryName,categoryId:e.categoryId,tagList:e.tagList},e.extra))}}},computed:{customTplInfo:function(){var t=this.data.get("tplInfo");return t.is_group?t:kx({},t,{order:1})},aiTabCustomStyle:function(){var t,e=this.data.get("$style"),n=this.data.get("askComponentData");if("askBack"===(null==(t=n[0])?void 0:t.component)){var a,i,o,r;if(!(null==(o=n[0])||null==(i=o.data)||null==(a=i.category)?void 0:a.length))return e.noOption;if("mulaskback"===(null==(r=n[0])?void 0:r.type))return e.cardWarp}return""},chatParams:function(){return this.data.get("baseData.chatParams")},"tplInfo.lid":function(){return this.data.get("baseData.lid")},questionGuideShowUbcLog:function(){var t,e,n,a,i,o="";return null==(e=this.data.get("questionGuide"))||null==(t=e.items)||t.forEach((function(t){var e;null==(e=t.options)||e.forEach((function(t){o+=t.value+","}))})),JSON.stringify({value:"nonala_cpt",valueInfo:{component_id:"47_2",component_name:"questionGuide",component_type:"askBack",component_subtype:(null==(n=this.data.get("questionGuide"))?void 0:n.scrollable)?"slide":"unslide",component_content:o},agent_id:null==(a=on.getState("agentInfo"))?void 0:a.agentId,agent_name:null==(i=on.getState("agentInfo"))?void 0:i.agentName})}},listenNewConversation:null,listenNewConversationLaunched:null,attached:function(){var t=this;this.listen(),this.listenDataChange(),this.listenQuestionGuide(),this.listenNewConversation=function(){t.handleNewConversation()},this.listenNewConversationLaunched=function(){t.data.set("isNewConversationLaunched",!0)},Jn().on(this.listenNewConversation),Xn().on(this.listenNewConversation),Yn().on(this.listenNewConversation),ea().on(this.listenNewConversationLaunched)},disposed:function(){this.listenNewConversation&&(Jn().off(this.listenNewConversation),Xn().off(this.listenNewConversation),Yn().off(this.listenNewConversation),this.listenNewConversation=null),this.listenNewConversationLaunched&&(ea().off(this.listenNewConversationLaunched),this.listenNewConversationLaunched=null);var t=Hn();this.listenAskDataInterflow&&(t.conversation.askDataInterflow.off(this.listenAskDataInterflow),this.listenAskDataInterflow=null);this.listenQuestionGuideFlow&&(t.component.questionGuide.off(this.listenQuestionGuideFlow),this.listenQuestionGuideFlow=null)},handleNewConversation:function(){this.el&&ra().emit(this.el.offsetHeight),this.data.set("isNewConversationLaunched",!0)},listenAskDataInterflow:null,listenDataChange:function(){var t=this,e=Hn().conversation.askDataInterflow;if(e){var n=this.data.get("rank");this.listenAskDataInterflow=function(e){var a;if(!t.data.get("hasComponentData")||Boolean(null==(a=e.params)?void 0:a.allowMultiUpdate)){var i=e.params.generator;if(i&&i.data){switch( __call$(Object,"assign",[i.data,{type:"primary",showLoading:!1,emptyDisabled:!0,showAi:!0,jumpTypes:["multiSearch"],hideAskItem:!0,toChatSearch:!0,context:{app:"bdbox",scene:"chat-search"}}]) ,i.component){case"askBack":var o; __call$(Object,"assign",[i.data,{showAi:!1,context:{app:"bdbox",scene:"ai-tab"},showCategoryItemIcon:!1,defaultActiveStyle:!1}]) ,(null==(o=i.data)?void 0:o.logExt)&& __call$(Object,"assign",[i.data.logExt,{type:i.type}]) ;break;case"questionClosely":var r;if((null==(r=i.data.recommendWord)?void 0:r.length)>3){var s,l=Math.ceil((null==(s=i.data.recommendWord)?void 0:s.length)/2); __call$(Object,"assign",[i.data,{rowNum:2,maxColNum:l}]) }var c=i.agentInfo||{};(null==c?void 0:c.log_ext)&&"text"===c.log_ext.scene&&"text_short"===c.log_ext.scene_1st&&"text_bless"===c.log_ext.scene_2nd&&(i.data.logExt||(i.data.logExt={}), __call$(Object,"assign",[i.data.logExt,c.log_ext]) )}var d=[],u=i.data.recommendWord||[],p=0;u.forEach((function(t){var e;if("agentRec"===t.type){var a=t.agentInfo;a&&d.push(a.agentName+a.label)}else d.push(t.text);"photoQuestion"===t.scene?p=1:(null==(e=on.getState("imageQuery"))?void 0: __get$(e,n) )&&(p=2)})), __call$(Object,"assign",[i.data,{photoQuestions:p}]) ,t.nextTick((function(){t.data.set("askComponentData",[i]),t.nextTick((function(){po({re_rank:n,lid:t.data.get("tplInfo.lid"),ori_lid:on.getState("oriLid"),photo_questions:p,text:d})}))})),t.data.set("hasComponentData",!0)}}},e.on(this.listenAskDataInterflow,{when:function(e){void 0===e&&(e={});var a=t.data.get("latestRank");return e.rank===n&&n===a}})}},listenQuestionGuideFlow:null,listenQuestionGuide:function(){var t=this,e=Hn().component.questionGuide,n=this.data.get("rank");this.listenQuestionGuideFlow=function(e){var n,a=e.params.questionGuideInfo;t.data.set("askComponentShow",!(null==(n=on.getState("agentInfo"))?void 0:n.agentName)),a.items.forEach((function(e){e.options=null==e?void 0:e.options.map((function(e){var n,a,i,o;return kx({},e,{"data-show-area":!0,"data-show-ext":JSON.stringify({type:"show",value:"cpt_option",valueInfo:{component_id:"47_2",component_name:"questionGuide",component_type:"askBack",component_subtype:(null==(n=t.data.get("questionGuide"))?void 0:n.scrollable)?"slide":"unslide",component_content:e.value},agent_id:null==(a=on.getState("agentInfo"))?void 0:a.agentId,agent_name:null==(i=on.getState("agentInfo"))?void 0:i.agentName}),"need-click-log":!0,"data-click-log":JSON.stringify({clk_info:{srcid:t.data.get("tplInfo.srcid"),tplname:"nonala_cpt",type:"b",action:"invokecsaitab"},extra:{component_content:{component_id:"47_2",component_name:"questionGuide",component_type:"askBack",component_subtype:(null==(o=t.data.get("questionGuide"))?void 0:o.scrollable)?"slide":"unslide",component_content:e.value}}})})}))})),t.data.set("questionGuide",a),t.data.set("hasComponentData",!0)},e.on(this.listenQuestionGuideFlow,{when:function(e){void 0===e&&(e={});var a=t.data.get("latestRank");return e.rank===n&&n===a}})},listen:function(){this.data.get("tplInfo.lid")},changeCard:function(t){var e=this.data.get("askData.category");e&&e.length&&t.data.id!==this.data.get("tplInfo.lid")&&this.ref("ask").deleteTags({needDeleteAll:!0})},handleAskBackEvent:function(t){this.askTagEventHandle(t.data,t.el)},handleUpdateAgentInfo:function(t){on.dispatch("update",kx({},t))},askTagEventHandle:function(t,e){void 0===e&&(e=null);var n=t.name,a=t.params;switch(n){case"submit-tag":if(a.cardId!==this.data.get("tplInfo.lid"))return;(null==e?void 0:e.sendJumpLog)?e.sendJumpLog(a):this.ref("ask").sendJumpLog(a);break;case"delete-tag":if(a.cardId!==this.data.get("tplInfo.lid"))return;(null==e?void 0:e.deleteTags)?e.deleteTags(a):this.ref("ask").deleteTags(a)}},handleQuestionGuideChange:function(t){var e,n,a=null==(e=this.data.get("questionGuide"))?void 0: __get$(e.items,t.index) ,i=(null==a?void 0:a.prefix)||"",o=(null==a?void 0:a.suffix)||"",r=(null==t||null==(n=t.option)?void 0:n.value)||"";on.dispatch("update",{truncQueryIndexRange:[i.length,i.length+r.length]}),Xl({query:i+r+o})}}),xx={};xx= __call$(Object,"assign",[xx,{answerAskWrapper:"answer-ask-wrapper_6o1ue_1","answer-ask-wrapper":"answer-ask-wrapper_6o1ue_1",immerseGroup:"immerse-group_6o1ue_6","immerse-group":"immerse-group_6o1ue_6",aiTabWrap:"ai-tab-wrap_6o1ue_9","ai-tab-wrap":"ai-tab-wrap_6o1ue_9",divider:"divider_6o1ue_12",noOption:"no-option_6o1ue_62","no-option":"no-option_6o1ue_62",cardWarp:"card-warp_6o1ue_65","card-warp":"card-warp_6o1ue_65",questionGuideWrapper:"question-guide-wrapper_6o1ue_73","question-guide-wrapper":"question-guide-wrapper_6o1ue_73",assitantHeight:"assitant-height_6o1ue_79","assitant-height":"assitant-height_6o1ue_79",aiTabWeatherExpStyle:"ai-tab-weather-exp-style_6o1ue_122","ai-tab-weather-exp-style":"ai-tab-weather-exp-style_6o1ue_122",askEntranceWrap:"ask-entrance-wrap_6o1ue_129","ask-entrance-wrap":"ask-entrance-wrap_6o1ue_129"}]) ,Sx.template='\n    <div data-show-area>\n        <div\n            s-show="{{hasComponentData && !isNewConversationLaunched}}"\n            class="\n                {{$style[\'answer-ask-wrapper\']}}\n                {{!hideTopAgentList ? $style[\'ai-tab-wrap\'] : \'\'}}\n                {{aiTabCustomStyle}}\n                {{hideTopAgentList ? $style[\'ai-tab-weather-exp-style\'] : \'\'}}\n            "\n        >\n            \x3c!-- 不上框反问组件 --\x3e\n            <div class="{{$style[\'question-guide-wrapper\']}}" s-if="questionGuide.title">\n                <cosd-question-guide\n                    class="{{!questionGuide.scrollable ? $style[\'assitant-height\'] : \'\'}}"\n                    attr-data-show-area\n                    attr-data-show-ext="{{questionGuideShowUbcLog}}"\n                    title="{{questionGuide.title}}"\n                    items="{{questionGuide.items}}"\n                    appearance="{{questionGuide.appearance}}"\n                    scrollable="{{questionGuide.scrollable}}"\n                    on-change="handleQuestionGuideChange"\n                />\n            </div>\n\n            \x3c!-- 反问/追问/输入框区 --\x3e\n            \x3c!-- 手百 A 页、互动多轮框架内 --\x3e\n            <template s-if="askComponentShow">\n                <div\n                    s-for="data in askComponentData"\n                    class="{{hideTopAgentList ? $style[\'ask-entrance-wrap\'] : \'\'}}"\n                >\n                    <ask-entrance\n                        ask-component-data="{{data}}"\n                        tpl-info="{{tplInfo}}"\n                        can-launch-multi-search="{{canLaunchMultiSearch}}"\n                        theme="{{theme}}"\n                        chat-params="{{chatParams}}"\n                        is-single-card="{{true}}"\n                        chat-search-ai-tab-info="{{chatSearchAiTabInfo}}"\n                        rank="{{rank}}"\n                        cur-agent-info="{{curAgentInfo}}"\n                        on-tag-event="handleAskBackEvent"\n                        on-update-agent-info="handleUpdateAgentInfo"\n                    />\n                </div>\n\n                \x3c!-- AI助手首页天气入口实验：agentList需展示在answer-ask中 --\x3e\n                <chat-guide\n                    guide-word="{{guideWord}}"\n                    agent-list="{{agentList}}"\n                    show-in-answer-ask="{{true}}"\n                    s-if="{{hideTopAgentList}}"\n                />\n            </template>\n        </div>\n    </div>\n';var Ix="function"==typeof Sx?Sx.prototype.initData||Tx:Sx.initData||Tx;function Tx(){return{$style:xx}}function Cx(){return  __call$(Object,"assign",[{},Ix.call(this),{$style:xx}]) }"function"==typeof Sx?Sx.prototype.initData=Cx:Sx.initData=Cx;var Lx=a.defineComponent({handlerVisibility:null,timer:null,components:{"cosc-feedback-form":e.FeedBackForm},computed:{tcClickLog:function(){return JSON.stringify({clk_info:{pd:"csaitab",srcid:"",tab_se:"1",tplname:"nonala_cpt",type:"b",action:"feedbackForm"},extra:{component_content:{component_name:"feedbackForm"}}})},ubcShowLog:function(){return JSON.stringify({value:"nonala_cpt",ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),setype:"csaitab",valueInfo:{component_name:"feedbackForm"}})},isGlobalCard:function(){return"global"===this.data.get("feedbackFormData.position")},needShow:function(){var t=this.data.get("feedbackFormData"),e=t.position,n=t.delayTime;return!("global"===e&&n)}},initData:function(){return{feedbackFormData:{},product:{},showCard:!0,isPc:"pc"===rt()}},created:function(){this.handlerVisibility=this.handleVisibilityChange.bind(this)},attached:function(){var t=this.data.get(),e=t.needShow,n=t.isPc,a=t.isGlobalCard;n&&!e?("visible"===document.visibilityState&&this.startTimer(),document.addEventListener("visibilitychange",this.handlerVisibility)):(a&&this.overrideHideCard(),this.sendShowLog())},sendShowLog:function(){Ua({type:"show",value:"nonala_cpt_disp",page:"resultpage",ext:{ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank")),setype:"csaitab",valueInfo:[{component_name:"feedbackForm"}]}})},hideCard:function(t){var e=this.data.get("isPc");"submit"===t&&e||(this.data.set("showCard",!1),this.fire("closeCard"))},startTimer:function(){var t=this;this.timer=setTimeout((function(){t.showMonitorCard(),document.removeEventListener("visibilitychange",t.handlerVisibility)}),1e3*this.data.get("feedbackFormData.delayTime"))},handleVisibilityChange:function(){"visible"===document.visibilityState?this.startTimer():this.clearTimer()},clearTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},overrideHideCard:function(){var t=this;qa().on((function(){(window.screen.width<1389||window.innerWidth<1389||window.innerWidth<1689&&!document.querySelector(".right-bar-wrapper-live"))&&t.hideCard()}))},showMonitorCard:function(){this.data.set("needShow",!0),this.sendShowLog(),this.overrideHideCard();var t=Date.now()+2592e5;localStorage.setItem(Lf,t.toString())},detached:function(){document.removeEventListener("visibilitychange",this.handlerVisibility),this.clearTimer()}}),Dx={};Dx= __call$(Object,"assign",[Dx,{feedbackForm:"feedback-form_12do1_1","feedback-form":"feedback-form_12do1_1",global:"global_12do1_8"}]) ,Lx.template='\n    <div s-if="showCard">\n        \x3c!-- 全局卡片支持延迟展现，需要监控页面持续可见 --\x3e\n        <div\n            s-if="needShow"\n            need-click-log\n            data-show-ext="{{ubcShowLog}}"\n            data-show-area\n            data-click-log="{{tcClickLog}}"\n            class="answer-feedback-wrapper"\n        >\n            <cosc-feedback-form\n                class="\n                    {{$style[\'feedback-form\']}}\n                    {{isGlobalCard ? \'global-feedback-form \' + $style[\'global\']: \'\'}}\n                "\n                title="{{feedbackFormData.title}}"\n                type="{{feedbackFormData.type}}"\n                product="{{product}}"\n                appearance="{{isGlobalCard ? \'filled\' : \'outline\'}}"\n                col="{{feedbackFormData.col}}"\n                successMessage="{{feedbackFormData.successMessage}}"\n                scoreCaptions="{{feedbackFormData.scoreCaptions}}"\n                options="{{feedbackFormData.options}}"\n                titleTag="{{feedbackFormData.titleTag}}"\n                on-submit="hideCard(\'submit\')"\n                on-close="hideCard(\'close\')"\n            />\n        </div>\n    </div>\n';var Px="function"==typeof Lx?Lx.prototype.initData||Ex:Lx.initData||Ex;function Ex(){return{$style:Dx}}function Ax(){return  __call$(Object,"assign",[{},Px.call(this),{$style:Dx}]) }function Ox(){return Ox=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Ox.apply(this,Array.from(arguments))}"function"==typeof Lx?Lx.prototype.initData=Ax:Lx.initData=Ax;var Rx=new X({pid:"19_103",lid:"",sample:1}),Nx=function(){function t(t){var e;this.groupList={};var n=t.params,a=t.platform,i=t.card,o=t.dim,r=void 0===o?{}:o,s=t.sendType;this.monitorInfo={},this.modelName="",this.typingTimer=null,this.typingObserveDelay=5e3,this.hasInit=!1,this.observer=null,this.params=n,this.platform=a||"wise",this.card=i||"",this.dim=Ox({platform:this.platform,card:this.card,isSync:on.getState("isSync")||"0",isAgent:(null==(e=on.getState("agentInfo"))?void 0:e.agentName)?"1":"0"},r),this.sendType=s,this.initGroupList()}var e=t.prototype;return e.initListener=function(){var t=this;if(!this.hasInit){var e=!1,n=0,a=this.params.aiContainerEl;this.observer=new MutationObserver((function(e){e.forEach((function(e){if("characterData"===e.type||"childList"===e.type){var i=a.textContent.length;i!==n&&(n=i,t.clearTypingTimer(),t.setTypingTimer())}}))})),a&&this.observer&&this.observer.observe(a,{childList:!0,subtree:!0,characterData:!0});document.addEventListener("visibilitychange",(function(){var n;(t.sendCount(),t.sendExceptMonitor(),document.hidden)?(clearTimeout(t.typingTimer),t.observer&&t.observer.disconnect(),e=!1):(!e&&!(null==(n=t.monitorInfo)?void 0:n.finishedTime)&&a&&t.observer&&t.observer.observe(a,{childList:!0,subtree:!0,characterData:!0}),e=!0)})),this.hasInit=!0}},e.stopListen=function(){this.observer&&this.observer.disconnect(),this.clearTypingTimer()},e.setTypingTimer=function(){var t=this;this.typingTimer||(this.typingTimer=setTimeout((function(){t.sendTypingExcept()}),this.typingObserveDelay))},e.clearTypingTimer=function(){clearTimeout(this.typingTimer),this.typingTimer=null},e.isSend=function(t){return!!t&&(!this.sendType||this.sendType.includes(t))},e.initGroupList=function(){"wise"===this.platform?(this.groupList.perf="chatsearch",this.groupList.whiteScreen="ai_index_white_screen",this.groupList.interface="ai_index_interface",this.groupList.lostPackage="ai_index_lost_package",this.groupList.show="aiIndexShow"):(this.groupList.perf="chat_pc",this.groupList.whiteScreen="chat_pc_white_screen",this.groupList.interface="chat_pc_interface",this.groupList.lostPackage="chat_pc_lost_package",this.groupList.show="chat_pc_show")},e.setMonitorData=function(t,e){var n;"object"==(void 0===t?"undefined":(n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)? __call$(Object,"assign",[this.monitorInfo,t]) : __set$(this.monitorInfo,t,e) },e.setModelName=function(t){!this.modelName&&(this.modelName=t)},e.sendPerfMonitor=function(t,e){var n,a,i,o=e.tti,r=e.dangerCheckTime,s=e.generatingStartTime,l=e.waitProcessStartTime,c=e.startTime,d=e.finishedTime,u=e.fetchEndTime,p=e.sseRequestStart,h=e.serverSpeed,f=void 0===h?{}:h,g=e.chunkFirstPackageTime,m=e.overviewBlockFirstTokenDur,v=f.costs||{},y=v.vuiPreTime,w=v.vuiFirstTokenCost,b=Ox({tti:o-c,start2SseRequest:p-c},window.renderHeadStartTime&&t<=1&&(null==(a=performance)||null==(n=a.timing)?void 0:n.navigationStart)?{start2Rendered:window.renderHeadStartTime-performance.timing.navigationStart,render2BootstrapStart:on.getState("bootstrapStart")-window.renderHeadStartTime}:{},r?{dangerCheckTime:r}:{},d?{sseAllTime:d-c}:{},u?{sseRequestTime:u-p}:{},l?{sseWaitTime:l-p}:{},s?Ox({start2SseFirstGenerateTime:s-c},p?{newSseFirstGenerateTime:s-p}:{}):{},g?{startToChunkFirstPackageTime:g-c}:{},y&&w?{feAndNetTime:s-c-y-w,severTime:y+w}:{},v,void 0===m?{}:{overviewBlockFirstTokenDur:m}),_=f.labels||{};Object.keys(_).length&&(delete f.labels.asid,delete f.labels.query),this.isSend("pref")&&c&&Object.keys(b).length&&Rx.sendPerf({group:"1"===_.frame_type?"chatsearch_new":this.groupList.perf,info:b,dim:Ox({rank:t<=1?"first":"other",modelName:this.modelName||"unknow",loadMode:t<=1?"1"===(null==(i=this.dim)?void 0:i.isSync)?"first_sync":"first_async":"non_first_async"},_,this.dim)})},e.sendExceptMonitor=function(){var t,e=this.monitorInfo,n=e.hasSendExceptMonitor,a=e.generatingStartTime,i=e.finishedTime,o=e.netError,r=e.antiCheat,s=e.timeout,l=e.aiContainerEmpty,c=e.stopGenerateAbnormal,d=e.allPackageCount,u=e.lostPackages;if(!n){var p=this.params,h=p.ctse_id,f=p.ori_lid,g=p.rank,m="",v="";o?(m="网络异常",v="网络异常"):r?m="反作弊":s?(m="请求超时",v="请求超时"):l?m="命中画布空白兜底":c?(m="请求异常中断",v="请求异常中断"):!a&&i&&(m="提前结束回调后才开始生成",v="提前结束回调后才开始生成");var y=Ox({},this.monitorInfo,{ctse_id:h,ori_lid:f,rank:g,query:_t(on.getState("query")),lid:on.getState("lid"),agentName:null==(t=on.getState("agentInfo"))?void 0:t.agentName}),w=Ox({msg:m},y),b="";u>0&&(b="共发送"+d+"包，丢了"+u+"包"),m&&this.isSend("whiteScreen")&&Rx.sendExcept({group:this.groupList.whiteScreen,info:w,dim:Ox({type:m},this.dim)}),this.isSend("interface")&&v&&Rx.sendExcept({group:this.groupList.interface,info:Ox({msg:v},y),dim:Ox({type:v},this.dim)}),this.isSend("lostPackage")&&"wise"===this.platform&&b&&Rx.sendExcept({group:this.groupList.lostPackage,info:Ox({msg:b},y),dim:this.dim}),this.monitorInfo.hasSendExceptMonitor=1}},e.sendPerf=function(){if(!on.getState("isDev")){var t=this.monitorInfo||{},e=this.params.rank,n=void 0===e?"":e;!t.isRetry&&this.sendPerfMonitor(n,this.monitorInfo)}},e.sendTypingExcept=function(){var t,e=this.monitorInfo||{};if(!e.hasSendTypingExec){var n=e.fetchEndTime,a=e.finishedTime,i=e.isUserActiveAbort,o=e.lastPack,r=this.params,s=r.ctse_id,l=void 0===s?"":s,c=r.ori_lid,d=void 0===c?"":c,u=r.rank,p=void 0===u?"":u,h=r.aiContainerEl;if(!i){var f=Ox({msg:""},e,{ctse_id:l,ori_lid:d,rank:p,query:_t(on.getState("query")),lid:on.getState("lid"),agentName:null==(t=on.getState("agentInfo"))?void 0:t.agentName,reciviedLastPack:o,renderedLastPack:h.innerText.substr(-50)});n?a||(f.msg="打字卡住"):(f.msg="无结束回调",this.isSend("interface")&&Rx.sendExcept({group:this.groupList.interface,info:f,dim:Ox({type:"无结束回调"},this.dim)})),this.isSend("whiteScreen")&&f.msg&&Rx.sendExcept({group:this.groupList.whiteScreen,info:f,dim:Ox({type:f.msg},this.dim)}),this.monitorInfo.hasSendTypingExec=1}}},e.sendCount=function(){(this.monitorInfo||{}).hasSendCount||(this.isSend("show")&&Rx.sendCount({group:this.groupList.show,info:{show:1},dim:this.dim}),this.monitorInfo.hasSendCount=1)},t}(),Mx=function(){function t(t,e){this.SUCCESS_TOASTT_MSG="数据复制成功",this.FAIL_TOASTT_MSG="数据复制失败",this.CLICK_COUNT=5,this.TIME_LENGTH=5e3,this.sseDataList=[],this.clickList=[],this.doubleTouch=!1,this.threeTouch=!1,this.cardEl=t,this.Toast=e,this.bindClickListener(),this.bindTouchListener()}var e=t.prototype;return e.bindClickListener=function(){var t,e=this;null==(t=this.cardEl)||t.addEventListener("click",(function(){e.addClickEvent(),e.touchHandler()}))},e.addClickEvent=function(){this.clickList.length>=this.CLICK_COUNT&&this.clickList.shift(),this.clickList.push(+new Date)},e.bindTouchListener=function(){var t,e=this;null==(t=this.cardEl)||t.addEventListener("touchstart",(function(t){2===t.touches.length?(e.doubleTouch=!0,e.clickList=[]):3===t.touches.length&&(e.threeTouch=!0,e.clickList=[])}))},e.touchHandler=function(){this.clickList.length===this.CLICK_COUNT&& __get$(this.clickList,this.clickList.length-1) -this.clickList[0]<=this.TIME_LENGTH&&this.doubleTouch&&this.threeTouch&&(this.copy(),this.doubleTouch=!1,this.threeTouch=!1)},e.addSseData=function(t,e){this.sseDataList.push({status:e,data:t,time:+new Date})},e.clearSseData=function(){this.sseDataList=[]},e.copy=function(){var t=this;this.sseDataList.length&&this.Toast&&Ep(JSON.stringify(this.sseDataList)).then((function(){t.Toast.show({message:t.SUCCESS_TOASTT_MSG})})).catch((function(e){t.Toast.show({message:t.FAIL_TOASTT_MSG+"\nerr: "+e})}))},t}(),qx=a.defineComponent({components:{},computed:{stateText:function(){return"retry"===this.data.get("state")?"重新回答":"停止回答"}},attached:function(){this.dispatch("send-ubclog",{type:"show",value:"stop"}),this.dispatch("send-midlog",{cst:2,clk_extra:{t:2}}),this.onClickBtn=Xi(this.onClick.bind(this),300,{leading:!0,trailing:!1})},initData:function(){return{state:"stop",sceneTheme:!1}},onClick:function(t){var e=this.data.get("state");this.fire("click",e),"stop"===e&&this.dispatch("send-ubclog",{type:"show",value:"rewrite"}),this.dispatch("send-log",{type:"b",fm:"beha",extra:{clk_region:"function"},target:t.target})}}),jx={};jx= __call$(Object,"assign",[jx,{statusbox:"statusbox_pplkr_1",stop:"stop_pplkr_6",img:"img_pplkr_20",stateText:"state-text_pplkr_29","state-text":"state-text_pplkr_29"}]) ,qx.template="\n    \x3c!-- 停止生成按钮 --\x3e\n    \x3c!-- answer-generate-state-button class 用来在外层通过css控制样式，而不是js --\x3e\n    \x3c!-- 用 js 会使逻辑更加复杂 --\x3e\n    <div data-module=\"{{state === 'retry' ? 'rewrite' : 'stop'}}\" class=\"answer-generate-state-button\">\n        <div class=\"{{$style.statusbox}}\">\n            <div class=\"{{$style.stop}} {{sceneTheme ? 'spring-theme-stop' : ''}}\" on-click=\"onClickBtn\">\n                <span class=\"{{$style['state-text']}}\">{{stateText}}</span>\n            </div>\n        </div>\n    </div>\n";var Bx="function"==typeof qx?qx.prototype.initData||Hx:qx.initData||Hx;function Hx(){return{$style:jx}}function $x(){return  __call$(Object,"assign",[{},Bx.call(this),{$style:jx}]) }function Fx(){return Fx=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},Fx.apply(this,Array.from(arguments))}"function"==typeof qx?qx.prototype.initData=$x:qx.initData=$x;var Ux=["markdown-yiyan","markdown-hamburg","markdown"],Gx=["imageGroup"],Wx="data-has-agent",zx=a.defineComponent({linkReg:/\[(.*?)\]\((.*?)\)/g,isAiAskReady:!1,components:{"ai-entry":Y_,loading:Yw,"cos-icon":e.Icon,"cs-container":_S,"dqa-searching-steps":e.SearchingSteps,"cos-avatar":e.Avatar,"ds-thinking":gm},messages:{"ai-entry:render-finished":function(t){var e;this.renderFinished(null==(e=t.value)?void 0:e.type)},"ai-ask-back:input-send":function(t){var e,n=this.data.get("askBackSelectCount");this.dispatch("chat:launch-search",{word:(null==t||null==(e=t.value)?void 0:e.targetStr)||"",event:"ai-ask-back:input-send",askBackSelectCount:n,sa:"re_dl_reply"})},"ai-question-closely:click":function(t){var e,n,a=this.data.get("isHaveQuestion");this.dispatch("chat:launch-search",{word:(null==t||null==(n=t.value)||null==(e=n.data)?void 0:e.text)||"",event:"ai-question-closely:click",isHaveQuestion:a,sa:"re_dl_prob"})},"ai-input:input-send":function(t){var e,n,a=this.data.get("isHaveQuestion");this.dispatch("chat:launch-search",{word:(null==t||null==(n=t.value)||null==(e=n.data)?void 0:e.text)||"",event:"ai-input:input-send",isHaveQuestion:a,sa:"re_dl_input"})},"ai-markdown-editor:btn-click":function(t){var e=this,n=t.value,a=n.actionType,i=n.text,r=n.target,s=n.event,l=n.author,c=n.receiver,d=n.id,u=n.originText,p=n.isRisk,h=n.hasTextContentChanged,f=n.diyUrl,g={actionType:a,text:i,target:r||(null==s?void 0:s.target),id:d,receiver:c,author:l,originText:u,isRisk:p,hasTextContentChanged:h};if("cancle"===a||"recipient"===a||"from"===a||"edit"===a||"image"===a&&1===p)this.sendSpringLog(g);else{if("copy"===a)return this.sendSpringLog(g),void this.copyText(i);var m=this.data.get("entryRef");this.handleRiskCheck(t.value).then((function(t){try{var n;null==(n=e.ref(m))||n.handleComponent("ai-markdown-editor","changeEditStatus",{isDanger:null==t?void 0:t.is_danger,id:d})}catch(t){}var a;if((g.isRisk=t.is_danger,e.sendSpringLog(g),!t.is_danger)&&((null==(a=on.getState("agentInfo"))?void 0:a.agentName)&&(on.dispatch("update",{agentInfo:{}}),zn().emit({word:"",invokeKeyboard:0})),f)){var i=t.diyParams||"",r=i?f+"&"+i:f;return void(o.canIUse("search.open")?o.search.open({url:r,notShowLandingTopBar:0,isContainer:"1",statusBarStyle:2,config:'{"immersed":1,"hideBack":1,"background":"#09090A"}'}):window.open(r,"_blank"))}})).catch((function(){try{var t;null==(t=e.ref(m))||t.handleComponent("ai-markdown-editor","changeEditStatus",{isDanger:0,id:d})}catch(t){}}))}},"ai-image-with-thumbnail:jump-diy-page":function(t){var e=t.value.url,n=this.data.get("commonData.chatParams"),a=this.data.get("tplInfo.lid")||"",i=this.data.get("cid")||"",r=this.data.get("oriLid")||"",s={chat_token:sc(""),lid:a,cid:i,ori_lid:r,sge_lid:n.sge_lid};e=jt(e,Ht.params(s)),o.canIUse("search.open")?o.search.open({url:e,notShowLandingTopBar:0,isContainer:"1",statusBarStyle:2,config:'{"immersed":1,"hideBack":1,"background":"#09090A"}'}):window.open(e,"_blank")},"ai-image-with-thumbnail:update":function(t){var e=this,n=t.value,a=n.id,i=n.updateTemplateListApi,o=this.data.get("entryRef"),r=this.data.get("cid")||"",s=this.data.get("oriLid")||"",l=jt(i,Ht.params({msgId:r,sessionId:s}));i&&fetch(l,{method:"get",mode:"cors",credentials:"include"}).then((function(t){return t.json()})).then((function(t){setTimeout((function(){var n,i;null==(i=e.ref(o))||i.handleComponent("image-with-thumbnail","updateTemplateList",{id:a,templateList:null==t||null==(n=t.data)?void 0:n.templateList})}),200)})).catch((function(t){var n;null==(n=e.ref(o))||n.handleComponent("image-with-thumbnail","updateTemplateList",{id:a,templateList:null})}))},"writing:cancel-edit":function(t){var e;if(null==(e=t.value)?void 0:e.showDialog){var n=Hn().conversation.dialogPop;null==n||n.emit({cid:this.data.get("cid"),id:"ai_index_"+this.data.get("rank")})}else this.dispatch("writing:cancel-edit",{})},"writing:copy":function(t){var e=t.value.text;this.copyText(e)},"pic-loading:set-height":function(t){if(t.value){this.data.set("picMinHeight",t.value);var e=this.ref(this.data.get("entryRef"));e&&e.el&&(e.el.style.minHeight=t.value+"px")}},"pic-loading:listen-pic-load":function(t){var e=this;this.nextTick((function(){var t=e.el.querySelector(".marklang-img");t&&(t.onload=t.onerror=t.onabort=function(){t.onload=t.onerror=t.onabort=null,e.data.set("picMinHeight",0)})}))}},computed:{aiLogoBg:function(){var t=(this.data.get("theme")||{}).aiLogoBg;return t||"https://psstatic.cdn.bcebos.com/basics/aichat/ai-icon-bg-4_1703229976000.png"},isPicIntent:function(){var t=this.data.get("intentionType")||"",e=this.data.get("intentionTypeMap"),n=this.data.get("hasNoTextComponent");return t===(null==e?void 0:e.PIC)||n},overviewType:function(){if(!this.data.get("agentInfo.agentName"))return on.getState("singleOverviewType")},ubcShowLog:function(){var t,e;return JSON.stringify({type:"show",value:"dialog_agent",agent_id:null==(t=this.data.get("agentInfo"))?void 0:t.agentId,agent_name:null==(e=this.data.get("agentInfo"))?void 0:e.agentName})},ubcClickLog:function(){var t,e;return JSON.stringify({type:"click",value:"dialog_agent",ubcExt:{agent_id:null==(t=this.data.get("agentInfo"))?void 0:t.agentId,agent_name:null==(e=this.data.get("agentInfo"))?void 0:e.agentName}})},isShowSpecialIcon:function(){var t=this.data.get("agentInfo"),e=this.data.get("authorityInfo");return!(!(null==t?void 0:t.agentName)&&!(null==e?void 0:e.title))}},initData:function(){return{generatingSuffix:'<span data-safe-html class="chat-answer-typing-loading"></span>',index:0,currentIndex:0,setectedAskTagNum:0,isFinished:!1,isHaveQuestion:!1,askBackSelectCount:0,typingSpeed:10,theme:{},guideWord:"",autoHeight:!1,cid:"",agentInfo:null,entryRef:"ai-entry"+Date.now(),intentionType:"",intentionTypeMap:{},rank:1,bgProps:null,answerIndex:0,searchingStepsData:{},searchingStepsStartTime:0,showSteps:!1,isWaiting:!0,isPc:"pc"===rt(),agentBoxAbsolute:!1,blockIndex:0,logExtParams:{},generationPrompt:"",transitionPrompt:"",blessStyle:"",isExtension:vt(),dsUsedModel:{},hasSetDsLabel:!1,askUsedModel:{}}},created:function(){var t,e,n=on.getState("agentInfo"),a=this.data.get("overviewType");(this.data.set("agentInfo",n),(null==n?void 0:n.agentName)||"2"!==a&&"3"!==a)||this.el&&(null==(e=xn(this.el,'[class^="index_answer-container"]'))||null==(t=e.classList)||t.add(Vt))},listenAiWriting:null,attached:function(){var t=this;this.setPrompt();var e=this.getAgentLogInfo(),n=e.value,a=e.agentSearchId,i=e.agentName;this.watch("searchingStepsData",(function(e){var o,r=t.data.get("searchingStepsStartTime"),s=t.data.get("transitionPrompt");if(null==e||null==(o=e.steps)?void 0:o.length){var l;if(s&&(e.steps[0].title=s),t.data.get("overviewType"))null==(l=t.ref("loading"))||l.updateLoading(e);else t.data.set("showSteps",!0);r||(t.data.set("searchingStepsStartTime",(new Date).getTime()),t.dispatch("send-ubclog",{type:"show",value:n,extra:{agent_id:a,agent_name:i}}))}else if(r){var c=(new Date).getTime();t.data.set("searchingStepsStartTime",0),t.dispatch("send-ubclog",{ubcId:17630,value:n,extra:{starttime:r+"",endtime:c+"",duration:c-r+"",agent_id:a,agent_name:i}}),t.dispatch("overview:send-perf")}})),this.watch("isWaiting",(function(t){var e;!t&&(null==(e=on.getState("agentInfo"))?void 0:e.agentSearchId)&&ra().emit(100)})),this.watch("sseStatus",(function(e){!e&&t.setPrompt()}));var o=Hn().conversation.dialogClick,r=this.data.get("entryRef");this.listenAiWriting=function(e){var n;void 0===e&&(e={}),null==(n=t.ref(r))||n.handleComponent("ai-writing","changeEditStatus",e)},o.on(this.listenAiWriting),Pa().emit(),this.listenAgentShow()},answerBoxDom:null,setAgentDataInAnswerBox:function(){this.answerBoxDom&&kn(this.answerBoxDom,Wx,"true")},removeAgentDataInAnswerBox:function(){this.answerBoxDom&&kn(this.answerBoxDom,Wx,null)},listenAgentShow:function(){var t=this;this.answerBoxDom=xn(this.el,Xt,null),this.data.get("isShowSpecialIcon")&&this.setAgentDataInAnswerBox(),this.watch("isShowSpecialIcon",(function(e){e?t.setAgentDataInAnswerBox():t.removeAgentDataInAnswerBox()}))},disposed:function(){(this.removeAgentDataInAnswerBox(),this.answerBoxDom=null,this.listenAiWriting)&&(Hn().conversation.dialogClick.off(this.listenAiWriting),this.listenAiWriting=null)},setPrompt:function(){"sge_spring"===this.data.get("commonData.chatParams.setype")&&this.data.set("generationPrompt","正在奋笔疾书")},goToAgent:function(t,n){var a,i;if(this.data.get("isExtension"))e.Toast.info({message:"请到网页版使用",duration:2e3});else{if("pc"===rt()){var o,r,s=As((null==(o=n.jumpUrl)?void 0:o.h5)||(null==(r=n.jump_url)?void 0:r.h5));if(s)return void window.open(s,"_blank")}var l=(null==(a=n.jumpUrl)?void 0:a.zbios)||(null==(i=n.jump_url)?void 0:i.zbios);if(l){var c=Es(l,{_baiduboxapp:{sysExt:{sessionId:JSON.stringify({hudongExtLog:{lid:this.data.get("commonData.tplInfo.lid")}})}}});this.dispatch("send-log",{cyc:1,action:"agent_head",target:t.target}),Pp(c)}}},getAgentLogInfo:function(){var t=on.getState("agentInfo")||{};return{value:t.agentSearchId?"agent-loading":"loading",agentSearchId:t.agentSearchId,agentName:t.agentName}},startWaiting:function(){var t;this.data.set("isFinished",!1),this.data.set("isHaveQuestion",!1),this.data.set("isWaiting",!0),this.data.set("showSteps",!1),this.data.set("agentBoxAbsolute",!1);var e=this.data.get("entryRef");null==(t=this.ref(e))||t.startWaiting()},startGenerating:function(){var t;if(this.el){var e,n=xn(this.el,"."+Vt);null==n||null==(e=n.classList)||e.remove(Vt)}var a=this.data.get("entryRef");this.data.set("isWaiting",!1),null==(t=this.ref(a))||t.startGenerating()},pushBlock:function(t){var e,n,a,i,o,r,s,l;if(t&&t.generator){var c=this.data.get("overviewType"),d=bn(".cosd-markdown",this.el),u= __get$(d,d.length-1) ,p=_n(".marklang",this.el);"2"!==c&&"3"!==c||!u||!p||u.className.includes(Jt)||"UL"!==(null==(e=p.lastElementChild)?void 0:e.tagName)||u.classList.add(Jt);var h=this.data.get("hasSetDsLabel"),f=t.generator,g=null==t||null==(a=t.agentInfo)||null==(n=a.agentMeta)?void 0:n[0],m=f.usedModel||{};if(f.switchModel){var v=new Gi(on),y=new Vi(on),w=f.switchModel,b=v.getCurrentModel();if(b.modelName!==w){v.handleChangeUsedModelStatus(w,{});var _=on.getState("modelList").find((function(t){return t.id===b.modelName}));y.handleSelectModel(_)}y.handleSelectModel({id:w})}if(h||(on.dispatch("update",{dsUsedModel:m}),this.data.set("dsUsedModel",m),this.data.set("hasSetDsLabel",!0)),"markdownEditor"!==f.component&&"markdown"!==f.component||!(null==(i=f.data)?void 0:i.value)||!(null==(o=f.data)?void 0:o.isGuideWord)){var k=this.data.get("blockIndex"),S=this.data.get("entryRef"),x=null==(r=this.ref(S))?void 0:r.isMarkdownCmpt(f),I=null==(s=this.ref(S))?void 0:s.isBlockNotForRender(f);!x&&I||this.data.set("blockIndex",++k),this.generatorHandle(f,g,k),f.component&&Gx.includes(f.component)&&this.data.set("hasNoTextComponent",!0),f.data&&f.data.style&&this.data.set("blessStyle",f.data.style),null==(l=this.ref(S))||l.pushBlock(f)}else this.data.set("guideWord",f.data.value)}},clear:function(){var t;this.data.set("guideWord","");var e=this.data.get("entryRef");null==(t=this.ref(e))||t.clear(),this.data.set("emptyWord","")},stop:function(t,e){var n;if("separate-bub"===t||t&&e){this.data.set("isWaiting",!1),"userAbort"===t&&this.data.set("agentBoxAbsolute",!1),this.data.set("blockIndex",0);var a=this.data.get("entryRef");null==(n=this.ref(a))||n.stop(t,e)}},generatorHandle:function(t,e,n){var a=this;if(t.needClearHistory&&this.data.set("needClearHistory",!0),null==t?void 0:t.data){(null==e?void 0:e.pluginInfo)&&Ro(e);var i,o,r=this.data.get("commonData.lid");if("markdown"===t.component||"markdown-yiyan"===t.component||"askBack"===t.component||"markdownEditor"===t.component)t.data.askBackId=r,t.data.editorStyle=this.data.get("commonData.editorStyle"),null==(o=t.data)||null==(i=o.value)|| __call$(i,"replace",[this.linkReg,function(t,e){a.dispatch("send-ubclog",{type:"show",value:"wz_link",extra:{info:e}});}]) ;if("imageWithThumbnail"===t.component&&(t.data.showRetry=!0),"sge_spring"===(this.data.get("commonData.chatParams")||{}).setype&&("input"===t.component||"askBack"===t.component?(t.data.type="primary",t.data.emptyDisabled=!0,t.data.initBtnIsFocus=!0,t.data.showLoading=!1,t.data.jumpTypes=["multiSearch"],t.data.sendText="写祝福",t.data.btnText="写祝福",t.data.inputIcon="&#xe721",t.data.primarySendText="写祝福"):"questionClosely"===t.component&&(t.data.hideAskItem=!0,t.data.jumpTypes=["multiSearch"],this.data.set("isHaveQuestion",!0))),e&&e.logo&&e.agentName&&this.data.set("agentInfo",e),(e=this.data.get("agentInfo"))&&e.agentName&&e.logo&&!this.data.get("agentBoxAbsolute")&&1===n&&Ux.includes(t.component)){var s; __call$(this.data,"assign",[{agentBoxAbsolute:!0}]) ;var l=null==(s=t.data)?void 0:s.value,c=/^#+\s/.test(l)?"<br/>\n"+l:l;t.data.value=this.getAtAgentMarkdown(e)+c}}},getAtAgentMarkdown:function(t){var e,n;if(!t)return"";var a=this.data.get("isPc")?null==(e=t.jumpUrl)?void 0:e.h5:null==(n=t.jumpUrl)?void 0:n.zbios;return"["+t.agentName+"]("+a+'){type="agent" src="'+t.logo+'"} '},renderFinished:function(t){var e,n,a,i=bn(".cosd-markdown",this.el),o= __get$(i,i.length-1) ;o&&o.classList.remove(Jt),this.data.set("isFinished",!0),this.entryEmptyHandler(),this.referShowLog();var r=this.ref(this.data.get("entryRef"));(null==r||null==(n=r.el)||null==(e=n.style)?void 0:e.minHeight)&&(r.el.style.minHeight="auto");var s=Op(null==r?void 0:r.el,null==(a=this.data.get("agentInfo"))?void 0:a.agentName);this.fire("render-finished",{ttsText:s,answerIndex:this.data.get("answerIndex"),type:t})},referShowLog:function(){var t,e=this,n=this.data.get("entryRef"),a=null==(t=this.ref(n))?void 0:t.el;if(a){var i=bn(".cosd-citation",a);i.forEach((function(t,n){var a,o,r;(null==(a=t.parentElement)?void 0:a.nextElementSibling)!==(null==(o= __get$(i,n+1) )?void 0:o.parentElement)&&e.dispatch("send-ubclog",{type:"show",value:"subscript",extra:{is_his:"0",info_rank:null==(r=t.getElementsByClassName("cosd-citation-citationId")[0])?void 0:r.innerText}})}))}},entryEmptyHandler:function(){var t=this;this.data.get("hideAlaStyle")||setTimeout((function(){var e=t.data.get("entryRef"),n=t.ref(e),a=null==n?void 0:n.el,i=t.data.get("isPicIntent");(!i&&!(null==a?void 0:a.innerText)||i&&!(null==a?void 0:a.innerHTML))&&(t.data.get("needClearHistory")?t.data.set("emptyWord","😩对不起，我还没有学会这个问题，可以换个话题再问问我，我将尽力为你回答~"):t.data.set("emptyWord","抱歉，出了点小问题，请稍后重试。"),t.fire("empty",{ttsText:t.data.get("emptyWord")}))}),100)},markdownInnerShowEvent:function(){ho()},handleRenderFinished:function(t){this.dispatch("pack-render-finished",t)},handleUbcLogEvent:function(t){this.dispatch("send-ubclog",t)},handleActionLogEvent:function(t){var e,n,a=this.data.get("commonData.chatParams"),i=a.setype,o=void 0===i?"":i,r=a.scene,s=void 0===r?"":r,l=this.data.get("commonData.tplInfo"),c=this.data.get("logExtParams")||{},d=this.data.get("commonData.isChatSearch");if("sge_spring"===o||d){var u=this.data.get("rank"),p=this.data.get("oriLid");t.ext= __call$(Object,"assign",[{},t.ext,Fx({re_rank:String(u),ori_lid:p,setype:o,scene:s,lid:l.lid,cid:this.data.get("cid")},c)]) }var h="",f=(null==o?void 0:o.startsWith("sge"))||!1,g="csaitab"===o;f&&"askBack"===(null==t?void 0:t.component)?h="invokesge":g&&"askBack"===(null==t?void 0:t.component)&&(h="invokecsaitab");var m=this.data.get("entryRef");Np(t,l,{action:h,launchMultiSearch:f||g},(null==(e=t.ext)?void 0:e.target)||(null==(n=this.ref(m))?void 0:n.el))},sendSpringLog:function(t){var e=t.actionType,n=t.text,a=t.target,i=t.id,o=t.isRisk,r=t.area;if(this.data.get("isPc")){lp({type:"click",value:e,ubcExt:Fx({},this.data.get("logExtData"))},this.data.get("tplInfo"),a)}else{this.data.get("commonData.chatParams");var s={type:"b",action:e,extra:{module_type:"content"},target:a};switch(e){case"copy":s.extra.copy_content=n;break;case"cancle":s.extra.content_order=i;break;case"edit":s.extra.content_order=i,"content"!==r&&(s.extra.is_interact=1);break;case"image":s.cyc=1,s.type="na",s.action=void 0,s.extra.content_order=i,s.extra.is_risk=o||0}this.dispatch("send-log",s)}},handleCopy:function(t){var e,n={type:"b",action:"copy",fm:"beha",target:null==(e=t.event)?void 0:e.target};this.data.get("isPc")&&(n.ubcExt=this.data.get("logExtData"),n.type="click",n.value="copy"),this.dispatch("send-log",n),this.copyText(t.text)},copyText:function(t){Ep(t).then((function(){e.Toast.show({message:"复制成功"})})).catch((function(){e.Toast.show({message:"复制失败"})}))},handleRiskCheck:function(t){if("more"===t.strategy)return new Promise((function(t){t({isDanger:0})}));var e=this.data.get("commonData.chatParams"),n=this.data.get("commonData.riskcheckApi"),a=this.data.get("blessStyle");return function(t,e){return new Promise((function(n,a){fetch(t,{method:"post",mode:"cors",credentials:"include",body:JSON.stringify(e)}).then((function(t){return t.json()})).then((function(t){n(null==t?void 0:t.data)})).catch((function(t){a(null==t?void 0:t.data)}))}))}(n,{sge_lid:e.sge_lid,query:t.query,type:"spring_edit",token:sc(t.query),ori_content:t.originText,fix_content:t.text,author:t.author,receiver:t.receiver,ori_lid:this.data.get("oriLid")||"",lid:this.data.get("tplInfo.lid")||"",cid:this.data.get("cid"),acrostic:"1"===a?1:0})},handleComponentAll:function(){var t=this,e=this.data.get("entryRef");return new Promise((function(n){t.ref(e)?t.ref(e).handleComponentAll("getAsyncApiParams").then((function(t){var e=t&&t.reduce((function(t,e){return t.concat(e)}),[]);n(e||[{}])})):n([{}])}))},onEditClick:function(){this.fire("edit-click")}}),Qx={};Qx= __call$(Object,"assign",[Qx,{flashAnimation:"flashAnimation_11wt5_1",aiEntry:"ai-entry_11wt5_24","ai-entry":"ai-entry_11wt5_24",entryMinHeight:"entry-min-height_11wt5_101","entry-min-height":"entry-min-height_11wt5_101",emptyWord:"empty-word_11wt5_109","empty-word":"empty-word_11wt5_109",aiEntryTheme:"ai-entry-theme_11wt5_117","ai-entry-theme":"ai-entry-theme_11wt5_117",fusionAladdin:"fusion-aladdin_11wt5_130","fusion-aladdin":"fusion-aladdin_11wt5_130",aiIconBox:"ai-icon-box_11wt5_133","ai-icon-box":"ai-icon-box_11wt5_133",agentBoxAbsolute:"agent-box-absolute_11wt5_151","agent-box-absolute":"agent-box-absolute_11wt5_151",authorityIconBox:"authority-icon-box_11wt5_179","authority-icon-box":"authority-icon-box_11wt5_179",authorityIcon:"authority-icon_11wt5_179","authority-icon":"authority-icon_11wt5_179",aiIconBoxWrapper:"ai-icon-box-wrapper_11wt5_192","ai-icon-box-wrapper":"ai-icon-box-wrapper_11wt5_192",aiEntryBox:"ai-entry-box_11wt5_195","ai-entry-box":"ai-entry-box_11wt5_195",aiIconBoxBlock:"ai-icon-box-block_11wt5_198","ai-icon-box-block":"ai-icon-box-block_11wt5_198",aiIndexAiIconAni:"ai-index-ai-icon-ani_11wt5_233","ai-index-ai-icon-ani":"ai-index-ai-icon-ani_11wt5_233",iconBgAnimation:"iconBgAnimation_11wt5_1",aiIndexAgentIconWrapper:"ai-index-agent-icon-wrapper_11wt5_259","ai-index-agent-icon-wrapper":"ai-index-agent-icon-wrapper_11wt5_259",aiIndexAgentText:"ai-index-agent-text_11wt5_265","ai-index-agent-text":"ai-index-agent-text_11wt5_265",aiIndexAgentIcon:"ai-index-agent-icon_11wt5_259","ai-index-agent-icon":"ai-index-agent-icon_11wt5_259",agentAvatarWrapper:"agent-avatar-wrapper_11wt5_293","agent-avatar-wrapper":"agent-avatar-wrapper_11wt5_293",searchingSteps:"searching-steps_11wt5_332","searching-steps":"searching-steps_11wt5_332",emptyPicMinHeight:"empty-pic-min-height_11wt5_336","empty-pic-min-height":"empty-pic-min-height_11wt5_336"}]) ,zx.template='\n    <cs-container\n        s-ref="cs-container"\n        bg-props="{{bgProps}}"\n        log-ext-data="{{logExtData}}"\n        common-data="{{commonData}}"\n        current-answer="{{currentAnswer}}"\n        answer-index="{{answerIndex}}"\n        tts-text="{{ttsText}}"\n        rank="{{rank}}"\n        on-edit-click="onEditClick"\n        cid="{{cid}}"\n        agent-info="{{agentInfo}}"\n        is-bless="{{isBless}}"\n        is-show-button="{{isShowButton}}"\n        tplInfo="{{commonData.tplInfo}}"\n    >\n        <slot name="header"></slot>\n        <div\n            class="{{isFinished ? \'ai-index-no-animation-icon\' : \'ai-index-animation-icon\'}}\n            {{autoHeight ? $style[\'no-entry-min-height\'] : $style[\'entry-min-height\']}}\n            {{picMinHeight ? $style[\'empty-pic-min-height\'] : \'\'}}\n            markdown-typing-all\n            "\n            style="{{picMinHeight ? \'--pic-min-height:\' + picMinHeight + \'px;\' : \'\'}}"\n        >\n            \x3c!-- agent的logo --\x3e\n            <div\n                s-if="agentInfo && agentInfo.logo && agentInfo.agentName"\n                id="agent-icon"\n                class="{{$style[\'ai-icon-box\']}} {{$style[\'ai-icon-box-wrapper\']}} {{agentBoxAbsolute ? $style[\'agent-box-absolute\'] : \'\'}}"\n                on-click="goToAgent($event, agentInfo)"\n            >\n                <div\n                    class="{{$style[\'ai-index-agent-icon-wrapper\']}}"\n                    style="margin-bottom: {{isWaiting ? \'.14rem\' : \'0\' }}"\n                    need-click-log\n                    data-click-log="{{ubcClickLog}}"\n                    data-show-area\n                    data-show-ext="{{ubcShowLog}}"\n                >\n                    <div class="{{$style[\'ai-index-agent-icon\']}}">\n                        <cos-avatar\n                            class="{{$style[\'agent-avatar-wrapper\']}}"\n                            src="{{agentInfo.logo}}"\n                            size="sm"\n                        />\n                    </div>\n                    <div class="{{$style[\'ai-index-agent-text\']}} cs-force-selection">\n                        {{ agentInfo.agentName }}\n                    </div>\n                </div>\n            </div>\n            \x3c!-- 空白兜底 --\x3e\n            <div\n                s-else-if="guideWord || emptyWord"\n            >\n                <p>\n                    <span s-if="guideWord">{{ guideWord }}</span>\n                    <div s-elif="emptyWord" class="{{$style[\'empty-word\']}}">{{ emptyWord }}</div>\n                </p>\n            </div>\n            \x3c!-- 存在智能体回答失败走ai助手兜底回答的情况，导致智能体与权威标重叠，决定隐藏权威标 --\x3e\n            <div\n                s-if="authorityInfo && authorityInfo.title && !agentInfo.agentName"\n                class="{{$style[\'authority-icon-box\']}}"\n            >\n                <cos-icon\n                    class="{{$style[\'authority-icon\']}}"\n                    name="authority"\n                />\n                <div class="{{$style[\'authority-text\']}} c-fwb cs-force-selection">\n                    {{ authorityInfo.title }}\n                </div>\n            </div>\n            \x3c!-- 画布 --\x3e\n            <div class="{{$style[\'ai-entry-box\']}}">\n                <ai-entry\n                    class="{{$style[\'ai-entry\']}}\n                        {{theme && theme.scene ? $style[\'ai-entry-theme\'] : \'\'}}\n                        {{commonData.isAlaHat && commonData.chatAlaType === 2 ? $style[\'fusion-aladdin\'] : \'\'}}"\n                    s-ref="{{entryRef}}"\n                    blocks="{{blocks}}"\n                    question="{{question}}"\n                    rank="{{rank}}"\n                    render-mode="{{isGenerate ? \'only-csr\' : \'ssr\'}}"\n                    context="{{ {\n                        tplInfo: commonData.tplInfo,\n                        scene: \'chat-search\',\n                        app: \'bdbox\',\n                        theme: theme,\n                        editorParams: commonData.editorParams,\n                        isSse: true\n                    } }}"\n                    cid="{{cid}}"\n                    typing-speed="{{typingSpeed}}"\n                    on-action-log-event="handleActionLogEvent"\n                    on-ubc-log-event="handleUbcLogEvent"\n                    on-markdown-inner-show-event="markdownInnerShowEvent"\n                    on-copy="handleCopy"\n                    on-fragment-render-finished="handleRenderFinished"\n                    generating-suffix="{{generatingSuffix}}"\n                    answer-index="{{answerIndex}}"\n                    tplInfo="{{commonData.tplInfo}}"\n                    agentInfo="{{agentInfo}}"\n                    ask-used-model="{{askUsedModel}}"\n                >\n                    <loading\n                        s-if="!hideAlaStyle"\n                        slot="idle"\n                        sse-status="1"\n                        overview-type="{{overviewType}}"\n                        appearance="steps"\n                        generation-prompt="{{generationPrompt}}"\n                    />\n                    <dqa-searching-steps\n                        s-if="!hideAlaStyle && showSteps"\n                        s-ref="searchingStep"\n                        slot="waiting"\n                        s-bind="searchingStepsData"\n                        class="cos-dqa {{$style[\'searching-steps\']}}"\n                    />\n                    <loading\n                        s-if="!hideAlaStyle && !showSteps"\n                        s-ref="loading"\n                        slot="waiting"\n                        sse-status="1"\n                        overview-type="{{overviewType}}"\n                        appearance="steps"\n                        generation-prompt="{{generationPrompt}}"\n                    />\n                </ai-entry>\n            </div>\n        </div>\n        <slot name="footer"></slot>\n    </cs-container>\n';var Jx="function"==typeof zx?zx.prototype.initData||Vx:zx.initData||Vx;function Vx(){return{$style:Qx}}function Kx(){return  __call$(Object,"assign",[{},Jx.call(this),{$style:Qx}]) }"function"==typeof zx?zx.prototype.initData=Kx:zx.initData=Kx;var Xx=a.defineComponent({dialogPop:null,dialogClick:null,components:{"cos-dialog":e.Dialog},initData:function(){return{showDialog:!1,id:"",cid:"",checked:!1}},listenDialogPop:null,attached:function(){var t,e=this;this.handleRadioClick=Xi(this.handleRadioClick,300);var n=Hn();this.dialogPop=n.conversation.dialogPop,this.dialogClick=n.conversation.dialogClick,this.listenDialogPop=function(t){void 0===t&&(t={}),t.id&&t.id===e.data.get("id")&&(e.data.set("showDialog",!0),e.data.set("cid",t.cid))},null==(t=this.dialogPop)||t.on(this.listenDialogPop)},disposed:function(){var t;this.listenDialogPop&&(null==(t=this.dialogPop)||t.off(this.listenDialogPop),this.listenDialogPop=null)},handleOk:function(){var t;this.data.set("showDialog",!1),null==(t=this.dialogClick)||t.emit({cid:this.data.get("cid"),action:"edit",status:"ok"})},handleCancel:function(){var t;this.data.set("showDialog",!1),null==(t=this.dialogClick)||t.emit({cid:this.data.get("cid"),status:"cancel"})},handleRadioClick:function(){var t,e=this.data.get("checked");this.ref("radio").checked=!e,this.data.set("checked",!e),null==(t=localStorage)||t.setItem("writingEditQuitNoTips",e?"0":"1")}}),Yx={};Yx= __call$(Object,"assign",[Yx,{noticeRadioGroup:"notice-radio-group_evik9_1","notice-radio-group":"notice-radio-group_evik9_1",noticeRadio:"notice-radio_evik9_1","notice-radio":"notice-radio_evik9_1"}]) ,Xx.template='\n    <div>\n        <cos-dialog\n            open="{=showDialog=}"\n            title="取消后将不保留您更改的内容"\n            ok-text="继续取消"\n            cancel-text="再想想"\n            on-ok="handleOk"\n            on-cancel="handleCancel"\n        >\n            <div\n                class="{{$style[\'notice-radio-group\']}}"\n            >\n                <input\n                    s-ref="radio"\n                    type="radio"\n                    value="dewey"\n                    class="{{$style[\'notice-radio\']}}"\n                    on-click="handleRadioClick"\n                />\n                <span on-click="handleRadioClick">下次不再提醒</span>\n            </div>\n        </cos-dialog>\n    </div>\n';var Zx="function"==typeof Xx?Xx.prototype.initData||tI:Xx.initData||tI;function tI(){return{$style:Yx}}function eI(){return  __call$(Object,"assign",[{},Zx.call(this),{$style:Yx}]) }function nI(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function aI(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof Xx?Xx.prototype.initData=eI:Xx.initData=eI;var iI=Tt.connect(on,{imageQuery:"imageQuery"})(a.defineComponent({trimWhitespace:"all",components:{"cos-icon":e.Icon},computed:{btnText:function(){var t=this.data.get("status");return 0===t?"去验证年龄":1===t?"查看身份信息":void 0}},initData:function(){return{btnText:"",hasClickVerify:!1,verifyUrl:"https://wappass.baidu.com/v6/realName?tpl=&adapter=3&hideFinish=1&client=&clientfrom=&u&okU=",questionNumber:0}},attached:function(){var t,e=this,n=this.data.get("rank"),a=this.data.get("imageQuery"),i=null==a||null==(t= __get$(a,n) )?void 0:t.rectIndex;this.data.set("questionNumber",i),document.addEventListener("visibilitychange",(function(){return e.handleVisibilityChange()})),this.dispatch("send-ubclog",{type:"show",value:this.data.get("status")?"verify_identity":"verify_age",extra:{question_number:i}})},goVerify:function(){this.dispatch("send-ubclog",{type:"click",value:this.data.get("status")?"verify_identity":"verify_age",extra:{question_number:this.data.get("questionNumber")}}),this.data.set("hasClickVerify",!0)},fetch:function(t){return(e=function(){return aI(this,(function(e){switch(e.label){case 0:return[4,fetch(t,{method:"post",credentials:"include"})];case 1:return[2,e.sent().json()]}}))},function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){nI(o,a,i,r,s,"next",t)}function s(t){nI(o,a,i,r,s,"throw",t)}r(void 0)}))})();var e},handleVisibilityChange:function(){var t=this;!document.hidden&&this.data.get("hasClickVerify")&&(this.data.set("hasClickVerify",!1),this.fetch("https://graph.baidu.com/api/zyb/auth").then((function(e){!e||0!==e.errno&&1001!==e.errno||t.dispatch("chat:retry","")})))}})),oI={};oI= __call$(Object,"assign",[oI,{verify:"verify_t6kb2_1",verifyBtn:"verify-btn_t6kb2_5","verify-btn":"verify-btn_t6kb2_5",verifyBtnIcon:"verify-btn-icon_t6kb2_17","verify-btn-icon":"verify-btn-icon_t6kb2_17"}]) ,iI.template='\n    <div class="{{$style.verify}}">\n        <div\n            s-is="{{verifyUrl ? \'a\' : \'div\'}}"\n            href="{{verifyUrl}}"\n        >\n            <span class="{{$style[\'verify-btn\']}} cos-rounded-sm" on-click="goVerify">\n                <cos-icon\n                    name="social-security"\n                    class="{{$style[\'verify-btn-icon\']}}"\n                />\n                {{ btnText }}\n            </span>\n        </div>\n    </div>\n';var rI="function"==typeof iI?iI.prototype.initData||sI:iI.initData||sI;function sI(){return{$style:oI}}function lI(){return  __call$(Object,"assign",[{},rI.call(this),{$style:oI}]) }function cI(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function dI(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof iI?iI.prototype.initData=lI:iI.initData=lI;var uI="com.baidu.searchbox.chatsearch.aicall.notifyEvent."+Bn,pI="call_input";function hI(){var t;return t=function(t){var e,n,a,i,r,s;return dI(this,(function(l){return ht()?(e=function(t){var e,n,a=on.getState("phoneParams");return(null==a||null==(n=a.reqInfo)||null==(e=n.businessParams)?void 0:e.interactionInfo)&&(a.reqInfo.businessParams.interactionInfo.sa=t,a.reqInfo.businessParams.interactionInfo.re_rank=String(+on.getState("rank")),a.reqInfo.businessParams.interactionInfo.enterType=on.getState("enterType")),(null==a?void 0:a.reqInfo)&&(a.reqInfo.sessionId=on.getState("oriLid"),a.reqInfo.source=t===pI?"interactionInputBar":"interactionTab",a.reqInfo.headerParams={source:"wise_csaitab"}),a&&(a.logInfo={ext:{call_page_from:t===pI?1:2,figure_type:"3"},source:"3841000010001000"}),a}(t),n=e.ttsInfo,a=e.asrInfo,i=e.reqInfo,r=e.metaInfo,s=e.logInfo,o.canIUse("aiCall.open")&&o.aiCall.open({ttsInfo:n,asrInfo:a,reqInfo:i,metaInfo:r,logInfo:s,callbackAction:uI,success:function(t){na().emit(),function(t){if(o.canIUse("event.on")&&window){var e="aiTelCallBack"+ +new Date; __set$(window,e,function(e,n){t&&t(JSON.parse(n));}) ,o.event.on({action:uI,jscallback:e})}}(mI)},fail:function(t){}}),[2]):[2]}))},hI=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){cI(o,a,i,r,s,"next",t)}function s(t){cI(o,a,i,r,s,"throw",t)}r(void 0)}))},hI.apply(this,Array.from(arguments))}function fI(t){!function(t){ha().emit(!0),tc({data:{from:"chat_search",sge_lid:(on.getState("chatParams")||{}).sge_lid,token:sc(),pn:0,rn:t.turnCount+1,search_before_lid:on.getState("lid"),cur_ori_lid:t.sessionId,req_type:3,landingPageSwitch:on.getState("landingPageSwitch"),landingPage:lt()?"deepseek":"aitab"}},{appendRender:!0,isAiCall:!0},"behind")}(t),o.canIUse("event.off")&&o.event.off({action:uI})}function gI(t){var e,n={},a=null==t?void 0:t.costs;Object.keys(null!=a?a:{}).forEach((function(t){var e= __get$(a,t) ; __set$(n,t,"number"!=typeof e?Number(e):e) })),null==t||(null==(e=t.labels)||delete e.query),function(t,e){on.getState("isDev")||un.sendPerf({group:"aicall",info:t,dim:e})}(n,t.labels)}function mI(t){switch(t.type){case"close":fI(t.data);break;case"performanceInfo":gI(t.data)}}var vI=a.defineComponent({trimWhitespace:"all",initData:function(){return{}},computed:{realShowExt:function(){return JSON.stringify({type:"show",value:"ai_call_real",ori_lid:""+this.data.get("oriLid"),agent_id:""+this.data.get("agentInfo.agentSearchId"),agent_name:""+this.data.get("agentInfo.agentName"),figure_type:""+this.data.get("agentInfo.telParams.figureType")})}},attached:function(){this.handleAgentTelLog=Ki(this.handleAgentTelLog,1e3,{leading:!0,trailing:!1}),this.dispatch("send-ubclog",{type:"show",value:"ai_call",extra:{figure_type:""+this.data.get("agentInfo.telParams.figureType")}})},handleAgentTelLog:function(t){var e=this.data.get("type");(t||"ai-tel"===e)&&(this.dispatch("send-ubclog",{type:"click",value:"ai_call",extra:{figure_type:""+this.data.get("agentInfo.telParams.figureType")}}),"ai-tel"!==e?Pp(t):function(t){hI.apply(this,Array.from(arguments))}("call_prob"))}}),yI={};yI= __call$(Object,"assign",[yI,{agentTel:"agent-tel_82o66_1","agent-tel":"agent-tel_82o66_1",agentTelIcon:"agent-tel-icon_82o66_27","agent-tel-icon":"agent-tel-icon_82o66_27",agentTelText:"agent-tel-text_82o66_37","agent-tel-text":"agent-tel-text_82o66_37"}]) ,vI.template='\n    <div\n        class="{{$style[\'agent-tel\']}}"\n        data-show-ext="{{realShowExt}}"\n        need-show-log="true"\n        data-show-area\n        on-click="handleAgentTelLog(agentInfo.telUrl)"\n    >\n        <span class="{{$style[\'agent-tel-icon\']}}"></span>\n        <span class="{{$style[\'agent-tel-text\']}}">给我打电话</span>\n    </div>\n';var wI="function"==typeof vI?vI.prototype.initData||bI:vI.initData||bI;function bI(){return{$style:yI}}function _I(){return  __call$(Object,"assign",[{},wI.call(this),{$style:yI}]) }function kI(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function SI(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function xI(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){SI(o,a,i,r,s,"next",t)}function s(t){SI(o,a,i,r,s,"throw",t)}r(void 0)}))}}function II(){return II=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},II.apply(this,Array.from(arguments))}function TI(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return kI(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kI(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function CI(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof vI?vI.prototype.initData=_I:vI.initData=_I;var LI,DI,PI,EI={askBack:1,input:1,questionClosely:1},AI={yiyan:{userAbort:"好的，停下来了，有问题再问我。",other:"抱歉，出了点小问题，请稍后重试。",netError:"抱歉，似乎没接收到你的消息，检查下网络后再继续吧。"},deepseek:{userAbort:"抱歉，服务繁忙，请稍后再试。",other:"抱歉，服务繁忙，请稍后再试。",netError:"抱歉，服务繁忙，请稍后再试。"}},OI={PIC:"pic"};!function(t){t.STOP="stop",t.RETRY="retry"}(LI||(LI={})),function(t){t.REBUILD="rebuild",t.APPEND="append"}(DI||(DI={})),function(t){t.AGENT_TEL="agent-tel",t.AI_TEL="ai-tel",t.ADULT_CHECK="adult-check"}(PI||(PI={}));var RI,NI="interact:replace-click",MI=a.defineComponent({rebuildTimes:0,agentRankMax:{},currInteractData:null,components:{"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem,"wd-feedback-pop":rx,header:CS,"c-ai-container":zx,interact:rS,"wd-tts-player":Nk,"agent-tel":vI,"ai-tel":vI,"adult-check":iI,"dialog-pop":Xx,"pc-menu-bar":ex,"state-button":qx},messages:(RI={"UI:showToast":function(t){var n;e.Toast.show({message:null==t||null==(n=t.value)?void 0:n.content})},"chat:launch-search":function(t){this.launchSearch(t.value||{})},"ai-image-with-thumbnail:retry":function(){this.onReplace(!0)}}, __set$(RI,NI,function(t){var e=t.value;e.extra=__call$(Object,"assign",[{},e.extra||{},{morecreate_num:this.rebuildTimes+1}]),this.dispatch("send-log",e);}) ,RI["chat:retry"]=function(){this.data.set("attachBtnShow",!1),this.data.set("attachBtn",null),this.retry()},RI["image-query-tab:click"]=function(t){this.data.set("attachBtnShow",!1),this.data.set("attachBtn",null);var e=t.value,n=this.data.get("rank"),a=on.getState("imageQuery"); __get$(a,n) .rectIndex=e,on.dispatch("update",{imageQuery:II({},a)}),this.retry(),this.dispatch("image-query-tab:click-log",{ubcId:"17132",page:"resultpage",type:"click",value:"change_question_number",extra:{question_number:e}})},RI["writing:cancel-edit"]=function(){this.data.set("hideSwiperIndicator",!1),this.data.set("disbaleTouchAction",!1),this.data.set("hideFooter",!1),this.data.set("borderActiveIndex",-1)},RI["update-agent-info"]=function(t){var e=null==t?void 0:t.value;e&&this.updateAgentInfo(e)},RI["overview:send-perf"]=function(){var t=this;this.monitor&&this.nextTick((function(){var e=t.data.get("overviewBlockFirstTokenDur");t.monitor.setMonitorData("overviewBlockFirstTokenDur",e)}))},RI["pack-render-finished"]=function(t){this.data.set("completedPack",t.value),this.data.set("completedPackIndex",this.data.get("completedPackIndex")+1)},RI),computed:{isIosDakeMode:function(){return this.data.get("commonData").isIOS&&navigator.userAgent.toLowerCase().includes("theme/dark")},isAllowAction:function(){var t=this.data.get("currentIndex"),e=this.data.get("currentAnswerIndex"),n=this.data.get("answerList["+t+"]["+e+"].isLoading"),a=this.data.get("answerList["+t+"]["+e+"].stateBtnType");return!n||"retry"===a},themeColorStyle:function(){var t="#6e4bfa",e="#292080",n=["#FFFFF4","#FFFDFA"];return{"--theme-color":t,"--theme-color-light":t,"--theme-color-bg":t,"--theme-color-bg-light":t,"--theme-color-border":t+"99","--theme-logo":"url("+"https://gips3.baidu.com/it/u=3154978027,2545641559&fm=3028&app=3028&f=PNG&fmt=auto&q=97&size=f54_54"+")","--theme-logo-bg":"url("+"https://gips2.baidu.com/it/u=2546181581,921105335&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f540_540"+")","--theme-color-stroke":"#DCD7FB"+"33","--theme-color-mask":"linear-gradient(180deg, "+n[0]+"00 68.72%, "+n[1]+" 82.38%)","--theme-color-dark":e,"--theme-color-bg-light-dark":e+"0A","--theme-color-loading-dark":e+"1F","--theme-color-loading1-dark":e+"00"}},isSge:function(){var t=this.data.get("commonData").chatParams,e=void 0===t?{}:t;return e.chat_samples&&e.chat_samples.indexOf("sge_")>=0||e.setype&&"csaitab"!==e.setype},deleteParams:function(){var t=this.data.get("sessionId"),e=this.data.get("deleteQidList");return JSON.stringify({sessionId:t,deleteQidList:e})},abortText:function(){var t=on.getState("usedModel")||{},e=this.data.get("abortServerText");return II({}, __get$(AI,"DeepSeek-R1"===(null==t?void 0:t.modelName)?"deepseek":"yiyan") ,{server:e})}},initData:function(){var t,e,n=this;return{prefetchUrlList:[],fallbackAskData:[],commonData:{},graphCreationLog:{},answerList:[[{isLoading:!0,isStateBtnShow:!1,autoHeight:!1,stateBtnType:"stop",blocks:[]}]],titleData:{},imageInfo:{},getCopyTarget:function(t){var e,a=n.data.get("currentIndex"),i=void 0===t?n.data.get("currentAnswerIndex"):t,o=null==(e=n.ref("ai-container-"+a+"-"+i))?void 0:e.el;return null==o?void 0:o.querySelector(".marklang, .ai-entry")},currentIndex:0,currentAnswerIndex:0,hasSendToChatSearch:!1,hasHitNotice:!1,noticeText:"",hasSendGenerateStart:!1,hasSendGenerateComplete:!1,abortServerText:"",supText:"",tabName:"",mainHallTask:{},typingSpeed:30,isAnnotation:!1,isDataFlyWheel:!1,springStyle:"",generateKey:"",generateParams:{},cids:[[]],agentInfo:null,hasShowTtsAnimationAgent:[],showAgentTel:!1,isRebuild:!1,generateDataList:[],baseData:{},searchingStepsData:{},overviewBlockFirstTokenDur:0,latestRank:1,rank:1,rebuildMode:"rebuild",canAppendMore:!0,seperateInteract:{show:!1,interactData:{}},replaceClickEvent:NI,agentId:[],resultIntentionTypeMap:OI,resultIntentionType:"",dangerCheckTime:0,startTime:0,replaceLimitText:"达到上限了，让我们换个话题吧",layoutReverse:!1,isBless:!1,typingSwitch:!0,downloadEnable:!0,ttsTextList:[],longPressTtsText:"",isSidebarUpdate:!1,shareParams:"",sessionId:"",deleteQidList:[],swiperPosDisable:!1,showDialog:!1,hideSwiperIndicator:!1,disbaleTouchAction:!1,hideFooter:!1,borderActiveIndex:-1,conversationLogId:"",hasSendError:!1,isPc:!1,feedbackFormData:{},isShowPcInteract:!1,logExtData:{},logExtParams:{},sectionId:1,pushedPackIndex:0,cacheList:[],completedPackIndex:0,isRight:"1"===(null==(e=on.getState("sample"))||null==(t=e.variables)?void 0:t.AI_TAB_RIGHT),isExtension:vt(),askUsedModel:{},recommendWordList:[],isShowFeedback:!1}},created:function(){var t,e=on.getState("agentInfo");!this.data.get("agentInfo.agentName")&&!this.data.get("agentId").length&&e&&e.agentName&&(this.data.set("agentInfo",on.getState("agentInfo")),this.data.set("agentId",[null==(t=on.getState("agentInfo"))?void 0:t.agentSearchId]))},listenLongPressHandler:null,listenDialogClick:null,attached:function(){var t=this,e=this.data.get("currentIndex"),n=this.data.get("currentAnswerIndex"),a=this.data.get("answerList["+e+"]["+n+"].isLoading"),i=this.data.get("commonData.isIOS"),o=this.data.get("generateKey"),r="";if(o){var s= __get$(window.generateParamsMap||{},o) ||{};this.data.set("generateParams",s),delete window.generateParamsMap[o],r=s.text}this.data.set("supText",r),this.data.set("tabName",window.sgeSpringTab||""),this.data.set("isPc","pc"===rt()),this.data.set("isAndroid",Oi),this.sseInit(a),this.listenInit(),this.data.set("tti",+new Date),this.handleAgentTelLog=Ki(this.handleAgentTelLog,1e3,{leading:!0,trailing:!1}),this.listenDialogClick=function(e){void 0===e&&(e={});var n=e.cid,a=e.status,i=t.data.get("currentIndex")||0,o=t.data.get("currentAnswerIndex")||0;n===t.data.get("cids["+i+"]["+o+"]")&&"ok"===a&&(t.data.set("hideSwiperIndicator",!1),t.data.set("disbaleTouchAction",!1),t.data.set("hideFooter",!1),t.data.set("borderActiveIndex",-1))},this.data.set("downloadEnable",!(i&&di(ci(),"13.56")<0)),this.listenLongPressHandler=US(this,"generate"),Hn().conversation.dialogClick.on(this.listenDialogClick),this.watch("commonData.defaultInteractData.isShowReplace",(function(n){for(var a=t.data.get("answerList["+e+"]"),i=0;i<(null==a?void 0:a.length);i++)t.data.set("answerList["+e+"]["+i+"].interactData.data.isShowReplace",n)})),this.canAllowTouchMove=Ki(this.canAllowTouchMove,500,{leading:!0,trailing:!1})},listenBeforeLaunchConversation:null,listenImageQuerySelectedChange:null,listenUserAbort:null,listenHideAiCallHistory:null,listenBubAsyncClick:null,listenDangerCheckTime:null,listenMenuHasDelete:null,listenInit:function(){var t=this;this.listenBeforeLaunchConversation=function(){t.dispatch("dqa-steps-finished",!0),t.stopGenerate(!1,"userAbort"),t.hideAiCallBtn()},Jn().on(this.listenBeforeLaunchConversation),this.listenImageQuerySelectedChange=function(e){var n=e.rank,a=e.rectIndex,i=e.rectList,o=e.imageInfo;if(n===t.data.get("rank")){var r=on.getState("imageQuery"); __get$(r,n) .rectIndex=a, __get$(r,n) .rectList=i, __get$(r,n) .imageInfo=o,on.dispatch("update",{imageQuery:II({},r)}),t.retry()}},Vn().on(this.listenImageQuerySelectedChange),this.listenUserAbort=function(){t.stopGenerate(!1,"userAbort")},Xn().on(this.listenUserAbort),na().on(this.listenUserAbort),this.listenHideAiCallHistory=function(){t.hideAiCallBtn()},ea().on(this.listenHideAiCallHistory),this.listenDangerCheckTime=function(e){t.monitor&&t.monitor.setMonitorData("dangerCheckTime",e)},this.watch("dangerCheckTime",this.listenDangerCheckTime),this.listenBubAsyncClick=function(e){e.rank===t.data.get("rank")&&t.handleBubAsyncClick(e)},Hn().conversation.asyncBubClick.on(this.listenBubAsyncClick)},onEditClick:function(t,n){var a,i;if(this.data.get("answerList["+t+"]["+n+"]").isWritingScene){if(Hy())return;return this.data.set("borderActiveIndex",n),this.data.set("hideSwiperIndicator",!0),this.data.set("disbaleTouchAction",!0),void this.data.set("hideFooter",!0)}var o=this.ref("ai-container-"+t+"-"+n),r=null==o||null==(a=o.data)?void 0:a.get("entryRef"),s=null==o?void 0:o.ref(r),l=(null==s||null==(i=s.data)?void 0:i.get("accBlocks"))||[],c=l.findIndex((function(t){return"ai-markdown"===t.component})),d=l.findIndex((function(t){return"ai-office-writing"===t.component})),u="";if(c>-1){var p,h=null==s?void 0:s.ref("ai-markdown"+c);u=(null==h||null==(p=h.data)?void 0:p.get("bindData.content"))||""}else if(d>-1){var f,g=null==s?void 0:s.ref("ai-office-writing"+d);u=(null==g||null==(f=g.data)?void 0:f.get("markdownValue"))||""}if(u=Fy(u)){if(Hy()){var m,v,y=null==(v=event)||null==(m=v.target)?void 0:m.closest('[data-module^="edit"]'),w=null==y?void 0:y.getAttribute("data-cid");w&&$y({title:"",content:u,lid:w})}}else e.Toast.show({message:"正文内容为空，暂不支持编辑"})},handleBubAsyncClick:function(t){var n=this,a=t||{},i=a.asyncApi,o=a.url,r=this.data.get("currentIndex"),s=this.data.get("answerList["+r+"]"),l=[];e.Toast.show({message:"正在上墙",type:"refresh",animationDuration:1e3,duration:8e3}),s.forEach((function(t,e){l.push(n.ref("ai-container-"+r+"-"+e).handleComponentAll())}));var c=!1;Promise.all(l).then((function(t){var n=t&&t.reduce((function(t,e){return t.concat(e)}),[])[0]||{},a=new URLSearchParams;Object.keys(n).forEach((function(t){a.append(t,JSON.stringify( __get$(n,t) ))})),i&&fetch(i,{method:"post",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then((function(t){return t.json()})).then((function(t){if(e.Toast.hide(),c=0===(null==t?void 0:t.errno),0!==(null==t?void 0:t.errno))throw new Error})).catch((function(){e.Toast.show({message:"上墙失败"})})).finally((function(){o&&c&&Rp(c?o+"&isShare="+c:o)}))}))},aiContainerWaiting:function(){var t=this.data.get("currentIndex"),e=this.data.get("currentAnswerIndex");this.data.set("answerList["+t+"]["+e+"].isFinished",!1),this.ref("ai-container-"+t+"-"+e).startWaiting()},aiContainerGenerating:function(){var t,e=this.data.get("currentIndex"),n=this.data.get("currentAnswerIndex");null==(t=this.ref("ai-container-"+e+"-"+n))||t.startGenerating()},aiContainerPushBlock:function(t){var e,n,a,i=this.data.get("currentIndex"),o=this.data.get("currentAnswerIndex");(null==t||null==(n=t.generator)||null==(e=n.data)?void 0:e.bgProps)&&this.data.set("answerList["+i+"]["+o+"].bgProps",t.generator.data.bgProps),null==(a=this.ref("ai-container-"+i+"-"+o))||a.pushBlock(t),this.data.set("pushedPackIndex",this.data.get("pushedPackIndex")+1),this.data.set("pushedPack",t)},aiContainerStop:function(t,e){var n,a=this.data.get("currentIndex"),i=this.data.get("currentAnswerIndex");ga().emit({isShowButton:!1}),ac(),null==(n=this.ref("ai-container-"+a+"-"+i))||n.stop(t,e)},aiContainerClear:function(){var t=this.data.get("currentIndex"),e=this.data.get("currentAnswerIndex");if(this.data.get("isSeparateBub")){for(var n=0;n<this.data.get("answerList["+t+"].length");n++){var a;null==(a=this.ref("ai-container-"+t+"-"+n))||a.clear()}this.data.set("answerList["+t+"]",[]),this.data.set("currentAnswerIndex",0),this.data.set("isSeparateBub",!1)}else{var i;null==(i=this.ref("ai-container-"+t+"-"+e))||i.clear()}},handleMonitor:function(){var t=this.data.get("baseData"),e=t.query,n=t.lid,a=this.data.get("rank"),i=this.data.get("oriLid"),o=this.data.get("commonData.tplInfo"),r=this.data.get("currentIndex"),s=this.data.get("currentAnswerIndex"),l=this.data.get("answerList["+r+"]["+s+"].isGenerate"),c=this.data.get("typingSpeed"),d=this.data.get("commonData.chatParams")||{},u={ori_lid:i,rank:a,lid:n,query:e,isGenerate:l,typingSpeed:c,aiContainerEl:this.ref("ai-container-"+r+"-"+s)&&this.ref("ai-container-"+r+"-"+s).el&&this.ref("ai-container-"+r+"-"+s).el.querySelector(".marklang, .ai-entry")};this.monitor=new Nx({params:u,platform:"wise",card:o.tplname,dim:{setype:d.setype}}),this.monitor.setMonitorData("tti",this.data.get("tti"))},onEmpty:function(t){this.data.set("ttsText",t.ttsText||""),this.monitor.setMonitorData("aiContainerEmpty",1)},onRenderFinished:function(t){var e,n=this,a=this.data.get("commonData"),i=t.ttsText,o=t.answerIndex,r=t.type,s=localStorage.getItem("hasShowTtsAnimationAgent")&&JSON.parse(localStorage.getItem("hasShowTtsAnimationAgent")||"")||[],l=this.data.get("agentInfo"),c=null==l?void 0:l.agentId,d=this.data.get("currentIndex"),u=this.data.get("currentAnswerIndex"),p=ti.getState("knowledgeId"),h=this.data.get("sessionId");if(1===this.data.get("rank")&&(p?setTimeout((function(){Ha().emit({updateType:"chat",knowledgeId:p})}),2500):Ha().emit({updateType:"his-chat",sessionId:h})),s.includes(c)?this.data.set("isNeedTtsAnimation",!1):i&&2===a.chatSearch&&c&&(null==l?void 0:l.speechId)&&(this.data.set("isNeedTtsAnimation",!0),s.push(c),localStorage.setItem("hasShowTtsAnimationAgent",JSON.stringify(s))),this.data.set("ttsText",i),this.data.set("answerList["+d+"]["+o+"].isFinished",!0),this.data.set("ttsTextList["+d+"]["+o+"]",i),"separate-bub"!==r){var f=this.data.get("isPc");if((null==l?void 0:l.isUpperBox)&&!f){var g="@"+l.agentName;l.startIndex=0,l.endIndex=g.length-1,zn().emit(II({word:g,agentInfo:qs(l),invokeKeyboard:0},Ri&&di(ci(),"13.55")<0?{forceUpperBox:!0}:{}))}this.monitor.setMonitorData("finishedTime",+new Date),this.monitor&&this.monitor.stopListen(),this.data.get("answerList["+d+"]["+u+"].sseStatus")===_g.COMPLETE&&this.completeHandle();var m=this.data.get("generateAnswer");kf.triggerEvent("onTypingFinished",{round_index:this.data.get("rank"),isHistory:this.data.get("isHistory"),data:{functional:{},messages:m&&(null==(e= __get$(m,d) )?void 0:e.data)||[]},api:{sendUbcLog:function(t){n.dispatch("send-ubclog",t)}}}),this.dispatch("show-capsule"),this.dispatch("send-ubclog",{type:"show",value:"ai_chat_over",extra:{is_rebuild:this.data.get("isRebuild")?"1":"0"}}),this.sendStatusToClient("generateComplete")}},launchSearch:function(t){var n,a=t.word,i=t.event,o=t.sa,r=t.extra;if(a&&i){var s=this.data.get("commonData.chatParams")||{},l=this.data.get("baseData"),c={};r&&r.text&&(c={style:this.data.get("springStyle"),content:r.text,author:r.author,receiver:r.receiver,acrosticText:r.acrosticText,req_type:r.req_type||"1",actionLid:l.lid,template:r.template}),Xl({query:a,extParams:{word:a,sa:o+"_"+this.data.get("commonData.tplInfo").srcid,setype:s.setype||"sge",actiontype:r&&r.actionType?r.actionType:"",agent_id:(null==(n=this.data.get("agentId"))?void 0:n[0])||"",agent_p:JSON.stringify(c),aitab_ct:r.aitab_ct||""}}).catch((function(t){if(!t||"string"!=typeof t)throw t;e.Toast.show({message:t})}))}},sseInit:function(){var t=this;this.sseDataCopy=new Mx(this.el,e.Toast),this.addAnswer(!0),this.nextTick((function(){t.handleMonitor(),t.getAnswer()}))},appendAnswer:function(){var t=this.data.get().currentIndex;this.data.push("answerList["+t+"]",{isLoading:!0,isStateBtnShow:!0,interactData:{},suggestionData:{data:{}},referenceList:[],sseStatus:void 0,stateBtnType:"stop",isGenerate:!0,generator:{},suggestion:{},antiFlag:!1,isFinished:!1,isHint:!1,isComplete:!1,hideInteract:!1});var e=this.data.get("answerList");this.data.set("currentAnswerIndex", __get$(e,t) .length-1)},addAnswer:function(t){void 0===t&&(t=!1),t&&this.data.set("answerList",[]),!t&&this.dispatch("add-answer"),this.data.push("answerList",[{isLoading:!0,isStateBtnShow:!0,autoHeight:!1,interactData:{},suggestionData:{data:{}},referenceList:[],sseStatus:void 0,stateBtnType:"stop",isGenerate:!0,generator:{},suggestion:{},antiFlag:!1,isFinished:!1,isHint:!1,isComplete:!1}]),!t&&this.data.push("cids",[]);var e=this.data.get("answerList");this.data.set("currentIndex",e.length-1),this.data.set("currentAnswerIndex",0), __call$(this.data,"assign",[{sectionId:1,cacheList:[],pushedPackIndex:0,pushedPack:void 0,completedPackIndex:0,completedPack:void 0,lastCompletedPackIndex:0,isSeparateBub:!1}]) },handleMessageData:function(t){var e,n,a,i,o,r,s,l,c,d=this,u=this.data.get("currentIndex"),p=this.data.get("currentAnswerIndex"),h=this.data.get("answerList["+u+"]["+p+"].sseStatus"),f="pc"===rt();if(h!==_g.ABORT){var g=t.content,m=void 0===g?{}:g,v=t.options,y=void 0===v?{}:v,w=t.type,b=void 0===w?"":w,_=t.functional,k=void 0===_?{}:_;if("baseData"!==b){var S,x,I=this.data.get("shareParams");if(m.shareId&&!I&&this.data.set("shareParams",JSON.stringify({shareId:m.shareId})),null==m||null==(n=m.generator)||null==(e=n.data)?void 0:e.typing)this.data.set("typingSwitch","0"!==(null==m||null==(x=m.generator)||null==(S=x.data)?void 0:S.typing));if(null==k?void 0:k.feedback)this.data.set("feedbackFormData",null==k?void 0:k.feedback);else{if(kf.triggerEvent("onMessage",{round_index:this.data.get("rank"),isHistory:this.data.get("isHistory"),agentInfo:{agentId:null==(a=this.data.get("agentInfo"))?void 0:a.agentId,agentSearchId:null==(i=this.data.get("agentInfo"))?void 0:i.agentSearchId,agentName:null==(o=this.data.get("agentInfo"))?void 0:o.agentName},data:m,api:{sendUbcLog:function(t){d.dispatch("send-ubclog",t)}}}),y.speedInfo&&(null==(r=y.speedInfo)?void 0:r.labels)&&(null==(s=y.speedInfo)?void 0:s.costs)){var T=t.options.speedInfo||{};this.dispatch("update-perf-info",{dim:T.labels}),this.monitor.setMonitorData("serverSpeed",T)}if(y.endTurn)f&&Xs().emit({type:Cf.SSE_STOP}),this.onCompleteProcess(t,_g.COMPLETE),this.sseDataCopy.addSseData(t,_g.COMPLETE);else if(b&&"generator"!==b)this.onAbortProcess(t,_g.ABORT),this.sseDataCopy.addSseData(t,_g.ABORT);else{var C,L;if(this.onGeneratingProcess(t,_g.GENERATING),!this.monitor.monitorInfo.generatingStartTime){var D=+new Date;this.monitor.setMonitorData("generatingStartTime",D),this.dispatch("generate-start",{generatingStartTime:D}),this.data.set("startGenerateTime",D),Ua({type:"click",value:"answer_card",ext:{re_rank:String(this.data.get("rank")),a_lid:this.data.get("baseData.apagelid"),lid:this.data.get("baseData.lid"),ori_lid:this.data.get("oriLid"),setype:"csaitab"}})}this.monitor.setModelName(null==(L=t.content)||null==(C=L.generator)?void 0:C.component),this.sseDataCopy.addSseData(t,_g.GENERATING)}(null==m||null==(l=m.generator)?void 0:l.hideAlaCard)&&(this.dispatch("hide-ala-card"),this.data.set("commonData.isAlaHat",!1)),(null==m||null==(c=m.generator)?void 0:c.isFinished)&&this.handleContentFinished()}}}},dataCacheHandler:function(t){var e=this;if(!this.dataCache){this.dataCache=[];var n=this.data.get("currentIndex"),a=this.data.get("currentAnswerIndex");this.watch("answerList["+n+"]["+a+"].isComplete",(function(t){var n;t&&(null==(n=e.dataCache)||n.forEach((function(t){e.handleMessageData(t)})),e.dataCache=void 0)}))}this.dataCache.push(t)},deleteParamsCollect:function(t){if(t.qid&&t.sessionId){var e=this.data.get("sessionId"),n=this.data.get("deleteQidList");e||this.data.set("sessionId",t.sessionId),n.includes(t.qid)||this.data.push("deleteQidList",t.qid)}},getAnswer:function(){var t,e,n=this;this.aiContainerWaiting();var a=this.data.get("currentIndex"),i=this.data.get("generateAnswer");i&&(null==(e= __get$(i,a) )||null==(t=e.data)||t.forEach((function(t){n.handleMessageData(t)}))),this.watchAnswer()},watchAnswer:function(){var t=this;this.watch("generateAnswer",(function(e,n){var a=n.oldValue,i=n.newValue,o=t.data.get("currentIndex"),r= __get$(i,o) ,s= __get$(a,o) ||{data:[]};if(r.data&&s.data&&r.data.length>s.data.length){var l=r.data.slice(s.data.length);t.nextTick((function(){for(var e,n=TI(l);!(e=n()).done;){var a=e.value;t.handleMessageData(a)}}))}var c= __get$(e,o) .perfData;if(c){var d,u=+new Date,p=t.data.get("startTime")||0,h=(null==c||null==(d=c.packageIntervalList)?void 0:d.length)?c.packageIntervalList[0].time-c.openToFirstPackage-c.fetchToOpen:0,f=(null==c?void 0:c.totalPackagesNum)||0,g=(null==c?void 0:c.lostPackages)||0;t.monitor.setMonitorData({fetchEndTime:u,startTime:p,sseRequestStart:h,lostPackages:g,allPackageCount:f})}}))},setSseStatus:function(t){this.dispatch("update-chat-status",t);var e=this.data.get("currentIndex"),n=this.data.get("currentAnswerIndex");this.data.set("answerList["+e+"]["+n+"].sseStatus",t)},onOpenProcess:function(t,e){this.setSseStatus(e)},onWaitingProcess:function(t,e){this.setSseStatus(e),this.aiContainerWaiting()},onGeneratingProcess:function(t,e){var n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b;this.setSseStatus(e);var _=t.content,k=t.options,S=void 0===k?{}:k,x=this.data.get("currentIndex")||0,I=this.data.get("currentAnswerIndex")||0,T=this.data.get("oriLid");this.data.set("cids["+x+"]["+I+"]",S.qid),this.data.set("commonData.editorParams.extLogParams.cid",S.qid);var C,L=null==(i=t.content)||null==(a=i.agentInfo)||null==(n=a.agentMeta)?void 0:n[0];(L&&(this.data.set("agentInfo",L),L.telUrl&&L.agentId&&this.data.set("attachBtn",{type:"agent-tel",agentInfo:L,oriLid:T})),L)&&(Ks(null==(C=this.data.get("baseData"))?void 0:C.query,L),this.data.set("isSidebarUpdate",!0));this.deleteParamsCollect(S);var D,P,E,A,O,R=null==(r=t.content)||null==(o=r.generator)?void 0:o.attachBtn;(R&&this.data.set("attachBtn",R),"operate-capsule"===(null==(l=t.content)||null==(s=l.generator)?void 0:s.component))&&(null==(O=Hn())||null==(A=O.conversation)||null==(E=A.operateCapsulesDataInterflow)||E.emit(null==(P=t.content)||null==(D=P.generator)?void 0:D.data));"writing"===(null==(d=t.content)||null==(c=d.generator)?void 0:c.component)&&this.data.set("answerList["+x+"]["+I+"].isWritingScene",!0);var N=null==(p=t.content)||null==(u=p.generator)?void 0:u.authorityInfo;N&&N.title&&this.data.set("authorityInfo",N),this.dispatch("cid-update",{cid:S.qid||"",index:x,answerIndex:I});var M=_.generator,q=void 0===M?{}:M;this.sendStatusToClient("generateStart"),(null==_||null==(h=_.agentInfo)?void 0:h.agent_id)&&this.data.set("agentId",_.agentInfo.agent_id),(null==q?void 0:q.rebuildMode)&&this.data.set("rebuildMode",q.rebuildMode),(null==q?void 0:q.resultIntentionType)&&this.data.set("resultIntentionType",q.resultIntentionType),"text"===(null==q||null==(f=q.logExt)?void 0:f.scene)&&(q.data&&(q.data.logExtData=II({},q.logExt)),this.data.set("commonData.isComposition",!0));var j=null==_||null==(g=_.agentInfo)?void 0:g.log_ext;if(j&&"text_short"===j.scene_1st&&"text_bless"===j.scene_2nd&&(this.data.set("isBless",!0),this.data.set("layoutReverse",!0),this.dispatch("update-log-ext",II({},j)),ut()&&this.data.set("commonData.isComposition",!0)),0!==Object.keys(q).length){var B=(null==q?void 0:q.logExt)||{};this.logDataUpdate(B),this.data.set("logExtParams",B)}if((null==q?void 0:q.isRebuildEnd)&&this.data.set("canAppendMore",!1),(null==q||null==(m=q.data)?void 0:m.value)&&(this.monitor&&this.monitor.initListener(),this.monitor.setMonitorData({lastPack:q.data.value})), __get$(EI,q.component) &&this.data.set("answerList["+x+"]["+I+"].existAskback",!0),"dict3S"===(null==q||null==(v=q.notice)?void 0:v.noticeStyleType)){this.data.set("hasHitNotice",!0),this.data.set("noticeText",q.notice.noticeText||"内容涉及违规不做进一步回答，您可以向我问一些其他的问题，我会尽力帮您解决的。"),this.dispatch("send-ubclog",{type:"show",value:"cont_wrong",extra:{wrong_type:"命中风控"}})}"1"===(null==q||null==(y=q.data)?void 0:y.style)&&(this.data.set("commonData.editorParams.style","1"),this.data.set("springStyle","1"),q.data.textStyle="1");var H=q.queryIntent;if(7!==H&&24!==H||lt()||(null==q?void 0:q.isMcp)||(Hy()&&this.data.set("commonData.defaultInteractData.isShowEdit",!0),this.data.set("commonData.defaultInteractData.isShowtotalWord",!0)),this.addBottomArea(_,x,I),(null==(w=q.interactiveArea)?void 0:w.isHideInteractiveArea)&&(!q.sectionId||q.sectionId<2)&&this.data.set("answerList["+x+"]["+I+"].hideInteract",!0),(null==(b=q.data)?void 0:b.isHideStateBtn)&&(!q.sectionId||q.sectionId<2)&&this.data.set("answerList["+x+"]["+I+"].isStateBtnShow",!1),this.handleChatSearchGeneratingProcess(S,_,x),q.needClearHistory){var $=this.data.get("rank");this.data.set("clearHistoryMode",!0),Gn().emit({rank:$,type:"delete-rank-show-toast"})}},sendStatusToClient:function(t){return xI((function(){var e,n,a,i,o,r;return CI(this,(function(s){switch(s.label){case 0:return e=this.data.get("hasSendGenerateStart"),n=this.data.get("hasSendGenerateComplete"),a=this.data.get("hasSendError"),"generateStart"===t&&e||"generateComplete"===t&&(!e||n||a)?[2]:(i={query:this.data.get("baseData.query"),lid:this.data.get("baseData.lid"),conversationLogId:this.data.get("conversationLogId"),perfInfo:{fe_stage:{},fe_ext:{}},chatNum:this.data.get("rank"),widgetGuide:0},"generateStart"===t?(i.perfInfo.generating_start_time=""+Date.now(),this.data.set("hasSendGenerateStart",!0)):(i.perfInfo.generating_complete_time=""+Date.now(),this.data.set("hasSendGenerateComplete",!0)),"generateComplete"!==t?[3,2]:[4,lg()]);case 1:o=s.sent(),r=this.data.get("rank"),o&&1===r&&(i.widgetGuide=1),s.label=2;case 2:return  __get$(Hn().conversation,t) .emit(i),[2]}}))})).apply(this)},sendErrorToClient:function(t,e){var n;if(void 0===e&&(e=""),"userAbort"!==t){this.data.set("hasSendError",!0);var a="error"===t?1:5;null==(n=Hn().conversation.errorOccur)||n.emit({query:this.data.get("baseData.query"),lid:this.data.get("baseData.lid"),conversationLogId:this.data.get("conversationLogId"),perfInfo:{fe_error_code:a,error_info:e,fe_stage:{},fe_ext:{}},chatNum:this.data.get("rank")})}},logDataUpdate:function(t){t&&this.dispatch("update-log-ext",II({},t))},handleChatSearchGeneratingProcess:function(t,e,n){this.aiContainerGenerating(),this.data.push("cacheList",e);var a=e.suggestion,i=e.generator,o=void 0===i?{}:i,r=e.hints,s=void 0===r?{}:r;if(s.parts&&Array.isArray(s.parts)&&s.parts.length>0){var l=this.data.get("currentIndex"),c=this.data.get("currentAnswerIndex"),d=this.data.get("abortText");if(this.data.set("answerList["+l+"]["+c+"].isHint",!0),this.data.set("abortServerText",s.parts[0].text||d.other),this.dispatch("send-ubclog",{type:"show",value:"cont_wrong",extra:{wrong_type:"命中风控"}}),"kunlunHint"===s.parts[0].type&&this.data.get("isPc"))return Hl(this.data.get("baseData").query);nl().emit({curBlock:o,hints:s,rank:this.data.get("rank")})}if(o.data&&(o.data.cid=t.qid),"imageWithThumbnail"===o.component&&o.data){o.data.showRetry=!0;var u=this.data.get("commonData.tplInfo"),p=u.lid,h=u.srcid,f=u.tplname,g=u.order;o.data.source="",o.data.logExt={lid:p,srcid:h,tplname:f,order:g,sa:"re_bless_share"},o.data.downloadEnable=this.data.get("downloadEnable"),this.data.set("layoutReverse",!1),this.data.set("commonData.defaultInteractData.isShowReplace",!1)}"markdownEditor"===o.component&&o.data&&(o.data.noChangeNeedCheckRisk=!0,o.data.hasBorderLayer=!0);var m=this.data.get("latestRank"),v=this.data.get("rank");if( __get$(EI,o.component) )m===v&&this.aiContainerPushBlock(e);else if(0!==Object.keys(o).length&&!a){var y,w=e.generator.sectionId;(null==e||null==(y=e.generator)?void 0:y.sectionId)||this.data.get("isSeparateBub")?w&&w===this.data.get("sectionId")&&this.data.get("pushedPackIndex")===this.data.get("cacheList.length")-1?this.aiContainerPushBlock(e):w&&this.separateBubble(e,n):this.aiContainerPushBlock(e)}},separateBubble:function(t,e){var n,a,i=this,o=t.generator.sectionId;this.data.set("isSeparateBub",!0);var r=this.data.get(),s=r.completedPackIndex,l=r.pushedPackIndex,c=r.cacheList;s>=l&&o!==(null==(a= __get$(c,s-1) )||null==(n=a.generator)?void 0:n.sectionId)&&!this.data.get("inSeperating")&&this.setSeperateBubAndAddAnswer(e,t,o),!this.data.get("startWatchIndex")&&this.watch("completedPackIndex",(function(t){var e,n,a,o;if(i.data.set("startWatchIndex",!0),i.data.get("completedPack.isFinished")&&i.setSseStatus(_g.COMPLETE),!(i.data.get("lastCompletedPackIndex")>=t)){i.data.set("lastCompletedPackIndex",t);var r=i.data.get("cacheList"),s=null==(n= __get$(r,t-1) )||null==(e=n.generator)?void 0:e.sectionId,l=null==(o= __get$(r,t) )||null==(a=o.generator)?void 0:a.sectionId;s+1===l?i.setSeperateBubAndAddAnswer(i.data.get("currentIndex"), __get$(r,t) ,l): __get$(r,t) &&i.data.get("pushedPackIndex")<=t&&(s===l||!l)&&(i.addBottomArea( __get$(r,t) ,i.data.get("currentIndex"),i.data.get("currentAnswerIndex")),i.aiContainerPushBlock( __get$(r,t) ))}}))},setSeperateBubAndAddAnswer:function(t,e,n){var a,i=this;this.data.set("sectionId",n),this.data.set("inSeperating",!0);var o=this.data.get("currentAnswerIndex");if(this.data.merge("answerList["+t+"]["+o+"]",{isLoading:!1,isStateBtnShow:!1}),this.aiContainerStop("separate-bub",""),this.data.set("answerList["+t+"]["+o+"].isFinished",!0),this.setSseStatus(_g.COMPLETE),this.appendAnswer(),"writing"===(null==e||null==(a=e.generator)?void 0:a.component)){var r=this.data.get("currentAnswerIndex");this.data.set("answerList["+t+"]["+r+"].isWritingScene",!0)}this.nextTick((function(){var n,a,o,r;i.aiContainerGenerating(),i.addBottomArea(e,t,i.data.get("currentAnswerIndex")),i.aiContainerPushBlock(e),(null==(a=e.generator)||null==(n=a.interactiveArea)?void 0:n.isHideInteractiveArea)&&i.data.set("answerList["+i.data.get("currentIndex")+"]["+i.data.get("currentAnswerIndex")+"].hideInteract",!0),(null==(r=e.generator)||null==(o=r.data)?void 0:o.isHideStateBtn)&&i.data.set("answerList["+i.data.get("currentIndex")+"]["+i.data.get("currentAnswerIndex")+"].isStateBtnShow",!1),i.data.set("inSeperating",!1)}))},addBottomArea:function(t,e,n){t.suggestion;var a=t.generator,i=void 0===a?{}:a,o=t.alaCards,r=void 0===o?{}:o;if("reference"===i.component){var s,l=null==(s=i.data)?void 0:s.referenceList;l&&this.data.set("answerList["+e+"]["+n+"].referenceList",l)}if(i.interactiveArea||r.interactiveArea){var c,d=i.interactiveArea||r.interactiveArea,u=this.data.get("rank");d.dislikeOptions.text||d.dislikeOptions.alaCards;var p=this.currInteractData||this.data.get("commonData.defaultInteractData"),h={data:II({},p,{praise:II({},p.praise,{feLikeKey:d.feLikeKey,feDislikeKey:d.feDislikeKey,feLikeType:d.feLikeType,feedbackId:"ai_index_"+u,disable:d.likeDisable||(null==(c=p.praise)?void 0:c.disable)})})};this.data.get("answerList["+e+"]["+n+"]").isWritingScene&&!lt()&&(Hy()&&(h.data.isShowEdit=!0),h.data.isShowtotalWord=!0),this.data.set("answerList["+e+"]["+n+"].interactData",h),this.currInteractData=h.data,this.data.set("interactiveArea",d)}},onCompleteProcess:function(t,e){var n,a=this.data.get("currentIndex"),i=this.data.get("currentAnswerIndex"),o=this.data.get("answerList["+a+"]["+i+"].sseStatus");this.data.get("isSidebarUpdate")||Ks(null==(n=this.data.get("baseData"))?void 0:n.query);o!==_g.ABORT&&(this.setSseStatus(e),this.data.get("answerList["+a+"]["+i+"].isFinished")&&this.completeHandle())},completeHandle:function(){var t,e,n=this,a=this.data.get("currentIndex"),i=this.data.get("currentAnswerIndex"),o=this.data.get("startGenerateTime"),r=this.data.get("answerList["+a+"]["+i+"].sseStatus"),s=this.ref("ai-container-"+a+"-"+i);(r!==_g.ABORT&&this.nextTick((function(){n.sseEnd()})),this.monitor.sendPerf(),!this.data.get("hasSendEnd")&&+o&&Ua({ubcId:"17630",type:"click",value:"content_create_end",ext:{re_rank:String(this.data.get("rank")),a_lid:this.data.get("baseData.apagelid"),lid:this.data.get("baseData.lid"),ori_lid:this.data.get("oriLid"),setype:"csaitab",starttime:String(o),endtime:String(Date.now()),duration:String(Date.now()-o),height:String(Math.floor((null==s||null==(t=s.el)?void 0:t.getBoundingClientRect().height)||0))}}),this.data.get("hasSendEnd"))||this.data.get("feedbackFormData").title&&ua().emit({feedbackFormData:this.data.get("feedbackFormData"),rank:this.data.get("rank"),askModel:(null==(e=this.data.get("askUsedModel"))?void 0:e.modelName)||""});hr(),pr(),this.data.set("hasSendEnd",!0)},sendFinishedToMain:function(){return xI((function(){var t,e,n,a,i;return CI(this,(function(o){return t=this,n=this.data.get("rank"),a=this.data.get("currentIndex"),i=this.data.get("generateAnswer"),Fn().emit({rank:n,generateEle:this.el,isHistory:this.data.get("isHistory"),data:{functional:{},messages:i&&(null==(e= __get$(i,a) )?void 0:e.data)||[]},api:{sendUbcLog:function(e){t.dispatch("send-ubclog",e)}}}),[2]}))})).apply(this)},onAbortProcess:function(t,e,n){var a,i,o,r,s,l=t.type,c=t.error,d=void 0===c?{}:c;t.errorStr={msg:null==(a=d.message)?void 0:a.toString(),stack:null==(i=d.stack)?void 0:i.toString()},null==(r=this.chatSearch)||null==(o=r.getEventBusInstance().conversation.abortProcess)||o.emit(),this.stopGenerate(!1,l),this.sendErrorToClient(l,null==(s=d.message)?void 0:s.toString())},stopGenerate:function(t,e){var n,a=this;void 0===e&&(e="");var i=this.data.get("currentIndex"),o=this.data.get("currentAnswerIndex"),r=this.data.get("abortText"),s=this.data.get("startGenerateTime"),l=this.data.get("answerList["+i+"]["+o+"].isHint"),c=this.data.get("answerList["+i+"]["+o+"].sseStatus"),d=this.data.get("answerList["+i+"]["+o+"].isComplete"),u=this.ref("ai-container-"+i+"-"+o),p=null==u?void 0:u.ref("searchingStep");if(c!==_g.ABORT&&!d){if(Xs().emit({type:Cf.SSE_STOP}),p&&ra().emit((null==p||null==(n=p.el)?void 0:n.offsetHeight)||0),this.data.set("answerList["+i+"]["+o+"].sseStatus",_g.ABORT),this.data.set("answerList["+i+"]["+o+"].stateBtnType","retry"),this.data.get("isPc")||this.addDefaultInteract(),this.dispatch("update-chat-status",Pi.ABORT), __call$(this.data,"assign",[{sectionId:1,cacheList:[],pushedPackIndex:0,pushedPack:void 0,completedPackIndex:0,completedPack:void 0,lastCompletedPackIndex:0,isSeparateBub:!1}]) ,"error"===e)return this.aiContainerStop("other",r.netError),this.monitor.setMonitorData("netError",1),void this.dispatch("send-ubclog",{type:"show",value:"cont_wrong",extra:{wrong_type:"网络异常"}});var h,f,g;if("userAbort"===e&&!l)return this.aiContainerStop("user-abort",r.userAbort),!this.data.get("hasSendEnd")&&+s&&Ua({ubcId:"17630",type:"click",value:"content_create_stop",ext:{re_rank:String(this.data.get("rank")),a_lid:this.data.get("baseData.apagelid"),lid:this.data.get("baseData.lid"),ori_lid:this.data.get("oriLid"),setype:"csaitab",starttime:String(s),endtime:String(Date.now()),duration:String(Date.now()-s),height:String(Math.floor((null==u||null==(h=u.el)?void 0:h.getBoundingClientRect().height)||0))}}),this.data.set("hasSendEnd",!0),this.cancelLastGeneration(),pr(),void(null==(g=Hn().conversation.stopConversation)||g.emit({agentId:null==(f=this.data.get("agentInfo"))?void 0:f.agentId,sessionId:this.data.get("sessionId"),lid:this.data.get("baseData.lid")}));if("dangerCheckFail"!==e&&"isSeparateBub"!==e){var m=l?r.server:r.other;setTimeout((function(){a.aiContainerStop("other",m),ga().emit({isShowButton:!0})}),100)}}},sseEnd:function(){var t=this,e=this.data.get("currentIndex"),n=this.data.get("currentAnswerIndex"),a=this.data.get("commonData.isAlaHat"),i=this.data.get("isPc");if(this.data.get("answerList["+e+"]["+n+"].isHint")){var o=this.data.get("abortText");return this.aiContainerStop("hint",o.server),this.data.set("answerList["+e+"]["+n+"].stateBtnType","retry"),this.data.get("isPc")||this.addDefaultInteract(),i&&ra().emit(48),void(i&&this.data.get("clearHistoryMode")&&this.data.merge("answerList["+e+"]["+n+"]",{isStateBtnShow:!1}))}if(a){var r,s,l=(null==(r=this.ref("footer-wrap-"+e+"-"+n))?void 0:r.offsetHeight)||0;null==(s=ra())||s.emit(l+30),this.data.set("answerList["+e+"]["+n+"].autoHeight",!0)}var c=this.data.get("answerList["+e+"]["+n+"].interactData")||{},d=this.data.get("commonData.defaultInteractData"),u=this.data.get("rank");c.data||this.data.set("answerList["+e+"]["+n+"].interactData",{data:II({},d,{praise:II({},d.praise,{feedbackId:"ai_index_"+u})})}),i&&ga().emit(!1),this.data.merge("answerList["+e+"]["+n+"]",{isLoading:!1,isStateBtnShow:!1});var p=this.data.get("agentInfo");p&&p.agentId&&this.updateAgentRankMax(p.agentId,u),this.handleAttachBtnShow(),this.nextTick((function(){2===t.data.get("commonData.chatSearch")&&t.sendFinishedToMain(),t.data.set("answerList["+e+"]["+n+"].isComplete",!0)}))},listenAgentTelHide:null,listenAdultCheckHide:null,handleAttachBtnShow:function(){var t=this,e=this.data.get("attachBtn"),n=this.data.get("commonData");if(e&&2===n.chatSearch)if("ai-tel"===e.type){e.oriLid=this.data.get("oriLid"),this.data.set("attachBtnShow",!0);var a=e.callback_info,i=new URL(a.callback_url);i.searchParams.append("token",a.token),i.searchParams.append("cuid",a.cuid),fetch(i.toString(),{method:"get",mode:"cors",credentials:"include"})}else if("agent-tel"===e.type){var o,r,s=this.data.get("agentInfo");null==(o=sa())||o.emit({agentId:s.agentId}),di(ci(),"13.54.5")>=0&&this.data.set("attachBtnShow",!0),this.listenAgentTelHide=function(e){if(e.agentId===s.agentId&&t.data.get("attachBtnShow")){var n=t.ref("attachBtn").offsetHeight;t.data.set("attachBtnShow",!1),t.nextTick((function(){ra().emit(-1*n)}))}},null==(r=sa())||r.on(this.listenAgentTelHide)}else if("adult-check"===e.type){var l;la().emit(),this.data.set("attachBtnShow",!0),this.listenAdultCheckHide=function(){var e=t.ref("attachBtn").offsetHeight;t.data.set("attachBtnShow",!1),t.nextTick((function(){ra().emit(-1*e)}))},null==(l=la())||l.on(this.listenAdultCheckHide)}},updateAgentRankMax:function(t,e){(!this.agentRankMax.hasOwnProperty(t)||e> __get$(this.agentRankMax,t) )&&( __set$(this.agentRankMax,t,e) )},updateAgentInfo:function(t){on.dispatch("update",{agentInfo:II({},on.getState("agentInfo")||{},{agentParams:II({actionLid:this.data.get("baseData").lid},t)})})},handleAgentTelLog:function(t){t&&(this.dispatch("send-ubclog",{type:"click",value:"ai_call"}),Pp(t))},onStateButtonClick:function(t){t&&("retry"===t?(this.data.set("isRebuild",!0),this.retry()):(this.addDefaultInteract(),this.dispatch("dqa-steps-finished",!0),this.stopGenerate(!1,"userAbort")))},addDefaultInteract:function(){var t=this.data.get("currentIndex"),e=this.data.get("currentAnswerIndex");this.data.get("answerList["+t+"]["+e+"]");var n=this.data.get("answerList["+t+"]["+e+"].interactData")||{},a=this.data.get("commonData.defaultInteractData"),i=this.data.get("rank");n.data||this.data.set("answerList["+t+"]["+e+"].interactData",{data:II({},a,{praise:II({},a.praise,{feedbackId:"ai_index_"+i})})}),this.data.merge("answerList["+t+"]["+e+"]",{isLoading:!1,isStateBtnShow:!1})},getSseRequestParams:function(t){void 0===t&&(t={});var e=this.data.get("baseData.chatFallbackReqBody"),n={};e&&(n=JSON.parse(e));var a=t.isRetry,i=t.isReplace;t.rebuildIndex;var o=t.blockCmpt,r=!(!a&&!i),s={message:{isRebuild:r,content:{agentInfo:{agent_id:this.data.get("agentId")||[]},extData:II({},r?{aicc:""}:{})}}};return s.message.searchInfo=II({chatParams:{chat_token:this.getToken()}},i?{lid:this.data.get("baseData.lid"),ori_lid:this.data.get("oriLid")}:{},{blockCmpt:o}),n=Bi(n,s)},cancelLastGeneration:function(){return xI((function(){var t;return CI(this,(function(e){return[2,Rs({agentId:null==(t=this.data.get("agentInfo"))?void 0:t.agentId,sessionId:this.data.get("sessionId")||this.data.get("oriLid"),lid:this.data.get("baseData.lid")})]}))})).apply(this)},retry:function(){return xI((function(){var t,e,n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y;return CI(this,(function(w){switch(w.label){case 0:for(t=this,this.dispatch("update-chat-status",Pi.WAITING),this.dispatch("generate-retry"),this.monitor.setMonitorData("isRetry",!0),n=this.data.get("currentIndex"),a=this.data.get("currentAnswerIndex"),this.data.get("baseData"),this.data.set("answerList["+n+"]["+a+"].stateBtnType","stop"),i=a;i>0;i--)this.data.pop("answerList["+n+"]");return this.data.set("currentAnswerIndex",0),this.aiContainerClear(),this.updateNeedScroll(),this.clearAnswer(),this.sseDataCopy.clearSseData(),this.currInteractData=null,o=this.data.get("generateAnswer["+n+"].id"),r=this.data.get("rank"),s=on.getState("imageQuery"),l="",c={},d={},u= __get$(on.getState("blockCmptList"),this.data.get("oriLid")) ||[],s&& __get$(s,r) ?(p= __get$(s,r) ,h=p.imageInfo,f=p.rectIndex,g=p.rectList,m=p.imageUpload,l="SSE",m||(c={message:{query:kt({image_b64:h.imageB64,ext:II({},h,{rectIndex:f,rectList:g,actionType:"CHANGE_QUESTION",viscate:"question"})},"IMAGE"),searchInfo:{lid: __get$(on.getState("imageQueryLid"),r) }}})):(l="SSE",v={isRetry:!0,blockCmpt:u},c=this.getSseRequestParams(v)),c.message&&(c.message.searchInfo=c.message.searchInfo||{},c.message.searchInfo.chatParams=c.message.searchInfo.chatParams||{},c.message.searchInfo.chatParams.chat_token=this.getToken()),[4,this.cancelLastGeneration()];case 1:return w.sent(),y=on.getState("qaPairIdDiff"),null==(e=ia())||e.emit({qid:r-y,aid:o,requestType:l,sseExtraData:c,extraData:d}),this.data.set("hasSendEnd",!1),this.nextTick((function(){t.aiContainerWaiting()})),[2]}}))})).apply(this)},clearAnswer:function(){var t=this.data.get("currentIndex"),e=this.data.get("currentAnswerIndex");this.data.set("answerList["+t+"]["+e+"]",{isLoading:!0,isStateBtnShow:!0,interactData:{},suggestionData:{data:{}},referenceList:[],sseStatus:void 0,stateBtnType:"stop",isGenerate:!0,generator:{},suggestion:{},antiFlag:!1,isFinished:!1,isHint:!1,isComplete:!1})},updateNeedScroll:function(){var t=this;this.nextTick((function(){var e;(e=t.el)&&e.getBoundingClientRect().top<0&&e.scrollIntoView&&e.scrollIntoView({block:"start",behavior:"smooth"})}))},getToken:function(){var t=this.data.get("baseData");return sc(t.connectPreQuery?t.connectPreQuery+" "+t.query:t.query)},handleSwiperChange:function(t){var e=(t||{}).index,n=void 0===e?0:e;this.dispatch("send-log",{type:"scroll",action:"slideslip",target:this.el});var a=this.data.get("answerList");this.data.set("currentIndex",n),this.data.set("currentAnswerIndex", __get$(a,n) .length-1)},canAllowTouchMove:function(t){var e,n=null==t||null==(e=t.target)?void 0:e.closest(".cos-swiper"),a=this.data.get(),i=a.isAllowAction,o=a.disbaleTouchAction,r=a.commonData;if(n&&(null==r?void 0:r.isComposition)){var s,l;if(!(null==(l=t.target)||null==(s=l.classList)?void 0:s.contains("writing-one-more"))&&i&&!o)return void n.classList.remove("no-scroll");n.classList.add("no-scroll")}},setSeperateReplaceVisibility:function(t){void 0===t&&(t=!0),this.data.merge("seperateInteract.interactData",{isShowReplace:t})},judgeLastAnswerHasComplete:function(){var t=this.data.get("answerList"),e=this.data.get("currentIndex"),n=this.data.get("currentAnswerIndex");return! __get$(__get$(t,e),n) .isStateBtnShow},onAppend:function(){var t;this.setSeperateReplaceVisibility(!1),this.judgeLastAnswerHasComplete()?this.appendAnswer():(this.aiContainerClear(),this.clearAnswer());var e=this.data.get("rank");null==(t=oa())||t.emit({qid:e,requestType:"SSE",sseExtraData:this.getSseRequestParams({isReplace:!0,rebuildIndex:++this.rebuildTimes})})},onReplace:function(t){var n=this;if(void 0===t&&(t=!1),this.data.get("answerList").length>=5){var a=this.data.get("replaceLimitText");return e.Toast.show({message:a}),void this.dispatch("send-ubclog",{type:"show",value:"generate_most"})}if(this.dispatch("generate-replace"),this.monitor.setMonitorData("isRetry",!0),this.sseDataCopy.clearSseData(),t){var i;this.aiContainerClear(),this.updateNeedScroll(),this.clearAnswer();var o=this.data.get("currentIndex"),r=this.data.get("generateAnswer["+o+"].id"),s=this.data.get("rank");null==(i=ia())||i.emit({qid:s,aid:r,requestType:"SSE",sseExtraData:this.getSseRequestParams({isReplace:!0})})}else{var l,c=this.data.get("rank");null==(l=oa())||l.emit({qid:c,requestType:"SSE",sseExtraData:this.getSseRequestParams({isReplace:!0})}),this.addAnswer(),setTimeout((function(){n.ref("swiper").scrollToIndex(n.data.get("currentIndex"),"auto"),n.updateNeedScroll()}),200)}this.nextTick((function(){n.aiContainerWaiting()}))},handleFallBackAskSend:function(){this.fallbackAskBackHasSend=!0},hideAiCallBtn:function(){var t=this.data.get("attachBtnShow"),e="ai-tel"===this.data.get("attachBtn.type");t&&e&&(this.data.set("attachBtnShow",!1),this.data.set("attachBtn",null))},handleContentFinished:function(){2===this.data.get("commonData.chatSearch")&&Un().emit()},disposed:function(){var t,e;(this.listenLongPressHandler&&Ws().off(this.listenLongPressHandler),this.listenLongPressHandler&&Ba().off(this.listenLongPressHandler),this.listenLongPressHandler=null,this.listenBeforeLaunchConversation&&(Jn().off(this.listenBeforeLaunchConversation),this.listenBeforeLaunchConversation=null),this.listenImageQuerySelectedChange&&(Vn().off(this.listenImageQuerySelectedChange),this.listenImageQuerySelectedChange=null),this.listenUserAbort&&(Xn().off(this.listenUserAbort),na().off(this.listenUserAbort),this.listenUserAbort=null),this.listenHideAiCallHistory&&(ea().off(this.listenHideAiCallHistory),this.listenHideAiCallHistory=null),this.listenBubAsyncClick&&(Hn().conversation.asyncBubClick.off(this.listenBubAsyncClick),this.listenBubAsyncClick=null),this.listenDialogClick&&(Hn().conversation.dialogClick.off(this.listenDialogClick),this.listenDialogClick=null),this.listenAgentTelHide)&&(null==(t=sa())||t.off(this.listenAgentTelHide),this.listenAgentTelHide=null);this.listenAdultCheckHide&&(null==(e=la())||e.off(this.listenAdultCheckHide),this.listenAdultCheckHide=null)}}),qI={carousel:"carousel_wv73f_8"},jI={},BI={bgHeader:"bg-header_1tkh5_1","bg-header":"bg-header_1tkh5_1",borderLayer:"border-layer_1tkh5_8","border-layer":"border-layer_1tkh5_8"},HI={};HI= __call$(Object,"assign",[HI,{followQuestionRight:"follow-question-right_1w24r_1","follow-question-right":"follow-question-right_1w24r_1",hideItem:"hide-item_1w24r_30","hide-item":"hide-item_1w24r_30",contentBox:"content-box_1w24r_34","content-box":"content-box_1w24r_34",aladdin:"aladdin_1w24r_45",chatQueryFadeOut:"chatQueryFadeOut_1w24r_1",indicatorMargin:"indicator-margin_1w24r_57","indicator-margin":"indicator-margin_1w24r_57",containerNoPadding:"container-no-padding_1w24r_60","container-no-padding":"container-no-padding_1w24r_60",containerIndependenPadding:"container-independen-padding_1w24r_64","container-independen-padding":"container-independen-padding_1w24r_64",alaHat:"ala-hat_1w24r_68","ala-hat":"ala-hat_1w24r_68",itemAiContainer:"item-ai-container_1w24r_82","item-ai-container":"item-ai-container_1w24r_82",chatSearchAnswerShow:"chatSearchAnswerShow_1w24r_1",containerBorderActive:"container-border-active_1w24r_85","container-border-active":"container-border-active_1w24r_85",attachBtn:"attach-btn_1w24r_92","attach-btn":"attach-btn_1w24r_92",adultBtnWrapper:"adult-btn-wrapper_1w24r_95","adult-btn-wrapper":"adult-btn-wrapper_1w24r_95"}]) ,MI.template='\n    <div\n        class="\n        chat-search-answer-generate\n        {{isBless ? \'theme-custome-container\' : \'\'}}"\n        style="{{isBless ? themeColorStyle : \'\'}}"\n        data-share="{{shareParams}}"\n        data-delete="{{deleteParams}}"\n    >\n        <cos-swiper\n            styles="{{$swiper}}"\n            style="--indicator-color: {{commonData.indicatorColor}};"\n            s-ref="swiper"\n            type="page"\n            snap-align="center"\n            snap-stop="always"\n            on-change="handleSwiperChange"\n            on-scroll="native:canAllowTouchMove"\n            on-touchmove="native:canAllowTouchMove"\n            indicator="{{commonData.isComposition && !hideSwiperIndicator ? \'center\' : \'\'}}"\n            class="{{commonData.isComposition ? (isAllowAction && !disbaleTouchAction ? \'\' : \'no-scroll\') : \'\'}}"\n        >\n            <cos-swiper-item\n                styles="{{$swiperItem}}"\n                s-for="answer, index in answerList"\n                s-ref="{{\'swiperItem-\' + index}}"\n                width="100%"\n                class="{{index !== currentIndex ? $style[\'hide-item\'] : \'\'}} generate-swiper-item"\n            >\n                \x3c!-- content --\x3e\n                <div\n                    s-ref="{{\'container-\' + index}}"\n                    class="cs-answer-container {{$style[\'item-container\']}}"\n                    data-status="{{\n                        answerList[currentIndex]\n                        && answerList[currentIndex][currentAnswerIndex]\n                        && answerList[currentIndex][currentAnswerIndex].isFinished ? \'COMPLETE\' : \'GENERATING\'\n                    }}"\n                >\n                    <div\n                        class="chat-search-answer-generate-item"\n                        s-for="currentAnswer, currentAnswerIndex in answer"\n                        bubble-rank="{{currentAnswerIndex}}"\n                    >\n                        \x3c!-- 简搜和A页使用画布组件 --\x3e\n                        \x3c!-- 祝福语背景图会被识别导致弹窗错误，前端暂时屏蔽，后续考虑组件侧优化 --\x3e\n                        <c-ai-container\n                            s-ref="{{\'ai-container-\' + index + \'-\' + currentAnswerIndex}}"\n                            common-data="{{commonData}}"\n                            current-answer="{{currentAnswer}}"\n                            is-show-button="{{currentAnswer.isStateBtnShow}}"\n                            bg-props="{{currentAnswer.isWritingScene ? {} : (currentAnswer.bgProps || commonData.bgProps)}}"\n                            agentInfo="{{agentInfo}}"\n                            blocks="{{currentAnswer.blocks}}"\n                            auto-height="{{currentAnswer.autoHeight}}"\n                            tplInfo="{{tplInfo}}"\n                            is-generate="{{currentAnswer.isGenerate}}"\n                            tts-text="{{ttsTextList && ttsTextList[index] && ttsTextList[index][currentAnswerIndex]}}"\n                            index="{{index}}"\n                            current-index="{{currentIndex}}"\n                            theme="{{commonData.theme}}"\n                            typing-speed="{{typingSpeed}}"\n                            chat-info="{{chatInfo}}"\n                            cid="{{cids[index][currentAnswerIndex]}}"\n                            intention-type="{{resultIntentionType}}"\n                            intention-type-map="{{resultIntentionTypeMap}}"\n                            authorityInfo="{{authorityInfo}}"\n                            agentId="{{agentId}}"\n                            question="{{question}}"\n                            rank="{{rank}}"\n                            answer-index="{{currentAnswerIndex}}"\n                            searching-steps-data="{{searchingStepsData}}"\n                            log-ext-data="{{logExtData}}"\n                            sse-status="{{currentAnswer.sseStatus}}"\n                            class="\n                            {{\n                                answerList.length > 1 && (currentAnswerIndex === answer.length - 1)\n                                ? $style[\'indicator-margin\']\n                                : \'\'\n                            }}\n                            {{commonData.isAlaHat ? $style[\'ala-hat\'] : \'\'}}\n                            {{borderActiveIndex === currentAnswerIndex ? $style[\'container-border-active\'] : \'\'}}\n                            {{$style[\'item-ai-container\']}}\n                            "\n                            on-render-finished="onRenderFinished"\n                            on-empty="onEmpty"\n                            ori-lid="{{oriLid}}"\n                            is-bless="{{isBless}}"\n                            log-ext-params="{{logExtParams}}"\n                            ask-used-model="{{askUsedModel}}"\n                            on-edit-click="onEditClick(index, currentAnswerIndex)"\n                        >\n                            \x3c!-- 头部 --\x3e\n                            <header\n                                slot="header"\n                                is-show-pos="{{!swiperPosDisable && answerList.length > 1}}"\n                                current-index="{{index + 1}}"\n                                length="{{answerList.length}}"\n                                rank="{{rank}}"\n                                is-history="{{isHistory}}"\n                            ></header>\n\n                            \x3c!-- 底部区域 --\x3e\n                            <div\n                                slot="footer"\n                                s-show="{{!isExtension && !hideFooter}}"\n                                s-ref="{{\'footer-wrap-\' + index + \'-\' + currentAnswerIndex}}"\n                                data-ucfg="{{commonData.dataUcfg}}"\n                                style="width: 100%"\n                            >\n                                <state-button\n                                    s-if="{{currentAnswer.isStateBtnShow && !isPc}}"\n                                    state="{{currentAnswer.stateBtnType}}"\n                                    scene-theme="{{commonData.theme ? commonData.theme.scene : false}}"\n                                    on-click="onStateButtonClick"\n                                    class="{{currentAnswer.fallbackAskShow ? \'\' : $style[\'state-button\']}}"\n                                />\n                            </div>\n                        </c-ai-container>\n\n                        \x3c!-- 风控场景 --\x3e\n                        <notic-bar\n                            s-if="commonData.isChatSearch && hasHitNotice"\n                            notice-text="{{noticeText}}"\n                        />\n                        \x3c!-- pc hover菜单 --\x3e\n                        <pc-menu-bar\n                            s-if="isPc"\n                            s-ref="{{\'menu-\' + currentAnswerIndex}}"\n                            rank="{{rank}}"\n                            latest-rank="{{latestRank}}"\n                            type="generate"\n                            current-answer-index="{{currentAnswerIndex}}"\n                            get-copy-target="{{getCopyTarget}}"\n                            interactive-area="{{interactiveArea}}"\n                            question="{{question}}"\n                            feedback-data="{{interactiveArea.feedback}}"\n                            base-data="{{baseData}}"\n                            ask-used-model="{{askUsedModel}}"\n                            recommend-word-list="{{recommendWordList}}"\n                            is-show-feedback="{{isShowFeedback}}"\n                            generate-answer="{{generateAnswer}}"\n                            status="{{\n                                answerList[currentIndex]\n                                && answerList[currentIndex][currentAnswerIndex]\n                                && answerList[currentIndex][currentAnswerIndex].isFinished ? \'COMPLETE\' : \'GENERATING\'\n                            }}"\n                        />\n                    </div>\n                </div>\n            </cos-swiper-item>\n        </cos-swiper>\n        \x3c!-- 三合互动&&存在agent或AI助手的电话信息 --\x3e\n        <div class="{{$style[\'attach-btn\']}} {{isRight ? $style[\'follow-question-right\'] : \'\'}}" s-ref="attachBtn">\n            <div s-if="attachBtnShow" class="{{$style[\'adult-btn-wrapper\']}}">\n                <div\n                    s-is="attachBtn.type"\n                    s-bind="attachBtn"\n                    rank="{{rank}}"\n                >\n                </div>\n            </div>\n        </div>\n        \x3c!-- 点踩 弹窗 --\x3e\n        <wd-feedback-pop\n            id="{{\'ai_index_\' + rank}}"\n            color="{{commonData.defaultInteractData.praise.color}}"\n            feedback-show-input="{{isAnnotation}}"\n            feedback-custom-theme="{{commonData.chatParams && commonData.chatParams.setype === \'sge_spring\'}}"\n            is-data-fly-wheel="{{isDataFlyWheel}}"\n            use-card-send-log="{{true}}"\n        />\n        \x3c!-- 长按菜单语音播报功能，仅播报不展现 --\x3e\n        <wd-tts-player\n            s-show="false"\n            source="longPress"\n            text="{{longPressTtsText}}"\n            s-ref="ttsPlayer"\n            tts-api-from="csaitab"\n        />\n        <dialog-pop\n            id="{{\'ai_index_\' + rank}}"\n        />\n    </div>\n';var $I="function"==typeof MI?MI.prototype.initData||FI:MI.initData||FI;function FI(){return{$style:HI,$swiper:qI,$swiperItem:jI,$aladdin:BI}}function UI(){return  __call$(Object,"assign",[{},$I.call(this),{$style:HI,$swiper:qI,$swiperItem:jI,$aladdin:BI}]) }function GI(){return GI=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},GI.apply(this,Array.from(arguments))}"function"==typeof MI?MI.prototype.initData=UI:MI.initData=UI;var WI=function(){function t(t){this.currentIndex=0,this.steps=[],this.enableFinish=!0,this.firstInLastStep=!0,this.duration=1600,this.reflex=t}var e=t.prototype;return e.setDuration=function(t){t&&(this.duration=t)},e.pushData=function(t){if(t){var e=t.currentIndex,n=t.steps,a=void 0===n?[]:n,i=a.length||this.steps.length||1;e<this.currentIndex||(this.currentIndex=e,this.steps=a.length?a:this.steps,e>=i?(this.currentIndex=999,this.validStepsOver({steps:this.steps,currentIndex:999})):e===i-1?this.handleLastStep(t):e===i-2?this.handleSecondStep(t):this.reflex(t))}},e.handleSecondStep=function(t){var e=this;this.reflex(t),this.second2LastTimer||(this.second2LastTimer=setTimeout((function(){e.pushData(GI({},t,{currentIndex:t.currentIndex+1}))}),this.duration))},e.handleLastStep=function(t){var e=this;this.second2LastTimer&&clearTimeout(this.second2LastTimer),this.reflex(t),this.firstInLastStep&&(this.firstInLastStep=!1,this.enableFinish=!1,this.lastTimer=setTimeout((function(){e.enableFinish=!0,e.validStepsOver(t)}),400))},e.validStepsOver=function(t){this.enableFinish&&999===this.currentIndex&&this.reflex(GI({},t,{currentIndex:this.currentIndex}))},e.resetState=function(){this.second2LastTimer&&clearTimeout(this.second2LastTimer),this.second2LastTimer=null,this.lastTimer&&clearTimeout(this.lastTimer),this.lastTimer=null,this.currentIndex=0,this.steps=[],this.enableFinish=!0,this.firstInLastStep=!0},t}();function zI(){return zI=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},zI.apply(this,Array.from(arguments))}var QI={praise:{feLikeKey:"mockkey",feDislikeKey:"mockkey",feLikeType:"mock",feedbackContentList:[["答非所问","回答有误"],["信息过时","没有帮助"],["存在偏见","内容违法"]],feedbackTitle:"请选择遇到的问题",likeTxtDisable:!0,word:"",feedbackId:"ai_index_",feedbackCustom:!0,isGenPc:!0,showDivider:!0},isChatSearch:!0,isShowCopy:!0,isShowReplace:!1,isShowTts:!0,replaceText:"",replaceIcon:"exchange",commentDisable:!0,useCardSendLog:!0,useWiseStyle:!0,copyTxtDisable:!0,isShowEditTxt:!0,tplInfo:{},hudongTtsUrl:"",ttsApiFrom:"csaitab",isShowShare:ft()&&!lt(),recommendWordList:[],isShowFeedback:!1},JI=a.defineComponent({messages:{"send-log":function(t){this.sendLog(t.value)},"send-ubclog":function(t){this.sendUbcLog(t.value)},"send-broadcast-ubclog":function(t){this.sendUbcLog(zI({ubcId:"17630",page:"broadcast"},t.value))},"image-query-tab:show-log":function(t){this.sendUbcLog(zI({},t.value))},"image-query-tab:click-log":function(t){this.sendUbcLog(zI({},t.value))},"cid-update":function(t){var e=null==t?void 0:t.value,n=e.index,a=void 0===n?0:n,i=e.cid,o=void 0===i?"":i,r=e.answerIndex,s=void 0===r?0:r,l=this.data.get("cids"); __get$(l,a) ||( __set$(l,a,[]) ), __set$(__get$(l,a),s,o) ,this.data.set("cids["+a+"]["+s+"]",o)},"update-log-ext":function(t){var e=null==t?void 0:t.value;if(e){var n=this.data.get("logExtData");this.data.set("logExtData",zI({},n,e))}},"dqa-steps-finished":function(t){this.searchingStepsFinished(null==t?void 0:t.value)}},components:{generate:MI},initData:function(){return{data:{answerList:[],commonData:{defaultInteractData:QI,indicatorColor:"#6e4bfaff",chatSearch:2,isChatSearch:!0,chatParams:{},isAndroid:Oi,isIOS:Ri,isBaiduApp:!0,ubcPublic:"",isSkeletonShow:!1,isStateBtnShow:!0,isAlaHat:!1,sseQuery:"",isComposition:!1,bgProps:{image:""},tplInfo:{srcid:"52567",order:-1,lid:"",tplname:"nonala_chat",query:""},editorParams:{riskcheckApi:"",chatParams:{},isBaiduMainApp:!0,isLogin:!0,extLogParams:{}}}},cids:[[]],generateAnswer:[],dangerCheckTime:0,rank:1,baseData:{},latestRank:1,preChatParms:{},startTime:0,logExtData:{},searchingStepsData:{},overviewBlockFirstTokenDur:0,askUsedModel:{}}},computed:{"data.commonData.tplInfo.lid":function(){return this.data.get("baseData.lid")},"data.commonData.tplInfo.query":function(){return this.data.get("baseData.query")},"data.commonData.chatParams":function(){return this.data.get("baseData.chatParams")},"data.commonData.riskcheckApi":function(){return this.data.get("baseData.riskcheckApi")},"data.commonData.editorParams.riskcheckApi":function(){return this.data.get("baseData.riskcheckApi")},"data.commonData.editorParams.chatParams":function(){return this.data.get("baseData.chatParams")},"data.commonData.isComposition":function(){return"1"===this.data.get("baseData.chatParams.isComposition")},"data.commonData.defaultInteractData.isShowReplace":function(){return this.data.get("latestRank")===this.data.get("rank")},"data.commonData.isAlaHat":function(){return this.data.get("baseData.chatParams.is_ala_hat")},"data.commonData.defaultInteractData.praise.word":function(){return this.data.get("baseData.query")}},attached:function(){var t=this;this.linkClickListen(),this.searchingStepsHandle=new WI(this.searchingStepsDataChange.bind(this)),wg.listen((function(e){e.rank===t.data.get("rank")&&(e.isAgent&&t.searchingStepsHandle.setDuration(1e4),t.searchingStepsHandle.pushData(e.data))}))},linkClickListen:function(){var t,e=this,n=null==(t=this.ref("generate"))?void 0:t.el;null==n||n.addEventListener("click",(function(t){"span"===t.target.tagName.toLowerCase()&&t.target.closest("a")&&e.sendLog({xpath:"a(wz_link)",extra:{info:t.target.innerText},type:"l"})}))},sendLog:function(t){var e,n=this.ref("generate"),a=(null==n?void 0:n.data.get("currentIndex"))||0,i=(null==n?void 0:n.data.get("currentAnswerIndex"))||0,o=this.data.get("data.commonData"),r=o.tplInfo,s=void 0===r?{}:r,l=o.chatParams,c=void 0===l?{}:l,d=s.lid,u=this.data.get("oriLid"),p=this.data.get("rank"),h=this.data.get("conversationLogId")||"",f=c.setype,g=void 0===f?"csaitab":f,m=this.data.get("logExtData")||{},v=this.data.get("cids")||[];t.extra||(t.extra={}),t.extra.lid=d,t.extra.ori_lid=u,t.extra.re_rank=p.toString(),t.extra.ctse_id=h,t.extra.setype=g,t.extra.cid=(null==v||null==(e= __get$(v,a) )?void 0: __get$(e,i) )||"", __call$(Object,"assign",[t.extra,m]) ;var y=zI({},t,{extra:t.extra,ori_lid:u,index:a+1});delete y.target,lp(y,s,t.target)},sendUbcLog:function(t){var e=this;if(t){var n="stop"===t.value?5e3:0;setTimeout((function(){var n=t.type,a=void 0===n?"show":n,i=t.value,o=void 0===i?"":i,r=t.extra,s=void 0===r?{}:r,l=e.ref("generate"),c=((null==l?void 0:l.data.get("currentIndex"))||0)+1,d=e.data.get("data.commonData"),u=d.tplInfo,p=void 0===u?{}:u,h=d.chatParams,f=void 0===h?{}:h,g=p.lid,m=e.data.get("commonData.isComposition"),v=e.data.get("oriLid"),y=e.data.get("rank"),w=e.data.get("conversationLogId")||"",b=f.setype,_=void 0===b?"csaitab":b,k=(null==l?void 0:l.data.get("logExtData"))||{},S=k.scene,x=void 0===S?"":S,I=k.scene_1st,T=void 0===I?"":I,C=k.scene_2nd,L=void 0===C?"":C,D=(null==l?void 0:l.data.get("agentInfo"))||{},P={};if(m){var E=e.data.get("baseData.chatParams.generateInfo");P={artlen:E.artlen,arttype:E.arttype,contype:E.contype,iscreate:E.iscreate}}var A={a_lid:on.getState("apagelid")};Ua({ubcId:t.ubcId,page:t.page,type:a,value:o,source:"active",ext:zI({ctse_id:w,lid:g,ori_lid:v,re_rank:y.toString(),setype:_,scene:x,scene_1st:T,scene_2nd:L,index:c,agent_name:D.agentName,agent_id:D.agentSearchId},e.data.get("data.commonData.ubcPublic"),s,P,A)},p)}),n)}},sendLoadingLog:function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var n=on.getState("agentInfo")||{},a=n.agentSearchId,i=n.agentName,o=a?"agent-loading":"loading";this.sendUbcLog(zI({value:o,extra:zI({agent_id:a,agent_name:i},e)},t))},searchingStepsDataChange:function(t){var e,n=this,a=t||{},i=a.currentIndex,o=a.steps;if(999===i)return this.nextTick((function(){n.searchingStepsFinished(!1)}));this.dispatch("update-generate-status",{status:String(i),title:null==o||null==(e= __get$(o,i) )?void 0:e.title}),this.data.set("searchingStepsData.currentIndex",i),this.data.set("searchingStepsData.steps",o),this.dispatch("toggle-searching-steps-promise",{isClear:!1,promise:new Promise((function(t){bg.push(t)}))})},searchingStepsFinished:function(t){var e,n,a=this;bg.resolveAll(t),null==(e=this.searchingStepsHandle)||e.resetState(),this.data.set("searchingStepsData",{currentIndex:0,steps:[]}),Promise.resolve().then((function(){a.dispatch("toggle-searching-steps-promise",{isClear:!0})})),null==(n=ra())||n.emit(65)}});JI.template='\n    <generate\n        s-ref="generate"\n        s-bind="{{data}}"\n        generate-answer="{{generateAnswer}}"\n        question="{{question}}"\n        danger-check-time="{{dangerCheckTime}}"\n        start-time="{{startTime}}"\n        rank="{{rank}}"\n        oriLid="{{oriLid}}"\n        base-data="{{baseData}}"\n        searching-steps-data="{{searchingStepsData}}"\n        latest-rank="{{latestRank}}"\n        pre-chat-parms="{{preChatParms}}"\n        is-history="{{isHistory}}"\n        conversation-log-id="{{conversationLogId}}"\n        log-ext-data="{{logExtData}}"\n        overview-block-first-token-dur="{{overviewBlockFirstTokenDur}}"\n        ask-used-model="{{askUsedModel}}"\n        recommend-word-list="{{recommendWordList}}"\n        is-show-feedback="{{isShowFeedback}}"\n    />\n';var VI=Tt.connect(on,{loadingParams:"loadingParams"})(a.defineComponent({template:'\n    <div>\n        <div s-if="status === \'IDLE\'" class="cs-loading">\n            <div class="cs-loading-skeleton">\n                <div class="cs-loading-skeleton-contain">\n                    <div class="cs-loading-icon">\n                        <img class="cs-loading-icon-ani" src="{{loadingParams.backgroundImg}}"/>\n                    </div>\n                    <div class="cs-loading-tips">{{loadingParams.text}}</div>\n                    <div class="cs-loading-skeleton-index cs-loading-skeleton-loader-1">\n                        <div class="loading-bar"></div>\n                    </div>\n                    <div class="cs-loading-skeleton-index cs-loading-skeleton-loader-2">\n                        <div class="loading-bar"></div>\n                    </div>\n                    <div class="cs-loading-skeleton-index cs-loading-skeleton-loader-3">\n                        <div class="loading-bar"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- 只有异常情况才展示，当用户主动取消，也就是abortType !== \'userAbort\'的时候不展示。 --\x3e\n        <div s-else-if="status === \'ABORT\' && abortType !== \'userAbort\'" class="cs-error">\n            <div class="cs-error-wrap-text">😫 抱歉，出了点小问题，请稍后重试</div>\n            <div class="cs-error-wrap-btn">\n                <i class="refresh-icon cu-icon">&#xe788;</i>\n                <span>重新回答</span>\n            </div>\n        </div>\n    </div>\n    ',components:{},initData:function(){return{status:"IDLE",abortType:""}}}));function KI(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++) __set$(a,n,__get$(t,n)) ;return a}function XI(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function YI(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){XI(o,a,i,r,s,"next",t)}function s(t){XI(o,a,i,r,s,"throw",t)}r(void 0)}))}}function ZI(){return ZI=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},ZI.apply(this,Array.from(arguments))}function tT(t,e){var n="undefined"!=typeof Symbol&& __get$(t,Symbol.iterator) ||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return KI(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?KI(t,e):void 0}}(t))||e){n&&(t=n);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value: __get$(t,a++) }}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function eT(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var nT=Tt.connect(on,{user:"user",query:"query",oriLid:"oriLid",chatParams:"chatParams",conversationLogId:"conversationLogId",latestRank:"curRankInfo.rank",preChatParms:"preChatParms",modelList:"modelList",qaPairIdDiff:"qaPairIdDiff"})(a.defineComponent({template:'\n    <div class="{{isHistory ? \'history-answer-box\' : \'answer-box\'}}\n            {{!chatGenerate || addHistoryCardMarginTop ? \'answer-generate-none\' : \'\'}}\n            {{showNoResult ? \'no-result-show\' : \'\'}}\n            {{isPc && !hideExtraBottom && !isHistory && latestRank === currentRank ? \'last-answer-box\' : \'\'}}"\n        data-click-log="{{baseClickLogStr}}"\n        data-time-log="{{baseTimeLogStr}}"\n        data-show-log="{{baseShowLogStr}}"\n        data-base-data="{{baseDataStr}}"\n    >\n        <answer-history\n            s-if="isHistory"\n            rank="{{currentRank}}"\n            question="{{question}}"\n            qid="{{answer.historyQid}}"\n            blocksList="{{answer.blocksList}}"\n            hints="{{answer.hints}}"\n            isSeparateBub="{{answer.isSeparateBub}}"\n            independenBlocks="{{answer.independenBlocks}}"\n            shareParams="{{answer.shareParams}}"\n            deleteParams="{{answer.deleteParams}}"\n            aiEntryStyle="{{answer.aiEntryStyle}}"\n            initShowHistory="{{answer.initShowHistory}}"\n            isAiCall="{{answer.isAiCall}}"\n            tplInfo="{{tplInfo}}"\n            latest-rank="{{latestRank}}"\n            has-ala-card="{{hasAlaCard}}"\n        />\n        <answer-generate\n            s-elif="chatGenerate && answer.length > 0"\n            s-ref="answer-generate"\n            generate-answer="{{generateSection.answer}}"\n            danger-check-time="{{dangerCheckTime}}"\n            rank="{{currentRank}}"\n            question="{{question}}"\n            start-time="{{startTime}}"\n            ori-lid="{{oriLid}}"\n            base-data="{{baseData}}"\n            conversation-log-id="{{curConversationLogId}}"\n            latest-rank="{{latestRank}}"\n            pre-chat-parms="{{preChatParms}}"\n            is-history="{{isHistory}}"\n            image-query-lid="{{imageQueryLid}}"\n            sample="{{sample}}"\n            overview-block-first-token-dur="{{overviewBlockFirstTokenDur}}"\n            ask-used-model="{{requestParams.message.searchInfo.usedModel}}"\n            class="{{isFirstRankHideQuery ? \'answer-generator-hide-query\' : \'\'}}"\n            recommend-word-list={{recommendWordList}}\n            is-show-feedback="{{feedbackForm.showCard}}"\n        />\n\n        \x3c!--bca-disable--\x3e\n        <div\n            s-if="(cardSection && cardSection.show) || isHistory"\n            class="answer-search\n                {{cardSection.data ? \'answer-search-box\' : \'\'}}\n                {{isHistory && (!answer.blocksList || !answer.blocksList.length) ? \'answer-search-no-generate\' : \'\'}}\n            "\n            s-ref="htmlDom"\n        >\n            <template s-if="!isPc">{{answer.cardHtml | raw}}</template>\n        </div>\n        \x3c!--bca-enable--\x3e\n\n        \x3c!--人脉卡--\x3e\n        <answer-recommend\n            s-if="{{agentRecommendList}}"\n            s-ref="answer-recommend"\n            typing-end="{{typingEnd}}"\n            agent-recommend-list="{{agentRecommendList}}"\n            generate-answer="{{generateSection.answer}}"\n            question="{{question}}"\n            is-history="{{isHistory}}"\n        />\n        <feedback-form\n            s-if="feedbackForm.showCard && typingEnd"\n            feedbackFormData="{{feedbackForm.feedbackFormData}}"\n            product="{{feedbackForm.productData}}"\n            on-closeCard="closeCard"\n        />\n        <chat-guide\n            s-if="askSection.show && currentRank === 1 && hitGuideDown"\n            guide-word="{{guideWord}}"\n            agent-list="{{agentList}}"\n            hit-guide-down="{{true}}"\n        />\n        \x3c!-- 引导提醒组件 --\x3e\n        <answer-tips\n            rank="{{currentRank}}"\n            latest-rank="{{latestRank}}"\n        />\n        <answer-ask\n            s-if="askSection.show"\n            rank="{{currentRank}}"\n            base-data="{{baseData}}"\n            latest-rank="{{latestRank}}"\n            cur-agent-info="{{curAgentInfo}}"\n        />\n        <no-result s-if="showNoResult" />\n        <chat-danger query-is-danger="{{queryIsDanger}}" rank="{{currentRank}}" />\n    </div>',components:{"chat-loading":VI,"chat-danger":kl,"answer-generate":JI,"answer-ask":Sx,"answer-history":gx,"no-result":Sg,"chat-guide":$h,"feedback-form":Lx,"answer-recommend":Wf,"answer-tips":pg},initData:function(){var t,e;return{answer:[{answer:{answerData:[],status:"IDLE"}}],question:{question:""},currentRank:0,isHistory:!1,perfInfo:{},baseData:{lid:"",chatGenerate:!0,chatFallbackReqBody:"",chatParams:{setype:"csaitab"},chatSearch:2,riskcheckApi:"",longword:"",queryIsDanger:0,promKey:"",logCommonInfo:{},sample:on.getState("sample"),user:{isUserLogin:0},query:""},searchingStepsPackOver:!0,searchingStepsPackOverTimeStart:0,overviewBlockFirstTokenDur:0,generateSection:{need:!1,answer:[]},cardSection:{show:!1,data:""},askSection:{show:!1},baseClickLog:{lid:"",extra:{lid:"",re_rank:"1",ori_lid:"",cid:""}},baseTimeLog:{},playClickLog:{ala_clk:"ai_index_1_0_10_o",order:1,clk_info:{srcid:"52567",tplname:"ai_index",type:"b",action:"play",index:1}},requestUrl:"",requestParams:{},abortType:"",showNoResult:!1,existAnswer:!1,rebuildMode:Ut.REBUILD,hasSendPageComplete:{perf:!1,invoke:!1},requestStart:0,requestEnd:0,agentInfo:null,chatGenerate:!0,queryIsDanger:0,startTime:0,severPerfInfo:{},hideAlaCard:!1,guideWord:on.getState("guideWord"),agentList:on.getState("agentList"),hitGuideDown:!1,searchingStepsPromise:null,curConversationLogId:"",isPc:"pc"===rt(),hideExtraBottom:!1,hasStartBottomAlign:!1,closeBottomAlign:!1,feedbackForm:{showCard:!1,feedbackFormData:{},productData:{},recommendWordList:[]},typingEnd:!1,sceneLogExt:{scene:"",scene_1st:"",scene_2nd:""},shortcutsData:{},showCapsule:!1,curAgentInfo:{},agentRecommendList:null,isAiCall:!1,separateBub:!1,stopNotAbortSse:!1,upWard:!1,isBtmAlignSample:"1"===(null==(e=on.getState("sample"))||null==(t=e.variables)?void 0:t.CHANGE_BOTTOM_ALIGN)||"pc"===rt()||lt(),observer:null,isDeepSeekPage:lt()}},computed:{baseDataStr:function(){var t=this.data.get("isHistory"),e=this.data.get("answer"),n=this.data.get("baseData");return t&&(n.lid=(null==e?void 0:e.historyQid)||""),JSON.stringify(n)},baseClickLogStr:function(){var t=this.data.get("baseClickLog"),e=this.data.get("sceneLogExt"),n=ZI({},t,{extra:ZI({},t.extra,{scene:null==e?void 0:e.scene,scene_1st:null==e?void 0:e.scene_1st,scene_2nd:null==e?void 0:e.scene_2nd})});return JSON.stringify(n)},baseTimeLogStr:function(){return JSON.stringify(this.data.get("baseTimeLog"))},baseShowLogStr:function(){var t=this.data.get("sceneLogExt"),e=on.getState("agentInfo");if(this.data.get("isHistory")){var n,a=this.data.get("answer.blocksList");e=null==(n=(a&&a[0]?a[0]:[])[0])?void 0:n.agentInfo}var i={agent_id:null==e?void 0:e.agentSearchId,agent_name:null==e?void 0:e.agentName,scene:null==t?void 0:t.scene,scene_1st:null==t?void 0:t.scene_1st,scene_2nd:null==t?void 0:t.scene_2nd};return JSON.stringify(i)},playClickLogStr:function(){return JSON.stringify(this.data.get("playClickLog"))},dangerCheckTime:function(){return this.data.get("perfInfo.dangerCheck.duration")},addHistoryCardMarginTop:function(){var t,e=this.data.get("isHistory"),n=this.data.get("answer");return e&&!(null==n||null==(t=n.blocksList)?void 0:t.length)},tplInfo:function(){var t=this.data.get("baseData");return{srcid:"52567",order:-1,lid:t.lid,tplname:"nonala_chat",query:t.query}},isFirstRankHideQuery:function(){return on.getState("firstRankHideQuery")},currentRank:function(){var t=this.data.get("qaPairIdDiff");return this.data.get("qaPairId")+t}},messages:{"add-answer":function(){this.data.set("separateBub",!1)},"component-show":function(t){var e=on.getState("oriLid"),n=on.getState("blockCmptList"),a= __get$(n,e) ,i=t.value.name;a&&!a.includes(i)?a.push(i): __set$(n,e,[i]) ,on.dispatch("update",{blockCmptList:n})},"update-perf-info":function(t){this.data.merge("severPerfInfo",t.value)},"generate-start":function(t){this.data.merge("severPerfInfo",t.value)},"hide-ala-card":function(){this.data.set("hideAlaCard",!0)},"toggle-searching-steps-promise":function(t){t.value.isClear?this.data.set("searchingStepsPromise",null):this.data.set("searchingStepsPromise",t.value.promise)},"generate-retry":function(){this.data.get("latestRank")===this.data.get("currentRank")&&(this.data.set("hasStartBottomAlign",!1),this.data.set("closeBottomAlign",!1)),this.data.set("typingEnd",!1)},"update-chat-status":function(t){this.setChatStatus(null==t?void 0:t.value)},"update-generate-status":function(t){var e=(null==t?void 0:t.value)||{},n=e.status,a=e.title;this.updateGenerateInfo(n,a)},"generate-replace":function(){this.data.get("latestRank")===this.data.get("currentRank")&&(this.data.set("hasStartBottomAlign",!1),this.data.set("closeBottomAlign",!1)),this.data.set("typingEnd",!1),ka().emit({rank:this.data.get("currentRank"),disabled:!0})},"show-capsule":function(){var t;this.data.set("showCapsule",!0),(null==(t=this.data.get("shortcutsData").capsuleData)?void 0:t.length)&&ya().emit({rank:this.data.get("currentRank")})},"open-half-screen":function(t){var e,n,a,i=this;kf.triggerEvent("onOpenDrawer",{round_index:this.data.get("currentRank"),isHistory:this.data.get("isHistory"),agentInfo:{agentInfo:{agentId:null==(e=this.data.get("curAgentInfo"))?void 0:e.agentId,agentSearchId:null==(n=this.data.get("curAgentInfo"))?void 0:n.agentSearchId,agentName:null==(a=this.data.get("curAgentInfo"))?void 0:a.agentName}},data:(null==t?void 0:t.value)||{},api:{sendUbcLog:function(t){i.dispatch("send-ubclog",t)}}})}},attached:function(){var t,e,n=this;this.updateGenerateInfo(Ei.THINKING,"正在思考"),setTimeout((function(){var t=_n('style[data-css-module="markdown"]',document.head),e=_n('style[data-css-module="markdown"]');if(!t&&e){var n=e.cloneNode(!0);document.head.appendChild(n)}}),0);var a=this.data.get("isHistory");if(kf.triggerEvent("onQuestionStart",{round_index:this.data.get("currentRank"),isHistory:a,data:{functional:{}},api:{sendUbcLog:function(t){n.dispatch("send-ubclog",t)}}}),a){var i=this.data.get("answer").isAiCall,o=on.getState("isShowHello");if(this.data.set("isAiCall",i),this.historyCardProcess(),this.data.get("isPc")&&on.dispatch("update",{hasPullHistory:!0}),i||o){var r=this.data.get("answer.historyAskMessage[0]"),s=this.data.get("answer.blocksList[0]");r&&s&&this.handleHistoryAskData(r,s)}}else{this.data.set("startTime", __get$(on.getState("startTimeList"),this.data.get("currentRank")) ),this.listenInit(),this.processAnswer(),this.handleCardSectionVisible(),this.cardEventListener(),this.sendNAMessageToServer(),this.watchContentChange(),this.watchContentFinished(),this.data.set("hitGuideDown","2"===(null==(e=on.getState("sample"))||null==(t=e.variables)?void 0:t.AGENT_SUG));var l=this.data.get("conversationLogId");this.data.set("curConversationLogId",l),this.updateCurAgentInfo()}},listenInit:function(){var t=this;this.listenNewChatHideCapsule=function(){var e=t.data.get("observer");e&&(e.disconnect(),t.data.set("observer",null))},Jn().on(this.listenNewChatHideCapsule),this.listenDeleteAgent=function(t){var e,n,a=on.getState("agentInfo")||{},i=((null==(e=t.params)?void 0:e.agentInfo)||{}).agentSearchId||(null==(n=t.params)?void 0:n.agentSearchId)||"";a.agentSearchId===i&&on.dispatch("update",{agentInfo:{}})},Fs().on(this.listenDeleteAgent),this.listenStopToBottomAlign=function(){t.data.set("closeBottomAlign",!0),nc()},ba().on(this.listenStopToBottomAlign)},updateCurAgentInfo:function(){var t,e,n=on.getState("agentInfo");null==n||(null==(t=n.agentParams)||delete t.isQ2c),null==n||(null==(e=n.agentParams)||delete e.content_build_id),on.dispatch("update",{agentInfo:n}),this.data.set("curAgentInfo",on.getState("agentInfo"))},cardEventListener:function(){var t=this,e=this.data.get("currentRank");Hn().conversation.askDataSend.on((function(e){var n=e.generator,a=e.options;t.sendAskData(n,a)}),{when:function(t){var n;return void 0===t&&(t={}),(null==t||null==(n=t.options)?void 0:n.rank)===e}}),Jn().on((function(){t.data.set("hideExtraBottom",!0),t.updateFeedbackForm({showCard:!1,feedbackFormData:{},productData:{}})})),Xn().on((function(){return t.data.set("hideExtraBottom",!0)})),this.listenFeedbackForm=function(e){t.handleFeedbackForm(ZI({actionName:"大盘随机"},e))},ua().on(this.listenFeedbackForm),Fn().on((function(e){if(e.rank===t.data.get("currentRank")){var n=t.ref("answer-generate"),a=(null==n?void 0:n.el.innerText)||"";t.data.set("feedbackForm.productData.data.extrastring.desc26",(null==a?void 0:a.length)>1e3?a.substring(0,1e3):a),t.data.set("typingEnd",!0)}ac(),setTimeout((function(){var e=t.data.get("observer");e&&(e.disconnect(),t.data.set("observer",null)),nc()}),3e3)}))},processAnswer:function(){var t=this.data.get("answer");this.handleAnswer(t,{oldValue:[{answer:{answerData:[],status:"IDLE"}}],newValue:t}),this.listenAnswer()},listenAnswer:function(){var t=this,e=this;this.watch("answer",YI((function(t,n){var a,i;return eT(this,(function(o){return a=n.oldValue,i=n.newValue,e.handleAnswer(t,{oldValue:a,newValue:i}),[2]}))}))),this.watch("upWard",(function(e){(e||!e&&1==+t.data.get("currentRank"))&&t.data.get("isBtmAlignSample")&&setTimeout((function(){!function(t){$l.changeBottomAlign(t)}(t.data.get("isPc"))}),2e3)}))},handleAnswer:function(t,e){var n=e.oldValue,a=e.newValue;return YI((function(){var e,i,o,r,s,l,c,d,u,p,h,f,g,m,v;return eT(this,(function(y){for(i=function(i){if( __get$(a,i) && __get$(n,i) ){var r= __get$(a,i) .answer.answerData,s= __get$(n,i) .answer.answerData;if(r.length>s.length){var l=r.slice(s.length);e.data.get("generateSection.answer["+i+"]")||e.data.set("generateSection.answer["+i+"]",{data:[],id: __get$(a,i) .id,status: __get$(a,i) .status,perfData:{}}),e.data.set("generateSection.answer["+i+"].status", __get$(a,i) .answer.status),e.nextTick((function(){for(var t,e=tT(l);!(t=e()).done;){var n=t.value;o.handlePacks(n,i)}}))}} __get$(t,i) .answer.perfData&&e.data.set("generateSection.answer["+i+"].perfData", __get$(t,i) .answer.perfData)},o=this,t&&(null==(s=t[0])||null==(r=s.answer)?void 0:r.answerData)&&(null==(c=t[0])||null==(l=c.answer)?void 0:l.answerData.length)&&!this.data.get("requestEnd")&&this.data.set("requestEnd",+new Date),d=0;d<a.length;d++)e=this,i(d);return(u=a[0])&&"ABORT"===u.answer.status&&(p=u.answer.answerData,h= __get$(p,p.length-1) .type,this.data.set("abortType",h)),u&&"COMPLETE"===u.answer.status&&(!this.data.get("requestStart")&&this.data.set("requestStart",null==(m= __get$(t,t.length-1) )||null==(g=m.answer)||null==(f=g.perfData)?void 0:f.requestStartTime),v=this,this.nextTick(YI((function(){var t,e,n;return eT(this,(function(a){switch(a.label){case 0:return(t=Ul("prerenderConfirmPromise"))?[4,t]:[3,2];case 1:a.sent(),a.label=2;case 2:return v.existCard()||v.data.get("existAnswer")||(v.data.set("chatGenerate",v.data.get("baseData.chatGenerate")),(n=v.ref("answer-generate")&&v.ref("answer-generate").el)&&(null==(e=ra())||e.emit(n.offsetHeight-81)),v.data.set("showNoResult",!0)),v.data.set("queryIsDanger",v.data.get("baseData.queryIsDanger")),[2]}}))})))),[2]}))})).apply(this)},handleSearchingStepsPack:function(t){var e,n,a,i,o,r,s=null==(n=t.content)||null==(e=n.generator)?void 0:e.component;if(!(null==t||null==(a=t.functional)?void 0:a.feedback))if("searchingSteps"===s)wg.emit(ZI({},null==(i=t.content)?void 0:i.generator,{rank:this.data.get("currentRank"),isAgent:!!(null==(r=t.content)||null==(o=r.agentInfo)?void 0:o.agentMeta)})),this.data.set("searchingStepsPackOver",!1);else if(!this.data.get("searchingStepsPackOver")){var l;this.data.set("searchingStepsPackOver",!0),this.data.set("searchingStepsPackOverTimeStart",(new Date).getTime()),wg.emit({component:"searchingSteps",data:{currentIndex:999},rank:this.data.get("currentRank")}),null==(l=this.ref("answer-generate"))||l.searchingStepsFinished(!1)}},sendNAMessageToServer:function(){var t=this;Hn().container.imageGuidanceShow.on((function(){if(!t.showPhotoSearchGuideInfo&&t.photoSearchGuideInfo){var e=t.ref("answer-generate");null==e||e.sendUbcLog({type:"show",value:"guide_pic"}),t.showPhotoSearchGuideInfo=!0;var n=new URL(t.photoSearchGuideInfo.callback_url);n.searchParams.append("token",t.photoSearchGuideInfo.token),n.searchParams.append("cuid",t.photoSearchGuideInfo.cuid),fetch(n.toString(),{method:"get",mode:"cors",credentials:"include"})}}))},handleFunctionalPack:function(t){var e,n;if(di(ci(),"13.66")<0){var a,i,o=null==(i=t.functional)||null==(a=i.inputConfig)?void 0:a.photoSearchGuideInfo;o&&(this.photoSearchGuideInfo=o,Hn().conversation.showImageGuidance.emit())}else{var r,s=null==(r=t.functional)?void 0:r.inputConfig;s&&(s.photoSearchGuideInfo&&(this.photoSearchGuideInfo=s.photoSearchGuideInfo),Hn().conversation.sendInputConfig.emit(s))}var l=null==(e=t.functional)?void 0:e.question_guide;if(l){var c=this.data.get("currentRank");Hn().component.questionGuide.emit({rank:c,params:{questionGuideInfo:l}})}(null==(n=t.functional)?void 0:n.chatSearchTips)&&ka().emit({rank:this.data.get("currentRank"),tipsData:t.functional.chatSearchTips})},handleLogExtPack:function(t){var e,n,a=null==(n=t.content)||null==(e=n.generator)?void 0:e.logExt;a&&this.data.set("sceneLogExt",a)},handleAlaHat:function(t){var e,n,a,i,o,r;"markdown"===(null==(n=t.content)||null==(e=n.generator)?void 0:e.component)&&(null==(i=t.content)||null==(a=i.generator)?void 0:a.is_ala_hat)&&this.data.merge("baseData",{chatParams:{is_ala_hat:1}}),(null==(r=t.content)||null==(o=r.generator)?void 0:o.isComposition)&&this.data.merge("baseData",{chatParams:{isComposition:"1"}})},getAiFeedbackQuery:function(t){var e,n=null==t||null==(e=t.content)?void 0:e.generator;(null==n?void 0:n.queryIntent)&&this.data.set("baseData.queryIntent",n.queryIntent),(null==n?void 0:n.queryIndustry)&&this.data.set("baseData.queryIndustry",n.queryIndustry),(null==n?void 0:n.queryIntent)&&(null==n?void 0:n.queryIndustry)&&on.dispatch("update",{queryIntent:n.queryIntent,queryIndustry:n.queryIndustry})},aiTabWeatherExperiment:function(t){var e;if(!this.data.get("isPc")&&!this.data.get("isPc")){var n=null==(e=t.content)?void 0:e.generator,a="aiTabWeatherExperiment";if(n&&n.data&&["questionClosely","agentRec"].includes(n.component)&& __get$(n,a) &&( __set$(n.data,a,__get$(n,a)) ,"agentRec"===n.component)){var i=n.data||{},o=i.value,r=void 0===o?[]:o,s=i.guideWord,l=void 0===s?"":s,c=r.filter((function(t){return Ie(t)})).map((function(t){return ZI({},t,{span:8,startIndex:0,endIndex:t.agentName?t.agentName.length:-1})}));on.dispatch("update",{agentList:c,guideWord:l})}}},agentRecommendDataHandle:function(t){var e,n=this,a=null==(e=t.content)?void 0:e.generator;if(a&&a.data){var i=a.data.agentRecommendList;Fn().on((function(t){t.rank===n.data.get("currentRank")&&i&&n.data.set("agentRecommendList",i)}))}},handleMindMapShow:function(t){var e,n,a=null==t||null==(e=t.content)?void 0:e.generator,i=null==a?void 0:a.needClearMindMap,o=null==a?void 0:a.needClearHistory;if(i||o)return on.dispatch("update",{showMindMap:!1});var r=null==a||null==(n=a.data)?void 0:n.state,s="mindMap"===(null==a?void 0:a.component),l=r&&r!==Tf.NO_MIND_MAP;s&&l&&!on.getState("showMindMap")&&on.dispatch("update",{showMindMap:!0})},handlePacks:function(t,e){return YI((function(){var n,a,i,o,r,s,l,c,d,u,p,h,f,g,m,v,y,w,b,_,k,S,x,I,T,C,L,D,P,E,A,O,R,N,M,q,j,B,H,$,F,U,G,W,z,Q,J,V,K;return eT(this,(function(X){switch(X.label){case 0:return v=null==t||null==(a=t.content)||null==(n=a.generator)?void 0:n.data,y="pc"===rt(),"progress"!==(null==t||null==(o=t.content)||null==(i=o.generator)?void 0:i.component)||y?(v&&!Object.keys(v).length&&(t.content.generator.data.isEmptyPack=!0),y&&this.handleMindMapShow(t),"ppt-viewer"===(null==t||null==(s=t.content)||null==(r=s.generator)?void 0:r.component)&&el().emit({value:null==t||null==(_=t.content)||null==(b=_.generator)||null==(w=b.data)?void 0:w.value}),"mindMap"===(null==t||null==(c=t.content)||null==(l=c.generator)?void 0:l.component)?(Xs().emit({type:Cf.SET_DATA,data:null==t||null==(k=t.content)?void 0:k.generator.data}),[2]):(this.aiTabWeatherExperiment(t),this.agentRecommendDataHandle(t),this.handleSearchingStepsPack(t),this.handleFunctionalPack(t),this.handleLogExtPack(t),this.handleAlaHat(t),this.getAiFeedbackQuery(t),void 0!==(null==t||null==(u=t.content)||null==(d=u.generator)?void 0:d.isSafe)&&1!=+(null==t||null==(h=t.content)||null==(p=h.generator)?void 0:p.isSafe)&&(S=this.data.get("currentRank"),Oa().emit({rank:S})),(x=null==(m=t.content)||null==(g=m.agentInfo)||null==(f=g.agentMeta)?void 0:f[0])&&this.data.set("curAgentInfo",x),"baseData"!==t.type?[3,1]:0!==e||this.data.get("isPc")?[2]:(I=t.content,this.data.merge("baseData",I),this.data.merge("baseData",I),this.data.get("baseData.riskcheckApi")||(T=this.data.get("chatParams.sse_host"),this.data.set("baseData.riskcheckApi",(T||Gt)+Wt.riskcheck)),I.chatHitKunlun===jl?(Hl(_t(this.data.get("query"))),[2]):(this.updateData(),C=on.getState("agentInfo"),L={latest_rank:on.getState("rank")||"0",latest_lid:I.lid||"0",lid:I.lid||"0",apagelid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),setype:"csaitab",pd:"csaitab",agent_id:C.agentId,agent_name:C.agentName,sa:on.getState("sa"),srcid:on.getState("srcid")||"",extForMerge:{csaitab_lid:I.lid||"0",searchid:on.getState("apagelid")||"",tplname:on.getState("tplname")||"",srcid:on.getState("srcid")||"",order:on.getState("order")||""},extlog:{a_order:on.getState("order")||""}},Hn().conversation.resultLog.emit(L),[3,7])))):(Ia().emit({rank:this.data.get("currentRank"),content:v}),this.data.set("closeBottomAlign",!0),nc(),[2]);case 1:return"card"!==t.type?[3,2]:0!==e?[2]:(function(t,e){Mf.apply(this,Array.from(arguments))}(t.content,this),[3,7]);case 2:return A=this.data.get("latestRank"),O=this.data.get("currentRank"),this.handleTextCreateSeperateBub(t),"pc"===rt()?(M=on.getState("connectPreQuery"),q=null==(R=t.options)?void 0:R.qid,O>=A&&(!this.data.get("baseData.query")&&this.data.set("baseData.query",_t(this.data.get("query"))),M&&!this.data.get("baseData.connectPreQuery")&&this.data.set("baseData.connectPreQuery",M),this.data.set("baseData.lid",q),on.dispatch("update",{rank:this.data.get("currentRank"),sa:"",connectPreQuery:"",hideAlaCard:!1}),q&&on.dispatch("update",{lid:q}),Go(q||""),this.updateCurRankInfo(q),q&&this.data.set("baseClickLog.ubcExt",{lid:q,re_rank:O.toString()})),this.data.get("baseData.apagelid")||this.data.set("baseData.apagelid",on.getState("apagelid")),this.data.get("oriLid")||(this.data.set("oriLid",q),on.dispatch("update",{oriLid:q||""})),(null==(j=on.getState("subSession"))?void 0:j.oriLid)||on.dispatch("update",{subSession:ZI({},j,{oriLid:q||""})}),B=on.getState("agentInfo"),H=this.data.get("baseClickLog.extra"),this.data.merge("baseClickLog.extra",ZI({lid:null==(N=t.options)?void 0:N.qid,re_rank:this.data.get("currentRank"),ori_lid:on.getState("oriLid")},B.agentName&&!H.agent_name?{agent_name:B.agentName}:{},B.agentSearchId&&!H.agent_id?{agent_id:B.agentSearchId}:{}))):(O>=A&&on.dispatch("update",{rank:this.data.get("currentRank")}),G=this.data.get("hasStartBottomAlign"),W=this.data.get("closeBottomAlign"),(null==(U=t.content)||null==(F=U.generator)||null==($=F.data)?void 0:$.closeBottomAlign)&&(W=!0,this.data.set("closeBottomAlign",!0),nc()),this.data.get("isBtmAlignSample")||G||W||(this.data.set("hasStartBottomAlign",!0),ec())),z=Ul("prerenderConfirmPromise"),t.content&&t.content.generator&&this.data.set("existAnswer",!0),"reference"===(null==(P=t.content)||null==(D=P.generator)?void 0:D.component)&&(null==(Q=this.ref("answer-generate"))||Q.sendUbcLog({type:"show",value:"sitereach"})),z?[4,z]:[3,4];case 3:X.sent(),X.label=4;case 4:return(J=this.data.get("searchingStepsPromise"))?[4,J]:[3,6];case 5:if(X.sent())return[2];(V=this.data.get("searchingStepsPackOverTimeStart"))&&(this.data.set("overviewBlockFirstTokenDur",(new Date).getTime()-V),this.data.set("searchingStepsPackOverTimeStart",0)),X.label=6;case 6:this.handlerAskData(t,e),this.handleCapsuleData(t,e),this.handlerMockAiService(t),Z=this,(et=null==(Y=t)||null==(tt=Y.content)?void 0:tt.generator)&&"ala-card"===et.component&&et.data.value&&Z.data.set("cardSection.data",et.data),function(t,e){var n,a,i,o,r;if("wise"===rt()&&"ala-card"===(null==t||null==(a=t.content)||null==(n=a.generator)?void 0:n.component)){var s=document.createElement("div"),l=JSON.parse(null==t||null==(r=t.content)||null==(o=r.generator)||null==(i=o.data)?void 0:i.value).singCardContent;s.innerHTML=l,e.currentPageRootDom=s,e.data.set("cardSection.data",l)}}(t,this),this.data.push("generateSection.answer["+e+"].data",t),(K= __get$(on.getState("imageQueryLid"),O) )&&(on.dispatch("update",{lid:K}),this.data.set("baseData.lid",K)),(null==(E=t.options)?void 0:E.qid)&&this.data.set("baseClickLog.extra.cid",t.options.qid),X.label=7;case 7:return[2]}var Y,Z,tt,et}))})).apply(this)},handleTextCreateSeperateBub:function(t){var e,n,a,i,o,r,s,l=null==(e=t.content)?void 0:e.generator,c=["markdownEditor","imageWithThumbnail"].includes((null==l?void 0:l.component)||"");(1===(null==l||null==(n=l.data)?void 0:n.isIndependenGuide)&&(!l.sectionId||l.sectionId<=1)?(l.data.isIndependenGuide=void 0,l.sectionId=1,l.interactiveArea={isHideInteractiveArea:!0,swiperPosDisable:!0,dislikeOptions:{}},this.data.set("separateBub",!0),(null==l?void 0:l.data)&&(l.data.isHideStateBtn=!0)):this.data.get("separateBub")&&l&&(l.sectionId=2,c&&(l.interactiveArea=ZI({isHideInteractiveArea:!0,dislikeOptions:{}},l.interactiveArea||{}),(null==l?void 0:l.data)&&(l.data.isHideStateBtn=!0))),(null==l||null==(a=l.data)?void 0:a.backgroundImage)||(null==l||null==(i=l.data)?void 0:i.bgLinearGradient))&&(l.data.bgProps={backgroundImage:(null==l||null==(o=l.data)?void 0:o.backgroundImage)||"",backgroundImageDark:(null==l||null==(r=l.data)?void 0:r.backgroundImageDark)||"",bgLinearGradient:(null==l||null==(s=l.data)?void 0:s.bgLinearGradient)||""})},handlerMockAiService:function(t){var e,n,a,i,o;if("service"===(null==(n=t.content)||null==(e=n.generator)?void 0:e.component)){var r=(null==(a=t.content)?void 0:a.generator.data)||{},s=r.componentForUIJSON&&r.componentForUIJSON[0];s&& __call$(Object,"assign",[r,ZI({url:(null==(i=s.linkInfo)?void 0:__get$(i,"href"))||(null==(o=s.link)?void 0:o.url),src:s.logo,title:s.title,subTitle:s.caption,button:{text:s.actionText}},s.official?{titleIcon:"https://psstatic.cdn.bcebos.com/basics/chat/official_1716531768000.svg"}:{})]) }},handleHistoryAskData:function(t,e){var n,a=on.getState("rank"),i=this.data.get("currentRank"),o=null==(n=e[0])?void 0:n.agentInfo;if(a===i){t&&this.handlerAskData(null==t?void 0:t.data,0),this.data.set("askSection.show",!0);var r=on.getState("agentInfo");Object.keys(r).length>0?this.data.set("curAgentInfo",r):(this.data.set("curAgentInfo",o),this.data.set("curAgentInfo",o))}},handleCapsuleData:function(t){var e,n,a,i;if("capsule"===(null==(n=t.content)||null==(e=n.generator)?void 0:e.component)||"shortcuts"===(null==(i=t.content)||null==(a=i.generator)?void 0:a.component)){var o,r,s,l,c=null==t||null==(r=t.content)||null==(o=r.generator)?void 0:o.data;(this.data.get("showCapsule")||this.existCard())&&(this.data.set("showCapsule",!0),ya().emit({data:c,rank:this.data.get("currentRank")})),(null==(l=t.content)||null==(s=l.generator)?void 0:s.data)&&this.data.set("shortcutsData",{label:null==c?void 0:c.label,capsuleData:(null==c?void 0:c.value)||(null==c?void 0:c.items)})}},handlerAskData:function(t,e){var n,a,i,o,r=this.data.get("agentInfo"),s=null==(a=t.content)||null==(n=a.generator)?void 0:n.component;if(null==(o=t.content)||null==(i=o.agentInfo)?void 0:i.log_ext){var l,c,d=null==(c=t.content)||null==(l=c.agentInfo)?void 0:l.log_ext;"text"===d.scene&&"text_short"===d.scene_1st&&"text_bless"===d.scene_2nd&&this.data.set("agentInfo",t.content.agentInfo)}if((null==r?void 0:r.log_ext)&&s&&(r.log_ext.groupStyle="imageWithThumbnail"===s?"image":"markdownEditor"===s?"text":r.log_ext.groupStyle,this.data.set("agentInfo",r)),t.content&&t.content.generator){var u=t.content.generator,p=u.rebuildMode;p&&this.data.set("rebuildMode",p),p||(p=this.data.get("rebuildMode"));var h=on.getState("imageQuery"),f=this.data.get("currentRank");if("askBack"===u.component||"questionClosely"===u.component||"input"===u.component){if("questionClosely"===u.component&&this.data.set("recommendWordList",u.data.recommendWord),"input"!==u.component&&(0===e||p===Ut.APPEND)){var g=this.data.get("agentInfo");u.agentInfo=g;var m=p===Ut.APPEND|| __get$(h,f) ;this.sendAskData(u,{allowMultiUpdate:m})}u.component=""}on.getState("agentRecData")&&(this.sendAskData(on.getState("agentRecData")),on.dispatch("update",{agentRecData:null}))}},sendAskData:function(t,e){void 0===e&&(e={});var n=Hn().conversation.askDataInterflow;if(n){var a=this.data.get("currentRank"),i=JSON.parse(JSON.stringify(t)),o=this.data.get("baseData");i.actionLid=o.lid,n.emit({rank:a,params:ZI({generator:i},e)}),this.data.get("baseData.chatGenerate")||this.data.set("askSection.show",!0)}},updateData:function(){var t=this.data.get("baseData"),e=_t(this.data.get("query"));this.data.set("baseClickLog.lid",t.lid);var n=t.logCommonInfo||{},a=n.actionInfo||{},i=n.timeInfo||{},o=on.getState("agentInfo"),r=this.data.get("baseClickLog.extra");this.data.set("baseClickLog.clk_info",a.clkInfo||{}),this.data.merge("baseClickLog.extra",ZI({},a.extra||{},{lid:t.lid,re_rank:this.data.get("currentRank"),ori_lid:on.getState("oriLid")},o.agentName&&!r.agent_name?{agent_name:o.agentName}:{},o.agentSearchId&&!r.agent_id?{agent_id:o.agentSearchId}:{})),this.data.set("baseClickLog.w",JSON.stringify("0_10_"+t.query)),this.data.set("baseTimeLog",i.card||{});var s=this.data.get("chatParams"),l=this.data.get("latestRank");this.data.get("currentRank")>=l&&(on.dispatch("update",{lid:t.lid,rank:this.data.get("currentRank"),query:t.query,preQuery:e,chatParams:ZI({},s,t.chatParams),preChatParms:s,sa:"",connectPreQuery:"",hideAlaCard:!1}),Go(t.lid),this.updateCurRankInfo(t.lid)),t.user&&t.user.isUserLogin&&fs(!0),this.data.get("oriLid")||(Hn().conversation.sendSessionId.emit({sessionId:t.lid}),on.dispatch("update",{oriLid:t.lid}));var c=on.getState("subSession");(null==c?void 0:c.oriLid)||on.dispatch("update",{subSession:ZI({},c,{oriLid:t.lid||""})}),ao(),function(t){if(!isNaN(t)&&"number"==typeof t)for(var e=document.querySelector("body"),n=e.className.split(" "),a=0;a<n.length;a++)if(/^font-size-[0-9]+(\\.?[0-9]+)?$/.test( __get$(n,a) )){ __set$(n,a,Ju(t)) ,e.style.setProperty("--font-size-scale",t.toString()),e.className=n.join(" ");break}}(+t.fontSizeScale||1),this.sendPageComplete({perfInfo:{baseDataTime:String(Date.now())}},"invoke")},isAnswerExposed:function(){var t,e,n=this.data.get("isPc")?null==$l||null==(t=$l.containerDom)?void 0:t.getBoundingClientRect().bottom:window.innerHeight;return((null==(e=this.el)?void 0:e.getBoundingClientRect().bottom)||0)<=n},answerFullShowLog:function(){var t=this.ref("answer-generate");null==t||t.sendUbcLog({type:"show",value:"satisfy_all"})},handleCardSectionVisible:function(){var t=this;Hn().conversation.cardTypingComplete.on((function(e){var n=e.rank,a=e.data,i=e.api,o=e.isHistory,r=t.data.get(),s=r.currentRank,l=r.hideAlaCard;if(s===n){!l&&t.data.set("cardSection.show",!0),t.nextTick((function(){t.data.set("askSection.show",!0),t.data.get("agentRecommendList")&&t.data.set("askSection.show",!1)}));var c=45;t.data.get("closeBottomAlign")&&(c=window.innerHeight),function(t,e){if(t){var n=t.getBoundingClientRect(),a=document.documentElement.clientHeight,i=n.top+n.height-a;i>e&&va().emit({hideHeight:"pc"===rt()?i:e})}}(t.el,c);var d=t.ref("answer-generate");if(function(t,e){if(t&&e){var n=t.getBoundingClientRect(),a=document.documentElement.clientHeight,i=n.top+n.height-a;n.height>=a&&e.sendUbcLog({type:"show",value:"over_screen"}),i>0&&e.sendUbcLog({type:"show",value:"stop_keep_bottom"})}}(t.el,d),kf.triggerEvent("onAnwserEnd",{round_index:n,isHistory:o,data:a,api:i,components:{answerComponent:t}}),t.isAnswerExposed())t.answerFullShowLog();else{var u=function(){t.isAnswerExposed()&&(t.answerFullShowLog(),$l.offScroll(u))};$l.onScroll(u)}}})),this.watch("cardSection.show",(function(e){var n=t.data.get("cardSection"),a=+new Date+"";e&&t.nextTick((function(){t.data.get("isPc")&&n.data?Zh.render("card",n.data,t.ref("htmlDom")).then((function(){var e={generatingStartTime:t.data.get("severPerfInfo.generatingStartTime")+""};t.sendPageComplete({perfInfo:e},"perf")})):t.existCard()&&Bf().then((function(){t.data.set("closeBottomAlign",!0),nc(),window.chatSearchContainer&&window.chatSearchContainer.renderCard&&window.chatSearchContainer.renderCard(t.ref("htmlDom"),n.data,t.currentPageRootDom,{rank:t.data.get("currentRank")}).then((function(e){e.renderStart=a,e.requestStart=t.data.get("requestStart"),e.requestEnd=t.data.get("requestEnd"),t.data.set("cardPerf",e);var n=ZI({generatingStartTime:t.data.get("severPerfInfo.generatingStartTime")+""},e);t.sendPageComplete({perfInfo:n},"perf")}))}))}))}))},sendPageComplete:function(t,e){if(void 0===t&&(t={}),void 0===e&&(e="perf"),!(this.data.get("hasSendPageComplete.perf")&&"perf"===e||this.data.get("hasSendPageComplete.invoke")&&"invoke"===e||this.data.get("hasSendPageComplete.perf")&&this.data.get("hasSendPageComplete.invoke"))){var n=this.data.get("severPerfInfo.dim"),a=this.data.get("baseData"),i=ZI({lid:a.lid,query:a.query,oriLid:on.getState("oriLid"),chatNum:on.getState("rank"),perfInfo:{},startTimeList:on.getState("startTimeList"),naInjectTime:on.getState("naInjectTime")},t);Vs(on.getState("conversationLogId"),i,e,n),this.data.set("hasSendPageComplete."+e,!0)}},existCard:function(){return!(!this.data.get("cardSection.data")||!this.currentPageRootDom)&&!(!this.currentPageRootDom.querySelector(".se-page-bd")||!this.currentPageRootDom.querySelectorAll('.c-result:not([tpl=ai_index]):not([tpl="ai_ask"])').length)},historyCardProcess:function(){var t=this;if(!vt()){var e=this.ref("htmlDom");if(this.data.get("isPc")){var n=this.data.get("answer.cardHtml");n?Zh.render("card",{value:n},this.ref("htmlDom")):this.watch("answer.cardHtml",(function(){Zh.render("card",{value:n},t.ref("htmlDom"))}))}else{var a=null==e?void 0:e.querySelector(te);Bf().then((function(){a&&window.chatSearchContainer&&window.chatSearchContainer.renderCard&&window.chatSearchContainer.renderCard(e,"",e,{rank:t.data.get("currentRank"),hasRendered:!0})&&t.data.set("hasAlaCard",!0)}))}}},closeCard:function(){this.updateFeedbackForm({showCard:!1,feedbackFormData:{},productData:{}})},updateFeedbackForm:function(t){var e=t.showCard,n=t.feedbackFormData,a=t.productData;this.data.set("feedbackForm.showCard",e),this.data.set("feedbackForm.feedbackFormData",n),this.data.set("feedbackForm.productData",a)},updateCurRankInfo:function(t){on.dispatch("update",{curRankInfo:ZI({},on.getState("curRankInfo"),{rank:this.data.get("currentRank"),lid:t,oriLid:on.getState("oriLid")||t})})},handleFeedbackForm:function(t){return YI((function(){var e,n,a,i,o,r,s,l,c,d,u,p;return eT(this,(function(h){switch(h.label){case 0:if(e=t.isAction,n=t.rank,a=t.action,i=t.feedbackFormData,o=t.actionName,r=t.askModel,s=localStorage.getItem(Lf),l={rank:n,actionName:o,baseData:this.data.get("baseData"),recommendWordList:this.data.get("recommendWordList"),isPc:this.data.get("isPc"),askModel:r},this.updateFeedbackForm({showCard:!1,feedbackFormData:{},productData:{}}),!ht()&&!this.data.get("isPc")||ht()&&!ds()||this.data.get("currentRank")!==n)return[2];if(s&&Date.now()<Number(s))return[2];if(c=24*(this.data.get("isPc")?3:2)*60*60*1e3,!e)return[3,5];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Df(a)];case 2:return(d=h.sent())?(u=Ef(ZI({product:d.product},l)),localStorage.setItem(Lf,(Date.now()+c).toString()),this.updateFeedbackForm({showCard:!0,feedbackFormData:d,productData:u}),[3,4]):[2];case 3:return h.sent(),[3,4];case 4:return[3,6];case 5:p=Ef(ZI({product:i.product},l)),"global"===i.position&&i.delayTime||localStorage.setItem(Lf,(Date.now()+c).toString()),this.updateFeedbackForm({showCard:!0,feedbackFormData:i,productData:p}),h.label=6;case 6:return ka().emit({rank:this.data.get("currentRank"),disabled:!0}),[2]}}))})).apply(this)},setChatStatus:function(t){var e=this.data.get("currentRank")>=on.getState("rank")?"":"_OLD";this.dispatch("update-current-chat-status",t),on.dispatch("update",{chatStatus:""+t+e});var n="";switch(t){case Pi.COMPLETE:n=Ei.COMPLETE;break;case Pi.GENERATING:n=Ei.GENERATING;break;case Pi.WAITING:n=Ei.THINKING}this.updateGenerateInfo(n)},updateGenerateInfo:function(t){lt()||this.data.get("currentRank")>=on.getState("rank")&&on.dispatch("update",{generateStatus:t})},watchContentChange:function(){var t=this.data.get("isHistory"),e=this.data.get("isBtmAlignSample"),n=this.data.get("isPc");if(e&&!t){var a=new IntersectionObserver((function(t){t.forEach((function(t){var e=t.boundingClientRect,n=t.rootBounds;n&&e&&e.bottom>=n.bottom-1&&t.isIntersecting&&va().emit({hideHeight:700,showButton:!0})}))}),{root:n?document.getElementById("conversation-flow-container"):null,rootMargin:"0px 0px 10px 0px",threshold:[0,.1,.25,.75,1]});a.observe(this.el),this.data.set("observer",a)}},watchContentFinished:function(){var t=this;this.data.get("isPc")&&Un().on((function(){!t.data.get("hideAlaCard")&&t.data.set("cardSection.show",!0)}))},listenNewChatHideCapsule:null,listenDeleteAgent:null,listenCapsuleShow:null,listenStopToBottomAlign:null,listenFeedbackForm:null,disposed:function(){this.listenNewChatHideCapsule&&Xn().off(this.listenNewChatHideCapsule),this.listenDeleteAgent&&Fs().off(this.listenDeleteAgent),this.listenCapsuleShow&&ya().off(this.listenCapsuleShow),this.listenStopToBottomAlign&&ba().off(this.listenStopToBottomAlign),this.listenFeedbackForm&&ua().off(this.listenFeedbackForm),this.listenNewChatHideCapsule=null,this.listenDeleteAgent=null,this.listenCapsuleShow=null,this.listenStopToBottomAlign=null,this.listenFeedbackForm=null}}));function aT(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function iT(){return iT=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},iT.apply(this,Array.from(arguments))}function oT(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var rT=Tt.connect(on,{topRank:"topRank"})(a.defineComponent({trimWhitespace:"all",components:{"answer-timestamp":xl,"hover-menu":ex},initData:function(){var t=this;return{showMoreBtnOnce:!1,delay:!1,noAnimation:!1,question:{},answer:{},agentInfo:{},agentQuestion:{},showTip:!1,isHistory:!1,initShowHistory:!1,getCopyTarget:function(){return t.ref("agentQuestion")||t.ref("question")},isPc:"pc"===rt(),isLastQuestion:!1,lid:"",questionList:[],isHistoryPageClient:Vo()}},computed:{currentRank:function(){var t=on.getState("qaPairIdDiff");return this.data.get("qaPairId")+t},agentInfoStr:function(){var t=this.data.get("agentInfo");return JSON.stringify(t)},rank:function(){return this.data.get("currentRank")},realQuery:function(){var t=this.data.get("agentQuestion");return t&&this.data.get("agentQuestion.keyword")?t.prefix+t.suffix:this.data.get("question").question},realShowExt:function(){return JSON.stringify({type:"show",value:"change_render",ori_lid:on.getState("oriLid"),lid:this.data.get("lid"),re_rank:String(this.data.get("rank")),setype:"csaitab",query:this.data.get("realQuery")})},formattedQuestion:function(){var t;return Gd((null==(t=this.data.get("question"))?void 0:t.question)||"")}},inited:function(){var t=this.data.get("question.question"),e=on.getState("truncQueryIndexRange");e.length&&(t=t.slice(e[0],e[1]),this.data.set("question.question",t),on.dispatch("update",{truncQueryIndexRange:[]}))},created:function(){var t=on.getState("agentInfo"),e=on.getState("showRiskTip"),n=this.data.get("isHistory");n||on.dispatch("update",{chatStatus:Pi.WAITING}),n||e||!t||"20a8"!==t.agentSearchId||(this.data.set("showTip",!0),on.dispatch("update",{showRiskTip:!0}))},listenLongPressHandler:null,attached:function(){var t,e=this,n=this.data.get("isHistory"),a=null;n?a=this.data.get("agentInfo"):(a=on.getState("agentInfo"),this.data.set("agentInfo",a));var i=this.data.get("question.question");if(a&&a.agentName){(-1===i.indexOf("@"+a.agentName)||this.data.get("isPc")||on.getState("isWiseNewCsaitab"))&&(i=js(a,i));var o=Ts(i,a.startIndex||0,a.endIndex||a.agentName.length);this.data.set("agentQuestion",o)}(this.listenLongPressHandler=US(this,"question"),this.el.addEventListener("mouseenter",(function(){var t,n=e.el.closest(".cs-rank-container[rank]"),a=null==n||null==(t=n.querySelector("[data-delete]"))?void 0:t.getAttribute("data-delete");if(a){var i,o=JSON.parse(a);e.ref("menu")&&e.ref("menu").updateMenu({showDelete:null==o||null==(i=o.deleteQidList)?void 0:i.length})}})),n)||function(t){if(ht()){var e=JSON.stringify({targetId:ur,category:0,text:t}),n=encodeURIComponent(e),a="im_callback_"+ +new Date,i="baiduboxapp://message/updateSessionWithCommand?params="+n+"&callback="+a; __set$(window,a,function(){}) ,cr(i)}}(this.data.get("question.question"));var r=on.getState("csextdata"),s={};try{s=JSON.parse(r)}catch(t){s={}}var l=s.query_text_type||"",c=this.data.get("question").text_type||"",d=on.getState("sample"),u="1"===(null==d||null==(t=d.variables)?void 0:t.AGENT_UQUICK_CHANGE),p=s.functionType||"";this.data.set("hintQuickChange",u),"latex"===l||"latex"===c?(this.handleMathJax(),l&&(delete s.query_text_type,on.dispatch("update",{csextdata:JSON.stringify(s)}))):u&&this.nextTick((function(){e.watchShow()})),"numerologyForm"===p&&(delete s.functionType,on.dispatch("update",{csextdata:JSON.stringify(s)}))},handleHoverIn:function(){Ua({type:"show",value:"card_hover_menu",ext:{ori_lid:on.getState("oriLid"),lid:this.data.get("lid"),re_rank:String(this.data.get("rank")),a_lid:on.getState("apagelid"),setype:"csaitab"}})},watchShow:function(){var t=this,e=_n("#conversation-flow-content"),n=this.data.get("isHistory");this.bodyObserver= new MutationObserver(function(){var a,i=bn(".cs-rank-container",e);i.length&&(_n(".cs-question-bubble",__get$(i,i.length-1))===t.ref("questionBubble")?t.data.get("isLastQuestion")||(t.data.get("realQuery")&&t.data.set("isLastQuestion",!0),(!t.data.get("lid")&&!n)&&t.data.set("lid",on.getState("lid")),t.nextTick(function(){ho();})):(t.data.set("isLastQuestion",!1),a=t.ref("questionBubble"),uo.deleteTransDom(a)));}) ,e&&this.bodyObserver&&this.bodyObserver.observe(e,{childList:!0,subtree:!0,characterData:!0})},disposed:function(){this.listenLongPressHandler&&Ws().off(this.listenLongPressHandler),this.listenLongPressHandler&&Ba().off(this.listenLongPressHandler),this.listenLongPressHandler=null,this.questionObsever&&this.questionObsever.disconnect(),this.bodyObserver&&this.bodyObserver.disconnect()},handleClick:function(){var t,e=this,n=this.data.get("agentInfo"),a={word:this.data.get("question.question").trim(),type:"query"};if(n&&n.agentId&&n.agentName){a.agentInfo=qs(n);var i=a.word;"pc"!==rt()&&-1===i.indexOf("@"+n.agentName)&&(a.word=js(n,i))}var o=this.data.get("questionList");if(o.length>0){var r=null,s=null;o.forEach((function(t){var e,n,a=null==(n=t.data)||null==(e=n.question)?void 0:e.question;a&&("file"===t.type?r=a:"image"===t.type&&(s=Array.isArray(a)?a[0]:a))})),r&&(a.file=r),s&&(a.image=s)}this.data.get("isPc")||zn().emit(a);var l={};this.data.get("hintQuickChange")&&(ba().emit(),setTimeout((function(){e.scrollToTop()}),300),l={is_query_render:this.data.get("isLastQuestion")?"1":"0",ori_lid:on.getState("oriLid"),lid:this.data.get("lid"),re_rank:String(this.data.get("rank")),setype:"csaitab",query:this.data.get("realQuery")}),Ua({type:"click",value:"query_clk",curLid:null==(t=this.data.get("answer").baseData)?void 0:t.lid,sessionId:on.getState("sessionId"),rank:this.data.get("question.currentRank"),ext:iT({agent_id:n.agentId,agent_name:n.agentName},l)})},scrollToTop:function(){var t=this;Kl({element:this.ref("questionBubble"),block:"start",margin:8,behavior:"instant"}),this.data.get("isPc")&&setTimeout((function(){Kl({element:t.ref("questionBubble"),block:"start",margin:8,behavior:"instant"})}),50)},loadJs:function(t){var e=this;return new Promise((function(n,a){if(e.mathScript)n();else{var i=document.getElementsByTagName("script")[0],o=document.createElement("script");o.src=t,o.async=!0,o.id="math-jax-script",i.parentNode.insertBefore(o,i),o.onload=function(){o=null,e.mathScript=document.getElementById("math-jax-script"),n(o)},o.onerror=function(t){o=null,a(t)}}}))},handleMathJax:function(){return(t=function(){var t,e;return oT(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this.loadJs("//yy-s.zuoyebang.cc/static/mathjax_274_for-test/MathJax.js?config=update190725-1")];case 1:return n.sent(),e=this.el,[4,null==(t=window.MathJax)?void 0:t.Hub.Queue(["Typeset",window.MathJax.Hub,e])];case 2:case 3:return n.sent(),[3,4];case 4:return[2]}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){aT(o,a,i,r,s,"next",t)}function s(t){aT(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var t},handleLinkClick:function(t){null==t||t.stopPropagation(),!this.data.get("isPc")&&Ua({type:"click",value:"web_jump",ext:{setype:"csaitab"}})}})),sT={swiperBlock:"swiper-block_1a2le_1","swiper-block":"swiper-block_1a2le_1"},lT={};lT= __call$(Object,"assign",[lT,{questionBlock:"question-block_1by0i_1","question-block":"question-block_1by0i_1",questionLineBreak:"question-line-break_1by0i_5","question-line-break":"question-line-break_1by0i_5",latestQuestion:"latest-question_1by0i_9","latest-question":"latest-question_1by0i_9",latestQuestionLinkContent:"latest-question-link-content_1by0i_17","latest-question-link-content":"latest-question-link-content_1by0i_17",timestampMargin:"timestamp-margin_1by0i_21","timestamp-margin":"timestamp-margin_1by0i_21",topQueryMargin:"top-query-margin_1by0i_24","top-query-margin":"top-query-margin_1by0i_24",agentText:"agent-text_1by0i_27","agent-text":"agent-text_1by0i_27",aiAgentIcon:"ai-agent-icon_1by0i_31","ai-agent-icon":"ai-agent-icon_1by0i_31",questionBubbleAgent:"question-bubble-agent_1by0i_38","question-bubble-agent":"question-bubble-agent_1by0i_38",timestamp:"timestamp_1by0i_21",riskTip:"risk-tip_1by0i_44","risk-tip":"risk-tip_1by0i_44"}]) ,rT.template='\n    <div\n        s-if="{{\n            isHistory || (question.showQuestion && (question.question || (agentQuestion && agentQuestion.keyword)))\n        }}"\n        class="\n            cs-rank\n            cs-enable-selection\n            {{currentRank === topRank && +question.hisRank !== 1? $style[\'top-query-margin\'] : \'\'}}\n        "\n        rank="{{question.currentRank}}"\n        data-agent="{{agentInfoStr}}"\n        data-query="{{question.question}}"\n    >\n        <div s-if="showTip" class="{{$style[\'risk-tip\']}} cos-space-mb-xs">\n            内容由AI生成，仅供参考\n        </div>\n        \x3c!-- 历史会话页面不展示时间戳 --\x3e\n        <answer-timestamp\n            s-if="+question.hisRank === 1 && !initShowHistory && !isPc && !isHistoryPageClient"\n            timestamp="{{question.createTime}}"\n            class="{{$style[\'timestamp\']}} {{currentRank === topRank ? $style[\'timestamp-margin\'] : \'\'}}"\n        />\n        <div\n            s-ref="questionBubble"\n            data-show-area\n            need-show-log="{{isLastQuestion ? \'true\' : \'false\'}}"\n            data-show-ext="{{realShowExt}}"\n            class="cs-question-bubble cs-bubble"\n            on-mouseenter="handleHoverIn"\n        >\n            <div\n                s-if="agentQuestion && agentQuestion.keyword"\n                class="\n                    {{$style[\'question-block\']}}\n                    {{$swperClass.swiperBlock}}\n                    {{delay ? $style[\'cs-bubble-delay\'] : \'\'}}\n                    {{showMoreBtnOnce ? \' cs-bubble-reduce\' : \'\'}}\n                    {{noAnimation ? \'cs-bubble-no-animation\' : \'\'}}\n                    c-fwb\n                "\n                on-click="handleClick"\n            >\n                <span class="{{$style[\'agent-text\']}}">\n                    <span class="{{!isPc ? $style[\'latest-question\'] : \'\'}}">{{ agentQuestion.prefix }}</span>\n                </span>\n                <span class="cs-bubble-agent">\n                    <span class="{{$style[\'agent-text\']}} cos-font-medium">{{ agentQuestion.keyword }}</span>\n                </span>\n                <span\n                    s-ref="agentQuestion"\n                    class="cs-question-text\n                        {{!isPc ? $style[\'latest-question\'] : \'\'}}\n                        {{$style[\'question-line-break\']}}\n                    "\n                >\n                    {{ agentQuestion.suffix }}\n                </span>\n            </div>\n            <div\n                s-else\n                s-ref="agentQuestion"\n                class="\n                    {{$style[\'question-block\']}}\n                    {{$swperClass.swiperBlock}}\n                    {{delay ? $style[\'cs-bubble-delay\'] : \'\'}}\n                    {{showMoreBtnOnce ? \' cs-bubble-reduce\' : \'\'}}\n                    {{noAnimation ? \'cs-bubble-no-animation\' : \'\'}}\n                    c-fwb\n                "\n                on-click="handleClick"\n            >\n                <span class="cs-question-pure-text {{!isPc ? $style[\'latest-question\'] : \'\'}}">\n                    <template s-for="item in formattedQuestion">\n                        <a\n                            s-if="{{item.type === \'link\'}}"\n                            href="{{item.content}}"\n                            target="_blank"\n                            rel="noopener"\n                            on-click="handleLinkClick"\n                            class="{{!isPc ? $style[\'latest-question-link-content\'] : \'\'}}"\n                        >\n                            {{ item.displayText }}\n                        </a>\n                        <span\n                            s-else\n                            class="{{$style[\'question-line-break\']}}"\n                        >{{ item.content }}</span>\n                    </template>\n\n                </span>\n            </div>\n            <hover-menu\n                s-if="isPc"\n                s-ref="menu"\n                rank="{{rank}}"\n                type="question"\n                get-copy-target="{{getCopyTarget}}"\n                status="COMPLETE"\n                question-list="{{questionList}}"\n                agent-info="{{agentInfo}}"\n            />\n        </div>\n    </div>\n';var cT="function"==typeof rT?rT.prototype.initData||dT:rT.initData||dT;function dT(){return{$style:lT,$swperClass:sT}}function uT(){return  __call$(Object,"assign",[{},cT.call(this),{$style:lT,$swperClass:sT}]) }function pT(t,e){return pT=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},pT(t,e)}"function"==typeof rT?rT.prototype.initData=uT:rT.initData=uT;var hT=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).listenImageQueryTabClicked=null,e.listenImageQuerySelectedChange=null,e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pT(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{imageUrl:"",rectList:[],queryHeight:0,rectIndex:0}},n.created=function(){var t=this;this.listenImageQueryTabClicked=function(e){var n=e.index,a=e.rank;t.data.get("rank")===a&&t.data.set("rectIndex",n)},Kn().on(this.listenImageQueryTabClicked),this.listenImageQuerySelectedChange=function(e){var n=e.rank,a=e.rectIndex,i=e.rectList;t.data.get("rank")===n&&(t.data.set("rectIndex",a),t.data.set("rectList",i))},Vn().on(this.listenImageQuerySelectedChange)},n.disposed=function(){this.listenImageQueryTabClicked&&(Kn().off(this.listenImageQueryTabClicked),this.listenImageQueryTabClicked=null),this.listenImageQuerySelectedChange&&(Vn().off(this.listenImageQuerySelectedChange),this.listenImageQuerySelectedChange=null)},n.attached=function(){var t=this;this.judgeNumberLeft(),this.watch("rectIndex",(function(){t.nextTick((function(){t.judgeNumberLeft()}))}))},n.judgeNumberLeft=function(){var t=this.data.get("rectIndex"),e=this.ref("number"+t),n=this.ref("box"+t).getBoundingClientRect().left;e.getBoundingClientRect().left<n&&(e.style.right="unset")},e}(a.Component);hT.filters={formatBoxStyle:function(t){var e=this.data.get("imgContainWidth"),n=this.data.get("imgContainHeight");return"width: "+t.width*e+"px; height: "+t.height*n+"px; top: "+t.top*n+"px; left: "+t.left*e+"px"},formatCornerStyle:function(t,e){var n=this.data.get("imgContainWidth"),a=this.data.get("imgContainHeight"),i=this.data.get("queryHeight"),o=t.left*n,r=t.width*n,s=t.top*a,l=o+r-12+2,c=o-2,d=s-2,u=(a-i)/2,p=s+t.height*a-12+2;return l>n-12&&l<=n&&(l=n-12),c<0&&c>=-12&&(c=0),d>=u-5&&d<u+5&&(d=u+5),p>i-15+u&&p<=i+u&&(p=i-15+u),"lt"===e?"top: "+d+"px; left: "+c+"px;":"rt"===e?"top: "+d+"px; left: "+l+"px;":"lb"===e?"top: "+p+"px; left: "+c+"px;":"rb"===e?"top: "+p+"px; left: "+l+"px;":void 0}};var fT={};fT= __call$(Object,"assign",[fT,{imageQueryGraphMask:"image-query-graph-mask_15t3i_1","image-query-graph-mask":"image-query-graph-mask_15t3i_1",imageQueryGraphBox:"image-query-graph-box_15t3i_9","image-query-graph-box":"image-query-graph-box_15t3i_9",imageQueryGraphBoxImg:"image-query-graph-box-img_15t3i_16","image-query-graph-box-img":"image-query-graph-box-img_15t3i_16",imageQueryGraphBoxNumber:"image-query-graph-box-number_15t3i_19","image-query-graph-box-number":"image-query-graph-box-number_15t3i_19",imageQueryGraphBoxPoint:"image-query-graph-box-point_15t3i_38","image-query-graph-box-point":"image-query-graph-box-point_15t3i_38",imageQueryGraphBoxPointLt:"image-query-graph-box-point-lt_15t3i_45","image-query-graph-box-point-lt":"image-query-graph-box-point-lt_15t3i_45",imageQueryGraphBoxPointLb:"image-query-graph-box-point-lb_15t3i_48","image-query-graph-box-point-lb":"image-query-graph-box-point-lb_15t3i_48",imageQueryGraphBoxPointRt:"image-query-graph-box-point-rt_15t3i_51","image-query-graph-box-point-rt":"image-query-graph-box-point-rt_15t3i_51",imageQueryGraphBoxPointRb:"image-query-graph-box-point-rb_15t3i_54","image-query-graph-box-point-rb":"image-query-graph-box-point-rb_15t3i_54",imageQueryGraphBoxQuestion:"image-query-graph-box-question_15t3i_57","image-query-graph-box-question":"image-query-graph-box-question_15t3i_57"}]) ,hT.template="\n    <div class=\"{{$style['image-query-graph-mask']}}\">\n    <fragment s-for=\"item, index in rectList\">\n        <fragment s-if=\"index === rectIndex\">\n            <div\n                s-ref=\"{{'box' + index}}\"\n                class=\"{{$style['image-query-graph-box']}} image-query-graph-box\"\n                style=\"{{item | formatBoxStyle}}\"\n            >\n                <img\n                    s-if=\"imageUrl\"\n                    class=\"{{$style['image-query-graph-box-img']}}\"\n                    src=\"{{imageUrl}}\"\n                    style=\"width: {{imgContainWidth + 'px'}}; height: {{imgContainHeight + 'px'}}; top: {{-item.top * imgContainHeight + 'px'}}; left: {{-item.left * imgContainWidth + 'px'}}\"\n                />\n                <div s-ref=\"{{'number' + index}}\" class=\"{{$style['image-query-graph-box-number']}} image-query-graph-box-number\">\n                    <span>{{index + 1}}</span>\n                </div>\n            </div>\n            <div class=\"{{$style['image-query-graph-box-point']}} {{$style['image-query-graph-box-point-lt']}}\" style=\"{{item | formatCornerStyle('lt')}}\"></div>\n            <div class=\"{{$style['image-query-graph-box-point']}} {{$style['image-query-graph-box-point-rt']}}\" style=\"{{item | formatCornerStyle('rt')}}\"></div>\n            <div class=\"{{$style['image-query-graph-box-point']}} {{$style['image-query-graph-box-point-lb']}}\" style=\"{{item | formatCornerStyle('lb')}}\"></div>\n            <div class=\"{{$style['image-query-graph-box-point']}} {{$style['image-query-graph-box-point-rb']}}\" style=\"{{item | formatCornerStyle('rb')}}\"></div>\n        </fragment>\n        <div\n            class=\"{{$style['image-query-graph-box-question']}}\"\n            style=\"{{item | formatBoxStyle}}\"\n        ></div>\n    </fragment>\n";var gT="function"==typeof hT?hT.prototype.initData||mT:hT.initData||mT;function mT(){return{$style:fT}}function vT(){return  __call$(Object,"assign",[{},gT.call(this),{$style:fT}]) }function yT(t,e){return yT=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yT(t,e)}"function"==typeof hT?hT.prototype.initData=vT:hT.initData=vT;var wT=265.5,bT=236,_T=177,kT=177,ST=1.5,xT=.75,IT=1,TT=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yT(t,e)}(e,t);var n=e.prototype;return n.created=function(){var t=this.data.get("width")/this.data.get("height"),e=this.calcImgContain(t),n=e.queryWidth,a=e.queryHeight,i=e.imgWidth,o=e.imgHeight;e.imgTop,e.imgLeft;var r=e.centerStyle;this.data.set("queryHeight",a),this.data.set("containStyle","width: "+n+"px; height: "+a+"px"),this.data.set("imgStyle","width: "+i+"px; height: "+o+"px;"+(r||"")),this.data.set("imgContainHeight",o),this.data.set("imgContainWidth",i)},n.initData=function(){return{showLoading:!1,showError:!1,showQuery:!0,showImage:!0,showRetry:!1,containStyle:"width: auto; height: auto",imgStyle:"width: auto; height: auto",imgContainHeight:0,imgContainWidth:0}},n.attached=function(){this.dispatch("image-query-box:show-log",{ubcId:"17132",page:"resultpage",type:"show",value:"question_result"})},n.calcImgContain=function(t){void 0===t&&(t=1);return t>ST?{queryWidth:wT,queryHeight:kT,imgHeight:kT,imgWidth:kT*t,imgLeft:(kT*t-wT)/2,imgTop:0,centerStyle:"position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%)"}:t>IT&&t<=ST?{queryWidth:wT,queryHeight:wT/t,imgHeight:wT/t,imgWidth:wT,imgLeft:0,imgTop:0}:t<IT&&t>=xT?{queryWidth:bT*t,queryHeight:bT,imgWidth:bT*t,imgHeight:bT,imgLeft:0,imgTop:0}:t<xT?{queryWidth:_T,queryHeight:bT,imgWidth:_T,imgHeight:_T/t,imgTop:(_T/t-bT)/2,imgLeft:0,centerStyle:"position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%)"}:{queryWidth:wT,queryHeight:bT,imgWidth:wT,imgHeight:bT,imgTop:0,imgLeft:0}},n.handleImgLoadError=function(){this.handleImgError(!0),this.data.set("showRetry",!0)},n.handleImgError=function(t){void 0===t&&(t=!1),this.data.set("showLoading",!1),this.data.set("showQuery",!0),t||(this.data.set("showImage",!1),this.data.set("showError",!0))},n.handleImgQueryClick=function(){var t=this.data.get("realImageUrl");this.dispatch("image-query-question:click",t)},n.handleRetry=function(){ca().emit()},e}(a.Component);TT.components={mask:hT},TT.computed={shouldShowImageQueryMask:function(){var t=this.data.get("ext")||this.data.get("historyQuery").ext,e=this.data.get("imgContainHeight"),n=this.data.get("imgContainWidth");return t&&t.rectList&&t.rectList.length&&e&&n},realImageUrl:function(){var t=this.data.get("isHistory"),e=this.data.get("historyQuery"),n=this.data.get("imageUrl"),a=this.data.get("imageB64");return t?null==e?void 0:e.imageUrl:n||a},realRectIndex:function(){var t,e=this.data.get("isHistory"),n=this.data.get("historyQuery"),a=this.data.get("ext");return e?(null==n?void 0:n.rectIndex)?n.rectIndex:null==n||null==(t=n.ext)?void 0:t.rectIndex:null==a?void 0:a.rectIndex},realRectList:function(){var t,e=this.data.get("isHistory"),n=this.data.get("historyQuery"),a=this.data.get("ext");return e?(null==n?void 0:n.rectList)?n.rectList:null==n||null==(t=n.ext)?void 0:t.rectList:null==a?void 0:a.rectList}};var CT={};CT= __call$(Object,"assign",[CT,{imageQueryContain:"image-query-contain_accfk_1","image-query-contain":"image-query-contain_accfk_1",imageQueryTool:"image-query-tool_accfk_7","image-query-tool":"image-query-tool_accfk_7",imageQueryImgWrapper:"image-query-img-wrapper_accfk_17","image-query-img-wrapper":"image-query-img-wrapper_accfk_17",imageQueryImgWrapperShow:"image-query-img-wrapper-show_accfk_29","image-query-img-wrapper-show":"image-query-img-wrapper-show_accfk_29",chatBubbleFadeOut:"chatBubbleFadeOut_accfk_1",imageQueryImgContain:"image-query-img-contain_accfk_32","image-query-img-contain":"image-query-img-contain_accfk_32",imageQueryImg:"image-query-img_accfk_17","image-query-img":"image-query-img_accfk_17",imageQueryLoadingContain:"image-query-loading-contain_accfk_39","image-query-loading-contain":"image-query-loading-contain_accfk_39",imageQueryLoading:"image-query-loading_accfk_39","image-query-loading":"image-query-loading_accfk_39",rotateAni:"rotateAni_accfk_1",imageQueryError:"image-query-error_accfk_57","image-query-error":"image-query-error_accfk_57",imageQueryErrorImg:"image-query-error-img_accfk_68","image-query-error-img":"image-query-error-img_accfk_68",imageQueryRetry:"image-query-retry_accfk_74","image-query-retry":"image-query-retry_accfk_74",imageQueryRetryIcon:"image-query-retry-icon_accfk_77","image-query-retry-icon":"image-query-retry-icon_accfk_77"}]) ,TT.template='\n    <div class="{{$style[\'image-query-contain\']}}">\n        <div class="{{$style[\'image-query-tool\']}}">\n            <div s-show="showRetry"\n                class="{{$style[\'image-query-retry\']}}"\n                on-click="handleRetry">\n                <i class="{{$style[\'image-query-retry-icon\']}} cu-icon">&#xe61e;</i>\n            </div>\n        </div>\n        <div class="{{$style[\'image-query-img-wrapper\']}} {{showQuery ? $style[\'image-query-img-wrapper-show\'] : \'\'}}"\n            s-ref="contain"\n            style="{{containStyle}}"\n            on-click="handleImgQueryClick"\n            data-no-na-dialog="true"\n        >\n            <div s-ref="img"\n                s-show="showImage"\n                class="{{$style[\'image-query-img-contain\']}}"\n                style="{{imgStyle}}">\n                <img class="{{$style[\'image-query-img\']}}"\n                    src="{{realImageUrl}}"\n                    on-error="handleImgLoadError($event)"/>\n                <mask\n                    s-if="shouldShowImageQueryMask"\n                    queryHeight="{{queryHeight}}"\n                    imgContainHeight="{{imgContainHeight}}"\n                    imgContainWidth="{{imgContainWidth}}"\n                    imageUrl="{{realImageUrl}}"\n                    rank="{{rank}}"\n                    rectList="{{realRectList}}"\n                    rectIndex="{{realRectIndex}}"/>\n            </div>\n            <div s-show="showLoading" class="{{$style[\'image-query-loading-contain\']}}">\n                <div class="{{$style[\'image-query-loading\']}}"></div>\n            </div>\n            <div s-show="showError" class="{{$style[\'image-query-error\']}}">\n                <div class="{{$style[\'image-query-error-img\']}}"></div>\n                <div class="cos-space-mt-xxs cos-color-text-slim cos-text-body">无法展示</div>\n            </div>\n        </div>\n    </div>\n';var LT,DT="function"==typeof TT?TT.prototype.initData||PT:TT.initData||PT;function PT(){return{$style:CT}}function ET(){return  __call$(Object,"assign",[{},DT.call(this),{$style:CT}]) }"function"==typeof TT?TT.prototype.initData=ET:TT.initData=ET,function(t){t.LOADING="loading",t.SUCCESS="success",t.ERROR="error"}(LT||(LT={}));var AT=a.defineComponent({template:'\n        <div class="image-item-container"\n            style="{{class === \'auto\' ? (imgWidth > imgHeight ? \'width: 265.5px\' : \'width: 177px\') : \'\'}} "\n        >\n            <cos-image\n                src="{{src}}"\n                placeholder=""\n                class="cos-image-fit-cover cos-image-position-center\n                    {{class === \'default\' || imgWidth === imgHeight\n                    ? \'cos-image-1-1\'\n                    : (imgWidth > imgHeight ? \'cos-image-3-2\' : \'cos-image-3-4\')}}\n                "\n            >\n                \x3c!-- 图片资源上传中的状态展示 --\x3e\n                <div\n                    s-if="{{status === \'loading\'}}"\n                    class="loading-block"\n                >\n                    <cos-loading text="" />\n                </div>\n\n                \x3c!-- 图片资源上传失败的状态展示 --\x3e\n                <div\n                    s-if="{{status === \'error\'}}"\n                    class="error-block"\n                >\n                    <cos-icon name="info-circle-fill" class="icon" />\n                </div>\n            </cos-image>\n            <div\n                s-if="isShowAiEdit"\n                class="ai-edit-wrapper"\n                on-click="handleClickEdit"\n                data-show-area\n                data-show-ext="{{ubcShowExt}}"\n            >\n                <img\n                    class="ai-edit-icon"\n                    src="https://gips0.baidu.com/it/u=401145764,136222818&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f54_54"\n                />\n                <span class="ai-edit-text">\n                    修图\n                </span>\n            </div>\n        </div>\n    ',components:{"cos-image":e.Image,"cos-loading":e.Loading,"cos-icon":e.Icon},initData:function(){return{path:"",src:"",status:LT.SUCCESS,class:"default",imgWidth:0,imgHeight:0,isBaiduBoxNotArkWeb:ft()}},attached:function(){var t=this;if("auto"===this.data.get("class")){var e=this.data.get("src");e&&this.autoFitImage(e),this.watch("src",(function(e){t.autoFitImage(e)}))}},autoFitImage:function(t){var e=this,n=new Image;n.src=t,n.onload=function(){e.data.set("imgWidth",(null==n?void 0:n.width)||0),e.data.set("imgHeight",(null==n?void 0:n.height)||0)}},handleClickEdit:function(t){t.stopPropagation(),Ua({type:"click",value:"upload_pic_retouch",ext:{ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:String(+on.getState("rank"))}}),aw(this.data.get("src"))},computed:{ubcShowExt:function(){return JSON.stringify({value:"upload_pic_retouch"})},isShowAiEdit:function(){return on.getState("urlInfo").picEditBaseUrl&&this.data.get("isBaiduBoxNotArkWeb")}}});function OT(){return OT=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},OT.apply(this,Array.from(arguments))}function RT(t,e){for(var n=[],a=0;a<t.length;a+=e)n.push(t.slice(a,a+e));return n}var NT,MT=a.defineComponent({template:'\n        <div class="image-group-container">\n            <div class="image-group-block">\n                <div\n                    s-if="isSingleImage"\n                    class="image-group-single-item"\n                    on-click="handlePreview(isSingleImage, 0, imageGroup)"\n                >\n                    <image-item class="auto" s-bind="{{isSingleImage}}" />\n                </div>\n                <fragment s-for="rowItem, rowIndex in imageRowGroups">\n                    <div\n                        class="\n                            cos-row cos-row-col-12 cos-justify-end cos-gutter\n                            {{rowIndex < imageRowGroups.length - 1 ? \'image-group-row\' : \'\'}}\n                        "\n                        style="--cos-grid-gutter: 8px"\n                    >\n                        <fragment s-for="item, itemIndex in rowItem">\n                            <div\n                                class="cos-col-4"\n                                on-click="\n                                    handlePreview(item, imageRowGroups[0].length * rowIndex + itemIndex, imageGroup)\n                                "\n                            >\n                                <image-item s-bind="{{item}}" />\n                            </div>\n                        </fragment>\n                    </div>\n                </fragment>\n            <div>\n        </div>\n    ',components:{"image-item":AT},initData:function(){return{imageGroup:[],isSingleImage:void 0,imageRowGroups:[]}},computed:{isSingleImage:function(){var t=this.data.get("imageGroup");if(t&&1===t.length)return OT({class:"auto"},t[0])},imageRowGroups:function(){var t=this.data.get("imageGroup");return t&&t.length>1?4===t.length?RT(t,2):RT(t,3):[]}},handlePreview:function(t,e,n){t.status===LT.SUCCESS&&this.fire("preview-image",{urls:n.map((function(t){return t.src})),current:""+e})}});function qT(){return qT=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},qT.apply(this,Array.from(arguments))}!function(t){ __set$(t,t.UNACTIVE=0,"UNACTIVE") , __set$(t,t.ACTIVE=1,"ACTIVE") , __set$(t,t.EXPIRED=2,"EXPIRED") }(NT||(NT={}));var jT=Tt.connect(on,{topRank:"topRank",qaPairIdDiff:"qaPairIdDiff"})(a.defineComponent({components:{"image-query":TT,"image-group":MT},initData:function(){return{type:"image",question:{},isHistory:!1,isFinished:!1,invalidBgUrl:"pc"===rt()?"https://psstatic.cdn.bcebos.com/basics/chat/pc-image-invalid_1734763307000.png":"https://psstatic.cdn.bcebos.com/basics/chat/wise-image-invalid_1734763300000.png"}},computed:{singleImage:function(){var t,e=this.data.get("question.question");return e?(Array.isArray(e)||(e=[e]),1===e.length&&((null==(t=e[0].ext)?void 0:t.rectList)||e[0].rectList)?e[0]:null):null},valid:function(){var t,e=this.data.get("question.question");return!!e&&(Array.isArray(e)?2!==(null==(t=e[0])?void 0:t.imageStatus):2!==e.imageStatus)},currentRank:function(){var t=on.getState("qaPairIdDiff");return this.data.get("qaPairId")+t}},messages:{"image-query-question:click":function(t){var e,n=this.data.get("isHistory"),a=this.data.get("question"),i=null==a||null==(e=a.question[0])?void 0:e.imageInfo;if(!n&&i){var o=on.getState("imageQuery")||{},r=this.data.get("currentRank");i&&(i.srcp="csaitab_photoquestions"),i.imageType="QUESTION",i.params={rank:r}, __get$(o,r) &&(i.rectList= __get$(o,r) .rectList,i.rectIndex= __get$(o,r) .rectIndex),Hn().conversation.showImageEdit.emit(i);var s=on.getState("oriLid"),l=r+"",c=on.getState("lid");Ua({ubcId:"17132",page:"resultpage",type:"click",value:"question_result",ext:{ctse_id:on.getState("conversationLogId"),ori_lid:s,lid:c,re_rank:l,setype:"csaitab"}})}else xg(t.value,0,"question_query")},"image-query-box:show-log":function(t){var e=on.getState("oriLid"),n=on.getState("rank")+"",a=on.getState("lid");Ua(qT({},t.value,{ext:{ori_lid:e,lid:a,re_rank:n,setype:"csaitab"}}))}},created:function(){var t=on.getState("agentInfo"),e=on.getState("showRiskTip");this.data.get("isHistory")||e||!t||"20a8"!==t.agentSearchId||(this.data.set("showTip",!0),on.dispatch("update",{showRiskTip:!0}))},listenUpdateImageQuery:null,attached:function(){var t=this,e=this.data.get("type"),n=this.data.get("question.question[0].imageInfo"),a=n||{},i=a.imageB64,o=a.sign,r=a.token,s=a.rectList,l=void 0===s?[]:s,c=a.rectIndex,d=void 0===c?0:c,u=a.bigSign;if("image"===e){var p=on.getState("imageQuery"),h=this.data.get("currentRank"); __set$(p,h,n?{rectList:l,rectIndex:d,imageInfo:{imageB64:i,sign:o,token:r,bigSign:u}}:{imageUpload:!0}) ,on.dispatch("update",{imageQuery:qT({},p)})}var f=this.getImageGroup();this.data.set("imageGroup",f),this.data.get("isHistory")||(this.listenUpdateImageQuery=function(e){t.data.get("currentIndex")!==e.index||t.data.get("isFinished")||(t.data.set("isFinished",!0),"abort"!==e.action?t.updateImageQuery(e.query):t.abortImageQuery())},wa().on(this.listenUpdateImageQuery))},disposed:function(){this.listenUpdateImageQuery&&(wa().off(this.listenUpdateImageQuery),this.listenUpdateImageQuery=null)},getImageGroup:function(){var t,e=this.data.get("question.question");return e?(Array.isArray(e)||(e=[e]),this.data.set("currentIndex",null==(t=e[0])?void 0:t.index),e.map((function(t){return{src:t.imageUrl?t.imageUrl:t.imageB64,status:t.status||"success"}}))):[]},updateImageQuery:function(t){if(t&&Array.isArray(t)&&0!==t.length){var e=t.map((function(t){return{src:t.imageUrl,status:t.status}}));this.data.set("imageGroup",e)}},abortImageQuery:function(){var t=this.data.get("imageGroup"),e=[];t.forEach((function(t){e.push(qT({},t,{status:"error"}))})),this.data.set("imageGroup",e)},handlePreviewImage:function(t){xg(t.urls,+t.current,"question_query")}})),BT={};BT= __call$(Object,"assign",[BT,{topQueryMargin:"top-query-margin_8h14r_1","top-query-margin":"top-query-margin_8h14r_1",imageWrapper:"image-wrapper_8h14r_4","image-wrapper":"image-wrapper_8h14r_4",invalidImage:"invalid-image_8h14r_14","invalid-image":"invalid-image_8h14r_14",invalidImageBg:"invalid-image-bg_8h14r_19","invalid-image-bg":"invalid-image-bg_8h14r_19"}]) ,jT.template='\n    <div\n        class="cs-rank {{currentRank === topRank && +question.hisRank !== 1? $style[\'top-query-margin\'] : \'\'}}"\n        rank="{{question.currentRank}}"\n        data-share-disabled="1"\n    >\n        <div>\n            <div\n                s-if="!valid"\n                class="{{$style[\'invalid-image\']}}"\n            >\n                <img\n                    class="{{$style[\'invalid-image-bg\']}}"\n                    src="{{invalidBgUrl}}"\n                />\n            </div>\n            <image-query\n                s-else-if="singleImage"\n                s-bind="singleImage"\n                is-history="{{isHistory}}"\n                rank="{{currentRank}}"\n                history-query="{{singleImage}}"\n            />\n            <image-group\n                s-else\n                class="{{$style[\'image-wrapper\']}}"\n                image-group="{{imageGroup}}"\n                on-preview-image="handlePreviewImage"\n            />\n        </div>\n    </div>\n';var HT,$T="function"==typeof jT?jT.prototype.initData||FT:jT.initData||FT;function FT(){return{$style:BT}}function UT(){return  __call$(Object,"assign",[{},$T.call(this),{$style:BT}]) }"function"==typeof jT?jT.prototype.initData=UT:jT.initData=UT,function(t){ __set$(t,t.UNACTIVE=0,"UNACTIVE") , __set$(t,t.ACTIVE=1,"ACTIVE") , __set$(t,t.EXPIRED=2,"EXPIRED") }(HT||(HT={}));var GT=a.defineComponent({initData:function(){return{fileName:"",fileUri:"",fileUrl:"",filePath:"",fileSize:0,fileStatus:0,fileType:"",isExtension:vt(),isPc:"pc"===rt()}},computed:{getFileType:function(){return hi(this.data.get("fileType"),this.data.get("fileName"))},getFileIconUrl:function(){var t=this.data.get("getFileType");return  __get$(me,t) ||""},getFileSize:function(){var t=this.data.get("fileSize");return t?mi(t):""},isValid:function(){var t=this.data.get("fileStatus");return void 0!==t&&t!==HT.EXPIRED}},openNewWindowFile:function(){var t=this.data.get("isValid"),e=this.data.get("fileUrl");if(t&&e){var n= __call$(e,"replace",[/^https?:\/\//,"//"]) ;e&&window.open(this.data.get("isExtension")?e:n,"_blank")}},downloadFile:function(){if(!this.data.get("isPc")&&(Ua({type:"click",value:"file_preview_query"}),ft()&&di(ci(),"15.10")>=0)){var t={file_uri:this.data.get("fileUri"),file_url:this.data.get("fileUrl"),file_name:this.data.get("fileName")};Hn().conversation.openFile.emit(t)}else this.openNewWindowFile()}}),WT={};WT= __call$(Object,"assign",[WT,{fileBox:"file-box_1e52p_1","file-box":"file-box_1e52p_1",fileFail:"file-fail_1e52p_13","file-fail":"file-fail_1e52p_13",fileIcon:"file-icon_1e52p_16","file-icon":"file-icon_1e52p_16",fileInfo:"file-info_1e52p_21","file-info":"file-info_1e52p_21",fileName:"file-name_1e52p_29","file-name":"file-name_1e52p_29",fileType:"file-type_1e52p_33","file-type":"file-type_1e52p_33",fileHint:"file-hint_1e52p_46","file-hint":"file-hint_1e52p_46",wiseFileBox:"wise-file-box_1e52p_52","wise-file-box":"wise-file-box_1e52p_52"}]) ,GT.template="\n    <div\n        class=\"\n            {{isPc ? $style['file-box'] : $style['wise-file-box']}}\n            {{!isValid ? $style['file-fail'] : ''}}\n        \"\n        on-click=\"downloadFile\"\n    >\n        <img\n            class=\"{{$style['file-icon']}}\"\n            src=\"{{getFileIconUrl}}\"\n        />\n        <div class=\"{{$style['file-info']}}\">\n            <p\n                class=\"{{$style['file-name']}} cos-line-clamp-1\"\n            >\n                {{ fileName }}\n            </p>\n            <p\n                s-if=\"!isValid\"\n                class=\"{{$style['file-hint']}}\"\n            >\n                <span>该文件已失效</span>\n            </p>\n            <p s-else>\n                <span class=\"{{$style['file-type']}}\">{{ getFileType }}</span><span>{{ getFileSize }}</span>\n            </p>\n        </div>\n    </div>\n";var zT="function"==typeof GT?GT.prototype.initData||QT:GT.initData||QT;function QT(){return{$style:WT}}function JT(){return  __call$(Object,"assign",[{},zT.call(this),{$style:WT}]) }"function"==typeof GT?GT.prototype.initData=JT:GT.initData=JT;var VT=a.defineComponent({components:{"file-box":GT,"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem},initData:function(){return{type:"file",question:{},isHistory:!1,isFinished:!1}},listenHitResponseRisk:null,attached:function(){var t=this,e=this.data.get("isHistory"),n=on.getState("qaPairIdDiff"),a=this.data.get("qaPairId")+n;this.listenHitResponseRisk=function(e){a===e.rank&&t.data.set("question.question.fileStatus",HT.EXPIRED)},!e&&Oa().on(this.listenHitResponseRisk)},disposed:function(){this.listenHitResponseRisk&&(Oa().off(this.listenHitResponseRisk),this.listenHitResponseRisk=null)}}),KT={};KT= __call$(Object,"assign",[KT,{fileWrapper:"file-wrapper_1xgb1_1","file-wrapper":"file-wrapper_1xgb1_1",fileSwiperWrapper:"file-swiper-wrapper_1xgb1_5","file-swiper-wrapper":"file-swiper-wrapper_1xgb1_5"}]) ,VT.template='\n    <div\n        s-if="{{question.question}}"\n        class="\n            cs-rank\n            {{$style[\'file-swiper-wrapper\']}}\n        "\n        rank="{{question.currentRank}}"\n        data-share-disabled="1"\n    >\n        <cos-swiper>\n            <cos-swiper-item s-for="item, index in question.question">\n                <file-box\n                    class="{{$style[\'file-wrapper\']}}"\n                    file-name="{{item.fileName}}"\n                    file-url="{{item.fileUrl}}"\n                    file-size="{{item.fileSize}}"\n                    file-status="{{item.fileStatus}}"\n                    file-uri="{{item.fileUri}}"\n                ></file-box>\n            </cos-swiper-item>\n        </cos-swiper>\n    </div>\n';var XT="function"==typeof VT?VT.prototype.initData||YT:VT.initData||YT;function YT(){return{$style:KT}}function ZT(){return  __call$(Object,"assign",[{},XT.call(this),{$style:KT}]) }function tC(){return tC=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},tC.apply(this,Array.from(arguments))}"function"==typeof VT?VT.prototype.initData=ZT:VT.initData=ZT;var eC=Tt.connect(on,{user:"user"})(a.defineComponent({trimWhitespace:"all",template:'\n    <div\n        class="agent-greeting-container"\n        s-ref="agent-greeting"\n    >\n        <div class="greeting-container">\n            <div class=\'cs-guide-header\'>\n            </div>\n            <div on-click="goToAgent($event, agentInfo)">\n                <div class="avatar-container">\n                    <img\n                        class="avatar"\n                        src="{{agentInfo.logo}}"\n                    />\n                </div>\n                <span\n                    class="agent-name"\n                    on-click="goToAgent($event, agentInfo)"\n                >\n                    {{agentInfo.agentName}}\n                </span>\n                <span class="agent-desc">\n                    {{agentInfo.description}}\n                </span>\n            </div>\n        </div>\n        <div class="rec-container" data-show-area>\n            <ai-ask-entrance\n                s-if="!isNewConversationLaunched"\n                s-ref="askComponent"\n                s-bind="{{questionCloselyData}}"\n                sa="{{sa}}"\n                isAgentGreeting="{{true}}"\n            />\n        </div>\n    </div>\n    ',components:{"ai-ask-entrance":jp},initData:function(){return{isNewConversationLaunched:!1,sa:"",agentInfo:{agentId:"",agentName:"",desc:"",guides:[]},scrollTop:!1,isExtension:vt()}},computed:{questionCloselyData:function(){var t=this.data.get("agentInfo");return{askComponentData:{component:"questionClosely",data:{recommendWord:(t.guides||[]).map((function(t){return{text:t}})),type:"primary",emptyDisabled:!0,isSingleCol:"1",jumpTypes:["multiSearch"],hideAskItem:!0,context:{app:"bdbox",scene:"chat-search"},toChatSearch:!0,componentArea:"agent_guide_switch"},sa:this.data.get("sa"),agentInfo:t}}}},goToAgent:function(t,n){var a,i;if(this.data.get("isExtension"))e.Toast.info({message:"请到网页版使用",duration:2e3});else{if("pc"===rt()){var o,r,s=As((null==(o=n.jumpUrl)?void 0:o.h5)||(null==(r=n.jump_url)?void 0:r.h5));if(s){var l=tC({},n,{realUrl:s});ma().emit(l)}}var c=(null==(a=n.jumpUrl)?void 0:a.zbios)||(null==(i=n.jump_url)?void 0:i.zbios);if(c){var d=Es(c,{});this.dispatch("send-log",{cyc:1,action:"agent_head",target:t.target}),Pp(d)}}},handleNewConversation:function(){ra().emit(this.el.offsetHeight),this.data.set("isNewConversationLaunched",!0)},listenNewConversation:null,attached:function(){var t=this,e=this.data.get("agentInfo"),n=this.data.get("agentInfo"),a=n.agentSearchId,i=n.agentName,o=n.guides,r=void 0===o?[]:o,s="pc"===rt();ds()&&zn().emit({word:s?"":"@"+i,agentInfo:tC({startIndex:0,endIndex:i.length},qs(e)),noClear:!0,invokeKeyboard:0}),on.dispatch("update",{agentInfo:tC({},e,{startIndex:0,endIndex:i.length})}),this.data.get("scrollTop")&&setTimeout((function(){Kl({element:t.el,block:"start"})}),100),Ua({rank:on.getState("rank"),type:"show",value:"agent_guide",ext:{agent_id:a,agent_name:i,valueInfo:r.map((function(t,e){return{guide_pos:e+1,guide_info:t}}))}}),this.listenNewConversation=function(){t.handleNewConversation()},Jn().on(this.listenNewConversation),Xn().on(this.listenNewConversation),Yn().on(this.listenNewConversation)},disposed:function(){this.listenNewConversation&&(Jn().off(this.listenNewConversation),Xn().off(this.listenNewConversation),Yn().off(this.listenNewConversation),this.listenNewConversation=null)}})),nC=a.defineComponent({template:"",initData:function(){return{title:"AI 智能回答，开启搜索新体验！",iconUrl:"https://gips1.baidu.com/it/u=142336869,1631836133&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f102_102"}},popupHandler:null,created:function(){var t=this;this.popupHandler=function(e){t.showPopup(e)},da().on(this.popupHandler)},detached:function(){this.popupHandler&&(da().off(this.popupHandler),this.popupHandler=null)},showPopup:function(t){void 0===t&&(t={});var n=this.data.get("title"),a=this.data.get("iconUrl"),i=t.shareUrl,o=t.query,r=t.rank,s=t.type;i?new e.index_pc({options:{title:n,content:o,iconUrl:a,linkUrl:i},success:function(){"generate"===s&&r===on.getState("rank")&&ua().emit({isAction:!0,rank:r,action:2,actionName:"分享"})}}).show():Qn().emit({text:"当前内容暂不支持分享"})}}),aC=a.defineComponent({template:"",initData:function(){return{toastText:"",type:""}},botToastHandler:null,created:function(){var t=this;this.botToastHandler=function(e){t.showToast(e)},Qn().on(this.botToastHandler)},detached:function(){this.botToastHandler&&(Qn().off(this.botToastHandler),this.botToastHandler=null)},showToast:function(t){if(t&&t.text&&t.type){var n={message:t.text};switch(t.type){case"info":e.Toast.info(n);break;case"success":e.Toast.success(n);break;case"warn":e.Toast.warn(n);break;case"error":e.Toast.error(n)}}}}),iC=a.defineComponent({template:'\n        <div class="chat-dialog-container" data-no-na-dialog="true">\n            <cos-dialog\n                open="{=visible=}"\n                title="{{title}}"\n                type="{{type}}"\n                on-ok="handleOk"\n                on-close="handleClose"\n                on-cancel="handleCancel"\n                headless="{{headless}}"\n                appearance="{{appearance}}"\n            >\n                <div class="chat-dialog-content">{{content}}</div>\n            </cos-dialog>\n        </div>\n    ',components:{"cos-dialog":e.Dialog},initData:function(){return{visible:!1,title:"",headless:!1,content:""}},dialogHandler:null,created:function(){var t=this;this.dialogHandler=function(e){t.dialogShow(e)},pa().on(this.dialogHandler)},attached:function(){this.handleVisibleChange()},handleVisibleChange:function(){this.watch("visible",(function(t){t?document.body.setAttribute("data-no-na-dialog","true"):document.body.removeAttribute("data-no-na-dialog")}))},disposed:function(){this.dialogHandler&&(pa().off(this.dialogHandler),this.dialogHandler=null)},handleOk:function(){this.data.set("visible",!1),"function"==typeof this.confirm&&this.confirm()},handleCancel:function(){this.data.set("visible",!1),"function"==typeof this.cancel&&this.cancel()},dialogShow:function(t){void 0===t&&(t={});var e=t.title,n=t.content,a=t.confirm,i=t.cancel,o=t.type,r=t.appearance,s=!e;(n||e)&&(this.data.set("visible",!0),this.data.set("title",e),this.data.set("content",n),this.data.set("type",o),this.data.set("headless",s),this.data.set("appearance",r),this.confirm=a,this.cancel=i)}});function oC(t,e){return oC=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},oC(t,e)}var rC=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).listenShowLoading=null,e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oC(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{show:!1}},n.attached=function(){var t=this;this.listenShowLoading=function(e){t.data.set("show",e)},ha().on(this.listenShowLoading)},n.disposed=function(){ha().off(this.listenShowLoading)},e}(a.Component);rC.trimWhitespace="all",rC.components={"cos-loading":e.Loading};var sC={};sC= __call$(Object,"assign",[sC,{csLoading:"cs-loading_15but_1","cs-loading":"cs-loading_15but_1"}]) ,rC.template='\n    <div>\n        <cos-loading\n            s-if="show"\n            class="{{$style[\'cs-loading\']}}"\n        />\n    </div>\n';var lC="function"==typeof rC?rC.prototype.initData||cC:rC.initData||cC;function cC(){return{$style:sC}}function dC(){return  __call$(Object,"assign",[{},lC.call(this),{$style:sC}]) }"function"==typeof rC?rC.prototype.initData=dC:rC.initData=dC;var uC=a.defineComponent({initData:function(){return{afxUrl:"",ratio:0,gifHeight:0,isShow:!1,hasPlay:!1,loop:!0}},detached:function(){var t,e,n,a=this.data.get("timer");a&&clearTimeout(a),this.timer&&cancelAnimationFrame(this.timer),null==(t=this.gl)||t.deleteTexture(this.videoTexture),null==(e=this.gl)||e.deleteBuffer(this.posBuffer),this.gl&&(this.gl=null);var i=this.ref("canvas");null==i||null==(n=i.parentNode)||n.removeChild(i)},attached:function(){var t=this,e=navigator.userAgent.toLowerCase(),n=!1;if(this.data.get("afxUrl")&&(function(t){return/BDBoxEngine/i.test(t)||/baiduboxapp/.test(t)||/bdapp/.test(t)}(e)||function(t){var e=/^Mozilla\/(\d*?(\.\d*?)*?) \(Linux; Android (\d*?(\.\d*?)*?); .*?\) AppleWebKit\/(\d*?(\.\d*?)*?) \(KHTML, like Gecko\) Chrome\/(\d*?(\.\d*?)*?) Mobile Safari\/(\d*?(\.\d*?)*?)$/.test(t),n=/^Mozilla\/(\d*?(\.\d*?)*?) \(iPhone; CPU iPhone OS (\d*?(_\d*?)*?) like Mac OS X\) AppleWebKit\/(\d*?(\.\d*?)*?) \(KHTML, like Gecko\) CriOS\/(\d*?(\.\d*?)*?) Mobile\/(.*?) Safari\/(\d*?(\.\d*?)*?)$/.test(t);return e||n}(e)||function(t){return t.indexOf("applewebkit")>-1&&t.indexOf("mobile")>-1&&t.indexOf("safari")>-1&&-1===t.indexOf("linux")&&-1===t.indexOf("android")&&-1===t.indexOf("chrome")&&-1===t.indexOf("ios")&&-1===t.indexOf("browser")}(e))&&(n=!0),function(t){return/(iPhone|iPod|iPad)/gi.test(t)}(e)){var a=/(iphone\sos)\s([\d_]+)/.exec(e),i=a&&a[2]?a[2].split("_"):[];i&&i[0]&&+i[0]<11&&(n=!1)}this.data.set("isShow",n),n&&this.nextTick((function(){t.data.get("afxUrl")&&t.initVideo()}))},initVideo:function(){var t=this,e=this.ref("video");e.muted=!0,e.pause(),e.oncanplay=function(){t.data.get("hasPlay")||(e.play(),t.initAfx(e),t.data.set("hasPlay",!0),t.fire("canPlay"))},e.oncanplaythrough=function(){t.data.get("hasPlay")||(e.play(),t.initAfx(e),t.data.set("hasPlay",!0),t.fire("canPlay"))},e.onloadeddata=function(){t.data.get("hasPlay")||(e.play(),t.fire("canPlay"),t.initAfx(e),t.data.set("hasPlay",!0),t.fire("canPlay"))},e.onended=function(){t.fire("ended")},+this.data.get("loop")&&(e.onpause=function(){e.play()})},replayVideo:function(){var t=this.ref("video");t.currentTime=0,t.play()},initAfx:function(t){var e=this,n=this.ref("canvas"),a=window.innerHeight;t.videoWidth&&t.videoHeight?(n.width=t.videoWidth/2,n.height=t.videoHeight):(n.height=a*parseInt(this.data.get("gifHeight"),10)/100,n.width=n.height*parseFloat(this.data.get("ratio")));var i=n.getContext("webgl");if(this.gl=i,i){i.viewport(0,0,n.width,n.height),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);var o=this.createVertexBuffer(i,[-1,-1,1,-1,-1,1,1,1]);this.posBuffer=o;var r=this.createProgram(i,"attribute vec2 position;\n        varying vec2 v_Texcoord;\n        void main() {\n            v_Texcoord = (position + 1.0) * 0.5;\n            gl_Position = vec4(position, 0.0, 1.0);\n        }","precision highp float;\n        uniform sampler2D tex;\n        varying vec2 v_Texcoord;\n        void main() {\n            // 取右边画面像素\n            vec3 rgb = texture2D(tex, v_Texcoord * vec2(0.5, 1.0) + vec2(0.5, 0.0)).rgb;\n            // 取左边画面像素\n            float a = texture2D(tex, v_Texcoord * vec2(0.5, 1.0)).r;\n            gl_FragColor = vec4(rgb, a);\n        }");i.useProgram(r),this.setVertexBuffer(i,r,"position",o,2);var s=this.createImageTexture(i);this.videoTexture=s;var l=i.getUniformLocation(r,"tex");i.uniform1i(l,0);var c=function(){i.bindBuffer(i.ARRAY_BUFFER,o),i.bindTexture(i.TEXTURE_2D,s),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.drawArrays(i.TRIANGLE_STRIP,0,4),e.timer=requestAnimationFrame(c)};this.timer=requestAnimationFrame(c)}},createProgram:function(t,e,n){var a=t.createShader(t.VERTEX_SHADER),i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,e),t.shaderSource(i,n),t.compileShader(a),t.compileShader(i),[a,i].forEach((function(e){if(!t.getShaderParameter(e,t.COMPILE_STATUS))return null}));var o=t.createProgram();return t.attachShader(o,a),t.attachShader(o,i),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS),o},setVertexBuffer:function(t,e,n,a,i){t.bindBuffer(t.ARRAY_BUFFER,a);var o=t.getAttribLocation(e,n);t.enableVertexAttribArray(o),t.vertexAttribPointer(o,i,t.FLOAT,!1,0,0)},createVertexBuffer:function(t,e){var n=t.createBuffer();return e&&this.updateVertexBuffer(t,n,e),n},updateVertexBuffer:function(t,e,n){var a,i;t.bindBuffer(t.ARRAY_BUFFER,e),a=n,(null!=(i=Array)&&"undefined"!=typeof Symbol&& __get$(i,Symbol.hasInstance) ? __call$(i,Symbol.hasInstance,[a]) :a instanceof i)&&window.Float32Array&&(n=new Float32Array(n)),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)},createImageTexture:function(t,e){var n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),e&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null),n}}),pC={};pC= __call$(Object,"assign",[pC,{gifCanvas:"gif-canvas_1lr2r_1","gif-canvas":"gif-canvas_1lr2r_1",hideImg:"hide-img_1lr2r_8","hide-img":"hide-img_1lr2r_8"}]) ,uC.template='\n    <div>\n        <video\n            s-if="isShow"\n            s-ref="video"\n            src="{{afxUrl}}"\n            auto-rotate="{{false}}"\n            autoplay\n            playsinline\n            x5-playsinline\n            webkit-playsinline\n            t7-video-player-type="inline"\n            crossorigin="anonymous"\n            style="display: none; width: 100%; position: absolute; z-index: -1;"\n            loop="{{loop}}"\n        >\n        </video>\n        <canvas\n            s-ref="canvas"\n            class="{{$style.gifCanvas}}"\n        >\n        </canvas>\n    </div>\n';var hC="function"==typeof uC?uC.prototype.initData||fC:uC.initData||fC;function fC(){return{$style:pC}}function gC(){return  __call$(Object,"assign",[{},hC.call(this),{$style:pC}]) }function mC(t){var e;if("string"==typeof t)try{e=JSON.parse(t)}catch(t){e={}}else e=t||{};return e}function vC(){return vC=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},vC.apply(this,Array.from(arguments))}"function"==typeof uC?uC.prototype.initData=gC:uC.initData=gC;var yC="aoyunhui",wC="资源加载中，请稍后重试",bC="弹窗调用失败",_C="gk2024_popup_task_red_packet_",kC="gk2024_popup_abnormal_reward_",SC="red_packet",xC="red_packet_text",IC="red_packet_close",TC=a.defineComponent({capsulesAniTimer:0,components:{"cos-icon":e.Icon,"cos-image":e.Image,"cos-swiper":e.Swiper,"cos-swiper-item":e.SwiperItem,"cos-toast":e.Toast,"c-afx-video":uC},computed:{stepArray:function(){var t=this.data.get("step"),e=this.data.get("stepImg"),n=this.data.get("stepUnlockImg"),a=this.data.get("stepSelectedImg"),i=this.data.get("specialStep"),o=this.data.get("specialStepImg"),r=this.data.get("specialStepUnlockImg"),s=this.data.get("specialStepSelectedImg"),l=this.data.get("currStep"),c=function(t){return t<l},d=function(t){return t===l},u=function(i){return function(e){return e>=t}(i)?c(i)?r:d(i)?s:o:c(i)?n:d(i)?a:e};return Array.from({length:t+i}).map((function(t,e){return u(e)}))}},attached:function(){this.dataHandle(),this.stepHandle(),this.talosEventHandle()},initData:function(){return{step:0,stepImg:"",stepUnlockImg:"",stepSelectedImg:"",specialStep:0,specialStepImg:"",specialStepUnlockImg:"",specialStepSelectedImg:"",recommendWord:[],titleImg:"",background:"",tip:"",completeApi:"",registerApi:"",nextRoundParams:null,jumpUrl:"",isShow:!0,currStep:0,showLoading:!0,showTip:!1,closeToast:"还有红包未领取，确认离开吗",showCloseToast:!0,showScheduleAni:!1,showCapsuleAni:!0,currRankFromNa:!1,currActSence:""}},listenOperateCapsulesDataInterflow:null,dataHandle:function(){var t=this,e=Hn().conversation.operateCapsulesDataInterflow;this.listenOperateCapsulesDataInterflow=function(e){var n=e.recommendWord,a=void 0===n?[]:n,i=t.data.get(),o=i.showLoading,r=i.background;if(i.isShow&&!r&&t.setBodyPadding(),a&&a.length)t.data.set("recommendWord",a),t.data.set("showLoading",!1),t.layerLogHandle("show",SC,{packet_content:a.map((function(t){return t.text}))});else{var s,l,c=mC(on.getState("csextdata"));1===(null==c||null==(s=c.operationPlatform)?void 0:s.firstPackage)&&on.dispatch("update",{csextdata:JSON.stringify({operationPlatform:vC({},c.operationPlatform,{firstPackage:0})})}),t.data.set("currActSence",null==c||null==(l=c.operationPlatform)?void 0:l.act),t.data.set("step",e.step),t.data.set("stepImg",e.stepImg),t.data.set("stepUnlockImg",e.stepUnlockImg),t.data.set("stepSelectedImg",e.stepSelectedImg),t.data.set("specialStep",e.specialStep),t.data.set("specialStepImg",e.specialStepImg),t.data.set("specialStepUnlockImg",e.specialStepUnlockImg),t.data.set("specialStepSelectedImg",e.specialStepSelectedImg),t.data.set("titleImg",e.titleImg),t.data.set("background",e.background),t.data.set("tip",e.tip),t.data.set("completeApi",e.completeApi),t.data.set("registerApi",e.registerApi),t.data.set("nextRoundParams",e.nextRoundParams),t.data.set("jumpUrl",e.jumpUrl),t.layerLogHandle("show",SC)}t.data.set("showTip",!o&&!a.length)},e&&e.on(this.listenOperateCapsulesDataInterflow)},setBodyPadding:function(t){void 0===t&&(t=!0);var e=getComputedStyle(document.body),n=parseFloat(e.paddingBottom)||0,a=t?n+158:n-158;document.body.style.paddingBottom=a+"px"},scheduleAniEndedHandle:function(){this.data.set("showScheduleAni",!1)},detachedHandle:function(){this.data.set("isShow",!1),this.setBodyPadding(!1),this.unRigsterTalosEvent(),clearTimeout(this.capsulesAniTimer),this.data.set("showScheduleAni",!1),this.data.set("showCapsuleAni",!1)},closeHandle:function(){var t=this.data.get(),n=t.closeToast;if(t.showCloseToast)return e.Toast.show({message:n,position:"bottom"}),void this.data.set("showCloseToast",!1);this.layerLogHandle("click",IC),this.detachedHandle()},invokeInputHandle:function(){zn().emit({word:"",invokeKeyboard:1})},capsulesAniCanPlayHandle:function(){var t=this,e=this.data.get("showCapsuleAni");!this.capsulesAniTimer&&e&&(this.capsulesAniTimer=setTimeout((function(){t.data.set("showCapsuleAni",!1)}),3e3))},capsuleClickHandle:function(t){this.layerLogHandle("click",xC,{content:t}),Xl({query:t})},layerLogHandle:function(t,e,n){Ua({ubcId:"17132",type:t,value:e,ext:vC({},n,{ori_lid:on.getState("oriLid"),lid:on.getState("lid"),re_rank:on.getState("rank"),agent_id:on.getState("agentInfo").agentId})})},talosLogHandle:function(t,e){Ua({ubcId:"17676",type:t,value:"",page:"common_operate",ext:{action_name:e,pos_id:"4295_4300_"}})},showPopupHandle:function(t,n){var a=this;void 0===t&&(t=!0),void 0===n&&(n={});var i=t?"c-agent-feedback":"c-agent-reward";if(o.canIUse("talos.showWindow")){var r={bundle:{mainBizName:"box.rnplugin.searchmanifest",bundleName:"EggPopup",version:"1.0.164.1"},naParams:{showType:"fullscreen",bgClosable:0,bgColor:{normal:"#000000-0.8",dark:"#000000-0.8"},animation:{contentShow:{scale:{start:1,end:1,curve:[.41,.05,.1,1],time:200}},contentHide:{scale:{start:1,end:1,curve:[.41,.05,.1,1],time:200}}},leaveNotShowWindow:1},bizParams:{popup:{type:"c-agent-reward"},popupName:"MktFindRedpacket",popupParams:{componentName:i,componentData:vC({},n,{uuid:t?"1":"0"})}}};o.talos.showWindow(vC({},r,{success:function(){a.talosLogHandle("element_show",(t?kC:_C)+"show")},fail:function(t){var n=mC(t);10001==+(null==n?void 0:n.status)?e.Toast.show({message:wC}):e.Toast.show({message:bC})}}))}else e.Toast.show({message:bC})},taskApiHandle:function(t,e){var n=this;!function(t){var e=t.url,n=t.success,a=t.fail,i="jsonpCallback"+ +new Date+Math.round(1e3*Math.random()),o=document.createElement("script"),r=setTimeout((function(){o.onerror("JSONP request timeout")}),2e4);o.onerror=function(){document.body.removeChild(o),delete window[i],a(new Error("JSONP request failed"))},o.onload=function(){clearTimeout(r)}, __set$(window,i,function(t){clearTimeout(r),document.body.removeChild(o),delete window[i],n(t);}) ;var s=jt(e,Ht.params({callback:i}));o.src=s,document.body.appendChild(o)}({url:t,success:function(t){if(0===+(null==t?void 0:t.status))return e(t);n.showPopupHandle()},fail:function(t){n.showPopupHandle()}})},taskCompeleteHandle:function(){var t=this,e=this.data.get("completeApi");this.taskApiHandle(e,(function(){var e=t.data.get(),n=e.currActSence,a=e.step,i=e.specialStep,o=e.registerApi,r=n===yC?{source:"agent",bg:"https://gips0.baidu.com/it/u=1996389903,2860529362&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f1242_1428",title:"https://gips2.baidu.com/it/u=3079154271,3193657443&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f1242_150",btn1:{bg:"https://gips2.baidu.com/it/u=2254050010,2611925001&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f381_183"},type:o?1:0,num:"",numSuffix:""}:{source:"agent",type:o?1:0,num:a+i};t.showPopupHandle(!1,r)}))},getZid:function(){return new Promise((function(t,e){o.canIUse("account.getZid")?o.account.getZid({v:0,jsParams:"",success:function(e){var n;t((null==e||null==(n=e.data)?void 0:n.zid)||"")},fail:function(){e("")}}):e("")}))},registerTalosEvent:function(t){if(o.canIUse("event.on")&&window){var e="talosGlobalFuncName"+ +new Date; __set$(window,e,function(e,n){t&&t(e,n);}) ,o.event.on({action:"com.baidu.channel.search.popwindow",allowDuplicate:"false",jscallback:e})}},unRigsterTalosEvent:function(){o.canIUse("event.off")&&o.event.off({action:"com.baidu.channel.search.popwindow"})},jumpToActivity:function(){var t=this.data.get("jumpUrl")||"";o.canIUse("search.open")?this.nextTick((function(){o.search.open({url:t,newbrowser:1,forbidautorotate:1,notShowLandingTopBar:1,bottomBarType:"4",landingPageType:"mailuo"})})): __set$(__get$(window,"location"),"href",t) },taskRoload:function(){var t=this;this.getZid().then((function(e){var n=jt(t.data.get("registerApi"),Ht.params({zid:e}));t.taskApiHandle(n,(function(){var e=t.data.get("nextRoundParams")||{};on.dispatch("update",{csextdata:(null==e?void 0:e.csextdata)||"",agentInfo:null==e?void 0:e.agentInfo}),t.data.set("currStep",0),t.data.set("showTip",!1),t.data.set("showLoading",!0),t.data.set("recommendWord",[]),t.data.set("completeApi",""),t.data.set("registerApi",""),t.data.set("step",0),t.data.set("specialStep",0),t.nextTick((function(){Xl({query:e.query})}))}))})).catch((function(){t.showPopupHandle()}))},listenBeforeLaunchConversation:null,listenCardTypingComplete:null,stepHandle:function(){var t=this;this.listenBeforeLaunchConversation=function(e){var n=e.fromNa,a=void 0!==n&&n;t.data.set("currRankFromNa",a)},Jn().on(this.listenBeforeLaunchConversation),this.listenCardTypingComplete=function(){var e=t.data.get(),n=e.currStep,a=e.step,i=e.specialStep,o=e.currRankFromNa;(n<a||o&&n<i+a)&&(t.data.set("currStep",n+1),!t.data.get("showScheduleAni")&&t.data.set("showScheduleAni",!0),n+1===i+a&&t.taskCompeleteHandle())},Fn().on(this.listenCardTypingComplete)},disposed:function(){this.listenOperateCapsulesDataInterflow&&(Hn().conversation.operateCapsulesDataInterflow.off(this.listenOperateCapsulesDataInterflow),this.listenOperateCapsulesDataInterflow=null);this.listenBeforeLaunchConversation&&(Jn().off(this.listenBeforeLaunchConversation),this.listenBeforeLaunchConversation=null),this.listenCardTypingComplete&&(Fn().off(this.listenCardTypingComplete),this.listenCardTypingComplete=null)},talosEventHandle:function(){var t=this;this.registerTalosEvent((function(e,n){var a=mC(n),i=null==a?void 0:a.type,o=!!(null==a?void 0:a.uuid);switch(i){case"btn-click":t.talosLogHandle("click",kC+"click"),t.jumpToActivity();break;case"back_activity":t.talosLogHandle("click",_C+"to_open_click"),t.jumpToActivity();break;case"next_search":t.talosLogHandle("click",_C+"more_click"),t.taskRoload();break;case"close":t.talosLogHandle("click",(o?kC:_C)+"close")}}))}}),CC={};CC= __call$(Object,"assign",[CC,{operateLayer:"operate-layer_f54h6_1","operate-layer":"operate-layer_f54h6_1",operateLayerClose:"operate-layer-close_f54h6_17","operate-layer-close":"operate-layer-close_f54h6_17",layerSchedule:"layer-schedule_f54h6_28","layer-schedule":"layer-schedule_f54h6_28",scheduleAfx:"schedule-afx_f54h6_31","schedule-afx":"schedule-afx_f54h6_31",scheduleTips:"schedule-tips_f54h6_40","schedule-tips":"schedule-tips_f54h6_40",scheduleTitle:"schedule-title_f54h6_48","schedule-title":"schedule-title_f54h6_48",scheduleProgress:"schedule-progress_f54h6_52","schedule-progress":"schedule-progress_f54h6_52",progressNumber:"progress-number_f54h6_56","progress-number":"progress-number_f54h6_56",layerClose:"layer-close_f54h6_63","layer-close":"layer-close_f54h6_63",scheduleStep:"schedule-step_f54h6_68","schedule-step":"schedule-step_f54h6_68",stepImg:"step-img_f54h6_73","step-img":"step-img_f54h6_73",capsule:"capsule_f54h6_78",capsuleTip:"capsule-tip_f54h6_87","capsule-tip":"capsule-tip_f54h6_87",capsuleLoading:"capsule-loading_f54h6_88","capsule-loading":"capsule-loading_f54h6_88",tipText:"tip-text_f54h6_91","tip-text":"tip-text_f54h6_91",layerCapsules:"layer-capsules_f54h6_109","layer-capsules":"layer-capsules_f54h6_109",capsuleAfx:"capsule-afx_f54h6_129","capsule-afx":"capsule-afx_f54h6_129"}]) ,TC.template='\n    <div\n        class="{{$style[\'operate-layer\']}} {{(isShow && background) ? \'\' : $style[\'operate-layer-close\']}}"\n        style="background-image: url({{background}});"\n    >\n        \x3c!-- 进度面板 --\x3e\n        <div class="{{$style[\'layer-schedule\']}}">\n            <c-afx-video\n                s-if="showScheduleAni"\n                class="{{$style[\'schedule-afx\']}}"\n                afx-url="https://psstatic.cdn.bcebos.com/basics/yunying/ok_1715000516000.mp4"\n                loop="{{false}}"\n                on-ended="scheduleAniEndedHandle"\n            />\n            <div class="{{$style[\'schedule-tips\']}}">\n                <cos-image\n                    s-if="titleImg"\n                    class="{{$style[\'schedule-title\']}}"\n                    src="{{titleImg}}"\n                />\n                <div class="{{$style[\'schedule-progress\']}} cos-font-medium cos-space-ml-xl">\n                    已完成<span class="{{$style[\'progress-number\']}}">{{currStep}}</span>次\n                </div>\n                <div class="{{$style[\'layer-close\']}} cos-space-ml-3xl" on-click="closeHandle">\n                    <cos-icon name="close" />\n                </div>\n            </div>\n            <div class="{{$style[\'schedule-step\']}}">\n                <cos-image\n                    s-for="src in stepArray"\n                    class="{{$style[\'step-img\']}}"\n                    src="{{src}}"\n                />\n            </div>\n        </div>\n        <div class="cos-space-mt-xxs">\n            \x3c!-- 胶囊气泡loading态 --\x3e\n            <div s-if="showLoading" class="{{$style[\'capsule-loading\']}}">\n                <div class="{{$style[\'tip-text\']}} {{$style[\'capsule\']}} cos-font-medium cos-rounded-lg">\n                    智能体回答中，请等待\n                </div>\n            </div>\n            \x3c!-- 兜底文案提示词 --\x3e\n            <div s-elif="currStep >= step || showTip" class="{{$style[\'capsule-tip\']}}" on-click="invokeInputHandle">\n                <div class="{{$style[\'tip-text\']}} {{$style[\'capsule\']}} cos-font-medium cos-rounded-lg">\n                    {{tip}}\n                </div>\n            </div>\n            \x3c!-- 胶囊气泡 --\x3e\n            <div s-elif="recommendWord.length" class="{{$style[\'layer-capsules\']}}">\n                <cos-swiper>\n                    <cos-swiper-item s-for="item in recommendWord">\n                        <div\n                            class="{{$style[\'capsule\']}} cos-font-medium cos-rounded-lg"\n                            on-click="capsuleClickHandle(item.text)"\n                        >\n                            {{item.text}}\n                        </div>\n                    </cos-swiper-item>\n                </cos-swiper>\n                \x3c!-- 胶囊气泡提示动画 --\x3e\n                <c-afx-video\n                    s-if="showCapsuleAni"\n                    class="{{$style[\'capsule-afx\']}}"\n                    afx-url="https://psstatic.cdn.bcebos.com/operation/agent_increase/afx_1721291028000.mp4"\n                    on-canPlay="capsulesAniCanPlayHandle"\n                />\n            </div>\n        </div>\n    </div>\n';var LC="function"==typeof TC?TC.prototype.initData||DC:TC.initData||DC;function DC(){return{$style:CC}}function PC(){return  __call$(Object,"assign",[{},LC.call(this),{$style:CC}]) }function EC(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function AC(){return AC=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},AC.apply(this,Array.from(arguments))}function OC(t,e){return OC=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},OC(t,e)}"function"==typeof TC?TC.prototype.initData=PC:TC.initData=PC;var RC=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).halfListenStatus={},e.prefetchedUrls=[],e.chatEvents={onQuestionStart:function(t){e.willPrefetchUrls=new Set},onMessage:function(t){if("pc"!==rt()){var n=t.data,a=(null==n?void 0:n.generator)||{},i=a.component,o=a.data,r=void 0===o?{}:o,s=(null==r?void 0:r.value)||(null==r?void 0:r.items);if("shortcuts"===i)(null==s?void 0:s.length)&&s.forEach((function(t){if("drawer"===t.type){var n=Bt(t.options.url,{actionId:Bn,_agentParams:JSON.stringify({sence:"drawer"})});e.updateHalfScreenUrl(n)}}))}},onTypingFinished:function(t){},onAnwserEnd:function(t){e.preloadUrlList(t)},onOpenDrawer:function(t){if("pc"!==rt()){var n=t.data,a=t.round_index,i=n||{},o=i.url,r=i.board_from;o&&( __get$(e.halfListenStatus,a) ||( __set$(e.halfListenStatus,a,!0) ,e.listenHalfScreenEvent(a,t.api.sendUbcLog),Hn().container.halfScreenOpened.on(e.sendHalfScreenLog.bind(EC(e),a,t.api.sendUbcLog)),Hn().container.halfScreenClosed.on(e.sendHalfScreenLog.bind(EC(e),a,t.api.sendUbcLog))),Hn().conversation.openHalfScreen.emit(AC({},n,{board_ext:JSON.stringify({board_from:r,rank:a}),url:Bt(o,{actionId:Bn,_agentParams:JSON.stringify({sence:"drawer"}),_aitabRank:a})})))}else e.api.showToast({text:"能力正在建设中，请到百度APP体验完整功能~",type:"info"})}},e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&OC(t,e)}(e,t);var n=e.prototype;return n.updateHalfScreenUrl=function(t){-1===this.prefetchedUrls.indexOf(t)&&this.willPrefetchUrls.add(t)},n.preloadUrlList=function(t){var e=this.willPrefetchUrls;e.size&&this.prefetchUrlInfoList(e)},n.listenHalfScreenEvent=function(t,e){o.canIUse("event.on")&&o.event.on({action:"com.baidu.searchbox.chatsearch.halfscreen.notifyEvent."+Bn,jscallback:this.halfScreenEvent.bind(this,t,e)})},n.halfScreenEvent=function(t,e,n,a){var i=this;try{var o=a&&JSON.parse(a).data,r=o.name,s=o.params,l=o.url,c=o._aitabRank,d=this.api.getLatestRoundInfo();if(t===+c){var u=s.close_type,p=s.query,h=s.ext,f={params:{board_url:l,board_ext:JSON.stringify({rank:t}),close_type:u}};if("conversation"===r)h&&this.api.setAgentInfo(AC({},this.api.getAgentInfo(),{agentParams:AC({actionLid:d.lid},h)})),this.sendHalfScreenLog(t,e,f,!0),"string"==typeof p?this.api.launchConversation({query:p}):p.forEach((function(t){if("TEXT"===t.type){var e=t.data.text;i.api.launchConversation({query:e.query})}}))}}catch(t){console.error(t)}},n.sendHalfScreenLog=function(t,e,n,a){try{var i=(null==n?void 0:n.params)||{},o=i.board_url,r=i.board_ext,s=i.close_type,l=r&&JSON.parse(r),c=l.board_from;(+t==+l.rank||a)&&o&&e({type:s?"click":"show",value:s?"half_board_close":c?"half_board":"half_board_msg",extra:{board_url:o,board_from:c,close_type:s}})}catch(t){console.error(t)}},n.prefetchUrlInfoList=function(t){if(Ni||!t||!t.size){var e=Array.from(t);this.prefetchedUrls=this.prefetchedUrls.concat(e);var n=document.body||document.getElementsByTagName("body")[0];if(Oi)for(var a=0;a<e.length;a++){var i=document.createElement("link");i.rel="prerender", __set$(i,"href",__get$(t,a)) ,Oi&&n.appendChild(i)}if(Ri&&o.canIUse("search.landingPagePrefetch")){var r=e.map((function(t){return{prefetchType:1,prefetchInfo:{url:t},ext:{}}}));o.search.landingPagePrefetch({data:r})}}},e}(a.Component);RC.template="\n        <div>\n\n        </div>\n    ",RC.components={},RC.dependencies=["api"];var NC=Sf(RC);function MC(t,e){return MC=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},MC(t,e)}var qC=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&MC(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{isDeepSeekPage:lt(),isHarmony:pt(),scale:1,topSpace:+on.getState("topBarHeight")/window.devicePixelRatio+12,title:"DeepSeek-R1",deepseekLogo:"https://gips0.baidu.com/it/u=4155985737,1209176462&fm=3028&app=3028&f=PNG&fmt=auto&q=75&size=f72_72"}},n.attached=function(){var t=this;this.data.get("isHarmony")&&(this.observer=new ResizeObserver((function(){var e,n=parseFloat(null==(e=getComputedStyle(document.documentElement))?void 0:e.fontSize);t.data.set("scale",n/100)})),this.observer.observe(document.documentElement))},n.disposed=function(){this.observer&&(this.observer.disconnect(),this.observer=null)},e}(a.Component);function jC(t,e){return jC=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},jC(t,e)}qC.template='\n        <div class="chat-search-page-header">\n            <div s-if="isDeepSeekPage" class="chat-search-page-header-container">\n                <img class="chat-search-page-header-logo" src="{{deepseekLogo}}" />\n                <div class="chat-search-page-header-title">{{title}}</div>\n            </div>\n            <div\n                s-else-if="isHarmony" style="{{\'padding-top:\' + topSpace + \'px;\'}}"\n                class="chat-search-page-header-container"\n            >\n                <div class="chat-search-harmony-header-logo" style="{{\'transform: scale(\' + scale + \');\'}}" />\n            </div>\n        </div>\n    ';var BC,HC=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jC(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{isDeepSeekPage:lt(),isHarmony:pt()}},n.attached=function(){},e}(a.Component);HC.template='\n        <div>\n            <chat-page-header s-if="isDeepSeekPage || isHarmony" />\n            <chat-history-tips\n                isPulldownLoading="{{true}}"\n            />\n            <chat-share-popup />\n            <chat-toast />\n            <chat-dialog />\n            <chat-loading />\n            \x3c!-- 运营浮层 --\x3e\n            <chat-operate-capsules />\n\n            <chat-drawer />\n        </div>\n    ',HC.components={"chat-history-tips":Dl,"chat-share-popup":nC,"chat-toast":aC,"chat-dialog":iC,"chat-loading":rC,"chat-operate-capsules":TC,"chat-drawer":NC,"chat-page-header":qC},function(t){ __set$(t,t.UPLOADING=0,"UPLOADING") , __set$(t,t.SUCCESS=1,"SUCCESS") , __set$(t,t.ERROR=2,"ERROR") }(BC||(BC={}));var $C=a.defineComponent({initData:function(){return{status:1,fileName:"",fileToken:"",fileType:"",fileUrl:"",fileSize:0}},computed:{fileIcon:function(){var t=this.data.get("fileType");return/image/i.test(t)||_r.includes(t)?this.data.get("fileUrl")||"https://gips3.baidu.com/it/u=3971192352,3667158809&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f180_180": __get$(me,hi(this.data.get("fileType"),this.data.get("fileName"))) },fileDisplaySize:function(){return mi(this.data.get("fileSize"))}},handleDelete:function(t){t.stopPropagation(),this.fire("delete")}}),FC={};FC= __call$(Object,"assign",[FC,{fileItem:"file-item_2im0a_1","file-item":"file-item_2im0a_1",error:"error_2im0a_10",fileIcon:"file-icon_2im0a_13","file-icon":"file-icon_2im0a_13",fileName:"file-name_2im0a_18","file-name":"file-name_2im0a_18",fileSize:"file-size_2im0a_24","file-size":"file-size_2im0a_24",fileUploadError:"file-upload-error_2im0a_27","file-upload-error":"file-upload-error_2im0a_27",fileDeleteIcon:"file-delete-icon_2im0a_31","file-delete-icon":"file-delete-icon_2im0a_31",uploadLoading:"upload-loading_2im0a_36","upload-loading":"upload-loading_2im0a_36",rotate:"rotate_2im0a_1"}]) ,$C.template='\n    <div class="{{$style[\'file-item\']}} {{status !== 1 ? status === 2 ? $style[\'error\'] : $style[\'uploading\'] : \'\'}}">\n        <img class="{{$style[\'file-icon\']}}" src="{{fileIcon}}"/>\n        <div class="{{$style[\'file-name\']}}">{{fileName}}</div>\n        <div s-if="status === 0" class="{{$style[\'upload-loading\']}}"></div>\n        <div s-if="status !== 0 && status !== 2" class="{{$style[\'file-size\']}}">{{fileDisplaySize}}</div>\n        <div s-if="status === 2" class="{{$style[\'file-upload-error\']}}">上传失败</div>\n        <img\n            class="{{$style[\'file-delete-icon\']}}"\n            src="https://gips0.baidu.com/it/u=3222028005,933205828&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f36_36"\n            on-click="handleDelete"\n        />\n    </div>\n';var UC="function"==typeof $C?$C.prototype.initData||GC:$C.initData||GC;function GC(){return{$style:FC}}function WC(){return  __call$(Object,"assign",[{},UC.call(this),{$style:FC}]) }function zC(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function QC(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof $C?$C.prototype.initData=WC:$C.initData=WC;var JC=new Map([[dr.NETWORK_ERROR,"网络错误，请重试"],[dr.RISK_DENY,"当前文件暂不支持，换个文件试试吧"],[dr.FILE_SIZE_EXCEED_LIMIT,"文件过大"],[dr.KNOWLEDGE_ERROR,"文件上传失败"]]);var VC=a.defineComponent({components:{"file-item":$C},initData:function(){return{fileList:[],isDragging:!1,usedFileCapacity:0,fileCapacity:5368709120,uploadFileIns:null}},computed:{progress:function(){return 0===this.data.get("fileCapacity")?0:function(t,e){if(t>=e||t<=0)return t;var n=t*Math.pow(30/t,.5);return Math.max(1,Math.min(e,n))}(this.data.get("usedFileCapacity")/this.data.get("fileCapacity")*100,30)},leftSpace:function(){var t=this.data.get("fileCapacity")-this.data.get("usedFileCapacity"),e=mi(t),n=["GB","MB","KB","B"],a=n.findIndex((function(t){return e.includes(t)}));return(parseFloat(e)*Math.pow(1024,n.length-1-a)!==t?"约":"")+e},emptyShowExt:function(){return JSON.stringify({type:"show",value:"zsk_file_blank"})},uploadAddShowExt:function(){return JSON.stringify({type:"show",value:"zsk_file_indie"})}},handleDragEnter:function(t){t.preventDefault(),this.data.set("isDragging",!0)},handleDragOver:function(t){t.preventDefault()},handleDragLeave:function(t){t.preventDefault(),this.data.set("isDragging",!1)},handleDrop:function(t){var n;t.preventDefault(),this.data.set("isDragging",!1);var a=Array.from((null==(n=t.dataTransfer)?void 0:n.files)||[]);a.length&&(a.length>10&&e.Toast.show({message:"每次最多上传10个文件"}),this.handleUpload("drag",a.slice(0,10)))},handleUploadClick:function(t){void 0===t&&(t=!1),t&&this.data.get("fileList").length||(Ua({type:"click",value:t?"zsk_file_blank":"zsk_file_indie"}),this.handleUpload(t?"blank":"indie"))},checkCapacityMaxSize:function(t,n){if(n&&n.length){var a=n.reduce((function(t,e){return t+e.size}),0);if(this.data.get("usedFileCapacity")+a>this.data.get("fileCapacity"))return e.Toast.show({message:"当前知识库存储空间不足"}),this.handleSend(t,(null==n?void 0:n.length)||0,0),!1}return!0},handleUpload:function(t,n){return(a=function(){var a,i,o,r,s;return QC(this,(function(l){switch(l.label){case 0:return a=this,i=(null==n?void 0:n.length)||0,o=0,this.checkCapacityMaxSize(t,n)?(r={type:"all",maxSize:150,maxNum:10,sseHost:on.getState("chatParams.sse_host"),knowledgeId:ti.getState("knowledgeId"),callback:function(t){var n=t.status,r=t.fileInfo,s=t.num,l=a.data.get("fileList")||[];if(n===dr.INIT&&l.unshift({status:BC.UPLOADING,fileName:r.fileName,type:r.fileType.startsWith("image/")?"IMAGE":void 0,size:r.fileSize,fileToken:r.fileToken}),n===dr.NOT_AVAILABLE&&e.Toast.show({message:"暂不支持此格式，换个文件试试"}),n===dr.SET_FILE_NUM)i=s;else if(n===dr.BOS_SUCCESS){var c=l.find((function(t){return t.fileToken===r.fileToken}));c&&(c.fileId=r.fileId)}else if(n===dr.KNOWLEDGE_SUCCESS){var d=l.find((function(t){return t.fileToken===r.fileToken}));d&&(d.status=BC.SUCCESS,d.fileUrl=r.fileUrl,a.data.set("usedFileCapacity",a.data.get("usedFileCapacity")+d.size),o++)}else if(JC.has(n)){var u=l.find((function(t){return t.fileToken===r.fileToken}));u&&(u.status=BC.ERROR),e.Toast.show({message:JC.get(n)})}a.data.set("fileList",JSON.parse(JSON.stringify(l)))}},[4,xr.create(r)]):[2];case 1:s=l.sent(),this.data.set("uploadFileIns",s),l.label=2;case 2:return l.trys.push([2,,7,8]),n&&n.length?[4,s.uploadFiles(n).catch((function(){}))]:[3,4];case 3:return l.sent(),[3,6];case 4:return[4,s.getFile((function(e){return a.checkCapacityMaxSize(t,e)})).catch((function(){}))];case 5:l.sent(),l.label=6;case 6:return[3,8];case 7:return this.handleSend(t,i,o),[7];case 8:return[2]}}))},function(){var t=this,e=Array.from(arguments);return new Promise((function(n,i){var o=a.apply(t,e);function r(t){zC(o,n,i,r,s,"next",t)}function s(t){zC(o,n,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var a},handleDelete:function(t){var e=this,n=this.data.splice("fileList",[t,1])[0];xr.deleteFile(this.data.get("uploadFileIns"), __call$(Object,"assign",[{},n,{sseHost:on.getState("chatParams.sse_host"),knowledgeId:ti.getState("knowledgeId")}]) ,(function(){n.status!==BC.UPLOADING&&n.status!==BC.ERROR&&e.data.set("usedFileCapacity",e.data.get("usedFileCapacity")-n.size)}))},handleSend:function(t,e,n){Ua({type:"show",value:"zsk_file_upload_suc",ext:{upload_type:t,file_upload_num:e,file_suc_num:n}})}}),KC={};KC= __call$(Object,"assign",[KC,{uploadContainer:"upload-container_ut75t_1","upload-container":"upload-container_ut75t_1",uploadTitleDesc:"upload-title-desc_ut75t_17","upload-title-desc":"upload-title-desc_ut75t_17",uploadAddFile:"upload-add-file_ut75t_23","upload-add-file":"upload-add-file_ut75t_23",empty:"empty_ut75t_46",uploadContent:"upload-content_ut75t_49","upload-content":"upload-content_ut75t_49",progressBackground:"progress-background_ut75t_49","progress-background":"progress-background_ut75t_49",dragging:"dragging_ut75t_52",fileList:"file-list_ut75t_59","file-list":"file-list_ut75t_59",uploadTip:"upload-tip_ut75t_68","upload-tip":"upload-tip_ut75t_68",uploadDesc:"upload-desc_ut75t_75","upload-desc":"upload-desc_ut75t_75",spaceProgress:"space-progress_ut75t_81","space-progress":"space-progress_ut75t_81",progressBar:"progress-bar_ut75t_94","progress-bar":"progress-bar_ut75t_94",spaceDesc:"space-desc_ut75t_99","space-desc":"space-desc_ut75t_99",uploadMask:"upload-mask_ut75t_113","upload-mask":"upload-mask_ut75t_113",uploadMaskDesc:"upload-mask-desc_ut75t_129","upload-mask-desc":"upload-mask-desc_ut75t_129"}]) ,VC.template='\n    <div class="{{$style[\'upload-container\']}}">\n        <header>\n            文件<span class="{{$style[\'upload-title-desc\']}}">知识库内的对话会优先参考这些内容</span>\n            <div\n                s-if="fileList.length"\n                class="{{$style[\'upload-add-file\']}}"\n                on-click="handleUploadClick()"\n                data-show-area\n                data-show-ext="{{uploadAddShowExt}}"\n            >\n                <img src="https://gips3.baidu.com/it/u=3242808885,1786185630&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f36_36">\n                添加文件\n            </div>\n        </header>\n        <main\n            class="{{fileList.length ? \'\' : $style[\'empty\']}} {{isDragging ? $style[\'dragging\'] : \'\'}}"\n            on-click="handleUploadClick(true)"\n            on-dragenter="handleDragEnter"\n            on-dragover="handleDragOver"\n            on-dragleave="handleDragLeave"\n            on-drop="handleDrop"\n        >\n            <div class="{{$style[\'upload-content\']}}">\n                <template s-if="!fileList.length">\n                    <div\n                        class="{{$style[\'upload-tip\']}}"\n                        data-show-area\n                        data-show-ext="{{emptyShowExt}}"\n                    >\n                        点击或拖拽文件到此处上传\n                    </div>\n                    <div class="{{$style[\'upload-desc\']}}">\n                        支持Word、Excel、PPT、PDF、TXT，图片（单文件大小不超过150MB）\n                    </div>\n                </template>\n                <div class="{{$style[\'space-progress\']}}">\n                    <div class="{{$style[\'progress-background\']}}">\n                        <div class="{{$style[\'progress-bar\']}}" style="width: {{progress}}%"></div>\n                    </div>\n                    <div class="{{$style[\'space-desc\']}}">剩余空间{{leftSpace}}</div>\n                </div>\n            </div>\n            <div s-if="fileList.length" class="{{$style[\'file-list\']}}">\n                <file-item\n                    s-for="file, idx in fileList"\n                    status="{{file.status}}"\n                    fileName="{{file.fileName}}"\n                    fileToken="{{file.fileToken}}"\n                    fileSize="{{file.size}}"\n                    fileType="{{file.type}}"\n                    fileUrl="{{file.fileUrl}}"\n                    on-delete="handleDelete(idx)"\n                />\n            </div>\n            <div s-show="isDragging" class="{{$style[\'upload-mask\']}}">\n                <img src="https://gips1.baidu.com/it/u=3390398911,3918550005&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f72_72">\n                <div class="{{$style[\'upload-mask-desc\']}}">在此处释放即可添加到当前知识库</div>\n            </div>\n        </main>\n    </div>\n';var XC="function"==typeof VC?VC.prototype.initData||YC:VC.initData||YC;function YC(){return{$style:KC}}function ZC(){return  __call$(Object,"assign",[{},XC.call(this),{$style:KC}]) }function tL(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function eL(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof VC?VC.prototype.initData=ZC:VC.initData=ZC;var nL=a.defineComponent({initData:function(){return{preTitle:"",title:"",saveTimer:null}},attached:function(){var t=this;Ha().on((function(e){e.knowledgeId===ti.getState("knowledgeId")&&"title"===e.updateType&&e.currentTitle!==t.data.get("title")&&(t.data.set("preTitle",e.currentTitle),t.data.set("title",e.currentTitle))})),this.nextTick((function(){var e=t.ref("titleInput"),n= __get$Loc(location) .search.includes("newKnowledge");e&&n&&e.focus()}))},handleKeyDown:function(t){13===t.keyCode&&(t.preventDefault(),this.saveTitle())},saveTitle:function(){return(t=function(){var t,e,n,a;return eL(this,(function(i){switch(i.label){case 0:return t=this.data.get("title")||"未命名知识库",e=this.data.get("preTitle"),this.data.set("title",t),t===e?[3,2]:(n=ti.getState("knowledgeId"),this.data.set("preTitle",t),Ua({type:"click",value:"zsk_title_edit"}),[4,Ar((a={}, __set$(a,n,{title:t}) ,a))]);case 1:-1!==i.sent().status?(Ha().emit({updateType:"title",knowledgeId:n,currentTitle:t}),Ua({type:"click",value:"zsk_title_save",ext:{zsk_name:t,zsk_id:n}})):(this.data.set("title",e||"未命名知识库"),this.data.set("preTitle",e||"未命名知识库")),i.label=2;case 2:return[2]}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){tL(o,a,i,r,s,"next",t)}function s(t){tL(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var t}}),aL={};aL= __call$(Object,"assign",[aL,{titleContainer:"title-container_ijvdw_1","title-container":"title-container_ijvdw_1",titleIcon:"title-icon_ijvdw_8","title-icon":"title-icon_ijvdw_8",titleInput:"title-input_ijvdw_14","title-input":"title-input_ijvdw_14"}]) ,nL.template='\n    <div class="{{$style[\'title-container\']}}">\n        <img\n            class="{{$style[\'title-icon\']}}"\n            src="https://gips2.baidu.com/it/u=198180371,1398827139&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f60_60"\n        />\n        <input\n            value="{=title=}"\n            placeholder="未命名知识库"\n            class="{{$style[\'title-input\']}}"\n            maxlength="{{20}}"\n            on-keydown="handleKeyDown"\n            on-blur="saveTitle"\n            s-ref="titleInput"\n        />\n    </div>\n';var iL="function"==typeof nL?nL.prototype.initData||oL:nL.initData||oL;function oL(){return{$style:aL}}function rL(){return  __call$(Object,"assign",[{},iL.call(this),{$style:aL}]) }function sL(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function lL(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof nL?nL.prototype.initData=rL:nL.initData=rL;var cL=a.defineComponent({initData:function(){return{preInstruction:"",instruction:"",instructionGuideList:[],timer:null,isFocus:!1}},computed:{multiLine:function(){var t=this.data.get("instruction");return t.includes("\n")||t.length>40}},handleInput:function(){var t=this;this.data.get("saveTimer")&&clearTimeout(this.data.get("saveTimer"));var e=setTimeout((function(){return t.saveInstruction()}),2e3);this.data.set("saveTimer",e)},handleFocus:function(){this.data.set("isFocus",!0)},handleBlur:function(){this.data.set("isFocus",!1),this.data.get("timer")&&clearTimeout(this.data.get("timer")),this.saveInstruction()},saveInstruction:function(t){return void 0===t&&(t=!1),(e=function(){var e,n,a;return lL(this,(function(i){switch(i.label){case 0:return e=this.data.get("instruction"),n=this.data.get("preInstruction"),e===n?[3,2]:(this.data.set("preInstruction",e),!t&&Ua({type:"click",value:"zsk_global_edit"}),[4,Ar((a={}, __set$(a,ti.getState("knowledgeId"),{instruction:e}) ,a))]);case 1:-1===i.sent().status&&(this.data.set("instruction",n),this.data.set("preInstruction",n)),i.label=2;case 2:return[2]}}))},function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){sL(o,a,i,r,s,"next",t)}function s(t){sL(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var e},handleRandom:function(){var t=this.data.get("instructionGuideList");if(0!==t.length){for(1===t.length&&this.data.set("instruction",t[0]);;){var e=Math.floor(Math.random()*t.length);if( __get$(t,e) !==this.data.get("instruction")){this.data.set("instruction", __get$(t,e) );break}}Ua({type:"click",value:"zsk_global_change"}),this.saveInstruction()}}}),dL={};dL= __call$(Object,"assign",[dL,{instructionContainer:"instruction-container_1oq6s_1","instruction-container":"instruction-container_1oq6s_1",multiLine:"multi-line_1oq6s_12","multi-line":"multi-line_1oq6s_12",instructionTextarea:"instruction-textarea_1oq6s_15","instruction-textarea":"instruction-textarea_1oq6s_15",focus:"focus_1oq6s_18",random:"random_1oq6s_37"}]) ,cL.template='\n    <div\n        class="\n            {{$style[\'instruction-container\']}}\n            {{multiLine ? $style[\'multi-line\'] : \'\'}}\n            {{isFocus ? $style[\'focus\'] : \'\'}}\n        "\n    >\n        <textarea\n            class="{{$style[\'instruction-textarea\']}}"\n            placeholder="在此录入指令，定制在当前知识库的回答方式"\n            value="{=instruction=}"\n            maxlength="1000"\n            on-input="handleInput"\n            on-focus="handleFocus"\n            on-blur="handleBlur"\n        ></textarea>\n        <button class="{{$style[\'random\']}}" on-click="handleRandom">\n            <img\n                src="https://gips1.baidu.com/it/u=498944772,3185292372&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f32_32"\n            />\n            随机\n        </button>\n    </div>\n';var uL="function"==typeof cL?cL.prototype.initData||pL:cL.initData||pL;function pL(){return{$style:dL}}function hL(){return  __call$(Object,"assign",[{},uL.call(this),{$style:dL}]) }function fL(t,e){return fL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},fL(t,e)}"function"==typeof cL?cL.prototype.initData=hL:cL.initData=hL;var gL=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fL(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{loadingStatus:"loading",threshold:100}},n.attached=function(){var t=this.data.get("threshold");this.observer=new IntersectionObserver(this.handleIntoView.bind(this),{root:null,rootMargin:t+"px",threshold:0}),this.observer.observe(this.el)},n.handleIntoView=function(t){"loading"===this.data.get("loadingStatus")&&0!==t.length&&t[0].isIntersecting&&(this.fire("load"),Ua({type:"show",value:"more",page:"his_dialog"}))},n.handleClick=function(){"load-fail"===this.data.get("loadingStatus")&&this.fire("load")},n.disposed=function(){this.observer&&(this.observer.disconnect(),this.observer=null)},e}(a.Component);function mL(t,e){return mL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mL(t,e)}gL.template='\n        <div s-ref="infinite-scroll" class="chat-history-infinite-scroll" on-click="handleClick">\n            <slot name="loading" s-if="loadingStatus === \'loading\'">\n                <span class="chat-infinite-scroll-text-default">正在加载...</span>\n            </slot>\n            <slot name="loadFail" s-elif="loadingStatus === \'loadFail\'">\n                <span class="chat-infinite-scroll-text-default">- 加载失败 请点击重试 -</span>\n            </slot>\n            <slot name="loadEnd" s-else>\n                <span class="chat-infinite-scroll-text-default">- 到底了 没有更多内容了 -</span>\n            </slot>\n        </div>\n    ',gL.computed={};var vL=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mL(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{status:"loading",size:"30"}},n.attached=function(){var t={container:this.el,renderer:"svg",loop:!0,autoplay:!0,path:"https://psstatic.cdn.bcebos.com/basics/aichat/aitab_history_loading_1739519589000.json"};this.loadingInstance=s.loadAnimation(t)},e}(a.Component);function yL(t,e){return yL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},yL(t,e)}vL.template='\n        <div style="width: {{size}}px; height: {{size}}px;"></div>\n    ';var wL=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yL(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{status:"empty",emptyText:"当前没有历史",emptyIcon:"https://gips1.baidu.com/it/u=3603041107,2441073942&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f315_271"}},n.handleBtnClick=function(){Ua({type:"click",value:"back_ai",page:"his_dialog",ext:{setype:"csaitab"}}),si({isShowHello:"1",extParams:JSON.stringify({enter_type:"his_empty"})})},e}(a.Component);function bL(t,e){return bL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},bL(t,e)}wL.template='\n        <div class="chat-history-empty">\n            <div class="chat-history-empty-content">\n                <cos-empty\n                    s-if="status === \'empty\'"\n                    icon="{{emptyIcon}}"\n                    title="{{emptyText}}"\n                    size="md"\n                >\n                    <cos-button\n                        attr-data-show-area\n                        attr-data-show-ext="{{btnShowExt}}"\n                        on-click="native:handleBtnClick"\n                        class="chat-history-empty-no-data-button"\n                    >\n                        回到<span class="chat-history-empty-no-data-button-icon"></span>\n                    </cos-button>\n                </cos-empty>\n\n                <loading-lottie size="80" s-if="status === \'loading\'"></loading-lottie>\n            </div>\n        </div>\n    ',wL.components={"cos-button":e.Button,"cos-empty":e.Empty,"loading-lottie":vL},wL.computed={btnShowExt:function(){return JSON.stringify({setype:"csaitab",value:"back_ai",page:"his_dialog"})}};var _L=function(t){function e(){return t.apply(this,Array.from(arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bL(t,e)}(e,t),e}(a.Component);function kL(t,e){return kL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},kL(t,e)}_L.template='\n        <cos-empty\n            style="margin-top: 78px"\n            icon="https://gips3.baidu.com/it/u=1889663231,4044203578&fm=3028&app=3028&f=PNG&fmt=auto&q=100&size=f120_120"\n            title="知识库内的对话会展示在这里"\n            size="sm"\n        />\n    ',_L.components={"cos-empty":e.Empty};var SL=function(t){function e(){return t.apply(this,Array.from(arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kL(t,e)}(e,t),e.prototype.initData=function(){return{source:"history",status:"empty"}},e}(a.Component);function xL(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function IL(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function TL(t){return CL.apply(this,Array.from(arguments))}function CL(){var t;return t=function(t){var e,n,a;return IL(this,(function(i){switch(i.label){case 0:e=on.getState("chatParams.sse_host")||Gt,n=""+e+Wt.delete,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Li(n,{method:"POST",body:JSON.stringify(t)},3e3)];case 2:return[2,{status:(a=i.sent()).status,message:a.message}];case 3:return[2,{status:-1,message:"Failed to delete history",error:i.sent()}];case 4:return[2]}}))},CL=function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){xL(o,a,i,r,s,"next",t)}function s(t){xL(o,a,i,r,s,"throw",t)}r(void 0)}))},CL.apply(this,Array.from(arguments))}function LL(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function DL(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){LL(o,a,i,r,s,"next",t)}function s(t){LL(o,a,i,r,s,"throw",t)}r(void 0)}))}}function PL(t,e){return PL=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},PL(t,e)}function EL(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}SL.template='\n        <empty-page-history s-if="source === \'history\'" status="{{status}}"></empty-page-history>\n        <empty-page-knowledge s-else></empty-page-knowledge>\n    ',SL.components={"empty-page-history":wL,"empty-page-knowledge":_L};var AL=Math.min(Math.floor(window.innerHeight/46),30),OL=function(t){function n(){var e;return(e=t.apply(this,Array.from(arguments))||this).startTime=0,e.endTime=0,e.fetchCount=2,e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&PL(t,e)}(n,t);var a=n.prototype;return a.initData=function(){return{source:"history",historyList:[],infiniteScrollStatus:"loading",fetchStatus:"end",emptyStatus:"loading",pn:0}},a.attached=function(){if("knowledge"===this.data.get("source"))return this.data.set("pn",1),void this.data.set("emptyStatus","empty");this.sendPageShowLog(),this.fetchHistoryList()},a.sendPageShowLog=function(){this.startTime=+Date.now(),Ua({type:"display",page:"his_dialog"})},a.handleHistoryItemClick=function(){this.endTime=+Date.now(),Ua({ubcId:"18663",type:"",value:"page_duration",page:"his_dialog",ext:{starttime:String(this.startTime),endtime:String(this.endTime),duration:String(this.endTime-this.startTime)}})},a.fetchHistoryList=function(){var t=this;return DL((function(){var n,a,i,o,r,s,l,c,d,u;return EL(this,(function(p){switch(p.label){case 0:t.data.set("fetchStatus","loading"),n="knowledge"===t.data.get("source"),a=on.getState("chatParams.sse_host")||Gt,i=""+a+Wt.history,o=t.data.get("pn"),r={},p.label=1;case 1:return p.trys.push([1,3,,4]),[4,Di(i, __call$(Object,"assign",[{rn:n?5:AL,pn:o,req_type:4,from:"chat_search",token:sc()},n?{knowledgeId:ti.getState("knowledgeId")}:{}]) ,{},5e3)];case 2:return r=p.sent(),[3,4];case 3:return s=p.sent(),console.error(s),[3,4];case 4:if(l=r.status,c=r.data,0===l){if(!(null==(d=c.historyData)?void 0:d.length)&&0===o)return t.data.set("emptyStatus","empty"),[2];(null==d?void 0:d.length)||t.data.set("infiniteScrollStatus","loadEnd"),u=t.data.get("historyList"),t.data.splice("historyList",[].concat([u.length,0],d.reverse())),t.data.set("fetchStatus","end"),t.data.set("pn",+o+1)}else 0===o&&t.data.set("emptyStatus","empty"),t.data.set("infiniteScrollStatus","loadEnd"),e.Toast.error({message:"网络异常，请稍后再试"});return t.data.set("fetchStatus","end"),[2]}}))}))()},a.deleteHistoryItem=function(t){var n=this;return DL((function(){var a,i,o,r;return EL(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a="knowledge"===n.data.get("source"),i=a?ti.getState("knowledgeId"):"",[4,TL( __call$(Object,"assign",[{req_type:1,ori_lid_list:[{ori_lid:t}]},a?{knowledge_id:i}:{}]) )];case 1:return 0===(o=s.sent()).status?(n.updateHistoryListAfterDelete(t),a&&Ha().emit({updateType:"deleteChat",knowledgeId:i,sessionId:t})):(console.error("Error deleting history:",o),e.Toast.error({message:"删除失败， 请稍后再试"})),[3,3];case 2:return r=s.sent(),console.error("Error deleting history:",r),[3,3];case 3:return[2]}}))}))()},a.updateHistoryListAfterDelete=function(t){var e=this.data.get("historyList");on.getState("oriLid")===t&&ni();var n=e.filter((function(e){return e.sessionId!==t}));this.data.set("historyList",n),0===n.length&&this.data.set("emptyStatus","empty")},a.handleLoad=function(){this.data.set("infiniteScrollStatus","loading"),"loading"!==this.data.get("fetchStatus")&&this.fetchHistoryList()},n}(a.Component);OL.template='\n        <div class="chat-search-history-page {{source === \'knowledge\' ? \'knowledge-history\' : \'\'}}">\n            <div\n                s-if="historyList && historyList.length > 0"\n                class="chat-search-history-page-content"\n            >\n                <history-list\n                    history-list="{{historyList}}"\n                    source="{{source}}"\n                />\n                <infinite-scroll\n                    loading-status="{{infiniteScrollStatus}}"\n                    on-load="handleLoad"\n                >\n                    <div slot="loading" class="chat-history-page-list-loading">\n                        <loading-lottie size="28"></loading-lottie>\n                    </div>\n                    <div slot="loadEnd" class="chat-history-page-list-no-more">\n                        <div class="chat-history-page-list-no-more-left"></div>\n                        <div class="chat-history-page-list-no-more-text">\n                            没有更多历史了\n                        </div>\n                        <div class="chat-history-page-list-no-more-right"></div>\n                    </div>\n                </infinite-scroll>\n            </div>\n            <empty-page\n                s-else\n                status="{{emptyStatus}}"\n                source="{{source}}"\n            />\n        </div>\n    ',OL.messages={"history-item-click":function(){this.handleHistoryItemClick()},"delete-history":function(t){var e=t.value.sessionId;this.deleteHistoryItem(e)}},OL.components={"history-list":Ti,"infinite-scroll":gL,"empty-page":SL,"loading-lottie":vL};var RL=a.defineComponent({components:{"chat-history":OL},initData:function(){return{chatList:[]}},computed:{ubcShowLog:function(){var t=ti.getState("knowledgeId");return JSON.stringify({type:"show",value:"zsk_dialog",zsk_name:ti.getState("knowledgeMsg."+t+".title"),zsk_id:t})}}}),NL={};NL= __call$(Object,"assign",[NL,{historySection:"history-section_e3hbi_1","history-section":"history-section_e3hbi_1",historyTitle:"history-title_e3hbi_1","history-title":"history-title_e3hbi_1"}]) ,RL.template='\n    <div class="{{$style[\'history-section\']}}">\n        <div class="{{$style[\'history-title\']}}">对话</div>\n        <div data-show-area data-show-ext="{{ubcShowLog}}">\n            <chat-history history-list="{{chatList}}" source="knowledge" />\n        </div>\n    </div>\n';var ML="function"==typeof RL?RL.prototype.initData||qL:RL.initData||qL;function qL(){return{$style:NL}}function jL(){return  __call$(Object,"assign",[{},ML.call(this),{$style:NL}]) }"function"==typeof RL?RL.prototype.initData=jL:RL.initData=jL;var BL=a.defineComponent({attached:function(){var t={container:this.el,renderer:"svg",loop:!0,autoplay:!0,path:"https://psstatic.cdn.bcebos.com/basics/aichat/knowledge_loading_1746599336000.json"};s.loadAnimation(t)}}),HL={};HL= __call$(Object,"assign",[HL,{loading:"loading_k7lwp_1"}]) ,BL.template="\n    <div class=\"{{$style['loading']}}\"></div>\n";var $L="function"==typeof BL?BL.prototype.initData||FL:BL.initData||FL;function FL(){return{$style:HL}}function UL(){return  __call$(Object,"assign",[{},$L.call(this),{$style:HL}]) }function GL(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function WL(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof BL?BL.prototype.initData=UL:BL.initData=UL;var zL=a.defineComponent({components:{"upload-file":VC,"title-input":nL,instruction:cL,"history-list":RL,"sc-loading":BL},initData:function(){return{isLoading:!0,data:{}}},created:function(){return(t=function(){var t,n,a,i,o;return WL(this,(function(r){switch(r.label){case 0:return[4,Dr({knowledgeId:t=ti.getState("knowledgeId")})];case 1:return n=r.sent(),a=n.status,i=n.knowledgeList,-1!==a&&i.length?(o=i[0],ti.dispatch("updateItem",{data:o}),Ha().emit({updateType:"knowledge",knowledgeId:t}),this.data.set("data",o),this.data.set("isLoading",!1),[2]):(e.Toast.show({message:"知识库不存在"}),si({isShowHello:"1",extParams:JSON.stringify({enter_type:"sidebar_dialog"})}),[2])}}))},function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){GL(o,a,i,r,s,"next",t)}function s(t){GL(o,a,i,r,s,"throw",t)}r(void 0)}))}).apply(this);var t}}),QL={};QL= __call$(Object,"assign",[QL,{chatKnowledgeHeader:"chat-knowledge-header_bgrz5_1","chat-knowledge-header":"chat-knowledge-header_bgrz5_1"}]) ,zL.template='\n    <div class="{{$style[\'chat-knowledge-header\']}}">\n        <template s-if="!isLoading">\n            <title-input title="{{data.title}}" pre-title="{{data.title}}"/>\n            <instruction\n                instruction="{{data.instruction}}"\n                pre-instruction="{{data.instruction}}"\n                instruction-guide-list="{{data.instructionGuideList}}"\n            />\n            <upload-file\n                fileList="{{data.fileList}}"\n                used-file-capacity="{{data.usedFileCapacity}}"\n                file-capacity="{{data.fileCapacity}}"\n            />\n            <history-list chat-list="{{data.chatList}}"/>\n        </template>\n        <sc-loading s-else/>\n    </div>\n';var JL="function"==typeof zL?zL.prototype.initData||VL:zL.initData||VL;function VL(){return{$style:QL}}function KL(){return  __call$(Object,"assign",[{},JL.call(this),{$style:QL}]) }"function"==typeof zL?zL.prototype.initData=KL:zL.initData=KL;var XL=!1,YL=!1;function ZL(){var t=0,e=0;if(XL){var n=document.getElementById("conversation-flow-container");if(!n)return;var a=n.scrollHeight,i=n.scrollTop;t=n.clientHeight,e=a-Math.abs(i)-t}else{var o=document.documentElement.getBoundingClientRect();t=document.documentElement.clientHeight,e=o.height-Math.abs(o.top)-t}return{clientHeight:t,docuHideBottom:e}}function tD(t){void 0===t&&(t=!1),XL=t;var e=Xi((function(){!function(t){var e,n;void 0===t&&(t=!1);var a=ZL(),i="1"===(null==(n=on.getState("sample"))||null==(e=n.variables)?void 0:e.CHANGE_BOTTOM_ALIGN)||t||lt();if(a&&!YL){var o=a.docuHideBottom>a.clientHeight;i?ic(50)&&(va().emit({hideHeight:a.clientHeight,showButton:!0}),nc()):o&&va().emit({hideHeight:a.clientHeight})}}(t)}),200);setTimeout((function(){var n=t?document.getElementById("conversation-flow-container"):window;null==n||n.addEventListener("scroll",e)}),500)}Jn().on((function(){YL=!0,setTimeout((function(){YL=!1}),4e3)}));var eD="pc"===rt(),nD=a.defineComponent({template:'\n        <div\n            s-if="showScrollToBottomBtn"\n            class="{{hasCapsules && \'cs-move-up\'}} cs-scroll-to-bottom-btn"\n            on-click="onClick"\n            style="{{bottomStyle}}"\n        >\n            <cos-icon name="arrow-down" />\n        </div>\n    ',components:{"cos-icon":e.Icon},initData:function(){var t,e;return{isPc:eD,showScrollToBottomBtn:!1,hasCapsules:!1,isBtmAlignSample:"1"===(null==(e=on.getState("sample"))||null==(t=e.variables)?void 0:t.CHANGE_BOTTOM_ALIGN)||eD||lt(),inputIsOpening:!1,bottomStyle:lt()||pt()?"bottom:"+(wt(119)+18)+"px":""}},listenCapsuleShow:null,attached:function(){var t=this;this.listenShowBtn(),this.onClick=Xi(this.onBtnClick.bind(this),1e3),tD(eD),this.listenCapsuleShow=function(){t.data.set("hasCapsules",!0)},ya().on(this.listenCapsuleShow)},listenGoToBottom:null,listenShowBtn:function(){var t=this;this.listenGoToBottom=function(e){var n=e.hideHeight,a=e.showButton,i=t.data.get("showScrollToBottomBtn");t.data.get("isBtmAlignSample")&&!a||!n||n<0||i||(t.data.set("hasCapsules",!!_n(".cs-capsules")),t.data.set("showScrollToBottomBtn",!0),t.listenScrollHideBtn(n))},va().on(this.listenGoToBottom)},disposed:function(){this.listenCapsuleShow&&(ya().off(this.listenCapsuleShow),this.listenCapsuleShow=null),this.listenGoToBottom&&(va().off(this.listenGoToBottom),this.listenGoToBottom=null)},listenScrollHideBtn:function(t){var e=this,n=void 0;n=Xi((function(){var a=ZL();if(e.data.get("isBtmAlignSample")){if(ic(50))return;return e.data.set("showScrollToBottomBtn",!1),void e.removeScrollListener(n)}(null==a?void 0:a.docuHideBottom)<=t&&(e.data.set("showScrollToBottomBtn",!1),e.removeScrollListener(n))}),100),this.addScrollListener(n)},onBtnClick:function(){var t,e=this.data.get("isBtmAlignSample"),n=ZL(),a=(null==n?void 0:n.docuHideBottom)>2*(null==n?void 0:n.clientHeight)||e?"instant":"smooth";t=a,$l.scrollToBottom(t),e&&ec(),Ua({type:"click",value:"locate"})},addScrollListener:function(t){var e=this.data.get("isPc")?document.getElementById("conversation-flow-container"):window;null==e||e.addEventListener("scroll",t)},removeScrollListener:function(t){var e=this.data.get("isPc")?document.getElementById("conversation-flow-container"):window;null==e||e.removeEventListener("scroll",t)}}),aD=a.defineComponent({template:'\n        <div s-if="open">\n            <div class="cs-bottom-tips-tooltip">\n                <div class="cs-tooltip-content">{{content}}</div>\n                <div class="cs-tooltip-arrow"></div>\n            </div>\n        </div>\n    ',initData:function(){return{open:!1,content:"点击体验DeepSeek-R1满血版"}},attached:function(){this.listenOpenChange()},timer:null,listenTouchStart:null,listenOpenChange:function(){var t=this;this.watch("open",(function(e){e&&(t.timer=setTimeout((function(){t.data.set("open",!1),t.listenTouchStart&&window.removeEventListener("touchstart",t.listenTouchStart),t.listenTouchStart=null,t.timer=null}),3e3),t.listenTouchStart=function(){t.data.get("open")&&(t.data.set("open",!1),window.removeEventListener("touchstart",t.listenTouchStart),Hs().off(t.listenTouchStart),clearTimeout(t.timer),t.listenTouchStart=null,t.timer=null)},window.addEventListener("touchstart",t.listenTouchStart),Hs().on(t.listenTouchStart))}))},disposed:function(){this.listenTouchStart&&(window.removeEventListener("touchstart",this.listenTouchStart),Hs().off(this.listenTouchStart),clearTimeout(this.timer),this.listenTouchStart=null)}}),iD="CHAT_SEARCH_BOTTOM_TIPS_COUNT",oD=a.defineComponent({template:'\n    <div class="cs-footer">\n        <back-to-generate  s-if="!isPc"/>\n        \x3c!-- 阿拉丁卡片的反馈弹窗依赖dom --\x3e\n        <div class="se-page-ft"></div>\n        <div style="height: {{placeholder}}px"></div>\n        <bottom-tips\n            s-if="!isPc"\n            open="{{bottomTipsOpen}}"\n        />\n    </div>',components:{"back-to-generate":nD,"bottom-tips":aD},initData:function(){return{isPc:"pc"===rt(),placeholder:wt(pt()?74:119)}},computed:{},listenWiseInputFocus:null,attached:function(){var t=this;this.bottomTipsHandler(),this.listenWiseInputFocus=function(e){var n=wt(e.height);t.data.set("placeholder",e.focus?n-(yt()?18:0):n)},Ma().on(this.listenWiseInputFocus)},listenShowBottomTips:null,bottomTipsHandler:function(){var t=this;this.listenShowBottomTips=function(){t.computeShowBottomTips()},Na().on(this.listenShowBottomTips)},disposed:function(){this.listenWiseInputFocus&&Ma().off(this.listenWiseInputFocus),this.listenShowBottomTips&&Na().off(this.listenShowBottomTips)},computeShowBottomTips:function(){var t=this;if(!this.data.get("isPc")&&!lt()&&window.localStorage){var e=Number(window.localStorage.getItem(iD)||0);if(e>=1)return;window.localStorage.setItem(iD,String(e+1)),setTimeout((function(){t.data.set("bottomTipsOpen",!0)}),500)}}});function rD(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function sD(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){rD(o,a,i,r,s,"next",t)}function s(t){rD(o,a,i,r,s,"throw",t)}r(void 0)}))}}function lD(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var a= __get$(e,n) ;a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}(t.prototype,e),t}function cD(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function dD(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&& __get$(t,e) ,a=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&& __get$(t,a++) ,done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var uD=function(){function t(){this.isProcessing=!1,this.queue=[]}var e=t.prototype;return e.unshift=function(t){var e=this;return sD((function(){var n,a;return cD(this,(function(i){return a=Array.isArray(t)?t:[t],(n=e.queue).unshift.apply(n,[].concat(a)),e.start(),[2]}))}))()},e.shift=function(){return this.queue.shift()},e.pop=function(){return this.queue.pop()},e.splice=function(t,e){for(var n=Array.from(arguments).length,a=new Array(n>2?n-2:0),i=2;i<n;i++) __set$(a,i-2,__get$(Array.from(arguments),i)) ;var o;return void 0===e?this.queue.splice(t):(o=this.queue).splice.apply(o,[].concat([t,e],a))},e.clear=function(){this.queue=[],this.isProcessing=!1,this.curSetTimeout&&clearTimeout(this.curSetTimeout)},e.push=function(t){var e=this;return sD((function(){var n,a;return cD(this,(function(i){return a=Array.isArray(t)?t:[t],(n=e.queue).push.apply(n,[].concat(a)),e.start(),[2]}))}))()},e.start=function(){var t=this;return sD((function(){var e;return cD(this,(function(n){switch(n.label){case 0:if(e=function(){var e,n,a;return cD(this,(function(i){switch(i.label){case 0:return(e=t.queue.shift())?(n=e.action,a=e.delay,n?[4,new Promise((function(e,i){n(),t.curSetTimeout=setTimeout((function(){e(!0)}),a)}))]:[3,2]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))},t.isProcessing||0===t.queue.length)return[2];t.isProcessing=!0,n.label=1;case 1:return t.queue.length>0?[5,dD(e())]:[3,3];case 2:return n.sent(),[3,1];case 3:return t.isProcessing=!1,[2]}}))}))()},lD(t,[{key:"length",get:function(){return this.queue.length}}]),t}();function pD(){return pD=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},pD.apply(this,Array.from(arguments))}function hD(t,e,n){var a=function(t){void 0===t&&(t=[]);return new Map(t.filter((function(t){return t.id})).map((function(t){return[t.id,t]})))}(t),i=[];return e.forEach((function(t){var e=a.get(t.id);a.delete(t.id),e?function(t,e){return["title"].some((function(n){return  __get$(t,n) !== __get$(e,n) }))}(e,t)&&i.push({type:"update",itemInfo:pD({},n,{item:t})}):i.push({type:"add",itemInfo:pD({},n,{item:t})})})),a.forEach((function(t){i.push({type:"delete",itemInfo:pD({},n,{item:t})})})),i}var fD={add:0,update:100,delete:0,loading:1333,state:0},gD=function(){function t(t){this.queue=new uD,this.MindMapComponent=t}var e=t.prototype;return e.doMindMapAction=function(t,e){switch(t){case Cf.SET_DATA:this.setData(e);break;case Cf.SSE_STOP:this.close()}},e.setData=function(t){var e=this.mindMap||{},n=e.items,a=void 0===n?[]:n,i=e.mindMapId,o=t||{},r=o.mindMapId,s=o.items,l=void 0===s?[]:s,c=i!==r;(null==t?void 0:t.state)===Tf.NO_MIND_MAP?this.close():(c&&(this.reset(r),this.loading()),(null==t?void 0:t.state)===Tf.COMPLETED&&(this.mindMap=t,this.renderItems(a,l,t)))},e.loading=function(){var t;null==(t=this.queue)||t.push(this.createLoadingQueueItem())},e.close=function(){var t,e;(null==(t=this.mindMap)?void 0:t.state)===Tf.INIT&&(null==(e=this.MindMapComponent)||e.close())},e.reset=function(t){var e,n,a,i;null==(e=this.MindMapComponent)||e.reset(),this.mindMap={mindMapId:t,items:[],state:Tf.INIT},null==(a=this.MindMapComponent)||null==(n=a.data)||n.set("mindMapId",t),null==(i=this.queue)||i.clear()},e.renderItems=function(t,e,n){var a,i=this.generateRenderQueue(t,e,n);null==(a=this.queue)||a.push(i)},e.generateRenderQueue=function(t,e,n){var a=this;return hD(t,e,n).map((function(t){return a.createQueueItem(t)}))},e.createQueueItem=function(t){var e=this;return{action:function(){return e.MindMapComponent.executeAction(t)},delay:null==fD?void 0: __get$(fD,null==t?void 0:t.type) }},e.createStateQueueItem=function(t){var e=this;return this.createQueueItem({type:"state",cb:function(){var n,a;return null==(a=e.MindMapComponent)||null==(n=a.data)?void 0:n.set("state",t)}})},e.createLoadingQueueItem=function(){return this.createQueueItem({type:"loading"})},t}();function mD(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}function vD(t,e){return vD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vD(t,e)}var yD=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vD(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{text:"",lineClass:"",displayChars:[],indexDelay:.01,animationDuration:.16}},n.attached=function(){this.setDisplayChars(this.data.get("text")),this.checkEllipsis(),this.addWatchers()},n.addWatchers=function(){var t=this;this.watch("displayChars",(function(){t.checkEllipsis()})),this.watch("text",(function(e){t.setDisplayChars(e)}))},n.setDisplayChars=function(t){var e=this;this.data.set("displayChars",[]),this.nextTick((function(){e.data.set("displayChars",null==t?void 0:t.split(""))}))},n.checkEllipsis=function(){var t=this;this.nextTick((function(){var e=t.ref("textContainer");if(e){var n=e.scrollWidth>e.clientWidth;n&&t.fire("ellipsis",n)}}))},n.animateShow=function(){return{enter:function(t,e){var n,a,i=1e3*parseFloat((null==t||null==(n=t.style)?void 0:n.animationDelay)||"0.3"),o=1e3*parseFloat((null==t||null==(a=t.style)?void 0:a.animationDuration)||"0");function r(e){t.style.opacity=e+""}function s(){e(),t.style.opacity="1"}setTimeout((function(){!function(t,e,n,a){var i=performance.now();requestAnimationFrame((function o(r){var s=r-i,l=n(s/t);e(l),s<t?requestAnimationFrame(o):"function"==typeof a&&a()}))}(o,r,mD,s)}),i)}}},e}(a.Component),wD={};wD= __call$(Object,"assign",[wD,{writerContainer:"writer-container_1epry_1","writer-container":"writer-container_1epry_1",typewriterText:"typewriter-text_1epry_4","typewriter-text":"typewriter-text_1epry_4"}]) ,yD.template='\n    <div class="{{$style[\'writer-container\']}}">\n        <div\n            class="{{lineClass}}"\n            s-ref="textContainer"\n        >\n            <span\n                s-for="char, index in displayChars"\n                s-transition="animateShow(index)"\n                style="animation-delay: {{index * indexDelay}}s; animation-duration: {{animationDuration}}s;"\n                class="{{$style[\'typewriter-text\']}}"\n            >{{char}}</span>\n        </div>\n        <slot />\n    </div>\n';var bD="function"==typeof yD?yD.prototype.initData||_D:yD.initData||_D;function _D(){return{$style:wD}}function kD(){return  __call$(Object,"assign",[{},bD.call(this),{$style:wD}]) }"function"==typeof yD?yD.prototype.initData=kD:yD.initData=kD;var SD="ai_chat_tour_showed_key",xD={"mind-map-item":{key:"mind-map-item",content:"💡点击发起提问，探索更多",position:"bottom"}},ID=function(t){var e=t.key,n=function(){try{var t=localStorage.getItem(SD);return t?JSON.parse(t):{}}catch(t){return{}}}();return!!(null==n?void 0: __get$(n,e) )};function TD(t,e){return TD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},TD(t,e)}var CD=function(t){function n(){var n;return(n=t.apply(this,Array.from(arguments))||this).components={"cos-tooltip":e.Tooltip,"cos-icon":e.Icon},n}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&TD(t,e)}(n,t);var a=n.prototype;return a.initData=function(){var t=this;return{userInfo:{},open:!1,key:"",content:"",position:"",img:"",closeTime:5e3,pageScrollAction:function(){},getPopupContainer:function(){return t.el}}},a.created=function(){var t=this.data.get("key"),e= __get$(xD,t) ;e&& __call$(this.data,"assign",[e]) },a.attached=function(){var t=this.getPageContainer()||document.body;t&&(this.pageScrollAction=this.pageScroll.bind(this),t.addEventListener("scroll",this.pageScrollAction))},a.detached=function(){var t=this.getPageContainer();t&&t.removeEventListener("scroll",this.pageScrollAction)},a.open=function(){var t=this,e=this.data.get("key");ID({key:e})||(this.data.set("open",!0),this.nextTick((function(){t.data.set("animationOpen",!0)})),this.startCloseTimer(),function(t){var e=t.key;try{var n=localStorage.getItem(SD),a=n?JSON.parse(n):{}; __set$(a,e,!0) ,localStorage.setItem(SD,JSON.stringify(a))}catch(t){}}({key:e}))},a.close=function(){var t=this;this.data.set("animationClose",!0),this.nextTick((function(){t.data.set("open",!1)}))},a.startCloseTimer=function(){var t=this,e=this.data.get("closeTime");setTimeout((function(){t.data.get("open")&&t.close()}),e)},a.getPageContainer=function(){return document.getElementById("app-page")},a.pageScroll=function(t){var e=this.ref("tooltip");null==e.pagePositionChange||e.pagePositionChange.call(e)},n}(a.Component),LD={};LD= __call$(Object,"assign",[LD,{tour:"tour_q4z73_1",arrowVertical:"arrow-vertical_q4z73_11","arrow-vertical":"arrow-vertical_q4z73_11",arrowHorizontal:"arrow-horizontal_q4z73_15","arrow-horizontal":"arrow-horizontal_q4z73_15",content:"content_q4z73_65",open:"open_q4z73_71",close:"close_q4z73_81"}]) ,CD.template='\n    <div>\n        <cos-tooltip\n            s-ref="tooltip"\n            trigger="custom"\n            open="{{open}}"\n            position="{{position}}"\n            bubbleClass="{{$style.tour}} {{animationOpen ? $style.open : \'\'}} {{animationClose ? $style.close : \'\'}}"\n            getPopupContainer="{{getPopupContainer}}"\n        >\n            <slot />\n            <template slot="content">\n                <div class="{{$style.content}}">{{content}}</div>\n            </template>\n        </cos-tooltip>\n    </div>\n';var DD="function"==typeof CD?CD.prototype.initData||PD:CD.initData||PD;function PD(){return{$style:LD}}function ED(){return  __call$(Object,"assign",[{},DD.call(this),{$style:LD}]) }function AD(t,e){return AD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},AD(t,e)}"function"==typeof CD?CD.prototype.initData=ED:CD.initData=ED;var OD=function(t){function n(){var n;return(n=t.apply(this,Array.from(arguments))||this).components={"cos-tooltip":e.Tooltip},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&AD(t,e)}(n,t),n.prototype.initData=function(){return{text:"",show:!1,position:"top"}},n}(a.Component),RD={};RD= __call$(Object,"assign",[RD,{tour:"tour_1lh8j_1",arrowVertical:"arrow-vertical_1lh8j_8","arrow-vertical":"arrow-vertical_1lh8j_8",arrowHorizontal:"arrow-horizontal_1lh8j_12","arrow-horizontal":"arrow-horizontal_1lh8j_12",hide:"hide_1lh8j_62"}]) ,OD.template='\n    <div>\n        <cos-tooltip\n            position="{{position}}"\n            bubbleClass="{{$style.tour}} {{show ? \'\' : $style.hide}}"\n            content="{{text}}"\n        >\n            <slot />\n        </cos-tooltip>\n    </div>\n';var ND="function"==typeof OD?OD.prototype.initData||MD:OD.initData||MD;function MD(){return{$style:RD}}function qD(){return  __call$(Object,"assign",[{},ND.call(this),{$style:RD}]) }function jD(){return jD=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},jD.apply(this,Array.from(arguments))}function BD(){return{enter_type:on.getState("pcEnterType")||"ai_tab_url",setype:"csaitab",ori_lid:on.getState("oriLid"),lid:on.getState("lid"),sa:on.getState("oriSa"),re_rank:String(on.getState("rank")),a_lid:on.getState("apagelid"),valueInfo:[{component_name:"mindMap"}],query:on.getState("query")}}function HD(t){var e=t.mindMapList,n=t.item,a=t.index,i=t.actionType,o=function(t,e){for(var n=0,a=0,i=0;i<=t;i++){var o;1===(null==(o= __get$(e,i) )?void 0:o.level)?(n++,a=0):a++}return{pos:n,subPos:a}}(a,e);return jD({},BD(),{action_type:i,idea_query:null==n?void 0:n.title,pos:String(o.pos),sub_pos:String(o.subPos),total_pos:String(a+1),total_num:String(e.length)})}function $D(){return $D=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},$D.apply(this,Array.from(arguments))}function FD(t,e){return FD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},FD(t,e)}"function"==typeof OD?OD.prototype.initData=qD:OD.initData=qD;var UD=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&FD(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{item:{},isEllipsis:!1}},n.openTour=function(){var t=this.ref("tour");t&&t.open()},n.closeTour=function(){var t=this.ref("tour");t&&t.close()},n.onEllipsis=function(){this.data.set("isEllipsis",!0);var t=this.ref("bubble");t&&(t.style.right="0px")},e}(a.Component);UD.components={writer:yD,tour:CD,"hover-tip":OD},UD.computed={hasTitle:function(){return!!this.data.get("item.title")},ubcShowLog:function(){var t=HD({mindMapList:this.data.get("mindMapList"),item:this.data.get("item"),index:this.data.get("index"),actionType:this.data.get("actionType")});return JSON.stringify($D({value:"idea_single"},t))}};var GD={};GD= __call$(Object,"assign",[GD,{mindMapItem:"mind-map-item_sflgq_1","mind-map-item":"mind-map-item_sflgq_1",level1:"level-1_sflgq_11","level-1":"level-1_sflgq_11",level2:"level-2_sflgq_18","level-2":"level-2_sflgq_18",mindMapItemContent:"mind-map-item-content_sflgq_21","mind-map-item-content":"mind-map-item-content_sflgq_21",starWrapper:"star-wrapper_sflgq_26","star-wrapper":"star-wrapper_sflgq_26",starRotate270:"star-rotate-270_sflgq_32","star-rotate-270":"star-rotate-270_sflgq_32",rotate270:"rotate270_sflgq_1",starRotate180:"star-rotate-180_sflgq_35","star-rotate-180":"star-rotate-180_sflgq_35",rotate180:"rotate180_sflgq_1",starIcon:"star-icon_sflgq_38","star-icon":"star-icon_sflgq_38",starIconDark:"star-icon-dark_sflgq_49","star-icon-dark":"star-icon-dark_sflgq_49",darker:"darker_sflgq_1",writerLine:"writer-line_sflgq_52","writer-line":"writer-line_sflgq_52",writerUnderline:"writer-underline_sflgq_56","writer-underline":"writer-underline_sflgq_56",writerBubble:"writer-bubble_sflgq_69","writer-bubble":"writer-bubble_sflgq_69",starHoverRotate180:"star-hover-rotate-180_sflgq_84","star-hover-rotate-180":"star-hover-rotate-180_sflgq_84",lighter:"lighter_sflgq_1",rotate90:"rotate90_sflgq_1"}]) ,UD.template='\n    <div class="{{$style[\'mind-map-item\']}} {{$style[\'level-\' + item.level]}}">\n        <div class="{{$style[\'mind-map-item-content\']}}">\n            <div\n                s-if="{{item.level !== 1}}"\n                class="{{$style[\'star-wrapper\']}}"\n            >\n                <div\n                    class="{{$style[\'star-rotate-270\']}} {{hasTitle ? $style[\'star-hover-rotate-180\'] : \'\'}}"\n                    style="animation-iteration-count: {{hasTitle ? \'1\' : \'infinite\'}};"\n                >\n                    <div class="{{$style[\'star-icon\']}} {{hasTitle ? $style[\'star-icon-dark\'] : \'\'}}"></div>\n                </div>\n            </div>\n            <tour\n                s-ref="tour"\n                key="mind-map-item"\n            >\n                <hover-tip\n                    text="{{item.title}}"\n                    show="{{isEllipsis}}"\n                >\n                    <writer\n                        text="{{item.title}}"\n                        lineClass="{{$style[\'writer-line\']}} cos-line-clamp-1"\n                        on-ellipsis="onEllipsis"\n                    >\n                        <div class="{{$style[\'writer-underline\']}} cos-line-clamp-1">{{ item.title }}</div>\n                        <div\n                            s-if="hasTitle"\n                            s-ref="bubble"\n                            class="{{$style[\'writer-bubble\']}}"\n                        ></div>\n                    </writer>\n                </hover-tip>\n            </tour>\n        </div>\n        <div\n            data-show-area\n            s-if="hasTitle"\n        >\n            <div data-show-ext="{{ubcShowLog}}"></div>\n        </div>\n    </div>\n';var WD="function"==typeof UD?UD.prototype.initData||zD:UD.initData||zD;function zD(){return{$style:GD}}function QD(){return  __call$(Object,"assign",[{},WD.call(this),{$style:GD}]) }function JD(){return JD=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},JD.apply(this,Array.from(arguments))}function VD(t,e){return VD=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},VD(t,e)}"function"==typeof UD?UD.prototype.initData=QD:UD.initData=QD;var KD="loading-mind-map",XD=function(t){function e(){var e;return(e=t.apply(this,Array.from(arguments))||this).startTime=null,e.endTime=null,e.hasSentDurationLog=!1,e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&VD(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{mindMapList:[],state:Tf.INIT,loadingMindMapItem:{id:KD,title:"",level:2},actionType:"new_q",hasSendLog:!1,showMask:!1}},n.created=function(){this.mindMapDataTransfer=new gD(this)},n.attached=function(){this.addEventBusListeners(),this.addWatchers(),this.addMaskListener()},n.detached=function(){var t;null==(t=this.mindMapDataTransfer)||t.reset(),this.mindMapDataTransfer=null,this.removeMaskListener()},n.handleDurationLog=function(t){if(!this.hasSentDurationLog)if(this.startTime){if(t===Tf.COMPLETED){this.hasSentDurationLog=!0;var e=Date.now(),n=e-this.startTime;this.sendDurationLog({startTime:this.startTime,endTime:e,duration:n})}}else this.startTime=Date.now()},n.addEventBusListeners=function(){var t=this;Xs().on((function(e){var n,a=e.type,i=e.data;null==(n=t.mindMapDataTransfer)||n.doMindMapAction(a,i),t.handleDurationLog(null==i?void 0:i.state)}))},n.addWatchers=function(){var t=this;this.watch("state",(function(e){switch(e){case Tf.INIT:t.data.set("actionType","refresh");break;case Tf.COMPLETED:t.sendShowLog(),t.showTour(),t.deleteMindMap({item:t.data.get("loadingMindMapItem"),state:Tf.COMPLETED})}})),Jn().on((function(){on.getState("rank")<1||(t.sendShowLog(),t.data.set("hasSendLog",!1),t.data.get("mindMapList").length>0&&t.data.set("actionType","inherit"))})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&(t.sendShowLog(),t.data.get("state")!==Tf.COMPLETED&&t.data.set("hasSendLog",!1))})),window.addEventListener("beforeunload",(function(){t.sendShowLog()}))},n.handleItemClick=function(t,e){this.sendClickLog(t,e),Xl({query:this.getMindMapQuery(t,"switch"),extParams:{sa:"idea_clk"}}),this.showTourItemRef&&(this.showTourItemRef.closeTour(),this.showTourItemRef=null),yd()},n.getMindMapQuery=function(t,e){var n={type:"MIND_MAP",data:{mindMap:JD({},t,{operateType:e,mindMapId:this.data.get("mindMapId")})}};return[{type:"TEXT",data:{text:{query:(null==t?void 0:t.searchTitle)||(null==t?void 0:t.title),text_type:""}}},n]},n.addMindMap=function(t){var e,n,a=t.item,i=t.state,o=this.data.get("mindMapList")||[],r=this.data.get("loadingMindMapItem"),s=(null==(n=this.mindMapDataTransfer)||null==(e=n.mindMap)?void 0:e.items)||[],l=o.filter((function(t){return(null==t?void 0:t.id)!==KD})).concat(a),c=i===Tf.COMPLETED,d=l.length===s.length,u=c&&d; __call$(this.data,"assign",[{state:i,mindMapList:u?l:[].concat(l,[r])}]) },n.updateMindMap=function(t){var e=t.item,n=t.state,a=this.data.get("mindMapList").map((function(t){return t.id===e.id?JD({},t,e):t})); __call$(this.data,"assign",[{mindMapList:a,state:n}]) },n.deleteMindMap=function(t){var e=t.item,n=t.state,a=this.data.get("mindMapList").filter((function(t){return t.id!==e.id})); __call$(this.data,"assign",[{mindMapList:a,state:n}]) },n.reset=function(){this.data.set("mindMapList",[this.data.get("loadingMindMapItem")]),this.data.set("state",Tf.INIT),this.startTime=null,this.hasSentDurationLog=!1},n.showTour=function(){var t=this.data.get("mindMapList").find((function(t){return 2===t.level}));if(t){var e=this.ref("mindMapItem-"+t.id);e&&(this.showTourItemRef=e,e.openTour())}},n.executeAction=function(t){var e=t.type,n=t.itemInfo,a=t.cb;switch(e){case"add":this.addMindMap(n);break;case"update":this.updateMindMap(n);break;case"delete":this.deleteMindMap(n)}null==a||a()},n.close=function(){on.dispatch("update",{showMindMap:!1})},n.sendShowLog=function(){var t=0,e=0,n=this.data.get("mindMapList").map((function(n,a){return 1===n.level?(t++,e=0):e++,{idea_query:n.title,pos:String(t),sub_pos:String(e),total_pos:String(a+1)}}));0===n.length||this.data.get("hasSendLog")||(Ua({type:"show",value:"idea",ext:{enter_type:on.getState("pcEnterType")||"ai_tab_url",setype:"csaitab",ori_lid:on.getState("oriLid"),lid:on.getState("lid"),sa:on.getState("oriSa"),re_rank:String(on.getState("rank")),a_lid:on.getState("apagelid"),valueInfo:[{component_name:"mindMap",component_content:n}],query:on.getState("query"),action_type:this.data.get("actionType")}}),this.data.set("hasSendLog",!0))},n.sendClickLog=function(t,e){Ua({type:"click",value:"idea",ext:HD({mindMapList:this.data.get("mindMapList"),item:t,index:e,actionType:this.data.get("actionType")})})},n.addMaskListener=function(){var t=this,e=this.ref("scroll-container"),n=this.ref("scroll-content");this.onScroll=function(){var n=e.scrollTop,a=e.scrollHeight;n+e.clientHeight>=a-1?t.data.set("showMask",!1):t.data.set("showMask",!0)},e.addEventListener("scroll",this.onScroll),window.ResizeObserver&&(this.resizeObserver=new ResizeObserver((function(){var n=e.scrollTop,a=e.scrollHeight;n+e.clientHeight>=a-1?t.data.set("showMask",!1):t.data.set("showMask",!0)})),this.resizeObserver.observe(n))},n.sendDurationLog=function(t){var e=t.startTime,n=t.endTime,a=t.duration;Ua({ubcId:"17630",type:"show",value:"idea_create_time",ext:JD({},BD(),{starttime:String(e),endtime:String(n),duration:String(a)})})},n.removeMaskListener=function(){var t,e=this.ref("scroll-container");null==e||e.removeEventListener("scroll",this.onScroll),this.onScroll=null,null==(t=this.resizeObserver)||t.disconnect(),this.resizeObserver=null},e}(a.Component);XD.components={"sk-loading":gc,item:UD},XD.computed={isLoading:function(){return this.data.get("state")===Tf.INIT}};var YD={};YD= __call$(Object,"assign",[YD,{mindMap:"mind-map_fkjr0_1","mind-map":"mind-map_fkjr0_1",showMask:"show-mask_fkjr0_21","show-mask":"show-mask_fkjr0_21",mindMapHeader:"mind-map-header_fkjr0_24","mind-map-header":"mind-map-header_fkjr0_24",mindMapHeaderIcon:"mind-map-header-icon_fkjr0_33","mind-map-header-icon":"mind-map-header-icon_fkjr0_33",mindMapListWrapper:"mind-map-list-wrapper_fkjr0_39","mind-map-list-wrapper":"mind-map-list-wrapper_fkjr0_39",mindMapListContainer:"mind-map-list-container_fkjr0_46","mind-map-list-container":"mind-map-list-container_fkjr0_46",mindMapItemContainer:"mind-map-item-container_fkjr0_53","mind-map-item-container":"mind-map-item-container_fkjr0_53"}]) ,XD.template='\n    <div \n        class="\n            {{$style[\'mind-map\']}}\n            {{showMask ? $style[\'show-mask\'] : \'\'}}\n        "\n    >\n        <div class="{{$style[\'mind-map-header\']}}">\n            <img\n                class="{{$style[\'mind-map-header-icon\']}}"\n                src="https://psstatic.cdn.bcebos.com/basics/aichat/思路_1734335685000.png"\n                alt=""\n            />\n            灵感探索\n        </div>\n        <div\n            s-ref="scroll-container"\n            class="{{$style[\'mind-map-list-wrapper\']}}"\n        >\n            <div\n                s-ref="scroll-content"\n                class="{{$style[\'mind-map-list-container\']}}"\n            >\n                \x3c!-- 大纲思路节点内容 --\x3e\n                <div\n                    class="{{$style[\'mind-map-item-container\']}}"\n                    s-ref="mindMapItemContainer"\n                >\n                    <sk-loading s-if="{{isLoading}}" />\n                    <template s-else>\n                        <template s-for="item, index in mindMapList">\n                            <item\n                                s-ref="mindMapItem-{{item.id}}"\n                                item="{{item}}"\n                                index="{{index}}"\n                                on-click="native:handleItemClick(item, index)"\n                                action-type="{{actionType}}"\n                                mind-map-list="{{mindMapList}}"\n                            />\n                        </template>\n                    </template>\n                </div>\n            </div>\n        </div>\n    </div>\n';var ZD="function"==typeof XD?XD.prototype.initData||tP:XD.initData||tP;function tP(){return{$style:YD}}function eP(){return  __call$(Object,"assign",[{},ZD.call(this),{$style:YD}]) }function nP(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function aP(){return aP=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},aP.apply(this,Array.from(arguments))}function iP(t,e){return iP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},iP(t,e)}function oP(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof XD?XD.prototype.initData=eP:XD.initData=eP;var rP,sP=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&iP(t,e)}(e,t);var n=e.prototype;return n.initData=function(){return{agentsList:[]}},n.handleAgentClick=function(t,e){return(n=function(){var n,a,i,o,r,s;return oP(this,(function(l){switch(l.label){case 0:return[4,gs()];case 1:return l.sent()?(n=t.agentId,a=t.agentParams,i=void 0===a?{}:a,o=t.text,r=aP({actionType:"launchConversation",agentId:n,agentSearchId:n,agentName:o,logo:null==t?void 0:t.icon,startIndex:0,endIndex:o.length},i),s=on.getState("agentQuery")||on.getState("query"),Cs(r,"agent_idea_"+(e+1)),Ds(r,s||""),[2]):[2]}}))},function(){var t=this,e=Array.from(arguments);return new Promise((function(a,i){var o=n.apply(t,e);function r(t){nP(o,a,i,r,s,"next",t)}function s(t){nP(o,a,i,r,s,"throw",t)}r(void 0)}))})();var n},n.getUbcShowLog=function(t,e){return JSON.stringify({value:"agent_idea",query:on.getState("query"),agent_content:[{agent_id:null==t?void 0:t.agentId,agent_name:null==t?void 0:t.text,agent_pos:e+1}]})},n.getUbcClickLog=function(t,e){return JSON.stringify({value:"agent_idea",ubcExt:{query:on.getState("query"),agent_content:[{agent_id:null==t?void 0:t.agentId,agent_name:null==t?void 0:t.text,agent_pos:e+1}]}})},e}(a.Component);function lP(t,e){return lP=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lP(t,e)}sP.template='\n        <div class="chat-agents-list">\n            <div class="chat-agents-list-title">\n                <img class="chat-agents-list-title-icon" src="https://psstatic.cdn.bcebos.com/basics/aichat/智能体_1734335690000.png" alt="" />\n                问问智能体\n            </div>\n            <div class="chat-agents-list-content">\n                <template s-for="agent, index in agentsList">\n                    <div \n                        class="chat-agents-list-item" \n                        on-click="handleAgentClick(agent, index)"\n                        data-show-area\n                        data-show-ext="{{getUbcShowLog(agent, index)}}"\n                        need-click-log\n                        data-click-log="{{getUbcClickLog(agent, index)}}"\n                    >\n                        <div class="chat-agents-list-item-left">\n                            <img class="chat-agents-list-item-avatar" src="{{agent.icon}}" alt="" />\n                            <div class="chat-agents-list-item-info">\n                                <div class="chat-agents-list-item-name cos-line-clamp-1">{{agent.text}}</div>\n                                <div class="chat-agents-list-item-desc cos-line-clamp-1">{{agent.agentParams.description}}</div>\n                            </div>\n                        </div>\n                        <div class="chat-agents-list-item-right">\n                            <div class="chat-agents-list-item-btn">提问</div>\n                        </div>\n                    </div>\n                </template>\n            </div>\n        </div>\n    ';var cP=Tt.connect(on,{showMindMap:"showMindMap"})((rP=function(t){function e(){return t.apply(this,Array.from(arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lP(t,e)}(e,t),e.prototype.initData=function(){return{agentsList:[],showAgentNum:2}},e}(a.Component),rP.template='\n        <div class="chat-right-bar">\n            <div class="mind-map-wrapper" style="{{LayoutStyles.topLayerStyle}}">\n                <mind-map />\n            </div>\n            <div\n                s-if="showDivider"\n                class="cos-divider"\n            />\n            <div class="agents-list-wrapper" style="{{LayoutStyles.bottomLayerStyle}}">\n                <agents-list agents-list="{{showAgentsList}}" />\n            </div>\n        </div>\n    ',rP.components={"agents-list":sP,"mind-map":XD},rP.computed={showDivider:function(){var t=this.data.get("showAgentsList")||[];return this.data.get("showMindMap")&&t.length>0},LayoutStyles:function(){var t=this.data.get("showAgentsList")||[],e=this.data.get("showMindMap"),n=function(t){var e,n=t.containerHeight,a=t.agentsListSize,i=t.showMindMap,o=t.dividerHeight,r="number"==typeof n?n+"vh":n,s=0===(e=a)?0:56+40*e+18*(e-1),l=i&&a>0;return{containerStyle:{height:r},topLayerStyle:{height:i?l?"calc("+r+" - "+(s+o)+"px)":"calc("+r+" - "+s+"px)":"0px",opacity:i?1:0,transition:"all 240ms ease-in-out"},bottomLayerStyle:{height:s+"px",opacity:0===a?0:1,transition:"all 360ms ease-in-out"},showDivider:l}}({containerHeight:"100%",agentsListSize:t.length,showMindMap:e,dividerHeight:.5});return n},showAgentsList:function(){return(this.data.get("agentsList")||[]).slice(0,this.data.get("showAgentNum"))}},rP)),dP="生成中，请耐心等待～",uP="生成完成，可前往文库编辑或下载文件",pP="https://now.bdstatic.com",hP="store/v2/d4f2bff/chat-search/30c07c9/",fP={js:[pP+"/"+hP+"chat-wenku.umd.9f2536f56808ffa1eb54.js"],css:[pP+"/"+hP+"chat-wenku.umd.9f2536f56808ffa1eb54.css"]},gP={},mP={};mP= __call$(Object,"assign",[mP,{nxtBtn:"nxt-btn_1g1og_1","nxt-btn":"nxt-btn_1g1og_1"}]) ,gP.template='\n    <div class="{{$style[\'nxt-btn\']}}">\n        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path\n                d="M4.96491 0.892578L9.8056 5.73327C10.5566 6.48427 10.5566 7.7019 9.8056 8.45291L4.96491 13.2936L3.33313 11.6618L7.9021 7.09309L3.33313 2.52436L4.96491 0.892578Z"\n                fill="#333333"\n            />\n        </svg>\n    </div>\n';var vP="function"==typeof gP?gP.prototype.initData||yP:gP.initData||yP;function yP(){return{$style:mP}}function wP(){return  __call$(Object,"assign",[{},vP.call(this),{$style:mP}]) }"function"==typeof gP?gP.prototype.initData=wP:gP.initData=wP;var bP=Tt.connect(on,{showWorkspaceType:"showWorkspaceType",workspaceData:"workspaceData"})(a.defineComponent({components:{"cos-icon":e.Icon,"cos-loading":e.Loading,"cos-button":e.Button,"nxt-btn":gP},initData:function(){return{renderPptKey:"",renderFinished:!1,editorMounted:!1,remainDownloadCount:0,vipStatus:0,loadingInstance:null,leftEnd:!1,rightEnd:!1,pptsInfo:{},pptEditors:{},pptThumbnails:{},pptIdx:{},sseLock:!1,hasPptDownload:!1}},computed:{canDownload:function(){var t=this.data.get("remainDownloadCount");return t>0||1===this.data.get("vipStatus")||this.data.get("hasPptDownload")||-1===t},headerText:function(){if(this.data.get("renderFinished"))return uP;var t=this.data.get("workspaceData.wenku.pptId"),e= __get$(this.data.get("pptsInfo"),t) ;return"static"===(null==e?void 0:e.renderType)?"":dP},curIdx:function(){var t=this.data.get("workspaceData.wenku.pptId");return  __get$(this.data.get("pptIdx"),t) ||0}},attached:function(){var t=this;this.loadAnimationInstance();var e,n=this.data.get("workspaceData.wenku.pptId"),a= __get$(this.data.get("pptsInfo"),n) ;this.data.set("hasPptDownload",null!=(e=null==a?void 0:a.isDownload)&&e),this.watch("pptsInfo",(function(e){var n,a=t.data.get("workspaceData.wenku.pptId"),i= __get$(e,a) ;t.data.set("hasPptDownload",null!=(n=null==i?void 0:i.isDownload)&&n),t.loadPptEditor(i,a)})),this.data.get("sdkLoaded")&&this.loadPptEditor(a,n),this.watch("sdkLoaded",(function(e){e&&t.loadPptEditor(a,n)}))},loadPptEditor:function(t,e){var n=this,a=this.data.get("sdkLoaded");if(t&&a){var i=Mb(e,t.renderType); __get$(this.data.get("pptEditors"),i) ||"static"!==t.renderType||(this.data.set("editorMounted",!1),this.data.set("renderFinished",!1));var o=document.querySelectorAll(".ppt-preview-root-item"),r=Nb(this.data.get("workspaceData.wenku.pptId"),t.renderType);o.forEach((function(t){t.style.display="none"}));var s=document.getElementById(r);s&&(s.style.display="block"),setTimeout((function(){window.require(["@baidu/chat-wenku"],(function(a){var i=a.createPPTEditor,o=Nb(e,t.renderType),r=Mb(e,t.renderType),s= __get$(n.data.get("pptEditors"),r) ;if(!s){s=i({platform:"app",disableEditSlide:!0}),n.data.set("pptEditors."+r,s);var l=document.getElementById("ppteditor-preview"),c=document.createElement("div");c.id=o,c.classList.add("ppt-preview-root-item"),l.appendChild(c),s.app.mount("#"+o),window.naChangeThumbnailSlideWidth(200),null==s||s.on("EDITOR_SLIDE_RENDERED",(function(){if(e===n.data.get("workspaceData.wenku.pptId")&&!t.endTurn){var a=t.bdjson,i= __get$(n.data.get("pptIdx"),e) ;i<a.length?(s.addSlideByElement( __get$(a,i) ),n.data.set("pptIdx."+e,i+1)):n.data.set("sseLock",!1)}})),null==s||s.on("EDITOR_CHECK_BDJSON_FINISH",(function(){n.data.set("renderFinished",!0),n.scrollToPptCover(),n.listenerHandleScroll=n.handleScroll.bind(n);var a=qb(Nb(e,t.renderType));null==a||a.addEventListener("scroll",n.listenerHandleScroll)}))}s.pptUniqId=e,n.execRenderPpt(s,t),n.data.set("editorMounted",!0)}))}),300)}},scrollToPptCover:function(){var t=this.data.get("workspaceData.wenku.pptId"),e= __get$(this.data.get("pptsInfo"),t) ,n=qb(Nb(t,e.renderType));if(e&&n){n.scrollLeft=0;var a=n.querySelector(".thumbnail-list .thumbnail-item");a&&a.click()}},execRenderPpt:function(t,e){"static"===e.renderType?this.renderPptSlidesStatic(t,e):this.renderPptSlidesSse(t,e)},renderPptSlidesStatic:function(t,e){var n=e.bdjson;t.setSlides([]),null==t||t.setBdjson(n),null==t||t.checkBdjson(n)},renderPptSlidesSse:function(t,e){var n=e.bdjson,a=this.data.get("curIdx"),i=this.data.get("workspaceData.wenku.pptId");0===a?(t.setBdjson(n),this.data.set("pptIdx."+i,n.length)):this.data.get("sseLock")||(t.addSlideByElement( __get$(n,a) ),this.data.set("pptIdx."+i,a+1),this.data.set("sseLock",!0)),e.endTurn&&(this.data.set("pptIdx."+i,n.length),t.checkBdjson(n))},jumpToWenku:function(){if(this.data.get("renderFinished")){var t=this.data.get("workspaceData.wenku.pptId"),e= __get$(this.data.get("pptsInfo"),t) ;if(e&&e.docId){var n=Rb(e.docId);window.open(n),Ua({type:"click",value:"ppt_go_wenku",page:"resultpage",ext:{enter_type:"home_tab",setype:"csaitab",area:"pptdesk",re_rank:on.getState("rank"),a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),lid:on.getState("lid")}})}}},downloadPptHandler:function(){this.data.get("renderFinished")&&(this.data.get("canDownload")?(Zs().emit({pptUniqId:this.data.get("workspaceData.wenku.pptId")}),this.data.set("hasPptDownload",!0),this.ubcDownloadClickLog("ppt_download")):(this.ubcDownloadClickLog("ppt_charge_download"),this.fire("jump-to-wenku-vip")))},ubcDownloadClickLog:function(t){Ua({type:"click",value:t,page:"resultpage",ext:{enter_type:"home_tab",setype:"csaitab",area:"pptdesk",re_rank:on.getState("rank"),a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),lid:on.getState("lid")}})},handlePrev:function(){var t=this.data.get("workspaceData.wenku.pptId"),e=qb(Nb(t, __get$(this.data.get("pptsInfo"),t) .renderType)),n=this.ref("pptEditorPreview"),a=(null==n?void 0:n.clientWidth)||200;if(e){var i=e.scrollLeft,o=Math.max(i-a,0);e.scrollTo({left:o,behavior:"smooth"}),0===o&&this.data.set("leftEnd",!0)}},handleNext:function(){var t=this.data.get("workspaceData.wenku.pptId"),e=qb(Nb(t, __get$(this.data.get("pptsInfo"),t) .renderType)),n=this.ref("pptEditorPreview"),a=(null==n?void 0:n.clientWidth)||200;if(e){var i=e.scrollLeft,o=e.scrollWidth-e.clientWidth,r=Math.min(i+a,o);e.scrollTo({left:r,behavior:"smooth"}),r>=o&&this.data.set("rightEnd",!0)}},handleScroll:function(){var t=this.data.get("workspaceData.wenku.pptId"),e= __get$(this.data.get("pptsInfo"),t) ;if(e){var n=qb(Nb(t,null==e?void 0:e.renderType));if(n){var a=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;this.data.set("rightEnd",Math.abs(i-o-a)<4),this.data.set("leftEnd",0===a)}}},loadAnimationInstance:function(){var e=this;new Promise((function(e,n){t(["lottie-web"],(function(t){e(d(t))}),n)})).then((function(t){var n=t.default,a={container:e.ref("pptLoading"),renderer:"svg",loop:!0,autoplay:!0,path:"https://psstatic.cdn.bcebos.com/basics/chat/ppt-big-loading_1741768414000.json"};e.data.set("loadingInstance",n.loadAnimation(a))}))},removeScrollListener:function(t){var e= __get$(this.data.get("pptsInfo"),t) ,n=qb(Nb(t,null==e?void 0:e.renderType));n&&n.removeEventListener("scroll",this.listenerHandleScroll)},disposed:function(){var t=this;Object.keys(this.data.get("pptsInfo")).forEach((function(e){t.removeScrollListener(e);var n= __get$(t.data.get("pptsInfo"),e) ,a=Mb(e,null==n?void 0:n.renderType); __get$(t.data.get("pptEditors"),a) &&( __get$(t.data.get("pptEditors"),a) .off("EDITOR_SLIDE_RENDERED"), __get$(t.data.get("pptEditors"),a) .off("EDITOR_CHECK_BDJSON_FINISH"))}));var e=this.data.get("loadingInstance");e&&e.destroy()}})),_P={};_P= __call$(Object,"assign",[_P,{previewArea:"preview-area_1c4ch_1","preview-area":"preview-area_1c4ch_1",previewHeader:"preview-header_1c4ch_6","preview-header":"preview-header_1c4ch_6",headerText:"header-text_1c4ch_12","header-text":"header-text_1c4ch_12",pptPreviewPlaceholder:"ppt-preview-placeholder_1c4ch_18","ppt-preview-placeholder":"ppt-preview-placeholder_1c4ch_18",pptLoading:"ppt-loading_1c4ch_23","ppt-loading":"ppt-loading_1c4ch_23",pptLoadingSubImg:"ppt-loading-sub-img_1c4ch_31","ppt-loading-sub-img":"ppt-loading-sub-img_1c4ch_31",csLoading:"cs-loading_1c4ch_39","cs-loading":"cs-loading_1c4ch_39",pptPreviewRoot:"ppt-preview-root_1c4ch_50","ppt-preview-root":"ppt-preview-root_1c4ch_50",ppteditorPreviewContainer:"ppteditor-preview-container_1c4ch_54","ppteditor-preview-container":"ppteditor-preview-container_1c4ch_54",ppteditorPreview:"ppteditor-preview_1c4ch_54","ppteditor-preview":"ppteditor-preview_1c4ch_54",previewFooter:"preview-footer_1c4ch_134","preview-footer":"preview-footer_1c4ch_134",cosButtonContent:"cos-button-content_1c4ch_145","cos-button-content":"cos-button-content_1c4ch_145",btn:"btn_1c4ch_154",downloadBtn:"download-btn_1c4ch_170","download-btn":"download-btn_1c4ch_170",editBtn:"edit-btn_1c4ch_177","edit-btn":"edit-btn_1c4ch_177",editIcon:"edit-icon_1c4ch_182","edit-icon":"edit-icon_1c4ch_182",remainDownloadCount:"remain-download-count_1c4ch_189","remain-download-count":"remain-download-count_1c4ch_189",nxtMask:"nxt-mask_1c4ch_194","nxt-mask":"nxt-mask_1c4ch_194",preMask:"pre-mask_1c4ch_195","pre-mask":"pre-mask_1c4ch_195",visible:"visible_1c4ch_204",nxtBtn:"nxt-btn_1c4ch_210","nxt-btn":"nxt-btn_1c4ch_210",preBtn:"pre-btn_1c4ch_212","pre-btn":"pre-btn_1c4ch_212"}]) ,bP.template='\n    <div class="{{$style[\'preview-area\']}}">\n        <div class="{{$style[\'preview-header\']}}">\n            <div class="{{$style[\'header-text\']}}">{{ headerText }}</div>\n        </div>\n        <div class="{{$style[\'ppt-preview-placeholder\']}}">\n            <div\n                s-show="!editorMounted"\n                class="{{$style[\'ppt-loading\']}}"\n            >\n                <div class="{{$style[\'ppt-loading-sub-img\']}}">\n                    <cos-loading\n                        text=""\n                        class="{{$style[\'cs-loading\']}}"\n                    />\n                </div>\n                <div\n                    s-ref="pptLoading"\n                    class="{{$style[\'ppt-loading-img\']}}"\n                >\n                </div>\n            </div>\n            <div\n                id="ppt-preview-root"\n                class="{{$style[\'ppt-preview-root\']}}"\n            >\n                <div class="{{$style[\'ppteditor-preview-container\']}} cs-ppt">\n                    <div\n                        s-ref="pptEditorPreview"\n                        id="ppteditor-preview"\n                        class="{{$style[\'ppteditor-preview\']}}"\n                    ></div>\n                    <div\n                        class="\n                        {{$style[\'pre-mask\']}}\n                        {{!leftEnd ? $style.visible : \'\'}}\n                    "\n                    >\n                        <div\n                            class="{{$style[\'pre-btn\']}}"\n                            on-click="handlePrev"\n                        >\n                            <nxt-btn />\n                        </div>\n                    </div>\n                    <div\n                        class="\n                        {{$style[\'nxt-mask\']}}\n                        {{!rightEnd ? $style.visible : \'\'}}\n                    "\n                    >\n                        <div\n                            class="{{$style[\'nxt-btn\']}}"\n                            on-click="handleNext"\n                        >\n                            <nxt-btn />\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="{{$style[\'preview-footer\']}}">\n            <cos-button\n                appearance="text"\n                on-click="jumpToWenku"\n                disabled="{{!renderFinished}}"\n                class="loading-text\n                    {{$style.btn}}\n                    {{$style[\'edit-btn\']}}"\n            >\n                <img\n                    class="{{$style[\'edit-icon\']}}\n                        cos-space-mr-xxs"\n                    src="https://psstatic.cdn.bcebos.com/basics/chat/logo_1741863562000.svg"\n                    alt="wenku-logo"\n                />\n                <span>去文库编辑</span>\n            </cos-button>\n            <cos-button\n                disabled="{{!renderFinished}}"\n                on-click="downloadPptHandler"\n                class="loading-primary\n                    {{$style.btn}}\n                    {{$style[\'download-btn\']}}"\n            >\n                <cos-icon\n                    class="\n                    {{$style[\'download-icon\']}}\n                    cos-space-mr-xxs"\n                    style="font-size: 16px"\n                    name="download"\n                />\n                <span s-if="canDownload">\n                    <span>{{ hasPptDownload ? \'已下载\' : \'下载\' }}</span>\n                    <span\n                        s-if="vipStatus !== 1 && !hasPptDownload && remainDownloadCount !== -1"\n                        class="{{$style[\'remain-download-count\']}}"\n                    >\n                        (剩余{{ remainDownloadCount }}次)</span\n                    >\n                </span>\n                <span s-else>去文库开通会员下载</span>\n            </cos-button>\n        </div>\n    </div>\n';var kP="function"==typeof bP?bP.prototype.initData||SP:bP.initData||SP;function SP(){return{$style:_P}}function xP(){return  __call$(Object,"assign",[{},kP.call(this),{$style:_P}]) }"function"==typeof bP?bP.prototype.initData=xP:bP.initData=xP;var IP=a.defineComponent({components:{},computed:{},created:function(){},initData:function(){return{themeInfo:"",index:"",selectIndex:"",vipStatus:0}},attached:function(){var t=this;this.handleLazyLoad(),this.watch("themeInfo",(function(){t.handleLazyLoad()}))},handleLazyLoad:function(){var t=this,e=new IntersectionObserver((function(t,e){t.forEach((function(t){if(t.isIntersecting){var n=t.target,a=n.getAttribute("data-src");n&&a&&(n.setAttribute("src",a),e.unobserve(n))}}))}),{rootMargin:"0px 200px"});this.nextTick((function(){var n=t.ref("themeImg");n&&e.observe(n);for(var a=0;a<3;a++){var i=t.ref("themeImg"+a);i&&e.observe(i)}})),this.observer=e},handleSelectTheme:function(){this.data.set("selectIndex",this.data.get("index"))},disposed:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}}),TP={};TP= __call$(Object,"assign",[TP,{pptImgTheme:"ppt-img-theme_w7txe_1","ppt-img-theme":"ppt-img-theme_w7txe_1",pptImgThemeFree:"ppt-img-theme-free_w7txe_11","ppt-img-theme-free":"ppt-img-theme-free_w7txe_11",selected:"selected_w7txe_24",pptImgThemeLeft:"ppt-img-theme-left_w7txe_28","ppt-img-theme-left":"ppt-img-theme-left_w7txe_28",pptImgThemeLeftImg:"ppt-img-theme-left-img_w7txe_32","ppt-img-theme-left-img":"ppt-img-theme-left-img_w7txe_32",pptImgThemeRight:"ppt-img-theme-right_w7txe_40","ppt-img-theme-right":"ppt-img-theme-right_w7txe_40",pptImgThemeRightImg:"ppt-img-theme-right-img_w7txe_47","ppt-img-theme-right-img":"ppt-img-theme-right-img_w7txe_47"}]) ,IP.template='\n    <div\n        class="{{$style[\'ppt-img-theme\']}} {{index === selectIndex ? $style[\'selected\'] : \'\'}}"\n        on-click="handleSelectTheme"\n        s-ref="themeContainer"\n    >\n        <div\n            class="{{$style[\'ppt-img-theme-free\']}}"\n            s-if="themeInfo.isVipTheme && vipStatus === 0"\n        >\n            限免\n        </div>\n        <div class="{{$style[\'ppt-img-theme-left\']}}">\n            <img\n                class="{{$style[\'ppt-img-theme-left-img\']}}"\n                s-ref="themeImg"\n                data-src="{{themeInfo.pcSelectUrl}}"\n                alt=""\n            />\n        </div>\n        <div class="{{$style[\'ppt-img-theme-right\']}}">\n            <img\n                class="{{$style[\'ppt-img-theme-right-img\']}}"\n                s-for="item, index in themeInfo.pcrotateImgUrl"\n                s-ref="{{\'themeImg\' + index}}"\n                data-src="{{item.url}}"\n                alt=""\n            />\n        </div>\n    </div>\n';var CP="function"==typeof IP?IP.prototype.initData||LP:IP.initData||LP;function LP(){return{$style:TP}}function DP(){return  __call$(Object,"assign",[{},CP.call(this),{$style:TP}]) }"function"==typeof IP?IP.prototype.initData=DP:IP.initData=DP;var PP=a.defineComponent({trimWhitespace:"all",components:{"ppt-img-theme":IP,"cos-icon":e.Icon,"cos-button":e.Button},computed:{isWenkuWhite:function(){return-1===this.data.get("remainGenerateCount")},isInitShow:function(){return-2===this.data.get("remainGenerateCount")}},created:function(){},initData:function(){return{templateList:[],themeId:"",selectIndex:0,showLeftButton:!1,showRightButton:!1,isScrolling:!1,vipStatus:0,remainGenerateCount:0,outlineLid:"",outlineQid:""}},attached:function(){var t=this;setTimeout((function(){t.updateButtonVisibility()}),500),this.updateButtonVisibilityOB=this.updateButtonVisibility.bind(this),window.addEventListener("resize",this.updateButtonVisibilityOB)},handlePptBtnClick:function(){var t;"1"===(null==(t=document.getElementById("outline-editor"+this.data.get("outlineQid")))?void 0:t.getAttribute("has-empty-title"))?tl().emit({outlineQid:this.data.get("outlineQid")}):this.handleGeneratePPT()},handleGeneratePPT:function(){var t={type:"click",value:"ppt_generate",page:"resultpage",ext:{enter_type:"home_tab",setype:"csaitab",area:"pptdesk",is_plugin:"0",re_rank:on.getState("rank"),a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),lid:on.getState("lid")}};if(this.data.get("remainGenerateCount")<=0&&!this.data.get("isWenkuWhite"))this.data.get("vipStatus")?e.Toast.show({message:"本月PPT生成达会员上限，可切换百度账号继续体验。",duration:2e3}):(this.fire("jump-to-wenku-vip"),e.Toast.show({message:"生成需去文库开通会员"}),t.value="ppt_charge_time",Ua(t));else{var n= __get$(this.data.get("templateList"),this.data.get("selectIndex")) ;this.updatePptRanks(),Xl({query:"基于大纲和所选模板生成PPT",extParams:{sa:"pptdesk_generate",interactionType:5,searchInfo:{knowledgeId:Mr(),pptInfo:{outlineLid:this.data.get("outlineLid"),outlineQid:this.data.get("outlineQid"),themeId:this.data.get("themeId"),styleId:n.styleId,tplId:n.tplId}}}}),this.fire("update-remain-count"),t.value="ppt_generate",Ua(t),this.nextTick((function(){Ys().emit({type:"ppt-active"})}))}},updatePptRanks:function(){var t=on.getState("pptRanks")||[],e=on.getState("curRankInfo.rank")+1,n=on.getState("withoutStopSseRanks")||[];on.dispatch("update",{pptRanks:[].concat(t,[e]),withoutStopSseRanks:[].concat(n,[e])})},getLogInfo:function(t){return JSON.stringify({type:"click",value:t,page:"resultpage",ubcExt:{enter_type:"home_tab",setype:"csaitab",area:"pptdesk"}})},updateButtonVisibility:function(){var t=this.ref("scrollContainer");if(t){var e=t.scrollLeft,n=t.scrollWidth,a=t.clientWidth;this.data.set("showLeftButton",Math.floor(e)>0),this.data.set("showRightButton",Math.ceil(e)<n-a)}},handleScrollAction:function(t,e){var n=this;void 0===e&&(e=500),this.data.get("isScrolling")||(this.data.set("isScrolling",!0),t(),setTimeout((function(){n.data.set("isScrolling",!1)}),e))},handleScroll:function(t){var e=this;this.handleScrollAction((function(){var n=e.ref("scrollContainer");if(n){var a=n.clientWidth;n.scrollBy({left:"left"===t?-a:a,behavior:"smooth"})}}))},disposed:function(){window.removeEventListener("resize",this.updateButtonVisibilityOB)}}),EP={};EP= __call$(Object,"assign",[EP,{chatPptContainer:"chat-ppt-container_1mumr_1","chat-ppt-container":"chat-ppt-container_1mumr_1",chatPptContainerHeader:"chat-ppt-container-header_1mumr_6","chat-ppt-container-header":"chat-ppt-container-header_1mumr_6",chatPptContainerHeaderTitle:"chat-ppt-container-header-title_1mumr_9","chat-ppt-container-header-title":"chat-ppt-container-header-title_1mumr_9",chatPptContainerHeaderText:"chat-ppt-container-header-text_1mumr_15","chat-ppt-container-header-text":"chat-ppt-container-header-text_1mumr_15",chatPptThemeListContainer:"chat-ppt-theme-list-container_1mumr_21","chat-ppt-theme-list-container":"chat-ppt-theme-list-container_1mumr_21",chatPptThemeListLeft:"chat-ppt-theme-list-left_1mumr_27","chat-ppt-theme-list-left":"chat-ppt-theme-list-left_1mumr_27",hidden:"hidden_1mumr_40",leftIconWrapper:"left-icon-wrapper_1mumr_44","left-icon-wrapper":"left-icon-wrapper_1mumr_44",csIconLeft:"cs-icon-left_1mumr_59","cs-icon-left":"cs-icon-left_1mumr_59",chatPptThemeListRight:"chat-ppt-theme-list-right_1mumr_70","chat-ppt-theme-list-right":"chat-ppt-theme-list-right_1mumr_70",rightIconWrapper:"right-icon-wrapper_1mumr_87","right-icon-wrapper":"right-icon-wrapper_1mumr_87",csIconRight:"cs-icon-right_1mumr_102","cs-icon-right":"cs-icon-right_1mumr_102",chatPptThemeList:"chat-ppt-theme-list_1mumr_21","chat-ppt-theme-list":"chat-ppt-theme-list_1mumr_21",chatPptThemeListWrapper:"chat-ppt-theme-list-wrapper_1mumr_126","chat-ppt-theme-list-wrapper":"chat-ppt-theme-list-wrapper_1mumr_126",chatPptThemePreview:"chat-ppt-theme-preview_1mumr_136","chat-ppt-theme-preview":"chat-ppt-theme-preview_1mumr_136",chatPptThemePreviewWrapper:"chat-ppt-theme-preview-wrapper_1mumr_139","chat-ppt-theme-preview-wrapper":"chat-ppt-theme-preview-wrapper_1mumr_139",chatPptThemePreviewWrapperImg:"chat-ppt-theme-preview-wrapper-img_1mumr_158","chat-ppt-theme-preview-wrapper-img":"chat-ppt-theme-preview-wrapper-img_1mumr_158",chatPptThemePreviewFooter:"chat-ppt-theme-preview-footer_1mumr_162","chat-ppt-theme-preview-footer":"chat-ppt-theme-preview-footer_1mumr_162",cosButtonContent:"cos-button-content_1mumr_172","cos-button-content":"cos-button-content_1mumr_172",btn:"btn_1mumr_180",generateBtn:"generate-btn_1mumr_195","generate-btn":"generate-btn_1mumr_195",pptLogo:"ppt-logo_1mumr_199","ppt-logo":"ppt-logo_1mumr_199",remainGenerateCount:"remain-generate-count_1mumr_207","remain-generate-count":"remain-generate-count_1mumr_207"}]) ,PP.template='\n    <div class="{{$style[\'chat-ppt-container\']}}">\n        <div class="{{$style[\'chat-ppt-container-header\']}}">\n            <div class="{{$style[\'chat-ppt-container-header-title\']}}"> 选择模版 </div>\n            <div class="{{$style[\'chat-ppt-container-header-text\']}}">\n                选择一个喜欢的主题风格，点击开始生成PPT进入预览模式\n            </div>\n        </div>\n        <div class="{{$style[\'chat-ppt-theme-list-container\']}}">\n            <div class="{{$style[\'chat-ppt-theme-list-left\']}} {{!showLeftButton ? $style.hidden : \'\'}}">\n                <div\n                    class="{{$style[\'left-icon-wrapper\']}}"\n                    on-click="handleScroll(\'left\')"\n                    data-click-log="{{getLogInfo(\'ppt_change_left\')}}"\n                    need-click-log\n                >\n                    <cos-icon\n                        class="{{$style[\'cs-icon-left\']}}"\n                        name="left"\n                    />\n                </div>\n            </div>\n            <div class="{{$style[\'chat-ppt-theme-list-right\']}} {{!showRightButton ? $style.hidden : \'\'}}">\n                <div\n                    class="{{$style[\'right-icon-wrapper\']}}"\n                    on-click="handleScroll(\'right\')"\n                    data-click-log="{{getLogInfo(\'ppt_change_right\')}}"\n                    need-click-log\n                >\n                    <cos-icon\n                        class="{{$style[\'cs-icon-right\']}}"\n                        name="right"\n                    />\n                </div>\n            </div>\n            <div\n                class="{{$style[\'chat-ppt-theme-list\']}}"\n                s-ref="scrollContainer"\n                on-scroll="updateButtonVisibility"\n            >\n                <div class="{{$style[\'chat-ppt-theme-list-wrapper\']}}">\n                    <ppt-img-theme\n                        s-for="item, index in templateList"\n                        theme-info="{{item}}"\n                        index="{{index}}"\n                        select-index="{=selectIndex=}"\n                        vip-status="{{vipStatus}}"\n                    />\n                </div>\n            </div>\n        </div>\n        <div class="{{$style[\'chat-ppt-theme-preview\']}}">\n            <div class="{{$style[\'chat-ppt-theme-preview-wrapper\']}}">\n                <img\n                    class="{{$style[\'chat-ppt-theme-preview-wrapper-img\']}}"\n                    src="{{templateList[selectIndex].pcSelectUrl}}"\n                    alt=""\n                />\n            </div>\n        </div>\n        <div class="{{$style[\'chat-ppt-theme-preview-footer\']}}">\n            <cos-button\n                disabled="{{!isWenkuWhite && vipStatus && remainGenerateCount <= 0}}"\n                need-click-log\n                on-click="handlePptBtnClick"\n                class="{{$style.btn}} {{$style[\'generate-btn\']}}"\n            >\n                <img\n                    class="{{$style[\'ppt-logo\']}}"\n                    src="https://psstatic.cdn.bcebos.com/basics/chat/btn-ppt-logo_1742195947000.svg"\n                    alt=""\n                />\n                <span s-if="remainGenerateCount > 0 || isInitShow || isWenkuWhite">\n                    <span>开始生成PPT</span>\n                    <span\n                        s-if="remainGenerateCount > 0"\n                        class="{{$style[\'remain-generate-count\']}}"\n                    >\n                        (剩余{{ remainGenerateCount }}次)\n                    </span>\n                </span>\n                <span s-else>\n                    <span s-if="vipStatus">PPT生成次数已用完</span>\n                    <span s-else>生成需去文库开通会员</span>\n                </span>\n            </cos-button>\n        </div>\n    </div>\n';var AP="function"==typeof PP?PP.prototype.initData||OP:PP.initData||OP;function OP(){return{$style:EP}}function RP(){return  __call$(Object,"assign",[{},AP.call(this),{$style:EP}]) }function NP(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function MP(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){NP(o,a,i,r,s,"next",t)}function s(t){NP(o,a,i,r,s,"throw",t)}r(void 0)}))}}function qP(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}"function"==typeof PP?PP.prototype.initData=RP:PP.initData=RP;var jP=Tt.connect(on,{showWorkspaceType:"showWorkspaceType"})(a.defineComponent({pollingTimer:null,components:{"ppt-panel":bP,"ppt-template":PP,"cos-icon":e.Icon},initData:function(){return{vipStatus:1,remainDownloadCount:0,remainGenerateCount:-2,currentTab:"",outlineLid:"",outlineQid:"",templateList:[],themeId:"",pptsInfo:{},sdkLoaded:!1}},attached:function(){var t=this;this.microLoader=Bb(),Ys().on((function(e){var n=e.type,a=e.data,i=e.pptUniqId;"template"===n&&(t.data.set("currentTab","template-view"),t.data.set("outlineLid",a.outlineLid),t.data.set("outlineQid",a.outlineQid),t.data.set("templateList",a.templateList),t.data.set("themeId",a.themeId)),"ppt"===n&&(t.data.set("pptsInfo."+i,a),a.endTurn&&t.getRemainCountsHandler()),"ppt-active"===n&&t.data.set("currentTab","ppt-view"),"updateUserInfo"===n&&t.getRemainCountsHandler()})),this.watch("showWorkspaceType",(function(e){"wenku"===e?(t.getRemainCountsHandler(),t.microLoader.loadMicroApp(fP).then((function(){t.data.set("sdkLoaded",!0)}))): __call$(t.data,"assign",[{currentTab:"",outlineLid:"",outlineQid:"",templateList:[],themeId:""}]) })),this.handleStopGenerate(),Gn().on((function(t){var e=t.rank;on.getState("pptRanks").includes(e)&&on.dispatch("update",{showWorkspaceType:""})})),nl().on((function(e){var n=e.curBlock,a=e.rank,i=on.getState("pptRanks").includes(a),o=t.data.get("templateList").length>0;"ppt-viewer"!==(null==n?void 0:n.component)&&i&&o&&t.data.set("currentTab","template-view")}))},handleStopGenerate:function(){var t=Hn().conversation.stopConversation;null==t||t.on((function(){var t=on.getState("pptRanks"),e=on.getState("curRankInfo.rank");t.includes(e)&& __get$(t,t.length-1) ===e&&on.dispatch("update",{showWorkspaceType:""})}))},getRemainCountsHandler:function(){return MP((function(){var t,e,n,a;return qP(this,(function(i){switch(i.label){case 0:return[4,Li(on.getState("chatParams").sse_host+"/aichat/api/ppt/userinfo?tk="+sc(),{credentials:"include"},2e3).then((function(t){return 1003===t.status?Promise.reject(new Error("无数据返回")):0===t.status&&t.data?Promise.resolve(t.data):Promise.reject(new Error("无数据返回"))})).catch((function(t){}))];case 1:return(t=i.sent())?(e=t.vipStatus,n=t.pptGenerate,a=t.pptDownload,this.data.set("remainDownloadCount",a.left),this.data.set("remainGenerateCount",n.left),this.data.set("vipStatus",e),[2,t]):[2,Promise.reject()]}}))})).apply(this)},jumpToWenkuVip:function(){return MP((function(){var t,e;return qP(this,(function(n){return t=this,e=function(){"visible"===document.visibilityState&&(t.startPollingRemainCount(),window.removeEventListener("visibilitychange",e))},window.addEventListener("visibilitychange",e),"ppt-view"===this.data.get("currentTab")?window.open("https://wenku.baidu.com/ndbusiness/browse/wenkuvipcashier?third_fr=search_ppt&cashier_code=P*search_ppt-L*ppt_download"):window.open("https://wenku.baidu.com/ndbusiness/browse/wenkuvipcashier?third_fr=search_ppt&cashier_code=P*search_ppt-L*ppt_generation"),[2]}))})).apply(this)},startPollingRemainCount:function(){this.clearPollingTimer(),e.Toast.show({message:"正在支付中..."});var t=Date.now(),n=this,a=MP((function(){var i,o,r,s,l,c;return qP(this,(function(d){switch(d.label){case 0:return[4,n.getRemainCountsHandler()];case 1:return d.sent(),i=n.data.get("vipStatus"),o=n.data.get("remainDownloadCount"),r=n.data.get("remainGenerateCount"),s="ppt-view"===n.data.get("currentTab")&&o>0,l="template-view"===n.data.get("currentTab")&&r>0,c=Date.now()-t>=6e5,1===i||s||l||c?(c?e.Toast.error({message:"支付失败，请重新跳转支付"}):e.Toast.success({message:"支付成功"}),n.clearPollingTimer(),[2]):(n.pollingTimer=setTimeout(a,2e3),[2])}}))}));a()},clearPollingTimer:function(){this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null)},closeWorkspace:function(){rl().emit()},disposed:function(){this.clearPollingTimer()}})),BP={};BP= __call$(Object,"assign",[BP,{workspaceStageContainer:"workspace-stage-container_1v910_1","workspace-stage-container":"workspace-stage-container_1v910_1",closeIcon:"close-icon_1v910_8","close-icon":"close-icon_1v910_8",workspaceStageContent:"workspace-stage-content_1v910_18","workspace-stage-content":"workspace-stage-content_1v910_18"}]) ,jP.template='\n    <div class="{{$style[\'workspace-stage-container\']}}">\n        <cos-icon\n            name="close"\n            class="{{$style[\'close-icon\']}}"\n            on-click="native:closeWorkspace"\n        />\n        <div class="{{$style[\'workspace-stage-content\']}}">\n            <ppt-panel\n                s-if="currentTab === \'ppt-view\'"\n                vip-status="{{vipStatus}}"\n                current-tab="{{currentTab}}"\n                sdk-loaded="{{sdkLoaded}}"\n                ppts-info="{{pptsInfo}}"\n                remain-download-count="{{remainDownloadCount}}"\n                remain-generate-count="{{remainGenerateCount}}"\n                on-update-remain-count="getRemainCountsHandler"\n                on-jump-to-wenku-vip="jumpToWenkuVip"\n            />\n            <ppt-template\n                s-if="currentTab === \'template-view\'"\n                outline-lid="{{outlineLid}}"\n                outline-qid="{{outlineQid}}"\n                vip-status="{{vipStatus}}"\n                remain-generate-count="{{remainGenerateCount}}"\n                template-list="{{templateList}}"\n                theme-id="{{themeId}}"\n                on-jump-to-wenku-vip="jumpToWenkuVip"\n                on-update-remain-count="getRemainCountsHandler"\n            />\n        </div>\n    </div>\n';var HP="function"==typeof jP?jP.prototype.initData||$P:jP.initData||$P;function $P(){return{$style:BP}}function FP(){return  __call$(Object,"assign",[{},HP.call(this),{$style:BP}]) }"function"==typeof jP?jP.prototype.initData=FP:jP.initData=FP;var UP=function(){var t=null;return function(){return t||(t=new Ob({maxRetries:3,retryDelay:1500,timeout:15e3,onSuccess:function(){},onError:function(t){return console.error("模块加载失败:",t)}})),t}}();var GP="https://now.bdstatic.com",WP="store/v2/d4f2bff/chat-search/b189a03/",zP={js:[GP+"/"+WP+"chat-editor.js"],css:[GP+"/"+WP+"chat-editor.css"]};function QP(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function JP(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var VP=a.defineComponent({trimWhitespace:"all",microLoader:UP(),chatEditor:null,debounceUpdateChatEditor:null,boundBeforeUnloadHandler:null,boundVisibilityChangeHandler:null,initData:function(){return{value:{id:""}}},attached:function(){var t=this;this.debounceUpdateChatEditor=function(t,e){var n=null,a=null;return{debounced:function(){for(var i=Array.from(arguments).length,o=new Array(i),r=0;r<i;r++) __set$(o,r,__get$(Array.from(arguments),r)) ;a=o,n||(n=Ki((function(){t.apply(void 0,[].concat(a)),a=null}),e)),n.apply(void 0,[].concat(o))},executeNow:function(){a&&"function"==typeof t&&(t.apply(void 0,[].concat(a)),a=null)}}}(this.updateChatEditorAction.bind(this),500),this.boundBeforeUnloadHandler=function(){t.debounceUpdateChatEditor.executeNow()},this.boundVisibilityChangeHandler=function(){"hidden"===document.visibilityState&&t.debounceUpdateChatEditor.executeNow()},window.addEventListener("beforeunload",this.boundBeforeUnloadHandler),document.addEventListener("visibilitychange",this.boundVisibilityChangeHandler),this.watchEditor()},messages:{"user-update-editor":function(t){var e=t.value;this.debounceUpdateChatEditor.debounced(e)},"send-duration-log":function(t){var e=t.value,n=e.startTime,a=e.endTime;Ua({ubcId:"17630",type:"show",value:"workspace",ext:{query:on.getState("query"),starttime:n,endtime:a,duration:a-n,lid:on.getState("lid"),re_rank:String(on.getState("rank")),ori_lid:on.getState("oriLid")}})},"get-store-info":function(t){var e=t.value,n=e.key;(0,e.callback)(on.getState(n))}},loadApp:function(){var t=this;this.microLoader.loadMicroApp(zP).then((function(){window.require(["@baidu/chat-editor"],(function(e){var n=e.App,a=t.data.get("hasDelay");setTimeout((function(){t.attachApp(n)}),a?300:0)}))}))},attachApp:function(t){var e=new t({data:{currentFile:this.data.get("currentFile"),value:this.data.get("value")},owner:this});this.chatEditor=e,e.attach(this.el)},watchEditor:function(){this.listenOpenChatEditor=this.watchOpenChatEditor.bind(this),il().on(this.listenOpenChatEditor),this.listenUpdateChatEditor=this.watchUpdateChatEditor.bind(this),al().on(this.listenUpdateChatEditor),this.listenCloseChatEditor=this.watchCloseChatEditor.bind(this),ol().on(this.listenCloseChatEditor)},watchOpenChatEditor:function(t){var e=t.currentFile,n=t.value,a=t.hasDelay;n.id!==this.data.get("value.id")?( __call$(this.data,"assign",[{hasDelay:a,currentFile:e,value:n}]) ,this.chatEditor||this.loadApp()):rl().emit()},watchUpdateChatEditor:function(t){t.id===this.data.get("value.id")&&this.data.set("value",t)},watchCloseChatEditor:function(t){t.id===this.data.get("value.id")&&rl().emit()},updateChatEditorAction:function(t){return(e=function(){var e,n,a,i;return JP(this,(function(o){switch(o.label){case 0:return t?(e=t.logId,n=function(t,e){if(null==t)return{};var n,a,i={},o=Object.keys(t);for(a=0;a<o.length;a++)n= __get$(o,a) ,e.indexOf(n)>=0||( __set$(i,n,__get$(t,n)) );return i}(t,["logId"]),[4,f_({qid:e,lid:on.getState("oriLid"),fileMeta:n})]):[2];case 1:return a=o.sent(),i=a.data,Ua({type:"click",value:"workspace_edit",ext:{query:on.getState("query"),enter_type:on.getState("pcEnterType")}}),i&&ll().emit({id:t.id,fileId:t.fileId,updateTime:i}),[2]}}))},function(){var t=this,n=Array.from(arguments);return new Promise((function(a,i){var o=e.apply(t,n);function r(t){QP(o,a,i,r,s,"next",t)}function s(t){QP(o,a,i,r,s,"throw",t)}r(void 0)}))})();var e},disposed:function(){this.chatEditor&&(this.chatEditor.dispose(),this.chatEditor=null),window.removeEventListener("beforeunload",this.boundBeforeUnloadHandler),document.removeEventListener("visibilitychange",this.boundVisibilityChangeHandler),il().off(this.listenOpenChatEditor),al().off(this.listenUpdateChatEditor)}}),KP={};KP= __call$(Object,"assign",[KP,{container:"container_1br66_1"}]) ,VP.template='\n    <div class="{{$style.container}}"></div>\n';var XP="function"==typeof VP?VP.prototype.initData||YP:VP.initData||YP;function YP(){return{$style:KP}}function ZP(){return  __call$(Object,"assign",[{},XP.call(this),{$style:KP}]) }"function"==typeof VP?VP.prototype.initData=ZP:VP.initData=ZP;var tE=Tt.connect(on,{showWorkspaceType:"showWorkspaceType"})(a.defineComponent({trimWhitespace:"all",components:{"wenku-workspace":jP,"editor-workspace":VP},messages:{"open-workspace-stage":function(t){t&&on.dispatch("update",{showWorkspaceType:t})}},attached:function(){var t=this;rl().on((function(){t.closeWorkspace()})),this.watchShowWorkspaceType()},watchShowWorkspaceType:function(){var t=this;this.watch("showWorkspaceType",(function(e,n){var a=n.oldValue;""===e&&(t.sendLog(a),on.dispatch("update",{workspaceData:{wenku:{outlineLid:"",outlineQid:"",pptId:""}}})),"wenku"!==e&&on.dispatch("update",{workspaceData:{wenku:{outlineLid:"",outlineQid:"",pptId:""}}})}))},sendLog:function(t){Ua({type:"click",value: __get$({wenku:"ppt_desk_close",editor:"editor_desk_close"},t) ,page:"resultpage",ext:{enter_type:"home_tab",setype:"csaitab",area:"pptdesk",re_rank:on.getState("rank"),a_lid:on.getState("apagelid"),ori_lid:on.getState("oriLid"),lid:on.getState("lid")}})},closeWorkspace:function(){on.dispatch("update",{showWorkspaceType:""})}})),eE={};eE= __call$(Object,"assign",[eE,{workspaceStage:"workspace-stage_a9qhj_1","workspace-stage":"workspace-stage_a9qhj_1"}]) ,tE.template="\n    <div class=\"{{$style['workspace-stage']}}\">\n        <wenku-workspace s-show=\"showWorkspaceType === 'wenku'\" />\n        <editor-workspace s-if=\"showWorkspaceType === 'editor'\" />\n    </div>\n";var nE="function"==typeof tE?tE.prototype.initData||aE:tE.initData||aE;function aE(){return{$style:eE}}function iE(){return  __call$(Object,"assign",[{},nE.call(this),{$style:eE}]) }function oE(){!function(t){$l.onPulldown(t)}(Xi((function(){var t=ds(),e=on.getState("isHistoryLoading"),n=on.getState("pulldownDisabled");!t||e||n||(on.dispatch("update",{isHistoryLoading:!0}),Zn().emit({state:Fo.LOADING}),tc(Jo("pc"===rt()||Vo()?{reqType:"5"}:{})))}),1e3,{leading:!0,trailing:!1}))}function rE(t,e,n,a,i,o,r){try{var s= __call$(t,o,[r]) ,l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,i)}function sE(t){return function(){var e=this,n=Array.from(arguments);return new Promise((function(a,i){var o=t.apply(e,n);function r(t){rE(o,a,i,r,s,"next",t)}function s(t){rE(o,a,i,r,s,"throw",t)}r(void 0)}))}}function lE(){return lE=Object.assign||function(t){for(var e=1;e<Array.from(arguments).length;e++){var n= __get$(Array.from(arguments),e) ;for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&( __set$(t,a,__get$(n,a)) )}return t},lE.apply(this,Array.from(arguments))}function cE(t,e){var n,a,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&( __set$(o,Symbol.iterator,function(){return this;}) ),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=2&o[0]?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,a=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&& __get$(i,i.length-1) )||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],a=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function dE(){var t=Hn(),e=t.conversation.stopConversation,n=t.conversation.retryGenerate,a=t.conversation.regenerate,i=t.conversation.fillerEmptyHeight;null==e||e.on((function(){var t=on.getState("rank");on.getState("withoutStopSseRanks").includes(t)||$l.stopGenerate()})),null==n||n.on((function(t){!function(t,e,n,a,i){$l.retry(t,e,n,a,i)}(t.qid,t.aid,t.requestType,t.sseExtraData,{})})),null==a||a.on((function(t){!function(t,e,n){$l.regenerate(t,e,n)}(t.qid,t.requestType,t.sseExtraData)})),null==i||i.on((function(t){!function(t){$l.fillerEmptyHeight(t)}(t)}))}function uE(t){return pE.apply(this,Array.from(arguments))}function pE(){return pE=sE((function(t){var e,n,a,i,o,r,s,l,c,d,u,p,h,f,g;return cE(this,(function(m){return"search"!==t.name?[2]:((i=t.params).imageExtInfo&&(i.query="[图片]"),o=on.getState("user"),r=$e({eventParams:i,user:o}),s=r.agentInfo,l=on.getState("chatParams").setype,Cs(s,i.agentSa),0===on.getState("rank")&&(r.firstRankQuery=Ps(r.query,r.agentInfo)),on.dispatch("update",lE({},r)),c=on.getState("chatPageInitialized"),d={query:r.query,extParams:lE({setype:l,imageQueryInfo:r.imageQueryInfo},r.shareId?{share_id:r.shareId}:{},i.interactionType?{interactionType:i.interactionType}:{},i.searchInfo?{searchInfo:i.searchInfo}:{}),showQAPair:!!c},u=null==r||null==(n=r.imageQueryInfo)||null==(e=n.imageExtInfo.params)?void 0:e.rank,"CHANGE_QUESTION"===(null==r||null==(a=r.imageQueryInfo)?void 0:a.imageExtInfo.actionType)?(Vn().emit({rank:u,rectIndex:(null==r||null==(h=r.imageQueryInfo)||null==(p=h.imageExtInfo)?void 0:p.rectIndex)||0,rectList:(null==r||null==(g=r.imageQueryInfo)||null==(f=g.imageExtInfo)?void 0:f.rectList)||[]}),[2]):(es(r.query),+r.isShowHello||Xl(d,!1,"SSE"),[2]))}))})),pE.apply(this,Array.from(arguments))}function hE(){return(hE=sE((function(){var t,e,n,a,i,o,r,s,l;return cE(this,(function(c){return t=on.getState("query"),e=on.getState("sa"),n=on.getState("shareId"),a=on.getState("chatParams").setype,i=+on.getState("isShowHello"),o=on.getState("oriLid"),t||i?(r=on.getState("chatPageInitialized"),s={query:t,extParams:lE({sa:e,setype:a},n?{share_id:n}:{}),showQAPair:!!r},(l=on.getState("agentInfo"))&&l.agentSearchId&&(on.dispatch("update",{agentRank:1,firstRankQuery:Ps(t,l)}),s.extParams.agt_rk=1),es({query:t,oriLid:o},!0),i||Xl(s,true),[2]):[2]}))}))).apply(this,Array.from(arguments))}"function"==typeof tE?tE.prototype.initData=iE:tE.initData=iE;var fE=!1;function gE(){window.chatSearchContainer||(window.chatSearchContainer={}), __call$(Object,"assign",[window.chatSearchContainer,{getEventInstance:Hn,launchSearch:function(t){var e=t.word,n=t.sa;n&&on.dispatch("update",{sa:n}),Xl({query:e});},getCurrentPageLogInfo:function(t){var e,n,a=t.closest(""+te),i=(null==a||null==(n=a.sandbox)||null==(e=n.window)?void 0:e.comm)||{};return{rank:i.chatRank,lid:i.lid,ori_lid:on.getState("oriLid")};}}]) ,window.chatSearchContainer.hasOwnProperty("currentRank")||Object.defineProperty(window.chatSearchContainer,"currentRank",{get:function(){return on.getState("rank")}}),window.chatSearchContainer.hasOwnProperty("sessionId")||Object.defineProperty(window.chatSearchContainer,"sessionId",{get:function(){return on.getState("oriLid")}}),fE||(Us().on(Ki(uE,200,{leading:!0,trailing:!1})),dE(),fE=!0),function(){hE.apply(this,Array.from(arguments))}(),oE()}var mE=Tt.connect(on,{showMindMap:"showMindMap",showWorkspaceType:"showWorkspaceType"})(a.defineComponent({components:{"chat-input-box":Qu,"back-to-generate":nD,"right-bar":cP,"workspace-stage":tE},computed:{hasRightBar:function(){var t=this.data.get("showMindMap"),e=this.data.get("showWorkspaceType"),n=this.data.get("agentsList");return t||e||!!n.length}},created:function(){Go("")},initData:function(){return{agentsList:[],isExtension:vt(),inKnowledge:Nr()}},attached:function(){!function(t){var e=t.containerDom,n=t.containerSanComponent,a=t.Question,o=t.ImageQuestion,r=t.FileQuestion,s=t.Answer,l=t.ChatQaContainer,c=t.Header,d=t.AgentGreeting,u=t.Guide,p=t.Footer,h=t.AnswerTips,f=t.ssehost,g=t.sseWshost,m=t.scrollMode,v=t.upwardMargin,y=t.KnowledgeHeader,w=on.getState("urlInfo")||{},b=lt()?w.conversationPath:Wt.conversation;$l= new i.ChatStream({upwardMargin:v,questionBubbles:{text:a,image:o,file:r},answerBubble:s,qaPairBubble:l,tipComponents:{dangerTip:kl,historyTips:Dl,guide:u,agentGreeting:d,answerTips:h},headerComponent:c,footerComponent:p,knowledgeHeader:y,containerDom:e,containerSanComponent:n,scrollMode:m,requestService:{dangerCheck:{host:(f||"https://chat.baidu.com")+"/aichat/api/checkquerydanger",paramsHandler:dc,failCallback:function(t){var e=t.QAInfo;ql(),on.dispatch("update",{rank:e.id}),zn().emit({word:_t(e.promptContent),invokeKeyboard:0,type:"query"});}},searchGenerate:{host:"/s",ssehost:pc((g||"https://chat.baidu.com")+b),paramsHandler:rc,degradeParamsHandler:cc,callbacks:{onMessageHandler:function(t){var e;if("baseData"===(null==(e=t.data)?void 0:e.type)){if(__get$(on.getState("imageQueryLid"),t.id))return;var n,a=on.getState("imageQueryLid");on.dispatch("update",{imageQueryLid:Wl((n={},__set$(n,t.id,t.data.lid),n),a)});}}}},history:{host:(f||"https://chat.baidu.com")+"/csaitab/history/list",callback:Ko,preprocessHistoryData:sr},delete:{host:(f||"https://chat.baidu.com")+"/csaitab/history/delete",callback:uc}}}) ,$l.init(),hc&&Gn().off(hc),hc=function(t){if(on.getState("rank")===t.rank&&"delete-rank-show-toast"===t.type){var e=on.getState("qaPairIdDiff"),n=t.rank-e;$l.deleteQAPair(n,{},!0),ql()}},Gn().on(hc)}({Question:rT,ImageQuestion:jT,FileQuestion:VT,Answer:nT,Header:HC,Guide:$h,Footer:oD,KnowledgeHeader:zL,AgentGreeting:eC,containerDom:this.ref("chat-stream"),containerSanComponent:this,ssehost:on.getState("chatParams").sse_host,sseWshost:on.getState("chatParams").sse_ws_host,scrollMode:"container",upwardMargin:0}),this.rightBarDisplayHandler(),gE(),this.sendPageShowLog()},sendPageShowLog:function(){this.data.get("inKnowledge")?this.trySendKnowledgeLog():this.sendMainPageShowLog()},startTime:Date.now(),hasSendKnowledgeLog:!1,trySendKnowledgeLog:function(){var t=this,e=ti.getState("knowledgeId"),n=ti.getState("knowledgeMsg."+e);n?this.sendKnowledgeLog(n):Ha().on((function(n){var a=n.updateType,i=n.knowledgeId;if("knowledge"===a&&(!i||i===e)){var o=ti.getState("knowledgeMsg."+e);o&&t.sendKnowledgeLog(o)}}))},sendKnowledgeLog:function(t){var e;this.hasSendKnowledgeLog||(this.hasSendKnowledgeLog=!0,Ua({type:"show",value:"zsk_home",ext:{open_type:JSON.parse(qt( new URL(__get$(__get$Loc(location),"href")) .searchParams).extParams||"{}").open_type||"",out_enter_type:on.getState("outEnterType"),zsk_id:t.id,zsk_name:t.title,file_num:(null==(e=t.fileList)?void 0:e.length)||0,file_list:(t.fileList||[]).map((function(t){return t.type})),storage:t.usedFileCapacity,global:t.instruction}}))},sendMainPageShowLog:function(){var t=on.getState("pcEnterType")||"ai_tab_url",e=on.getState("sa"),n=on.getState("apagelid"),a=on.getState("subEnterType"),i=on.getState("agentInfo");Ua({type:"display",value:"",ext:{sa:e||"",a_lid:n||"",agent_id:(null==i?void 0:i.agentId)||"",agent_name:(null==i?void 0:i.agentName)||"",enter_type:t,sub_ori_lid:"",sub_re_rank:"0",sub_enter_type:a||"",setype:"csaitab"}})},handleCapsuleShow:null,rightBarDisplayHandler:function(){var t=this;this.data.get("isExtension")||(this.watch("hasRightBar",(function(e){t.ref("right-bar-wrapper").style.setProperty("--right-bar-width-duration",e?".24s":".16s")})),this.handleCapsuleShow=function(e){var n=e.data,a=null==n?void 0:n.items;a&&t.data.set("agentsList",a)},ya().on(this.handleCapsuleShow))},disposed:function(){this.handleCapsuleShow&&ya().off(this.handleCapsuleShow),this.handleCapsuleShow=null,this.data.get("inKnowledge")&&this.sendKnowledgeDurationLog()},sendKnowledgeDurationLog:function(){var t=Date.now();Ua({ubcId:"17630",value:"zsk_home",ext:{starttime:this.startTime,endtime:t,duration:t-this.startTime,lid:on.getState("lid")}})}})),vE={};vE= __call$(Object,"assign",[vE,{chatContainerMainArea:"chat-container-main-area_xb11o_1","chat-container-main-area":"chat-container-main-area_xb11o_1",chatContainerMainStream:"chat-container-main-stream_xb11o_11","chat-container-main-stream":"chat-container-main-stream_xb11o_11",chatBottomWrapper:"chat-bottom-wrapper_xb11o_28","chat-bottom-wrapper":"chat-bottom-wrapper_xb11o_28",chatBottom:"chat-bottom_xb11o_28","chat-bottom":"chat-bottom_xb11o_28",rightBarWrapper:"right-bar-wrapper_xb11o_39","right-bar-wrapper":"right-bar-wrapper_xb11o_39",show:"show_xb11o_43",showWorkspace:"show-workspace_xb11o_47","show-workspace":"show-workspace_xb11o_47",hide:"hide_xb11o_50",easeInShow:"ease-in-show_xb11o_57","ease-in-show":"ease-in-show_xb11o_57",fadeIn:"fadeIn_xb11o_1",chatContainerPc:"chat-container-pc_xb11o_70","chat-container-pc":"chat-container-pc_xb11o_70",chatContainerMainWrapper:"chat-container-main-wrapper_xb11o_78","chat-container-main-wrapper":"chat-container-main-wrapper_xb11o_78",chatContainerMain:"chat-container-main_xb11o_1","chat-container-main":"chat-container-main_xb11o_1"}]) ,mE.template="\n    <div class=\"{{$style['chat-container-pc']}}\">\n        <div class=\"{{$style['chat-container-main-wrapper']}}\">\n            <div class=\"{{$style['chat-container-main']}}\">\n                \x3c!--- 对话区 --\x3e\n                <div\n                    class=\"{{$style['chat-container-main-area']}} chat-container-main-area\"\n                >\n                    \x3c!--- 对话流 --\x3e\n                    <div\n                        class=\"{{$style['chat-container-main-stream']}}\"\n                        s-ref=\"chat-stream\"\n                    ></div>\n                </div>\n            </div>\n            \x3c!--- 底部输入框 --\x3e\n            <div\n                s-ref=\"chat-bottom-wrapper\"\n                class=\"{{$style['chat-bottom-wrapper']}} {{hasRightBar ? $style['has-right-bar'] : ''}}\"\n            >\n                <div class=\"{{$style['chat-bottom']}}\">\n                    <chat-input-box />\n                    <back-to-generate />\n                </div>\n            </div>\n        </div>\n        \x3c!-- 灵感区 --\x3e\n        <div\n            s-if=\"!isExtension\"\n            s-ref=\"right-bar-wrapper\"\n            class=\"\n                {{$style['right-bar-wrapper']}}\n                {{hasRightBar ? 'right-bar-wrapper-live ' + $style['show'] : $style['hide']}}\n                {{showWorkspaceType ? $style['show-workspace'] : ''}}\n            \"\n        >\n            <div s-show=\"showWorkspaceType\" class=\"{{$style['ease-in-show']}}\">\n                <workspace-stage />\n            </div>\n            <div s-show=\"!showWorkspaceType\" class=\"{{$style['ease-in-show']}}\">\n                <right-bar agents-list=\"{{agentsList}}\" />\n            </div>\n        </div>\n    </div>\n";var yE,wE,bE="function"==typeof mE?mE.prototype.initData||_E:mE.initData||_E;function _E(){return{$style:vE}}function kE(){return  __call$(Object,"assign",[{},bE.call(this),{$style:vE}]) }"function"==typeof mE?mE.prototype.initData=kE:mE.initData=kE,function(t){t.OPEN_NEW_AGENT_CONVERSATION="openNewAgentConversation",t.JUMP_TO_TARGET_URL="jumpToTargetUrl"}(yE||(yE={})),function(t){t.LOADED="loaded"}(wE||(wE={}));var SE=function(){function t(t){var e=t.iframeId,n=t.fatherCb;this.iframeId=e,this.fatherCb=n,this.watchIframeStatus()}var e=t.prototype;return e.initMessagePipe=function(){this.channel=new MessageChannel,this.fatherPipe=this.channel.port1,this.childPipe=this.channel.port2,this.fatherPipe.onmessage=this.fatherCb},e.watchIframeStatus=function(){var t=this;window.addEventListener("message",(function(e){var n=(null==e?void 0:e.data)||{},a=n.iframeStatus;if(n.messageName,"loaded"===a)t.sendchildPipe()}))},e.sendchildPipe=function(){try{var t,e=document.getElementById(this.iframeId);this.initMessagePipe(),null==e||null==(t=e.contentWindow)|| __call$(t,"postMessage",["父亲页面消息: 将childPipe传递给子页面","*",[this.childPipe]]) }catch(t){}},t.sendIframeLoadStatus=function(t,e){ __call$(parent.window,"postMessage",[{messageName:t,iframeStatus:e},"*"]) },t}();function xE(t,e){return xE=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},xE(t,e)}var IE=function(t){function e(){return t.apply(this,Array.from(arguments))}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xE(t,e)}(e,t);var n=e.prototype;return n.created=function(){var t,e= new URLSearchParams(__get$(window,"location").search) ,n=e.get("appSquare")||"",a=e.get("tabName")||"";try{t=JSON.parse(decodeURIComponent(n))}catch(e){t={}}this.data.set("appSquare",t),this.data.set("tabName",a)},n.initData=function(){return{appSquare:{pcSquareUrl:""},tabName:"",iframeId:"chat-square-iframe"}},n.attached=function(){this.handleIframeMessage()},n.handleIframeMessage=function(){var t=this,e=this.data.get("iframeId");this.messagePipe=new SE({iframeId:e,fatherCb:function(e){var n=e.data,a=n.name,i=n.data;if(a)switch(a){case yE.OPEN_NEW_AGENT_CONVERSATION:t.openNewAgentPage(i);break;case yE.JUMP_TO_TARGET_URL:t.jumpToTargetUrl(i)}}})},n.jumpToTargetUrl=function(t){var e=t.targetUrl;window.open(e,"_blank")},n.openNewAgentPage=function(t){ma().emit(t)},e}(a.Component);IE.template='\n        <div class="chat-square-page-container">\n            <iframe\n                s-if="iframeUrl"\n                id="{{iframeId}}"\n                src="{{iframeUrl}}"\n                class="chat-square-iframe"\n            >\n            </iframe>\n        </div>\n    ',IE.computed={iframeUrl:function(){var t=this.data.get("appSquare"),e=this.data.get("tabName"),n=t.pcSquareUrl;if(e){var a=new URL(n),i=new URLSearchParams(a.search);i.set("tabName",e),a.search=i.toString(),n=a.toString()}return n}};var TE=[{rule:_e.CHAT.path,target:Kt,handler:function(t){li({event:t,Component:mE})}},{rule:_e.HISTORY.path,Component:OL,target:Kt},{rule:_e.SQUARE.path,Component:IE,target:Kt},{rule:_e.KNOWLEDGE.path,target:Kt,handler:function(t){li({event:t,Component:mE,componentType:"knowledge"})}}],CE=Tt.connect(on,{topRank:"topRank",showMindMap:"showMindMap",showWorkspaceType:"showWorkspaceType"})(a.defineComponent({components:{"chat-top-bar":ld,"chat-aside":rd},initData:function(){return{userInfo:on.getState("user"),curAgentIndex:"main",isFindAgentIframe:!1,isShowIframe:!0,iframeId:"agent-iframe"}},attached:function(){this.initRouter()},initRouter:function(){Dn.router.add(TE),Dn.router.setMode("html5"),Dn.router.start()},handleLogin:function(){hs()}})),LE={};LE= __call$(Object,"assign",[LE,{chatContainerBody:"chat-container-body_10t99_1","chat-container-body":"chat-container-body_10t99_1",chatContainerWrapper:"chat-container-wrapper_10t99_4","chat-container-wrapper":"chat-container-wrapper_10t99_4",chatContainer:"chat-container_10t99_1","chat-container":"chat-container_10t99_1",findAgentIframeLayout:"find-agent-iframe-layout_10t99_16","find-agent-iframe-layout":"find-agent-iframe-layout_10t99_16",chatContainerAside:"chat-container-aside_10t99_29","chat-container-aside":"chat-container-aside_10t99_29",chatContainerMain:"chat-container-main_10t99_58","chat-container-main":"chat-container-main_10t99_58",chatContainerAgent:"chat-container-agent_10t99_68","chat-container-agent":"chat-container-agent_10t99_68",findAgentIframe:"find-agent-iframe_10t99_16","find-agent-iframe":"find-agent-iframe_10t99_16",chatBackground:"chat-background_10t99_92","chat-background":"chat-background_10t99_92",fullWidth:"full-width_10t99_95","full-width":"full-width_10t99_95"}]) ,CE.template="\n    <div class=\"\n        {{$style['chat-container']}}\n        {{currentAgent && !isFindAgentIframe ? $style['chat-background'] : ''}}\n    \">\n        \x3c!--- 顶部 --\x3e\n        <chat-top-bar\n            on-login=\"handleLogin\"\n        />\n\n        \x3c!--- 主体 --\x3e\n        <div class=\"{{$style['chat-container-body']}}\">\n            \x3c!--- 左侧导航菜单，固定 --\x3e\n            <chat-aside />\n            \x3c!--- 主内容 --\x3e\n            <div id=\"chat-container-main\" class=\"{{$style['chat-container-wrapper']}} {{showWorkspaceType === 'editor' ? $style['full-width'] : ''}}\">\n            </div>\n        </div>\n    </div>\n";var DE="function"==typeof CE?CE.prototype.initData||PE:CE.initData||PE;function PE(){return{$style:LE}}function EE(){return  __call$(Object,"assign",[{},DE.call(this),{$style:LE}]) }"function"==typeof CE?CE.prototype.initData=EE:CE.initData=EE;var AE=0;document.addEventListener("mousedown",(function(){AE=(new Date).getTime()})),document.addEventListener("mouseup",(function(t){var e=(new Date).getTime()-AE,n=t.clientX,a=t.clientY;on.dispatch("update",{pcClickInfo:{clickTimeDiff:e,clientX:n,clientY:a}})})),window.sc.getESLInstance().addEslConfig({paths:{"js/cosmic.pc.lsZm6d5C":"//ms.bdstatic.com/se/chat-search/static/js/cosmic.pc.lsZm6d5C","js/cosmic-agent-ui.pc.Dxc4Elaq":"//ms.bdstatic.com/se/chat-search/static/js/cosmic-agent-ui.pc.Dxc4Elaq","js/search-components.pc.BE62d8-q":"//ms.bdstatic.com/se/chat-search/static/js/search-components.pc.BE62d8-q","js/share-img-utils.pc.KeJdRRYE":"//ms.bdstatic.com/se/chat-search/static/js/share-img-utils.pc.KeJdRRYE","js/bootstrap.pc.IMX_qn6-":"//ms.bdstatic.com/se/chat-search/static/js/bootstrap.pc.IMX_qn6-","js/baidubce-sdk.bundle.min.pc.DiNU-FrE":"//ms.bdstatic.com/se/chat-search/static/js/baidubce-sdk.bundle.min.pc.DiNU-FrE","js/echarts.pc.D2eWkmUa":"//ms.bdstatic.com/se/chat-search/static/js/echarts.pc.D2eWkmUa","js/artplayer.pc.HVd1QnTR":"//ms.bdstatic.com/se/chat-search/static/js/artplayer.pc.HVd1QnTR","js/jsencrypt.min.pc.CIS6xxmc":"//ms.bdstatic.com/se/chat-search/static/js/jsencrypt.min.pc.CIS6xxmc","js/index.pc.DihnYmlG":"//ms.bdstatic.com/se/chat-search/static/js/index.pc.DihnYmlG","js/qeditor.pc.N-rbs8Tu":"//ms.bdstatic.com/se/chat-search/static/js/qeditor.pc.N-rbs8Tu","js/client.esm.pc.CgpQ51lf":"//ms.bdstatic.com/se/chat-search/static/js/client.esm.pc.CgpQ51lf","js/crypto.pc.DP5BwNok":"//ms.bdstatic.com/se/chat-search/static/js/crypto.pc.DP5BwNok","js/cosmic":"//ms.bdstatic.com/se/chat-search/static/js/cosmic.pc.lsZm6d5C"}}),on.dispatch("update",{bootstrapStart:(new Date).getTime()});var OE,RE=document.getElementById("app");(new CE).attach(document.getElementById("app")),OE=+Date.now(),Jn().on((function(){var t=+Date.now();Ga(OE,t),OE=+Date.now()})),document.addEventListener("visibilitychange",(function(){if("hidden"===document.visibilityState){var t=+Date.now();Ga(OE,t),OE=0}else"visible"===document.visibilityState&&(OE=Date.now())})),window.addEventListener("beforeunload",(function(){var t=+Date.now();OE&&Ga(OE,t)})),ep||(ep=!0,document.body.addEventListener("click",sp));var NE,ME,qE;RE.setAttribute("data-click-log",JSON.stringify({tcreq4log:1,t:"zbios",vit:"osres",l:"1",fm:"beha",clk_type:1,clk_info:{pd:"csaitab",tab_se:"1"},extra:{ctse_id:"",setype:"csaitab",scene:""}})),NE="aitab-chat-search",ME=wn("body"),qE=Array.isArray(NE)?NE:[NE],ME.forEach((function(t){var e;(e=t.classList).add.apply(e,[].concat(qE))})),po(),new yn})),require(["js/bootstrap.pc.IMX_qn6-"]);

/*hammerhead|script|end*/