/*hammerhead|script|start*/if (typeof window !== 'undefined' && window){window['hammerhead|process-dom-method'] && window['hammerhead|process-dom-method']();if (window.__get$ && typeof __get$ === 'undefined')var __get$Loc = window.__get$Loc,__set$Loc = window.__set$Loc,__set$ = window.__set$,__get$ = window.__get$,__call$ = window.__call$,__get$Eval = window.__get$Eval,__proc$Script = window.__proc$Script,__proc$Html = window.__proc$Html,__get$PostMessage = window.__get$PostMessage,__get$ProxyUrl = window.__get$ProxyUrl,__rest$Array = window.__rest$Array,__rest$Object = window.__rest$Object,__arrayFrom$ = window.__arrayFrom$;} else {if (typeof __get$ === 'undefined')var __get$Loc = function(l){return l},__set$Loc = function(l,v){return l = v},__set$ = function(o,p,v){return o[p] = v},__get$ = function(o,p){return o[p]},__call$ = function(o,p,a){return o[p].apply(o,a)},__get$Eval = function(e){return e},__proc$Script = function(s){return s},__proc$Html = function(h){return h},__get$PostMessage = function(w,p){return arguments.length===1?w.postMessage:p},__get$ProxyUrl = function(u,d){return u},__rest$Array = function(a,i){return Array.prototype.slice.call(a, i)},__rest$Object = function(o,p){var k=Object.keys(o),n={};for(var i=0;i<k.length;++i)if(p.indexOf(k[i])<0)n[k[i]]=o[k[i]];return n},__arrayFrom$ = function(r){if(!r)return r;return!Array.isArray(r)&&"function"==typeof r[Symbol.iterator]?Array.from(r):r};if (typeof importScripts !== "undefined" && /\[native code]/g.test(importScripts.toString())) {var __getWorkerSettings$ = function () {return null};importScripts((location.origin || (location.protocol + "//" + location.host)) + "/worker-hammerhead.js");}}/*hammerhead|script|processing-header-end*/
define("superman/components/placeholder",["require","exports","superman/lib/event","superman/lib/commonUtils","superman/lib/extract_data"],function(require,_exports,_event,_commonUtils,_extract_data){"use strict";Object.defineProperty(_exports,"__esModule",{value:true});_exports.PlaceHolder=void 0;function _createForOfIteratorHelper(o){if(typeof Symbol==="undefined"|| __get$(o,Symbol.iterator) ==null){if(Array.isArray(o)||(o=_unsupportedIterableToArray(o))){var i=0;var F=function F(){};return{s:F,
n:function n(){if(i>=o.length)return{done:true};return{done:false,value: __get$(o,i++) }},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var it,normalCompletion=true,didErr=false,err;return{s:function s(){it= __call$(o,Symbol.iterator,[]) },n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(
!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(
len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){ __set$(arr2,i,__get$(arr,i)) }return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor= __get$(props,i) ;descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true
;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{ __set$(obj,key,value) }return obj}var PlaceHolder=function(){function PlaceHolder(){
_classCallCheck(this,PlaceHolder);_defineProperty(this,"inputPlaceholder",void 0);_defineProperty(this,"placeholderUl",void 0);_defineProperty(this,"signNum",void 0);_defineProperty(this,"carouselTop",void 0);_defineProperty(this,"bigTop",void 0);_defineProperty(this,"loopNum",void 0);_defineProperty(this,"timer",void 0);_defineProperty(this,"placeholder",void 0);_defineProperty(this,"firstInPage",void 0);this.inputPlaceholder=$(".placeholder");this.placeholderUl=$(".placeholder-ul")
;this.signNum=0;this.carouselTop=0;this.bigTop=0;this.loopNum=0;this.timer=0;F.addLog("superman:placeholder",["show","click"]);this.placeholder="";this.firstInPage=true}_createClass(PlaceHolder,[{key:"changePlaceholder",value:function changePlaceholder(data){var placeholderUl=this.placeholderUl;data=data||JSON.parse((0,_commonUtils.getStorage)("placeholderList")||"{}");var placeholderList=data&&data.box||[];var isCarousel=data&&data.need_carousels;var str=""
;var _iterator=_createForOfIteratorHelper(placeholderList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;var showText=item.show_text;if(showText.length>24){showText=showText.substring(0,23)+"..."}str+="<li>\n                ".concat(showText," \n            </li>")}}catch(err){_iterator.e(err)}finally{_iterator.f()}placeholderUl===null||placeholderUl===void 0?void 0:placeholderUl.html(str);this.signNum=0;(0,_commonUtils.setStorage)("signNum",JSON.stringify(
this.signNum));this.bigTop=-20*(placeholderList.length-1);this.carousel(isCarousel)}},{key:"carousel",value:function carousel(isCarousel){var _this=this;if(!isCarousel){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(function(){var placeholderUl=_this.placeholderUl;if(_this.carouselTop===_this.bigTop){if(_this.loopNum===2){_this.updatePlaceholder();_this.loopNum=0}else{_this.upDataUl();_this.changePlaceholder();_this.loopNum++}}else{_this.carouselTop-=20
;placeholderUl===null||placeholderUl===void 0?void 0:placeholderUl.css("top",_this.carouselTop+"px");_this.signNum++;(0,_commonUtils.setStorage)("signNum",JSON.stringify(_this.signNum));_this.carousel(true)}},6500)}},{key:"upDataUl",value:function upDataUl(){var inputPlaceholder=this.inputPlaceholder;inputPlaceholder===null||inputPlaceholder===void 0?void 0:inputPlaceholder.html('<ul class="placeholder-ul"></ul>');this.placeholderUl=$(".placeholder-ul");this.carouselTop=0}},{
key:"filterPlaceholder",value:function filterPlaceholder(data){var _JSON$parse$box;var placeholderList;var signNum=JSON.parse((0,_commonUtils.getStorage)("signNum")||"0")+1;if((0,_commonUtils.getStorage)("placeholderList")){placeholderList=(0,_commonUtils.getStorage)("placeholderList")}var oldData=placeholderList&&((_JSON$parse$box=JSON.parse(placeholderList).box)===null||_JSON$parse$box===void 0?void 0:_JSON$parse$box.slice(0,signNum));if(!oldData){return data}var idxs=[]
;var _iterator2=_createForOfIteratorHelper(oldData),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var item=_step2.value;idxs.push(item.text)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var newData=[];var repeatData=[];var _iterator3=_createForOfIteratorHelper(data),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _item=_step3.value;if(idxs.indexOf(_item.text)===-1){newData.push(_item)}else{repeatData.push(_item)}}}catch(err){_iterator3.e(err)}finally{
_iterator3.f()}return newData.concat(repeatData)}},{key:"updatePlaceholder",value:function updatePlaceholder(){var _this2=this;var bsToken=$("#bsToken")&&$("#bsToken").val()||"";$.ajax({url:"/home/async/boxrec?bsToken="+bsToken,type:"GET",data:"",headers:{"Content-Type":"application/json"},traditional:true,success:function success(data){if(!data){return}data=data.data;data.box=data&&data.box&&_this2.filterPlaceholder(data.box);(0,_commonUtils.setStorage)("placeholderList",JSON.stringify(data))
;_this2.upDataUl();_this2.changePlaceholder(data)}})}},{key:"clearPlaceholder",value:function clearPlaceholder(){var inputPlaceholder=this.inputPlaceholder;var bdsugDisplay=$(".bdsug").css("display");if(bdsugDisplay==="block"){if(this.timer){clearTimeout(this.timer)}inputPlaceholder===null||inputPlaceholder===void 0?void 0:inputPlaceholder.remove()}}},{key:"getPlaceholderData",value:function getPlaceholderData(){return new Promise(function(resolve,reject){var bsToken=$("#bsToken")&&$("#bsToken"
).val()||"";$.ajax({url:"/home/async/boxrec?bsToken="+bsToken,type:"GET",data:"",headers:{"Content-Type":"application/json"},traditional:true,success:function success(data){if(!data||!data.data||!data.data.box){reject([]);return}var placeholderList=[];var _iterator4=_createForOfIteratorHelper(data.data.box),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var item=_step4.value;placeholderList.push({text:item.show_text,sa:item.sa})}}catch(err){_iterator4.e(err)}finally{_iterator4.f()
}resolve(placeholderList)}})})}},{key:"leachData",value:function leachData(newData,hotData,usedList){if(usedList&&usedList.length>5){usedList=usedList.slice(-5)}var repeatArr=hotData;if(usedList){repeatArr=repeatArr.concat(usedList)}var data=[];var _iterator5=_createForOfIteratorHelper(newData),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var item=_step5.value;if(!repeatArr.includes(item.text)){data.push(item)}}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}
var expireTime=(new Date).getTime()+6e4;var placeholder=data[0].text;usedList=[placeholder];(0,_commonUtils.setStorage)("placeholderData",JSON.stringify({expireTime:expireTime,list:data,usedList:usedList}));this.setPlaceholder(placeholder)}},{key:"setPlaceholder",value:function setPlaceholder(placeholder){this.placeholder=placeholder;var placeholderData;try{placeholderData=(0,_commonUtils.getStorage)("placeholderData")?JSON.parse((0,_commonUtils.getStorage)("placeholderData")||""):{}}catch(e){}
var str_sa="";if(placeholderData&&placeholderData.list&&placeholderData.list.length>0){var _iterator6=_createForOfIteratorHelper(placeholderData.list),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var item=_step6.value;if(item.text===placeholder){str_sa=item.sa;break}}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}F.ubc&&F.ubc.sendShowLog("kuang_rec",{query:placeholder,str_sa:str_sa});bds.comm.kuangRec={query:placeholder,sa:"ikrec_"+str_sa}
;var inputUpgrade=bds.comm.inputUpgrade;if(inputUpgrade){var $newIpt=$("#main-ipt");var $placeholder=$("<div>").attr("id","new-ipt-placeholder").addClass("placeholder").text(placeholder);$placeholder.appendTo($newIpt)}var input=document.getElementById("kw");if(input){input.placeholder=placeholder}}},{key:"isShowBoxRec",value:function isShowBoxRec(){var _extractData=(0,_extract_data.extractData)("placeholder-data"),boxRecSwitch=_extractData.boxRecSwitch;var pcMainBoxRec=UPS.get("pcMainBoxRec")+""
;if(boxRecSwitch==="1"&&pcMainBoxRec==="1"){return true}return false}},{key:"init",value:function init(){var _this3=this;var nodeSample=bds&&bds.comm&&bds.comm.nodeSample||[];var boxRec=nodeSample.indexOf("need_carousels")>-1||nodeSample.indexOf("no_need_carousels")>-1;if(this.isShowBoxRec()){var placeholder="";var placeholderData;try{placeholderData=(0,_commonUtils.getStorage)("placeholderData")?JSON.parse((0,_commonUtils.getStorage)("placeholderData")||""):{}}catch(e){}if(!placeholderData){
return}var _placeholderData=placeholderData,expireTime=_placeholderData.expireTime,list=_placeholderData.list,usedList=_placeholderData.usedList;if(expireTime&&(new Date).getTime()<expireTime){if(list&&list.length>0){var _iterator7=_createForOfIteratorHelper(list),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var item=_step7.value;if(usedList.indexOf(item.text)===-1){placeholder=item.text;usedList.push(placeholder);break}}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}}if(
placeholder===""&&usedList&&usedList.length>0){placeholder=usedList[0];usedList.push(placeholder);usedList.shift()}this.setPlaceholder(placeholder);(0,_commonUtils.setStorage)("placeholderData",JSON.stringify({expireTime:expireTime,list:list,usedList:usedList}))}else{var _extractData2=(0,_extract_data.extractData)("placeholder-data"),boxRecData=_extractData2.boxRecData,hotData=_extractData2.hotData;var hotDataList=[];if(hotData&&hotData[0]&&hotData[0].banner){
var _iterator8=_createForOfIteratorHelper(hotData[0].banner),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var _item2=_step8.value;hotDataList.push(_item2.card_title)}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}}var placeholderList=[];if(!window.s_session.isLogin){if(boxRecData&&boxRecData.box){var _iterator9=_createForOfIteratorHelper(boxRecData.box),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var _item3=_step9.value;placeholderList.push({
text:_item3.show_text,sa:_item3.sa})}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}this.leachData(placeholderList,hotDataList,usedList)}}else{this.getPlaceholderData().then(function(data){_this3.leachData(data,hotDataList,usedList)})}}}if(boxRec){(0,_event.fire)("superman:placeholder","show",{clickType:"show"});this.updatePlaceholder();var inputPlaceholder=this.inputPlaceholder;var input=document.getElementById("kw");input===null||input===void 0?void 0:input.addEventListener("input",
function(){inputPlaceholder===null||inputPlaceholder===void 0?void 0:inputPlaceholder.css("display","none")});input===null||input===void 0?void 0:input.addEventListener("click",function(){if(_this3.timer){clearTimeout(_this3.timer)}});input===null||input===void 0?void 0:input.addEventListener("blur",function(){if(!(0,_commonUtils.getStorage)("placeholderList")){return}var data=JSON.parse((0,_commonUtils.getStorage)("placeholderList")||"{}");var isCarousel=data.need_carousels;_this3.carousel(
isCarousel)});input===null||input===void 0?void 0:input.addEventListener("keydown",function(event){if(event.keyCode===38||event.keyCode===40){_this3.clearPlaceholder()}})}}},{key:"destroy",value:function destroy(){if(this.timer){clearTimeout(this.timer)}}}]);return PlaceHolder}();_exports.PlaceHolder=PlaceHolder});
/*hammerhead|script|end*/